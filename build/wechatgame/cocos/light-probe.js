System.register(["./index-C5lmLqDW.js","./gc-object-CKHc4SnS.js","./global-exports-CR3GRnjt.js","./node-event-DTNosVQv.js","./component-BaGvu7EF.js"],(function(t){"use strict";var e,r,s,i,n,o,h,a,u,c,v,x,p,d,f,b,y,l;return{setters:[function(t){e=t.b,r=t.L,s=t.a,i=t.N,n=t.c,o=t.s,h=t.e,a=t.t,u=t.d},function(t){c=t.E,v=t.l,x=t.a,p=t._,d=t.b,f=t.m},function(t){b=t.c},function(t){y=t.N},function(t){l=t.C}],execute:function(){var _,g,P,m,z,w,O,I,M,A,S,C,T,k,q,L,D,B,E,X,U,R,V,N,j,Z,F,Y,G,W,H,Q,J,K,$=t("PlaceMethod",c({UNIFORM:0,ADAPTIVE:1})),tt=t("AutoPlacement",function(){function t(){}return t.generate=function(t){switch(t.method){case $.UNIFORM:return this.doGenerateUniform(t);case $.ADAPTIVE:return this.doGenerateAdaptive(t);default:return[]}},t.doGenerateUniform=function(t){if(t.nProbesX<2||t.nProbesY<2||t.nProbesZ<2)return[];for(var r=[],s=new e(0,0,0),i=new e((t.maxPos.x-t.minPos.x)/(t.nProbesX-1),(t.maxPos.y-t.minPos.y)/(t.nProbesY-1),(t.maxPos.z-t.minPos.z)/(t.nProbesZ-1)),n=0;n<t.nProbesX;n++){s.x=n*i.x+t.minPos.x;for(var o=0;o<t.nProbesY;o++){s.y=o*i.y+t.minPos.y;for(var h=0;h<t.nProbesZ;h++)s.z=h*i.z+t.minPos.z,r.push(new e(s))}}return r},t.doGenerateAdaptive=function(t){return this.doGenerateUniform(t)},t}()),et=n,rt=o,st=new r,it=new e(0,0,0),nt=new e(0,0,0),ot=new e(0,0,0),ht=new e(0,0,0),at=new e(0,0,0),ut=new e(0,0,0),ct=new e(0,0,0),vt=t("Vertex",et("cc.Vertex")((g=function(t){this.position=P&&P(),this.normal=m&&m(),this.coefficients=z&&z(),this.position.set(t)},P=s(g.prototype,"position",[rt],(function(){return new e(0,0,0)})),m=s(g.prototype,"normal",[rt],(function(){return new e(0,0,0)})),z=s(g.prototype,"coefficients",[rt],(function(){return[]})),_=g))||_),xt=(w=function(){function t(t,e,r,s){this.tetrahedron=O&&O(),this.index=I&&I(),this.vertex0=M&&M(),this.vertex1=A&&A(),this.tetrahedron=t,this.index=e,r<s?(this.vertex0=r,this.vertex1=s):(this.vertex0=s,this.vertex1=r)}var e=t.prototype;return e.set=function(t,e,r,s){this.tetrahedron=t,this.index=e,r<s?(this.vertex0=r,this.vertex1=s):(this.vertex0=s,this.vertex1=r)},e.isSame=function(t){return this.vertex0===t.vertex0&&this.vertex1===t.vertex1},t}(),O=s(w.prototype,"tetrahedron",[rt],(function(){return-1})),I=s(w.prototype,"index",[rt],(function(){return-1})),M=s(w.prototype,"vertex0",[rt],(function(){return-1})),A=s(w.prototype,"vertex1",[rt],(function(){return-1})),w),pt=(S=function(){function t(t,e,r,s,i,n){this.invalid=C&&C(),this.isOuterFace=T&&T(),this.tetrahedron=k&&k(),this.index=q&&q(),this.vertex0=L&&L(),this.vertex1=D&&D(),this.vertex2=B&&B(),this.vertex3=E&&E(),this.tetrahedron=t,this.index=e,this.vertex3=n,r<s&&r<i?(this.vertex0=r,s<i?(this.vertex1=s,this.vertex2=i):(this.vertex1=i,this.vertex2=s)):s<r&&s<i?(this.vertex0=s,r<i?(this.vertex1=r,this.vertex2=i):(this.vertex1=i,this.vertex2=r)):(this.vertex0=i,r<s?(this.vertex1=r,this.vertex2=s):(this.vertex1=s,this.vertex2=r))}var e=t.prototype;return e.set=function(t,e,r,s,i,n){this.invalid=!1,this.isOuterFace=!0,this.tetrahedron=t,this.index=e,this.vertex3=n,r<s&&r<i?(this.vertex0=r,s<i?(this.vertex1=s,this.vertex2=i):(this.vertex1=i,this.vertex2=s)):s<r&&s<i?(this.vertex0=s,r<i?(this.vertex1=r,this.vertex2=i):(this.vertex1=i,this.vertex2=r)):(this.vertex0=i,r<s?(this.vertex1=r,this.vertex2=s):(this.vertex1=s,this.vertex2=r))},e.isSame=function(t){return this.vertex0===t.vertex0&&this.vertex1===t.vertex1&&this.vertex2===t.vertex2},t}(),C=s(S.prototype,"invalid",[rt],(function(){return!1})),T=s(S.prototype,"isOuterFace",[rt],(function(){return!0})),k=s(S.prototype,"tetrahedron",[rt],(function(){return-1})),q=s(S.prototype,"index",[rt],(function(){return-1})),L=s(S.prototype,"vertex0",[rt],(function(){return-1})),D=s(S.prototype,"vertex1",[rt],(function(){return-1})),B=s(S.prototype,"vertex2",[rt],(function(){return-1})),E=s(S.prototype,"vertex3",[rt],(function(){return-1})),S),dt=t("CircumSphere",et("cc.CircumSphere")((U=function(){function t(){this.center=R&&R(),this.radiusSquared=V&&V()}return t.prototype.init=function(t,r,s,i){st.set(r.x-t.x,r.y-t.y,r.z-t.z,s.x-t.x,s.y-t.y,s.z-t.z,i.x-t.x,i.y-t.y,i.z-t.z),st.invert(),st.transpose(),it.set(.5*((r.x+t.x)*(r.x-t.x)+(r.y+t.y)*(r.y-t.y)+(r.z+t.z)*(r.z-t.z)),.5*((s.x+t.x)*(s.x-t.x)+(s.y+t.y)*(s.y-t.y)+(s.z+t.z)*(s.z-t.z)),.5*((i.x+t.x)*(i.x-t.x)+(i.y+t.y)*(i.y-t.y)+(i.z+t.z)*(i.z-t.z))),e.transformMat3(this.center,it,st),this.radiusSquared=e.squaredDistance(t,this.center)},t}(),R=s(U.prototype,"center",[rt],(function(){return new e(0,0,0)})),V=s(U.prototype,"radiusSquared",[rt],(function(){return 0})),X=U))||X),ft=t("Tetrahedron",et("cc.Tetrahedron")((j=function(){function t(t,e,r,s,i){if(void 0===i&&(i=-1),this.invalid=Z&&Z(),this.vertex0=F&&F(),this.vertex1=Y&&Y(),this.vertex2=G&&G(),this.vertex3=W&&W(),this.neighbours=H&&H(),this.matrix=Q&&Q(),this.offset=J&&J(),this.sphere=K&&K(),this.vertex0=e,this.vertex1=r,this.vertex2=s,this.vertex3=i,i>=0){var n=t._probes,o=n[this.vertex0].position,h=n[this.vertex1].position,a=n[this.vertex2].position,u=n[this.vertex3].position;this.sphere.init(o,h,a,u)}}var r=t.prototype;return r.isInCircumSphere=function(t){return e.squaredDistance(t,this.sphere.center)<this.sphere.radiusSquared-i},r.contain=function(t){return this.vertex0===t||this.vertex1===t||this.vertex2===t||this.vertex3===t},r.isInnerTetrahedron=function(){return this.vertex3>=0},r.isOuterCell=function(){return this.vertex3<0},t}(),Z=s(j.prototype,"invalid",[rt],(function(){return!1})),F=s(j.prototype,"vertex0",[rt],(function(){return-1})),Y=s(j.prototype,"vertex1",[rt],(function(){return-1})),G=s(j.prototype,"vertex2",[rt],(function(){return-1})),W=s(j.prototype,"vertex3",[rt],(function(){return-1})),H=s(j.prototype,"neighbours",[rt],(function(){return[-1,-1,-1,-1]})),Q=s(j.prototype,"matrix",[rt],(function(){return new r})),J=s(j.prototype,"offset",[rt],(function(){return new e(0,0,0)})),K=s(j.prototype,"sphere",[rt],(function(){return new dt})),N=j))||N),bt=t("Delaunay",function(){function t(t){this._probes=[],this._tetrahedrons=[],this._triangles=[],this._edges=[],this._probes=t}var r=t.prototype;return r.build=function(){return this.reset(),this.tetrahedralize(),this.computeAdjacency(),this.computeMatrices(),this._tetrahedrons},r.reset=function(){this._tetrahedrons.length=0,this._triangles.length=0,this._edges.length=0},r.tetrahedralize=function(){for(var t=this._probes.length,e=this.initTetrahedron(),r=0;r<t;r++)this.addProbe(r);this._tetrahedrons=this._tetrahedrons.filter((function(e){var r=t;return!(e.contain(r)||e.contain(r+1)||e.contain(r+2)||e.contain(r+3))})),this._probes.length=t,this.reorder(e)},r.initTetrahedron=function(){for(var t=new e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new e(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),s=0;s<this._probes.length;s++){var i=this._probes[s].position;t.x=Math.min(t.x,i.x),r.x=Math.max(r.x,i.x),t.y=Math.min(t.y,i.y),r.y=Math.max(r.y,i.y),t.z=Math.min(t.z,i.z),r.z=Math.max(r.z,i.z)}var n=new e(0,0,0);e.add(n,t,r),e.multiplyScalar(n,n,.5);var o=new e(0,0,0);e.subtract(o,r,t);var h=10*Math.max(o.x,o.y,o.z),a=new e(n.x,n.y+h,n.z),u=new e(n.x-h,n.y-h,n.z-h),c=new e(n.x-h,n.y-h,n.z+h),v=new e(n.x+h,n.y-h,n.z),x=this._probes.length;return this._probes.push(new vt(a)),this._probes.push(new vt(u)),this._probes.push(new vt(c)),this._probes.push(new vt(v)),this._tetrahedrons.push(new ft(this,x,x+1,x+2,x+3)),n},r.addTriangle=function(t,e,r,s,i,n,o){t<this._triangles.length?this._triangles[t].set(e,r,s,i,n,o):this._triangles.push(new pt(e,r,s,i,n,o))},r.addEdge=function(t,e,r,s,i){t<this._edges.length?this._edges[t].set(e,r,s,i):this._edges.push(new xt(e,r,s,i))},r.addProbe=function(t){for(var e=this._probes[t].position,r=0,s=0;s<this._tetrahedrons.length;s++){var i=this._tetrahedrons[s];i.isInCircumSphere(e)&&(i.invalid=!0,this.addTriangle(r,s,0,i.vertex1,i.vertex3,i.vertex2,i.vertex0),this.addTriangle(r+1,s,1,i.vertex0,i.vertex2,i.vertex3,i.vertex1),this.addTriangle(r+2,s,2,i.vertex0,i.vertex3,i.vertex1,i.vertex2),this.addTriangle(r+3,s,3,i.vertex0,i.vertex1,i.vertex2,i.vertex3),r+=4)}for(var n=0;n<r;n++)if(!this._triangles[n].invalid)for(var o=n+1;o<r;o++)if(this._triangles[n].isSame(this._triangles[o])){this._triangles[n].invalid=!0,this._triangles[o].invalid=!0;break}this._tetrahedrons=this._tetrahedrons.filter((function(t){return!t.invalid}));for(var h=0;h<r;h++){var a=this._triangles[h];a.invalid||this._tetrahedrons.push(new ft(this,a.vertex0,a.vertex1,a.vertex2,t))}},r.reorder=function(t){this._tetrahedrons.sort((function(r,s){return e.squaredDistance(r.sphere.center,t)-e.squaredDistance(s.sphere.center,t)}))},r.computeAdjacency=function(){for(var t=new e(0,0,0),r=new e(0,0,0),s=new e(0,0,0),i=new e(0,0,0),n=this._tetrahedrons.length,o=0,h=0;h<this._tetrahedrons.length;h++){var a=this._tetrahedrons[h];this.addTriangle(o,h,0,a.vertex1,a.vertex3,a.vertex2,a.vertex0),this.addTriangle(o+1,h,1,a.vertex0,a.vertex2,a.vertex3,a.vertex1),this.addTriangle(o+2,h,2,a.vertex0,a.vertex3,a.vertex1,a.vertex2),this.addTriangle(o+3,h,3,a.vertex0,a.vertex1,a.vertex2,a.vertex3),o+=4}for(var u=0;u<o;u++)if(this._triangles[u].isOuterFace){for(var c=u+1;c<o;c++)if(this._triangles[u].isSame(this._triangles[c])){this._tetrahedrons[this._triangles[u].tetrahedron].neighbours[this._triangles[u].index]=this._triangles[c].tetrahedron,this._tetrahedrons[this._triangles[c].tetrahedron].neighbours[this._triangles[c].index]=this._triangles[u].tetrahedron,this._triangles[u].isOuterFace=!1,this._triangles[c].isOuterFace=!1;break}if(this._triangles[u].isOuterFace){var v=this._probes[this._triangles[u].vertex0],x=this._probes[this._triangles[u].vertex1],p=this._probes[this._triangles[u].vertex2],d=this._probes[this._triangles[u].vertex3];e.subtract(r,x.position,v.position),e.subtract(s,p.position,v.position),e.cross(t,r,s),e.subtract(i,d.position,v.position);var f=e.dot(t,i);f>0&&e.negate(t,t),e.add(v.normal,v.normal,t),e.add(x.normal,x.normal,t),e.add(p.normal,p.normal,t);var b=this._triangles[u].vertex0,y=f>0?this._triangles[u].vertex2:this._triangles[u].vertex1,l=f>0?this._triangles[u].vertex1:this._triangles[u].vertex2,_=new ft(this,b,y,l);_.neighbours[3]=this._triangles[u].tetrahedron,this._tetrahedrons[this._triangles[u].tetrahedron].neighbours[this._triangles[u].index]=this._tetrahedrons.length,this._tetrahedrons.push(_)}}for(var g=0,P=n;P<this._tetrahedrons.length;P++){var m=this._tetrahedrons[P];this.addEdge(g,P,0,m.vertex1,m.vertex2),this.addEdge(g+1,P,1,m.vertex2,m.vertex0),this.addEdge(g+2,P,2,m.vertex0,m.vertex1),g+=3}for(var z=0;z<g;z++)for(var w=z+1;w<g;w++)this._edges[z].isSame(this._edges[w])&&(this._tetrahedrons[this._edges[z].tetrahedron].neighbours[this._edges[z].index]=this._edges[w].tetrahedron,this._tetrahedrons[this._edges[w].tetrahedron].neighbours[this._edges[w].index]=this._edges[z].tetrahedron);for(var O=0;O<this._probes.length;O++)this._probes[O].normal.normalize()},r.computeMatrices=function(){for(var t=0;t<this._tetrahedrons.length;t++){var e=this._tetrahedrons[t];e.vertex3>=0?this.computeTetrahedronMatrix(e):this.computeOuterCellMatrix(e)}},r.computeTetrahedronMatrix=function(t){var e=this._probes[t.vertex0].position,r=this._probes[t.vertex1].position,s=this._probes[t.vertex2].position,i=this._probes[t.vertex3].position;t.matrix.set(e.x-i.x,r.x-i.x,s.x-i.x,e.y-i.y,r.y-i.y,s.y-i.y,e.z-i.z,r.z-i.z,s.z-i.z),t.matrix.invert(),t.matrix.transpose()},r.computeOuterCellMatrix=function(t){var r=[],s=[];r[0]=this._probes[t.vertex0].normal,r[1]=this._probes[t.vertex1].normal,r[2]=this._probes[t.vertex2].normal,s[0]=this._probes[t.vertex0].position,s[1]=this._probes[t.vertex1].position,s[2]=this._probes[t.vertex2].position,e.subtract(nt,s[0],s[2]),e.subtract(ot,r[0],r[2]),e.subtract(ht,s[1],s[2]),e.subtract(at,r[1],r[2]),ut.set(s[2]),e.negate(ct,r[2]);var n=[];n[0]=ot.y*at.z-ot.z*at.y,n[3]=-ot.x*at.z+ot.z*at.x,n[6]=ot.x*at.y-ot.y*at.x,n[9]=nt.x*at.y*ct.z-nt.y*at.x*ct.z+ot.x*ht.y*ct.z-ot.y*ht.x*ct.z+nt.z*at.x*ct.y-nt.z*at.y*ct.x+ot.z*ht.x*ct.y-ot.z*ht.y*ct.x-nt.x*at.z*ct.y+nt.y*at.z*ct.x-ot.x*ht.z*ct.y+ot.y*ht.z*ct.x,n[9]-=ut.x*n[0]+ut.y*n[3]+ut.z*n[6],n[1]=ot.y*ht.z+nt.y*at.z-ot.z*ht.y-nt.z*at.y,n[4]=-nt.x*at.z-ot.x*ht.z+nt.z*at.x+ot.z*ht.x,n[7]=nt.x*at.y-nt.y*at.x+ot.x*ht.y-ot.y*ht.x,n[10]=nt.x*ht.y*ct.z-nt.y*ht.x*ct.z-nt.x*ht.z*ct.y+nt.y*ht.z*ct.x+nt.z*ht.x*ct.y-nt.z*ht.y*ct.x,n[10]-=ut.x*n[1]+ut.y*n[4]+ut.z*n[7],n[2]=-nt.z*ht.y+nt.y*ht.z,n[5]=-nt.x*ht.z+nt.z*ht.x,n[8]=nt.x*ht.y-nt.y*ht.x,n[11]=0,n[11]-=ut.x*n[2]+ut.y*n[5]+ut.z*n[8];var o=ot.x*at.y*ct.z-ot.y*at.x*ct.z+ot.z*at.x*ct.y-ot.z*at.y*ct.x+ot.y*at.z*ct.x-ot.x*at.z*ct.y;if(Math.abs(o)>i)for(var h=0;h<12;h++)n[h]/=o;else t.vertex3=-2;t.matrix.set(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8]),t.offset.set(n[9],n[10],n[11])},t}()),yt=t("LightProbeSampler",function(){function t(){}return t.uniformSampleSphere=function(t,r){var s=1-2*t,i=Math.sqrt(Math.max(0,1-s*s)),n=2*Math.PI*r,o=i*Math.cos(n),h=i*Math.sin(n);return new e(o,h,s)},t.uniformSampleSphereAll=function(t){for(var e=Math.floor(Math.sqrt(t)),r=e,s=[],i=1/e,n=1/r,o=0;o<e;o++)for(var h=(o+.5)*i,a=0;a<r;a++){var u=(a+.5)*n,c=this.uniformSampleSphere(h,u);s.push(c)}return s},t.uniformSpherePdf=function(){return 1/(4*Math.PI)},t}()),lt=t("SH",function(){function t(){}return t.updateUBOData=function(t,e,r){t[e++]=r[3].x*this.basisOverPI[3],t[e++]=r[1].x*this.basisOverPI[1],t[e++]=r[2].x*this.basisOverPI[2],t[e++]=r[0].x*this.basisOverPI[0]-r[6].x*this.basisOverPI[6]/3,t[e++]=r[3].y*this.basisOverPI[3],t[e++]=r[1].y*this.basisOverPI[1],t[e++]=r[2].y*this.basisOverPI[2],t[e++]=r[0].y*this.basisOverPI[0]-r[6].y*this.basisOverPI[6]/3,t[e++]=r[3].z*this.basisOverPI[3],t[e++]=r[1].z*this.basisOverPI[1],t[e++]=r[2].z*this.basisOverPI[2],t[e++]=r[0].z*this.basisOverPI[0]-r[6].z*this.basisOverPI[6]/3,t[e++]=r[4].x*this.basisOverPI[4],t[e++]=r[5].x*this.basisOverPI[5],t[e++]=r[6].x*this.basisOverPI[6],t[e++]=r[7].x*this.basisOverPI[7],t[e++]=r[4].y*this.basisOverPI[4],t[e++]=r[5].y*this.basisOverPI[5],t[e++]=r[6].y*this.basisOverPI[6],t[e++]=r[7].y*this.basisOverPI[7],t[e++]=r[4].z*this.basisOverPI[4],t[e++]=r[5].z*this.basisOverPI[5],t[e++]=r[6].z*this.basisOverPI[6],t[e++]=r[7].z*this.basisOverPI[7],t[e++]=r[8].x*this.basisOverPI[8],t[e++]=r[8].y*this.basisOverPI[8],t[e++]=r[8].z*this.basisOverPI[8],t[e++]=0},t.shaderEvaluate=function(t,r){var s=new h(r[3].x*this.basisOverPI[3],r[1].x*this.basisOverPI[1],r[2].x*this.basisOverPI[2],r[0].x*this.basisOverPI[0]-r[6].x*this.basisOverPI[6]/3),i=new h(r[3].y*this.basisOverPI[3],r[1].y*this.basisOverPI[1],r[2].y*this.basisOverPI[2],r[0].y*this.basisOverPI[0]-r[6].y*this.basisOverPI[6]/3),n=new h(r[3].z*this.basisOverPI[3],r[1].z*this.basisOverPI[1],r[2].z*this.basisOverPI[2],r[0].z*this.basisOverPI[0]-r[6].z*this.basisOverPI[6]/3),o=new h(r[4].x*this.basisOverPI[4],r[5].x*this.basisOverPI[5],r[6].x*this.basisOverPI[6],r[7].x*this.basisOverPI[7]),a=new h(r[4].y*this.basisOverPI[4],r[5].y*this.basisOverPI[5],r[6].y*this.basisOverPI[6],r[7].y*this.basisOverPI[7]),u=new h(r[4].z*this.basisOverPI[4],r[5].z*this.basisOverPI[5],r[6].z*this.basisOverPI[6],r[7].z*this.basisOverPI[7]),c=new e(r[8].x*this.basisOverPI[8],r[8].y*this.basisOverPI[8],r[8].z*this.basisOverPI[8]),v=new e(0,0,0),x=new h(t.x,t.y,t.z,1);v.x=h.dot(s,x),v.y=h.dot(i,x),v.z=h.dot(n,x);var p=new h(t.x*t.y,t.y*t.z,t.z*t.z,t.z*t.x),d=t.x*t.x-t.y*t.y;return v.x+=h.dot(o,p),v.y+=h.dot(a,p),v.z+=h.dot(u,p),e.scaleAndAdd(v,v,c,d),v},t.evaluate=function(t,r){for(var s=new e(0,0,0),i=r.length,n=0;n<i;n++){var o=r[n];e.scaleAndAdd(s,s,o,this.evaluateBasis(n,t))}return s},t.project=function(t,r){v(t.length>0&&t.length===r.length);for(var s=this.getBasisCount(),i=t.length,n=1/(yt.uniformSpherePdf()*i),o=[],h=0;h<s;h++){for(var a=new e(0,0,0),u=0;u<i;u++)e.scaleAndAdd(a,a,r[u],this.evaluateBasis(h,t[u]));e.multiplyScalar(a,a,n),o.push(a)}return o},t.convolveCosine=function(t){for(var r=[.8862268925,1.0233267546,.495415926],s=[],i=0;i<=this.LMAX;i++)for(var n=-i;n<=i;n++){var o=this.toIndex(i,n),h=new e(0,0,0);e.multiplyScalar(h,t[o],this.lambda(i)*r[i]),s.push(h)}return s},t.getBasisCount=function(){return 9},t.evaluateBasis=function(t,e){return v(t<this.getBasisCount()),(0,this.basisFunctions[t])(e)},t.reduceRinging=function(t,r){if(0!==r)for(var s=0;s<=this.LMAX;++s)for(var i=1/(1+r*s*s*(s+1)*(s+1)),n=-s;n<=s;++n){var o=this.toIndex(s,n);e.multiplyScalar(t[o],t[o],i)}},t.lambda=function(t){return Math.sqrt(4*Math.PI/(2*t+1))},t.toIndex=function(t,e){return t*t+t+e},t}());lt.LMAX=2,lt.basisFunctions=[function(){return.282095},function(t){return.488603*t.y},function(t){return.488603*t.z},function(t){return.488603*t.x},function(t){return 1.09255*t.y*t.x},function(t){return 1.09255*t.y*t.z},function(t){return.946175*(t.z*t.z-1/3)},function(t){return 1.09255*t.z*t.x},function(t){return.546274*(t.x*t.x-t.y*t.y)}],lt.basisOverPI=[.0897936,.155527,.155527,.155527,.347769,.347769,.301177,.347769,.173884],b.internal.SH=lt;var _t,gt,Pt,mt,zt,wt,Ot,It=function(){function t(){}return t.getQuadraticUniqueRoot=function(t,e,r){return 0!==t?-e/(2*t):0!==e?-r/e:0},t.getCubicUniqueRoot=function(t,e,r){var s=[],i=-t/3,n=e/3-t*t/9,o=r/2+t*t*t/27-t*e/6,h=n*n*n+o*o;if(h>0){var a=Math.sqrt(h);s.push(Math.cbrt(-o+a)+Math.cbrt(-o-a))}else if(h<0){var u=Math.acos(-o*Math.sqrt(-n)/(n*n))/3;s.push(2*Math.sqrt(-n)*Math.cos(u)),s.push(2*Math.sqrt(-n)*Math.cos(u+2*Math.PI/3)),s.push(2*Math.sqrt(-n)*Math.cos(u+4*Math.PI/3))}else if(0===o)s.push(0);else{var c=Math.cbrt(o);s.push(c),s.push(-2*c)}for(var v=0;v<s.length;v++)if(s[v]+i>=0)return s[v]+i;return 0},t}(),Mt=new e(0,0,0),At=new e(0,0,0),St=new e(0,0,0),Ct=new e(0,0,0),Tt=new e(0,0,0),kt=new e(0,0,0),qt=new e(0,0,0),Lt=new e(0,0,0),Dt=new e(0,0,0),Bt=new e(0,0,0),Et=new e(0,0,0),Xt=new e(0,0,0),Ut=new e(0,0,0),Rt=new e(0,0,0),Vt=new e(0,0,0),Nt=t("LightProbesData",(_t=n("cc.LightProbesData"),gt=a([vt]),Pt=a([ft]),_t((zt=function(){function t(){this._probes=wt&&wt(),this._tetrahedrons=Ot&&Ot()}var r=t.prototype;return r.empty=function(){return 0===this._probes.length||0===this._tetrahedrons.length},r.reset=function(){this._probes.length=0,this._tetrahedrons.length=0},r.updateProbes=function(t){this._probes.length=t.length;for(var r=this._probes.length,s=0;s<r;s++){var i=this._probes[s];if(i)i.position.set(t[s]);else{i=new vt(t[s]);for(var n=0;n<lt.getBasisCount();n++)i.coefficients[n]=e.ZERO;this._probes[s]=i}}},r.updateTetrahedrons=function(){var t=new bt(this._probes);this._tetrahedrons=t.build()},r.getInterpolationSHCoefficients=function(t,r,s){if(!this.hasCoefficients())return!1;var i=lt.getBasisCount(),n=this._tetrahedrons[t],o=this._probes[n.vertex0].coefficients,h=this._probes[n.vertex1].coefficients,a=this._probes[n.vertex2].coefficients;if(n.vertex3>=0)for(var u=this._probes[n.vertex3].coefficients,c=0;c<i;c++)s[c]=new e(0,0,0),e.scaleAndAdd(s[c],s[c],o[c],r.x),e.scaleAndAdd(s[c],s[c],h[c],r.y),e.scaleAndAdd(s[c],s[c],a[c],r.z),e.scaleAndAdd(s[c],s[c],u[c],r.w);else for(var v=0;v<i;v++)s[v]=new e(0,0,0),e.scaleAndAdd(s[v],s[v],o[v],r.x),e.scaleAndAdd(s[v],s[v],h[v],r.y),e.scaleAndAdd(s[v],s[v],a[v],r.z);return!0},r.getInterpolationWeights=function(t,e,r){var s=this._tetrahedrons.length;(e<0||e>=s)&&(e=0);for(var i=-1,n=-1,o=0;o<s;o++){var h=this._tetrahedrons[e];if(this.getBarycentricCoord(t,h,r),r.x>=0&&r.y>=0&&r.z>=0&&r.w>=0)break;if(i===(n=r.x<r.y&&r.x<r.z&&r.x<r.w?h.neighbours[0]:r.y<r.z&&r.y<r.w?h.neighbours[1]:r.z<r.w?h.neighbours[2]:h.neighbours[3]))break;i=e,e=n}return e},r.hasCoefficients=function(){return!this.empty()&&0!==this._probes[0].coefficients.length},t.getTriangleBarycentricCoord=function(t,r,s,n){if(e.subtract(Mt,r,t),e.subtract(At,s,t),e.cross(St,Mt,At),St.lengthSqr()<=i)return new e(0,0,0);var o=St.clone();o.normalize();var h=1/o.dot(St);e.subtract(Ct,t,n),e.subtract(Tt,r,n),e.subtract(kt,s,n),e.cross(qt,Tt,kt);var a=o.dot(qt)*h;e.cross(Lt,kt,Ct);var u=o.dot(Lt)*h;return new e(a,u,1-a-u)},r.getBarycentricCoord=function(t,e,r){e.vertex3>=0?this.getTetrahedronBarycentricCoord(t,e,r):this.getOuterCellBarycentricCoord(t,e,r)},r.getTetrahedronBarycentricCoord=function(t,r,s){var i=new e(0,0,0);e.subtract(i,t,this._probes[r.vertex3].position),e.transformMat3(i,i,r.matrix),s.set(i.x,i.y,i.z,1-i.x-i.y-i.z)},r.getOuterCellBarycentricCoord=function(r,s,i){var n=this._probes[s.vertex0].position,o=this._probes[s.vertex1].position,h=this._probes[s.vertex2].position;e.subtract(Bt,o,n),e.subtract(Et,h,n),e.cross(Dt,Bt,Et),e.subtract(Xt,r,n);var a=e.dot(Xt,Dt);if(a<0)i.set(0,0,0,-1);else{var u=new e(0,0,0);e.transformMat3(u,r,s.matrix),e.add(u,u,s.offset),a=-1===s.vertex3?It.getCubicUniqueRoot(u.x,u.y,u.z):It.getQuadraticUniqueRoot(u.x,u.y,u.z),e.scaleAndAdd(Ut,n,this._probes[s.vertex0].normal,a),e.scaleAndAdd(Rt,o,this._probes[s.vertex1].normal,a),e.scaleAndAdd(Vt,h,this._probes[s.vertex2].normal,a);var c=t.getTriangleBarycentricCoord(Ut,Rt,Vt,r);i.set(c.x,c.y,c.z,0)}},x(t,[{key:"probes",get:function(){return this._probes}},{key:"tetrahedrons",get:function(){return this._tetrahedrons}}]),t}(),wt=s(zt.prototype,"_probes",[o,gt],(function(){return[]})),Ot=s(zt.prototype,"_tetrahedrons",[o,Pt],(function(){return[]})),mt=zt))||mt));b.internal.LightProbesData=Nt;var jt,Zt,Ft,Yt,Gt,Wt,Ht,Qt,Jt,Kt,$t,te,ee,re,se,ie=t("LightProbes",function(){function t(){this._giScale=1,this._giSamples=1024,this._bounces=2,this._reduceRinging=0,this._showProbe=!0,this._showWireframe=!0,this._showConvex=!1,this._data=null,this._lightProbeSphereVolume=1}var e=t.prototype;return e.initialize=function(t){this._giScale=t.giScale,this._giSamples=t.giSamples,this._bounces=t.bounces,this._reduceRinging=t.reduceRinging,this._showProbe=t.showProbe,this._showWireframe=t.showWireframe,this._showConvex=t.showConvex,this._data=t.data,this._lightProbeSphereVolume=t.lightProbeSphereVolume},e.empty=function(){return!this._data||this._data.empty()},x(t,[{key:"giScale",get:function(){return this._giScale},set:function(t){this._giScale=t}},{key:"giSamples",get:function(){return this._giSamples},set:function(t){this._giSamples=t}},{key:"bounces",get:function(){return this._bounces},set:function(t){this._bounces=t}},{key:"reduceRinging",get:function(){return this._reduceRinging},set:function(t){this._reduceRinging=t}},{key:"showProbe",get:function(){return this._showProbe},set:function(t){this._showProbe=t}},{key:"showWireframe",get:function(){return this._showWireframe},set:function(t){this._showWireframe=t}},{key:"showConvex",get:function(){return this._showConvex},set:function(t){this._showConvex=t}},{key:"data",get:function(){return this._data},set:function(t){this._data=t}},{key:"lightProbeSphereVolume",get:function(){return this._lightProbeSphereVolume},set:function(t){this._lightProbeSphereVolume=t}}]),t}());b.internal.LightProbes=ie,t("LightProbeGroup",(jt=n("cc.LightProbeGroup"),Zt=a([e]),Ft=a($),Yt=a(f),Gt=a(f),Wt=a(f),jt(Ht=u((Qt=function(t){function e(){for(var e,r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))||this)._probes=Jt&&Jt(),e._method=Kt&&Kt(),e._minPos=$t&&$t(),e._maxPos=te&&te(),e._nProbesX=ee&&ee(),e._nProbesY=re&&re(),e._nProbesZ=se&&se(),e}p(e,t);var r=e.prototype;return r.onLoad=function(){},r.onEnable=function(){},r.onDisable=function(){},r.generateLightProbes=function(){this.node&&(this._probes=tt.generate({method:this._method,nProbesX:this._nProbesX,nProbesY:this._nProbesY,nProbesZ:this._nProbesZ,minPos:this._minPos,maxPos:this._maxPos}),this.onProbeChanged())},r.onProbeChanged=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0);var r=this.node.scene.globals.lightProbeInfo;r.syncData(this.node,this.probes),r.update(t),e&&this.node.emit(y.LIGHT_PROBE_CHANGED)},x(e,[{key:"probes",get:function(){return this._probes},set:function(t){this._probes=t}},{key:"method",get:function(){return this._method}},{key:"minPos",get:function(){return this._minPos},set:function(t){this._minPos=t}},{key:"maxPos",get:function(){return this._maxPos},set:function(t){this._maxPos=t}},{key:"nProbesX",get:function(){return this._nProbesX},set:function(t){this._nProbesX=t}},{key:"nProbesY",get:function(){return this._nProbesY},set:function(t){this._nProbesY=t}},{key:"nProbesZ",get:function(){return this._nProbesZ},set:function(t){this._nProbesZ=t}}]),e}(l),Jt=s(Qt.prototype,"_probes",[o],(function(){return[]})),Kt=s(Qt.prototype,"_method",[o],(function(){return $.UNIFORM})),$t=s(Qt.prototype,"_minPos",[o],(function(){return new e(-5,-5,-5)})),te=s(Qt.prototype,"_maxPos",[o],(function(){return new e(5,5,5)})),ee=s(Qt.prototype,"_nProbesX",[o],(function(){return 3})),re=s(Qt.prototype,"_nProbesY",[o],(function(){return 3})),se=s(Qt.prototype,"_nProbesZ",[o],(function(){return 3})),d(Qt.prototype,"probes",[Zt],Object.getOwnPropertyDescriptor(Qt.prototype,"probes"),Qt.prototype),d(Qt.prototype,"method",[Ft],Object.getOwnPropertyDescriptor(Qt.prototype,"method"),Qt.prototype),d(Qt.prototype,"nProbesX",[Yt],Object.getOwnPropertyDescriptor(Qt.prototype,"nProbesX"),Qt.prototype),d(Qt.prototype,"nProbesY",[Gt],Object.getOwnPropertyDescriptor(Qt.prototype,"nProbesY"),Qt.prototype),d(Qt.prototype,"nProbesZ",[Wt],Object.getOwnPropertyDescriptor(Qt.prototype,"nProbesZ"),Qt.prototype),Ht=Qt))||Ht)||Ht))}}}));
