System.register(["./factory-D9_8ZCqM.js","./gc-object-CKHc4SnS.js","./index-C5lmLqDW.js","./global-exports-CR3GRnjt.js","./rendering-sub-mesh-CowWLfXC.js","./component-BaGvu7EF.js","./debug-view-CKetkq9d.js","./scene-7MDSMR3j.js","./prefab-DH0xadMc.js","./pipeline-state-manager-Cdpe3is6.js","./node-event-DTNosVQv.js","./sprite-renderer-zme-rDJ_.js","./ui-renderer-DuhVjkfF.js","./deprecated-T2yM9nsJ.js","./director-DIlqD2Nd.js","./device-manager-BvjvoelW.js","./buffer-barrier-CuX_5NUR.js","./touch-DB0AR-Sc.js","./camera-component-Df61RNZm.js","./deprecated-Ca3AjUwj.js","./sprite-frame-C6JiNTOk.js","./create-mesh-hkbGggH3.js","./mesh-C8knhDLk.js","./wasm-minigame-DoCiKH-Y.js","./zlib.min-CyXMsivM.js","./deprecated-C8l6Kwy8.js","./model-renderer-BcRDUYby.js","./renderer-9hfAnqUF.js"],(function(t){"use strict";var e,i,n,s,o,r,a,l,h,c,u,d,_,p,m,y,v,f,E,A,g,T,P,b,k,O,w,L,R,C,S,D,U;return{setters:[function(t){e=t.d,i=t.f},function(t){n=t._,s=t.a,o=t.H,r=t.E,a=t.L,l=t.O,h=t.G,c=t.a2,u=t.a1,d=t.b},function(t){_=t.c,p=t.a,m=t.s,y=t.w,v=t.m,f=t.G,E=t.O,A=t.J,g=t.t,T=t.K,P=t.g,b=t.r},function(t){k=t.a,O=t.l},null,function(t){w=t.A,L=t.E,R=t.C},null,null,null,null,null,null,function(t){C=t.c},function(t){S=t.g},function(t){D=t.d},null,function(t){U=t.C},null,null,null,null,null,null,null,null,null,null,null],execute:function(){var M,I,V,j=t("VideoClip",_("cc.VideoClip")((I=function(t){function e(){var e;return(e=t.call(this)||this)._duration=V&&V(),e._video=null,e}return n(e,t),s(e,[{key:"_nativeAsset",get:function(){return this._video},set:function(t){this._video=t,this._duration=t?t.duration:0}}]),e}(w),V=p(I.prototype,"_duration",[m],(function(){return 0})),M=I))||M),F=k.document;function N(t,e,i){var n=F.createElement("video"),s=F.createElement("source");n.appendChild(s);var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="blob",r.onload=function(){200===this.status||0===this.status?(s.src=URL.createObjectURL(this.response),i(null,n)):i(new Error(r.status+"(no response)"))},r.onerror=function(){var e="load video failure - "+t;o(e),i(new Error(e))},r.send()}function x(t,e,i,n){var s=new j;s._nativeUrl=t,s._nativeAsset=e,n(null,s)}e.register({".mp4":N,".avi":N,".mov":N,".mpg":N,".mpeg":N,".rm":N,".rmvb":N}),i.register({".mp4":x,".avi":x,".mov":x,".mpg":x,".mpeg":x,".rm":x,".rmvb":x});var H,B,G=r({REMOTE:0,LOCAL:1});!function(t){t.NONE="none",t.PLAYING="playing",t.PAUSED="paused",t.STOPPED="stopped",t.COMPLETED="completed",t.META_LOADED="meta-loaded",t.READY_TO_PLAY="ready-to-play",t.ERROR="error",t.CLICKED="clicked"}(H||(H={})),function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(B||(B={}));var Y=function(){function t(t){var e=this;this._componentEventList=new Map,this._state=H.NONE,this._video=null,this._onInterruptedBegin=void 0,this._onInterruptedEnd=void 0,this._interrupted=!1,this._loaded=!1,this._loadedMeta=!1,this._ignorePause=!1,this._fullScreenOnAwake=!1,this._visible=!0,this._playing=!1,this._cachedCurrentTime=-1,this._waitingFullscreen=!1,this._waitingPlay=!1,this._keepAspectRatio=!1,this._component=null,this._uiTrans=null,this._node=null,this._stayOnBottom=!1,this._dirty=!1,this._forceUpdate=!1,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._component=t,this._node=t.node,this._uiTrans=t.node.getComponent(C),this._onInterruptedBegin=function(){e.video&&e._state===H.PLAYING&&(e.video.pause(),e._interrupted=!0)},this._onInterruptedEnd=function(){e._interrupted&&e.video&&(e.video.play(),e._interrupted=!1)},O.game.on(O.Game.EVENT_PAUSE,this._onInterruptedBegin),O.game.on(O.Game.EVENT_RESUME,this._onInterruptedEnd)}var e=t.prototype;return e.onLoadedMetadata=function(t){this._loadedMeta=!0,this._forceUpdate=!0,this._visible?this.enable():this.disable(),this.dispatchEvent(H.META_LOADED);var e=t.target;this._keepAspectRatio&&e&&this.syncUITransform(e.videoWidth,e.videoHeight),this.delayedFullScreen(),this.delayedPlay()},e.onCanPlay=function(){this._loaded=!0,this.dispatchEvent(H.READY_TO_PLAY)},e.onPlay=function(){this._playing=!0,this.dispatchEvent(H.PLAYING)},e.onPlaying=function(){this.dispatchEvent(H.PLAYING)},e.onPause=function(){this._playing=!1,this._ignorePause?this._ignorePause=!1:this.dispatchEvent(H.PAUSED)},e.onStoped=function(){this._playing=!1,this._ignorePause=!1,this.dispatchEvent(H.STOPPED)},e.onEnded=function(){this._playing=!1,this.dispatchEvent(H.COMPLETED)},e.onClick=function(){this.dispatchEvent(H.CLICKED)},e.onError=function(t){this.dispatchEvent(H.ERROR);var e=t.target;e&&e.error&&a("Error "+e.error.code+"; details: "+e.error.message)},e.play=function(){this._loadedMeta||this._loaded?this.canPlay():this._waitingPlay=!0},e.delayedPlay=function(){this._waitingPlay&&(this.canPlay(),this._waitingPlay=!1)},e.syncFullScreenOnAwake=function(t){this._fullScreenOnAwake=t,this._loadedMeta||this._loaded?this.canFullScreen(t):this._waitingFullscreen=!0},e.delayedFullScreen=function(){this._waitingFullscreen&&(this.canFullScreen(this._fullScreenOnAwake),this._waitingFullscreen=!1)},e.dispatchEvent=function(t){var e=this._componentEventList.get(t);e&&(this._state=t,e.call(this))},e.syncUITransform=function(t,e){var i=this._uiTrans;i&&(i.width=t,i.height=e)},e.syncCurrentTime=function(){this.video&&-1!==this._cachedCurrentTime&&this.video.currentTime!==this._cachedCurrentTime&&(this.seekTo(this._cachedCurrentTime),this._cachedCurrentTime=-1)},e.destroy=function(){this.removeVideoPlayer(),this._componentEventList.clear(),O.game.off(O.Game.EVENT_PAUSE,this._onInterruptedBegin),O.game.off(O.Game.EVENT_RESUME,this._onInterruptedEnd)},s(t,[{key:"fullScreenOnAwake",get:function(){return this._fullScreenOnAwake}},{key:"loaded",get:function(){return this._loaded}},{key:"componentEventList",get:function(){return this._componentEventList}},{key:"video",get:function(){return this._video}},{key:"state",get:function(){return this._state}},{key:"isPlaying",get:function(){return this._playing}},{key:"UICamera",get:function(){return D.root.batcher2D.getFirstRenderCamera(this._node)}}]),t}();O.internal.VideoPlayerImpl=Y;var K,q,z,W,Q,J,X,Z,$,tt,et,it,nt,st,ot,rt,at,lt,ht,ct,ut,dt=k.document,_t=-Math.pow(2,15),pt=y(),mt=function(t){function e(e){var i;return(i=t.call(this,e)||this)._eventList=new Map,i._clearColorA=-1,i._clearFlag=void 0,i}n(e,t);var i=e.prototype;return i.addListener=function(t,e){this._video&&(this._eventList.set(t,e),this._video.addEventListener(t,e))},i.removeAllListeners=function(){var t=this;this._eventList.forEach((function(e,i){t._video&&t._video.removeEventListener(i,e)})),this._eventList.clear()},i.canPlay=function(){var t=this;if(this.video){var e=this.video.play();k.Promise&&e instanceof Promise&&e.catch((function(){})).then((function(){t.syncCurrentTime()}))}},i.pause=function(){this.video&&(this.video.pause(),this._cachedCurrentTime=this.video.currentTime)},i.resume=function(){this.play()},i.stop=function(){var t=this;this.video&&(this._ignorePause=!0,this.video.currentTime=0,this.video.pause(),this._cachedCurrentTime=0,setTimeout((function(){t._ignorePause=!1,t.dispatchEvent(H.STOPPED)}),0))},i.syncClip=function(t){this.removeVideoPlayer(),t&&this.createVideoPlayer(t.nativeUrl)},i.syncURL=function(t){this.removeVideoPlayer(),t&&this.createVideoPlayer(t)},i.syncPlaybackRate=function(t){v.browserType!==l.UC?this.video&&(this.video.playbackRate=t):h("playbackRate is not supported by the uc mobile browser.")},i.syncVolume=function(t){this.video&&(this.video.volume=t)},i.syncMute=function(t){this.video&&(this.video.muted=t)},i.syncLoop=function(t){this.video&&(this.video.loop=t)},i.getDuration=function(){return this.video?this.video.duration:0},i.getCurrentTime=function(){return this.video?this.video.currentTime:-1},i.seekTo=function(t){this.video&&(this.video.currentTime=t,this._cachedCurrentTime=this.video.currentTime)},i.canFullScreen=function(t){var e=this,i=this._video;if(i&&i.readyState===B.HAVE_ENOUGH_DATA)return v.os===c.IOS&&v.isBrowser?(t?i.webkitEnterFullscreen&&i.webkitEnterFullscreen():i.webkitExitFullscreen&&i.webkitExitFullscreen(),void(this._fullScreenOnAwake=i.webkitDisplayingFullscreen)):f.supportsFullScreen?void(t?(v.browserType===l.IE&&(i.style.transform=""),i.setAttribute("x5-video-player-fullscreen","true"),f.requestFullScreen(i,(function(t){var n=v.browserType===l.IE?t.msFullscreenElement:t.fullscreenElement;e._fullScreenOnAwake=n===i}),(function(){e._fullScreenOnAwake=!1}))):(i.removeAttribute("x5-video-player-fullscreen"),f.exitFullScreen())):(this._fullScreenOnAwake=t,this._forceUpdate=!0,void this.syncMatrix())},i.syncStayOnBottom=function(t){this._video&&(this._video.style["z-index"]=t?_t:0,this._stayOnBottom=t),this._dirty=!0},i.syncKeepAspectRatio=function(t){this._keepAspectRatio=t,t&&this._loadedMeta&&this._video&&this.syncUITransform(this._video.videoWidth,this._video.videoHeight)},i.removeVideoPlayer=function(){var t=this._video;t&&u(S.container,t)&&(S.container.removeChild(t),this.removeAllListeners()),this._cachedCurrentTime=0,this._playing=!1,this._loaded=!1,this._loadedMeta=!1,this._video=null},i.createVideoPlayer=function(t){var e=this._video=dt.createElement("video");e.className="cocosVideo",e.style.visibility="hidden",e.style.position="absolute",e.style.bottom="0px",e.style.left="0px",e.style["transform-origin"]="0px 100% 0px",e.style["-webkit-transform-origin"]="0px 100% 0px",e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("x5-playsinline",""),e.setAttribute("playsinline",""),this._bindDomEvent(),S.container.appendChild(e);var i=dt.createElement("source");e.appendChild(i),i.src=t},i._bindDomEvent=function(){this._video,this.addListener("loadedmetadata",this.onLoadedMetadata.bind(this)),this.addListener("canplay",this.onCanPlay.bind(this)),this.addListener("canplaythrough",this.onCanPlay.bind(this)),this.addListener("play",this.onPlay.bind(this)),this.addListener("playing",this.onPlaying.bind(this)),this.addListener("pause",this.onPause.bind(this)),this.addListener("click",this.onClick.bind(this)),this.addListener("ended",this.onEnded.bind(this)),this.addListener("error",this.onError.bind(this))},i.onCanPlay=function(e){var i=e.target;if(!this._loaded||!i)switch(i.readyState){case B.HAVE_METADATA:case B.HAVE_ENOUGH_DATA:t.prototype.onCanPlay.call(this,e)}},i.enable=function(){if(this._video){if(this._visible=!0,"visible"===this._video.style.visibility)return;this._video.style.visibility="visible"}},i.disable=function(t){if(this._video){if(!t&&this._playing&&this._video.pause(),this._visible=!1,"hidden"===this._video.style.visibility)return;this._video.style.visibility="hidden"}},i.syncMatrix=function(){if(this._video&&this._visible&&this._component){var t=this.UICamera;if(t){this._dirty&&(this._dirty=!1,this._stayOnBottom?(this._clearColorA=t.clearColor.w,this._clearFlag=t.clearFlag,t.clearColor.w=0,t.clearFlag=U.ALL):this._clearFlag&&(t.clearColor.w=this._clearColorA,t.clearFlag=this._clearFlag,this._clearColorA=-1,this._clearFlag=null)),this._component.node.getWorldMatrix(pt),t.update(!0),t.worldMatrixToScreen(pt,pt,S.canvas.width,S.canvas.height);var e=0,i=0;if(this._fullScreenOnAwake?(e=E.width,i=E.height):(e=this._uiTrans.contentSize.width,i=this._uiTrans.contentSize.height),this._forceUpdate||this._m00!==pt.m00||this._m01!==pt.m01||this._m04!==pt.m04||this._m05!==pt.m05||this._m12!==pt.m12||this._m13!==pt.m13||this._w!==e||this._h!==i){this._m00=pt.m00,this._m01=pt.m01,this._m04=pt.m04,this._m05=pt.m05,this._m12=pt.m12,this._m13=pt.m13,this._w=e,this._h=i;var n=A.devicePixelRatio,s=1/n,o=1/n,r=S.container,a=pt.m00*s,c=pt.m01,u=pt.m04,d=pt.m05*o;this._video.style.width=this._w+"px",this._video.style.height=this._h+"px",v.browserType!==l.MOBILE_QQ?this._video.style.objectFit=this._keepAspectRatio?"none":"fill":h("keepAspectRatio is not supported by the qq mobile browser.");var _=this._w*s,p=this._h*o,m=this._uiTrans.anchorPoint,y=m.x,f=m.y,g=_*pt.m00*y,T=p*pt.m05*f,P=r&&r.style.paddingLeft?parseInt(r.style.paddingLeft):0,b=r&&r.style.paddingBottom?parseInt(r.style.paddingBottom):0,k="matrix("+a+","+-c+","+-u+","+d+","+(pt.m12*s-g+P)+","+-(pt.m13*o-T+b)+")";this._video.style.transform=k,this._video.style["-webkit-transform"]=k,v.browserType!==l.IE&&(this._forceUpdate=!1)}}}},e}(Y),yt=function(){function t(){}return t.getImpl=function(t){return new mt(t)},t}();O.internal.VideoPlayerImplManager=yt;var vt=t("VideoPlayer",(K=_("cc.VideoPlayer"),q=T(C),z=g(j),W=g(G),Q=g(j),J=g([L]),K(X=q((ut=function(t){function e(){var e;return(e=t.call(this)||this)._resourceType=$&&$(),e._remoteURL=tt&&tt(),e._clip=et&&et(),e._playOnAwake=it&&it(),e._volume=nt&&nt(),e._mute=st&&st(),e._playbackRate=ot&&ot(),e._loop=rt&&rt(),e._fullScreenOnAwake=at&&at(),e._stayOnBottom=lt&&lt(),e._keepAspectRatio=ht&&ht(),e._impl=null,e._cachedCurrentTime=0,e.videoPlayerEvent=ct&&ct(),e}n(e,t);var i=e.prototype;return i.syncSource=function(){var t=this._impl;t&&(this._resourceType===G.REMOTE?t.syncURL(this._remoteURL):t.syncClip(this._clip),this._cachedCurrentTime=0,t.syncLoop(this._loop),t.syncVolume(this._volume),t.syncMute(this._mute),t.seekTo(this._cachedCurrentTime),t.syncPlaybackRate(this._playbackRate),t.syncStayOnBottom(this._stayOnBottom),t.syncKeepAspectRatio(this._keepAspectRatio),t.syncFullScreenOnAwake(this._fullScreenOnAwake))},i.__preload=function(){this._impl=yt.getImpl(this),this.syncSource();var t=this._impl.componentEventList;t.set(H.META_LOADED,this.onMetaLoaded.bind(this)),t.set(H.READY_TO_PLAY,this.onReadyToPlay.bind(this)),t.set(H.PLAYING,this.onPlaying.bind(this)),t.set(H.PAUSED,this.onPaused.bind(this)),t.set(H.STOPPED,this.onStopped.bind(this)),t.set(H.COMPLETED,this.onCompleted.bind(this)),t.set(H.ERROR,this.onError.bind(this)),t.set(H.CLICKED,this.onClicked.bind(this)),this._playOnAwake&&this._impl.loaded&&this.play()},i.onEnable=function(){this._impl&&this._impl.enable()},i.onDisable=function(){this._impl&&this._impl.disable()},i.onDestroy=function(){this._impl&&(this._impl.destroy(),this._impl=null)},i.update=function(){this._impl&&this._impl.syncMatrix()},i.onMetaLoaded=function(){L.emitEvents(this.videoPlayerEvent,this,H.META_LOADED),this.node.emit("meta-loaded",this)},i.onReadyToPlay=function(){this._playOnAwake&&!this.isPlaying&&this.play(),L.emitEvents(this.videoPlayerEvent,this,H.READY_TO_PLAY),this.node.emit(H.READY_TO_PLAY,this)},i.onPlaying=function(){L.emitEvents(this.videoPlayerEvent,this,H.PLAYING),this.node.emit(H.PLAYING,this)},i.onPaused=function(){L.emitEvents(this.videoPlayerEvent,this,H.PAUSED),this.node.emit(H.PAUSED,this)},i.onStopped=function(){L.emitEvents(this.videoPlayerEvent,this,H.STOPPED),this.node.emit(H.STOPPED,this)},i.onCompleted=function(){L.emitEvents(this.videoPlayerEvent,this,H.COMPLETED),this.node.emit(H.COMPLETED,this)},i.onError=function(){L.emitEvents(this.videoPlayerEvent,this,H.ERROR),this.node.emit(H.ERROR,this)},i.onClicked=function(){L.emitEvents(this.videoPlayerEvent,this,H.CLICKED),this.node.emit(H.CLICKED,this)},i.play=function(){this._impl&&this._impl.play()},i.resume=function(){this._impl&&this._impl.resume()},i.pause=function(){this._impl&&this._impl.pause()},i.stop=function(){this._impl&&this._impl.stop()},s(e,[{key:"resourceType",get:function(){return this._resourceType},set:function(t){this._resourceType!==t&&(this._resourceType=t,this.syncSource())}},{key:"remoteURL",get:function(){return this._remoteURL},set:function(t){this._remoteURL!==t&&(this._remoteURL=t,this.syncSource())}},{key:"clip",get:function(){return this._clip},set:function(t){this._clip!==t&&(this._clip=t,this.syncSource())}},{key:"playOnAwake",get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this._impl&&this._impl.syncPlaybackRate(t)}},{key:"volume",get:function(){return this._volume},set:function(t){this._volume=t,this._impl&&this._impl.syncVolume(t)}},{key:"mute",get:function(){return this._mute},set:function(t){this._mute=t,this._impl&&this._impl.syncMute(t)}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._impl&&this._impl.syncLoop(t)}},{key:"keepAspectRatio",get:function(){return this._keepAspectRatio},set:function(t){this._keepAspectRatio!==t&&(this._keepAspectRatio=t,this._impl&&this._impl.syncKeepAspectRatio(t))}},{key:"fullScreenOnAwake",get:function(){return this._impl?(this._fullScreenOnAwake=this._impl.fullScreenOnAwake,this._fullScreenOnAwake):this._fullScreenOnAwake},set:function(t){this._fullScreenOnAwake!==t&&(this._fullScreenOnAwake=t,this._impl&&this._impl.syncFullScreenOnAwake(t))}},{key:"stayOnBottom",get:function(){return this._stayOnBottom},set:function(t){this._stayOnBottom!==t&&(this._stayOnBottom=t,this._impl&&this._impl.syncStayOnBottom(t))}},{key:"nativeVideo",get:function(){return this._impl&&this._impl.video||null}},{key:"currentTime",get:function(){return this._impl?this._impl.getCurrentTime():this._cachedCurrentTime},set:function(t){Number.isNaN(t)?h("illegal video time! value:"+t):(t=P(t,0,this.duration),this._cachedCurrentTime=t,this._impl&&this._impl.seekTo(t))}},{key:"duration",get:function(){return this._impl?this._impl.getDuration():0}},{key:"state",get:function(){return this._impl?this._impl.state:H.NONE}},{key:"isPlaying",get:function(){return!!this._impl&&this._impl.isPlaying}}]),e}(R),ut.EventType=H,ut.ResourceType=G,$=p((Z=ut).prototype,"_resourceType",[m],(function(){return G.LOCAL})),tt=p(Z.prototype,"_remoteURL",[m],(function(){return""})),et=p(Z.prototype,"_clip",[z,m],(function(){return null})),it=p(Z.prototype,"_playOnAwake",[m],(function(){return!0})),nt=p(Z.prototype,"_volume",[m],(function(){return 1})),st=p(Z.prototype,"_mute",[m],(function(){return!1})),ot=p(Z.prototype,"_playbackRate",[m],(function(){return 1})),rt=p(Z.prototype,"_loop",[m],(function(){return!1})),at=p(Z.prototype,"_fullScreenOnAwake",[m],(function(){return!1})),lt=p(Z.prototype,"_stayOnBottom",[m],(function(){return!1})),ht=p(Z.prototype,"_keepAspectRatio",[m],(function(){return!0})),d(Z.prototype,"resourceType",[W],Object.getOwnPropertyDescriptor(Z.prototype,"resourceType"),Z.prototype),d(Z.prototype,"clip",[Q],Object.getOwnPropertyDescriptor(Z.prototype,"clip"),Z.prototype),ct=p(Z.prototype,"videoPlayerEvent",[m,J],(function(){return[]})),X=Z))||X)||X));O.internal.VideoPlayer=vt,b(vt.prototype,"VideoPlayer.prototype",[{name:"onPasued",newName:"onPaused"}])}}}));
