System.register(["./gc-object-CKHc4SnS.js","./buffer-barrier-CuX_5NUR.js","./gl-constants-ByUWAeN6.js","./global-exports-CR3GRnjt.js","./index-C5lmLqDW.js"],(function(e){"use strict";var t,r,a,n,s,i,_,u,l,R,c,E,f,A,T,S,g,o,h,B,C,p,d,x,G,m,I,F,b,O,P,D,M,L,v,U,N,y,w,H,X,V,k,K,W,z,Y,q,Z,j,Q,J,$,ee,te,re,ae,ne,se,ie,_e,ue,le,Re,ce,Ee,fe,Ae,Te,Se,ge,oe,he,Be,Ce,pe,de,xe,Ge,me,Ie,Fe;return{setters:[function(e){t=e._,r=e.a,a=e.h,n=e.W,s=e.a2,i=e.J,_=e.ad,u=e.L,l=e.w,R=e.R,c=e.y,E=e.G,f=e.A,A=e.O},function(e){T=e.at,S=e.av,g=e.X,o=e.M,h=e.b,B=e.d,C=e.c,p=e.aJ,d=e.q,x=e.p,G=e.F,m=e.aQ,I=e.aj,F=e.as,b=e.aE,O=e.v,P=e.br,D=e.bq,M=e.w,L=e.k,v=e.j,U=e.aH,N=e.aU,y=e.S,w=e.J,H=e.ba,X=e.aF,V=e.$,k=e.W,K=e.O,W=e.au,z=e.Y,Y=e.Z,q=e._,Z=e.a0,j=e.Q,Q=e.L,J=e.N,$=e.bo,ee=e.b1,te=e.a4,re=e.a7,ae=e.a5,ne=e.aP,se=e.aK,ie=e.T,_e=e.e,ue=e.K,le=e.f,Re=e.H,ce=e.r,Ee=e.G,fe=e.a$,Ae=e.b0,Te=e.aq,Se=e.a8,ge=e.o,oe=e.ar,he=e.a1,Be=e.a2,Ce=e.a3},function(e){pe=e.W},function(e){de=e.c,xe=e.U,Ge=e.b,me=e.l},function(e){Ie=e.H,Fe=e.m}],execute:function(){var be,Oe=function(e){function a(){var t;return(t=e.call(this)||this)._gpuDescriptorSet=null,t}t(a,e);var n=a.prototype;return n.initialize=function(e){this._layout=e.layout;var t=e.layout.getGpuDescriptorSetLayout(),r=t.bindings,a=t.descriptorIndices,n=t.descriptorCount;this._buffers=Array(n).fill(null),this._textures=Array(n).fill(null),this._samplers=Array(n).fill(null);var s=[];this._gpuDescriptorSet={gpuDescriptors:s,descriptorIndices:a};for(var i=0;i<r.length;++i)for(var _=r[i],u=0;u<_.count;u++){var l={type:_.descriptorType,gpuBuffer:null,gpuTextureView:null,gpuSampler:null};s.push(l)}},n.destroy=function(){this._layout=null,this._gpuDescriptorSet=null},n.update=function(){if(this._isDirty&&this._gpuDescriptorSet){for(var e=this._gpuDescriptorSet.gpuDescriptors,t=0;t<e.length;++t)e[t].type&T?this._buffers[t]&&(e[t].gpuBuffer=this._buffers[t].getGpuBuffer()):e[t].type&S&&(this._textures[t]&&(e[t].gpuTextureView=this._textures[t].gpuTextureView),this._samplers[t]&&(e[t].gpuSampler=this._samplers[t].gpuSampler));this._isDirty=!1}},r(a,[{key:"gpuDescriptorSet",get:function(){return this._gpuDescriptorSet}}]),a}(g);!function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR"}(be||(be={}));var Pe=function(){function e(){}return e.setInstance=function(t){e._instance=t},r(e,null,[{key:"instance",get:function(){return e._instance}}]),e}();Pe._instance=null;var De=[pe.REPEAT,pe.MIRRORED_REPEAT,pe.CLAMP_TO_EDGE,pe.CLAMP_TO_EDGE],Me=new Float32Array(4),Le=Math.max,ve=Math.min;function Ue(e){switch(e){case G.R8:return pe.UNSIGNED_BYTE;case G.R8SN:return pe.BYTE;case G.R8UI:return pe.UNSIGNED_BYTE;case G.R8I:return pe.BYTE;case G.R16F:return pe.HALF_FLOAT;case G.R16UI:return pe.UNSIGNED_SHORT;case G.R16I:return pe.SHORT;case G.R32F:return pe.FLOAT;case G.R32UI:return pe.UNSIGNED_INT;case G.R32I:return pe.INT;case G.RG8:return pe.UNSIGNED_BYTE;case G.RG8SN:return pe.BYTE;case G.RG8UI:return pe.UNSIGNED_BYTE;case G.RG8I:return pe.BYTE;case G.RG16F:return pe.HALF_FLOAT;case G.RG16UI:return pe.UNSIGNED_SHORT;case G.RG16I:return pe.SHORT;case G.RG32F:return pe.FLOAT;case G.RG32UI:return pe.UNSIGNED_INT;case G.RG32I:return pe.INT;case G.RGB8:case G.SRGB8:return pe.UNSIGNED_BYTE;case G.RGB8SN:return pe.BYTE;case G.RGB8UI:return pe.UNSIGNED_BYTE;case G.RGB8I:return pe.BYTE;case G.RGB16F:return pe.HALF_FLOAT;case G.RGB16UI:return pe.UNSIGNED_SHORT;case G.RGB16I:return pe.SHORT;case G.RGB32F:return pe.FLOAT;case G.RGB32UI:return pe.UNSIGNED_INT;case G.RGB32I:return pe.INT;case G.BGRA8:case G.RGBA8:case G.SRGB8_A8:return pe.UNSIGNED_BYTE;case G.RGBA8SN:return pe.BYTE;case G.RGBA8UI:return pe.UNSIGNED_BYTE;case G.RGBA8I:return pe.BYTE;case G.RGBA16F:return pe.HALF_FLOAT;case G.RGBA16UI:return pe.UNSIGNED_SHORT;case G.RGBA16I:return pe.SHORT;case G.RGBA32F:return pe.FLOAT;case G.RGBA32UI:return pe.UNSIGNED_INT;case G.RGBA32I:return pe.INT;case G.R5G6B5:return pe.UNSIGNED_SHORT_5_6_5;case G.R11G11B10F:return pe.UNSIGNED_INT_10F_11F_11F_REV;case G.RGB5A1:return pe.UNSIGNED_SHORT_5_5_5_1;case G.RGBA4:return pe.UNSIGNED_SHORT_4_4_4_4;case G.RGB10A2:case G.RGB10A2UI:return pe.UNSIGNED_INT_2_10_10_10_REV;case G.RGB9E5:case G.DEPTH:return pe.FLOAT;case G.DEPTH_STENCIL:return pe.UNSIGNED_INT_24_8;case G.BC1:case G.BC1_SRGB:case G.BC2:case G.BC2_SRGB:case G.BC3:case G.BC3_SRGB:case G.BC4:return pe.UNSIGNED_BYTE;case G.BC4_SNORM:return pe.BYTE;case G.BC5:return pe.UNSIGNED_BYTE;case G.BC5_SNORM:return pe.BYTE;case G.BC6H_SF16:case G.BC6H_UF16:return pe.FLOAT;case G.BC7:case G.BC7_SRGB:case G.ETC_RGB8:case G.ETC2_RGB8:case G.ETC2_SRGB8:case G.ETC2_RGB8_A1:case G.ETC2_SRGB8_A1:case G.EAC_R11:return pe.UNSIGNED_BYTE;case G.EAC_R11SN:return pe.BYTE;case G.EAC_RG11:return pe.UNSIGNED_BYTE;case G.EAC_RG11SN:return pe.BYTE;case G.PVRTC_RGB2:case G.PVRTC_RGBA2:case G.PVRTC_RGB4:case G.PVRTC_RGBA4:case G.PVRTC2_2BPP:case G.PVRTC2_4BPP:case G.ASTC_RGBA_4X4:case G.ASTC_RGBA_5X4:case G.ASTC_RGBA_5X5:case G.ASTC_RGBA_6X5:case G.ASTC_RGBA_6X6:case G.ASTC_RGBA_8X5:case G.ASTC_RGBA_8X6:case G.ASTC_RGBA_8X8:case G.ASTC_RGBA_10X5:case G.ASTC_RGBA_10X6:case G.ASTC_RGBA_10X8:case G.ASTC_RGBA_10X10:case G.ASTC_RGBA_12X10:case G.ASTC_RGBA_12X12:case G.ASTC_SRGBA_4X4:case G.ASTC_SRGBA_5X4:case G.ASTC_SRGBA_5X5:case G.ASTC_SRGBA_6X5:case G.ASTC_SRGBA_6X6:case G.ASTC_SRGBA_8X5:case G.ASTC_SRGBA_8X6:case G.ASTC_SRGBA_8X8:case G.ASTC_SRGBA_10X5:case G.ASTC_SRGBA_10X6:case G.ASTC_SRGBA_10X8:case G.ASTC_SRGBA_10X10:case G.ASTC_SRGBA_12X10:case G.ASTC_SRGBA_12X12:default:return pe.UNSIGNED_BYTE}}function Ne(e){switch(e){case G.A8:return pe.ALPHA;case G.L8:return pe.LUMINANCE;case G.LA8:return pe.LUMINANCE_ALPHA;case G.R8:return pe.R8;case G.R8SN:return pe.R8_SNORM;case G.R8UI:return pe.R8UI;case G.R8I:return pe.R8I;case G.RG8:return pe.RG8;case G.RG8SN:return pe.RG8_SNORM;case G.RG8UI:return pe.RG8UI;case G.RG8I:return pe.RG8I;case G.RGB8:return pe.RGB8;case G.RGB8SN:return pe.RGB8_SNORM;case G.RGB8UI:return pe.RGB8UI;case G.RGB8I:return pe.RGB8I;case G.BGRA8:case G.RGBA8:return pe.RGBA8;case G.RGBA8SN:return pe.RGBA8_SNORM;case G.RGBA8UI:return pe.RGBA8UI;case G.RGBA8I:return pe.RGBA8I;case G.R16I:return pe.R16I;case G.R16UI:return pe.R16UI;case G.R16F:return pe.R16F;case G.RG16I:return pe.RG16I;case G.RG16UI:return pe.RG16UI;case G.RG16F:return pe.RG16F;case G.RGB16I:return pe.RGB16I;case G.RGB16UI:return pe.RGB16UI;case G.RGB16F:return pe.RGB16F;case G.RGBA16I:return pe.RGBA16I;case G.RGBA16UI:return pe.RGBA16UI;case G.RGBA16F:return pe.RGBA16F;case G.R32I:return pe.R32I;case G.R32UI:return pe.R32UI;case G.R32F:return pe.R32F;case G.RG32I:return pe.RG32I;case G.RG32UI:return pe.RG32UI;case G.RG32F:return pe.RG32F;case G.RGB32I:return pe.RGB32I;case G.RGB32UI:return pe.RGB32UI;case G.RGB32F:return pe.RGB32F;case G.RGBA32I:return pe.RGBA32I;case G.RGBA32UI:return pe.RGBA32UI;case G.RGBA32F:return pe.RGBA32F;case G.R5G6B5:return pe.RGB565;case G.RGB5A1:return pe.RGB5_A1;case G.RGBA4:return pe.RGBA4;case G.SRGB8:return pe.SRGB8;case G.SRGB8_A8:return pe.SRGB8_ALPHA8;case G.RGB10A2:return pe.RGB10_A2;case G.RGB10A2UI:return pe.RGB10_A2UI;case G.R11G11B10F:return pe.R11F_G11F_B10F;case G.DEPTH:return pe.DEPTH_COMPONENT32F;case G.DEPTH_STENCIL:return pe.DEPTH24_STENCIL8;case G.BC1:return be.COMPRESSED_RGB_S3TC_DXT1_EXT;case G.BC1_ALPHA:return be.COMPRESSED_RGBA_S3TC_DXT1_EXT;case G.BC1_SRGB:return be.COMPRESSED_SRGB_S3TC_DXT1_EXT;case G.BC1_SRGB_ALPHA:return be.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case G.BC2:return be.COMPRESSED_RGBA_S3TC_DXT3_EXT;case G.BC2_SRGB:return be.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case G.BC3:return be.COMPRESSED_RGBA_S3TC_DXT5_EXT;case G.BC3_SRGB:return be.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case G.ETC_RGB8:return be.COMPRESSED_RGB_ETC1_WEBGL;case G.ETC2_RGB8:return be.COMPRESSED_RGB8_ETC2;case G.ETC2_SRGB8:return be.COMPRESSED_SRGB8_ETC2;case G.ETC2_RGB8_A1:return be.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case G.ETC2_SRGB8_A1:return be.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case G.ETC2_RGBA8:return be.COMPRESSED_RGBA8_ETC2_EAC;case G.ETC2_SRGB8_A8:return be.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case G.EAC_R11:return be.COMPRESSED_R11_EAC;case G.EAC_R11SN:return be.COMPRESSED_SIGNED_R11_EAC;case G.EAC_RG11:return be.COMPRESSED_RG11_EAC;case G.EAC_RG11SN:return be.COMPRESSED_SIGNED_RG11_EAC;case G.PVRTC_RGB2:return be.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case G.PVRTC_RGBA2:return be.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case G.PVRTC_RGB4:return be.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case G.PVRTC_RGBA4:return be.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case G.ASTC_RGBA_4X4:return be.COMPRESSED_RGBA_ASTC_4x4_KHR;case G.ASTC_RGBA_5X4:return be.COMPRESSED_RGBA_ASTC_5x4_KHR;case G.ASTC_RGBA_5X5:return be.COMPRESSED_RGBA_ASTC_5x5_KHR;case G.ASTC_RGBA_6X5:return be.COMPRESSED_RGBA_ASTC_6x5_KHR;case G.ASTC_RGBA_6X6:return be.COMPRESSED_RGBA_ASTC_6x6_KHR;case G.ASTC_RGBA_8X5:return be.COMPRESSED_RGBA_ASTC_8x5_KHR;case G.ASTC_RGBA_8X6:return be.COMPRESSED_RGBA_ASTC_8x6_KHR;case G.ASTC_RGBA_8X8:return be.COMPRESSED_RGBA_ASTC_8x8_KHR;case G.ASTC_RGBA_10X5:return be.COMPRESSED_RGBA_ASTC_10x5_KHR;case G.ASTC_RGBA_10X6:return be.COMPRESSED_RGBA_ASTC_10x6_KHR;case G.ASTC_RGBA_10X8:return be.COMPRESSED_RGBA_ASTC_10x8_KHR;case G.ASTC_RGBA_10X10:return be.COMPRESSED_RGBA_ASTC_10x10_KHR;case G.ASTC_RGBA_12X10:return be.COMPRESSED_RGBA_ASTC_12x10_KHR;case G.ASTC_RGBA_12X12:return be.COMPRESSED_RGBA_ASTC_12x12_KHR;case G.ASTC_SRGBA_4X4:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case G.ASTC_SRGBA_5X4:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case G.ASTC_SRGBA_5X5:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case G.ASTC_SRGBA_6X5:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case G.ASTC_SRGBA_6X6:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case G.ASTC_SRGBA_8X5:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case G.ASTC_SRGBA_8X6:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case G.ASTC_SRGBA_8X8:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case G.ASTC_SRGBA_10X5:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case G.ASTC_SRGBA_10X6:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case G.ASTC_SRGBA_10X8:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case G.ASTC_SRGBA_10X10:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case G.ASTC_SRGBA_12X10:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case G.ASTC_SRGBA_12X12:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return a(16309),pe.RGBA}}function ye(e){switch(e){case G.A8:return pe.ALPHA;case G.L8:return pe.LUMINANCE;case G.LA8:return pe.LUMINANCE_ALPHA;case G.R8:case G.R8SN:case G.R8UI:case G.R8I:return pe.RED;case G.RG8:case G.RG8SN:case G.RG8UI:case G.RG8I:return pe.RG;case G.RGB8:case G.RGB8SN:case G.RGB8UI:case G.RGB8I:return pe.RGB;case G.BGRA8:case G.RGBA8:case G.RGBA8SN:case G.RGBA8UI:case G.RGBA8I:return pe.RGBA;case G.R16UI:case G.R16I:case G.R16F:return pe.RED;case G.RG16UI:case G.RG16I:case G.RG16F:return pe.RG;case G.RGB16UI:case G.RGB16I:case G.RGB16F:return pe.RGB;case G.RGBA16UI:case G.RGBA16I:case G.RGBA16F:return pe.RGBA;case G.R32UI:case G.R32I:case G.R32F:return pe.RED;case G.RG32UI:case G.RG32I:case G.RG32F:return pe.RG;case G.RGB32UI:case G.RGB32I:case G.RGB32F:return pe.RGB;case G.RGBA32UI:case G.RGBA32I:case G.RGBA32F:case G.RGB10A2:return pe.RGBA;case G.R11G11B10F:case G.R5G6B5:return pe.RGB;case G.RGB5A1:case G.RGBA4:return pe.RGBA;case G.SRGB8:return pe.RGB;case G.SRGB8_A8:return pe.RGBA;case G.DEPTH:return pe.DEPTH_COMPONENT;case G.DEPTH_STENCIL:return pe.DEPTH_STENCIL;case G.BC1:return be.COMPRESSED_RGB_S3TC_DXT1_EXT;case G.BC1_ALPHA:return be.COMPRESSED_RGBA_S3TC_DXT1_EXT;case G.BC1_SRGB:return be.COMPRESSED_SRGB_S3TC_DXT1_EXT;case G.BC1_SRGB_ALPHA:return be.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case G.BC2:return be.COMPRESSED_RGBA_S3TC_DXT3_EXT;case G.BC2_SRGB:return be.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case G.BC3:return be.COMPRESSED_RGBA_S3TC_DXT5_EXT;case G.BC3_SRGB:return be.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case G.ETC_RGB8:return be.COMPRESSED_RGB_ETC1_WEBGL;case G.ETC2_RGB8:return be.COMPRESSED_RGB8_ETC2;case G.ETC2_SRGB8:return be.COMPRESSED_SRGB8_ETC2;case G.ETC2_RGB8_A1:return be.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case G.ETC2_SRGB8_A1:return be.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case G.ETC2_RGBA8:return be.COMPRESSED_RGBA8_ETC2_EAC;case G.ETC2_SRGB8_A8:return be.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case G.EAC_R11:return be.COMPRESSED_R11_EAC;case G.EAC_R11SN:return be.COMPRESSED_SIGNED_R11_EAC;case G.EAC_RG11:return be.COMPRESSED_RG11_EAC;case G.EAC_RG11SN:return be.COMPRESSED_SIGNED_RG11_EAC;case G.PVRTC_RGB2:return be.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case G.PVRTC_RGBA2:return be.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case G.PVRTC_RGB4:return be.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case G.PVRTC_RGBA4:return be.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case G.ASTC_RGBA_4X4:return be.COMPRESSED_RGBA_ASTC_4x4_KHR;case G.ASTC_RGBA_5X4:return be.COMPRESSED_RGBA_ASTC_5x4_KHR;case G.ASTC_RGBA_5X5:return be.COMPRESSED_RGBA_ASTC_5x5_KHR;case G.ASTC_RGBA_6X5:return be.COMPRESSED_RGBA_ASTC_6x5_KHR;case G.ASTC_RGBA_6X6:return be.COMPRESSED_RGBA_ASTC_6x6_KHR;case G.ASTC_RGBA_8X5:return be.COMPRESSED_RGBA_ASTC_8x5_KHR;case G.ASTC_RGBA_8X6:return be.COMPRESSED_RGBA_ASTC_8x6_KHR;case G.ASTC_RGBA_8X8:return be.COMPRESSED_RGBA_ASTC_8x8_KHR;case G.ASTC_RGBA_10X5:return be.COMPRESSED_RGBA_ASTC_10x5_KHR;case G.ASTC_RGBA_10X6:return be.COMPRESSED_RGBA_ASTC_10x6_KHR;case G.ASTC_RGBA_10X8:return be.COMPRESSED_RGBA_ASTC_10x8_KHR;case G.ASTC_RGBA_10X10:return be.COMPRESSED_RGBA_ASTC_10x10_KHR;case G.ASTC_RGBA_12X10:return be.COMPRESSED_RGBA_ASTC_12x10_KHR;case G.ASTC_RGBA_12X12:return be.COMPRESSED_RGBA_ASTC_12x12_KHR;case G.ASTC_SRGBA_4X4:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case G.ASTC_SRGBA_5X4:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case G.ASTC_SRGBA_5X5:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case G.ASTC_SRGBA_6X5:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case G.ASTC_SRGBA_6X6:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case G.ASTC_SRGBA_8X5:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case G.ASTC_SRGBA_8X6:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case G.ASTC_SRGBA_8X8:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case G.ASTC_SRGBA_10X5:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case G.ASTC_SRGBA_10X6:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case G.ASTC_SRGBA_10X8:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case G.ASTC_SRGBA_10X10:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case G.ASTC_SRGBA_12X10:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case G.ASTC_SRGBA_12X12:return be.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return a(16310),pe.RGBA}}function we(e){switch(e){case v.BOOL:return pe.BOOL;case v.BOOL2:return pe.BOOL_VEC2;case v.BOOL3:return pe.BOOL_VEC3;case v.BOOL4:return pe.BOOL_VEC4;case v.INT:return pe.INT;case v.INT2:return pe.INT_VEC2;case v.INT3:return pe.INT_VEC3;case v.INT4:return pe.INT_VEC4;case v.UINT:return pe.UNSIGNED_INT;case v.FLOAT:return pe.FLOAT;case v.FLOAT2:return pe.FLOAT_VEC2;case v.FLOAT3:return pe.FLOAT_VEC3;case v.FLOAT4:return pe.FLOAT_VEC4;case v.MAT2:return pe.FLOAT_MAT2;case v.MAT2X3:return pe.FLOAT_MAT2x3;case v.MAT2X4:return pe.FLOAT_MAT2x4;case v.MAT3X2:return pe.FLOAT_MAT3x2;case v.MAT3:return pe.FLOAT_MAT3;case v.MAT3X4:return pe.FLOAT_MAT3x4;case v.MAT4X2:return pe.FLOAT_MAT4x2;case v.MAT4X3:return pe.FLOAT_MAT4x3;case v.MAT4:return pe.FLOAT_MAT4;case v.SAMPLER2D:return pe.SAMPLER_2D;case v.SAMPLER2D_ARRAY:return pe.SAMPLER_2D_ARRAY;case v.SAMPLER3D:return pe.SAMPLER_3D;case v.SAMPLER_CUBE:return pe.SAMPLER_CUBE;default:return a(16311),v.UNKNOWN}}function He(e){switch(e){case pe.BOOL:return v.BOOL;case pe.BOOL_VEC2:return v.BOOL2;case pe.BOOL_VEC3:return v.BOOL3;case pe.BOOL_VEC4:return v.BOOL4;case pe.INT:return v.INT;case pe.INT_VEC2:return v.INT2;case pe.INT_VEC3:return v.INT3;case pe.INT_VEC4:return v.INT4;case pe.UNSIGNED_INT:return v.UINT;case pe.UNSIGNED_INT_VEC2:return v.UINT2;case pe.UNSIGNED_INT_VEC3:return v.UINT3;case pe.UNSIGNED_INT_VEC4:return v.UINT4;case pe.FLOAT:return v.FLOAT;case pe.FLOAT_VEC2:return v.FLOAT2;case pe.FLOAT_VEC3:return v.FLOAT3;case pe.FLOAT_VEC4:return v.FLOAT4;case pe.FLOAT_MAT2:return v.MAT2;case pe.FLOAT_MAT2x3:return v.MAT2X3;case pe.FLOAT_MAT2x4:return v.MAT2X4;case pe.FLOAT_MAT3x2:return v.MAT3X2;case pe.FLOAT_MAT3:return v.MAT3;case pe.FLOAT_MAT3x4:return v.MAT3X4;case pe.FLOAT_MAT4x2:return v.MAT4X2;case pe.FLOAT_MAT4x3:return v.MAT4X3;case pe.FLOAT_MAT4:return v.MAT4;case pe.SAMPLER_2D:return v.SAMPLER2D;case pe.SAMPLER_2D_ARRAY:return v.SAMPLER2D_ARRAY;case pe.SAMPLER_3D:return v.SAMPLER3D;case pe.SAMPLER_CUBE:return v.SAMPLER_CUBE;default:return a(16313),v.UNKNOWN}}function Xe(e){switch(e){case pe.BOOL:return 4;case pe.BOOL_VEC2:return 8;case pe.BOOL_VEC3:return 12;case pe.BOOL_VEC4:return 16;case pe.INT:return 4;case pe.INT_VEC2:return 8;case pe.INT_VEC3:return 12;case pe.INT_VEC4:return 16;case pe.UNSIGNED_INT:return 4;case pe.UNSIGNED_INT_VEC2:return 8;case pe.UNSIGNED_INT_VEC3:return 12;case pe.UNSIGNED_INT_VEC4:return 16;case pe.FLOAT:return 4;case pe.FLOAT_VEC2:return 8;case pe.FLOAT_VEC3:return 12;case pe.FLOAT_VEC4:case pe.FLOAT_MAT2:return 16;case pe.FLOAT_MAT2x3:return 24;case pe.FLOAT_MAT2x4:return 32;case pe.FLOAT_MAT3x2:return 24;case pe.FLOAT_MAT3:return 36;case pe.FLOAT_MAT3x4:return 48;case pe.FLOAT_MAT4x2:return 32;case pe.FLOAT_MAT4x3:return 48;case pe.FLOAT_MAT4:return 64;case pe.SAMPLER_2D:case pe.SAMPLER_2D_ARRAY:case pe.SAMPLER_2D_ARRAY_SHADOW:case pe.SAMPLER_3D:case pe.SAMPLER_CUBE:case pe.INT_SAMPLER_2D:case pe.INT_SAMPLER_2D_ARRAY:case pe.INT_SAMPLER_3D:case pe.INT_SAMPLER_CUBE:case pe.UNSIGNED_INT_SAMPLER_2D:case pe.UNSIGNED_INT_SAMPLER_2D_ARRAY:case pe.UNSIGNED_INT_SAMPLER_3D:case pe.UNSIGNED_INT_SAMPLER_CUBE:return 4;default:return a(16314),0}}function Ve(e){switch(e){case pe.FLOAT_MAT2:case pe.FLOAT_MAT2x3:case pe.FLOAT_MAT2x4:return 2;case pe.FLOAT_MAT3x2:case pe.FLOAT_MAT3:case pe.FLOAT_MAT3x4:return 3;case pe.FLOAT_MAT4x2:case pe.FLOAT_MAT4x3:case pe.FLOAT_MAT4:return 4;default:return 1}}var ke=[pe.NEVER,pe.LESS,pe.EQUAL,pe.LEQUAL,pe.GREATER,pe.NOTEQUAL,pe.GEQUAL,pe.ALWAYS],Ke=[pe.ZERO,pe.KEEP,pe.REPLACE,pe.INCR,pe.DECR,pe.INVERT,pe.INCR_WRAP,pe.DECR_WRAP],We=[pe.FUNC_ADD,pe.FUNC_SUBTRACT,pe.FUNC_REVERSE_SUBTRACT,pe.MIN,pe.MAX],ze=[pe.ZERO,pe.ONE,pe.SRC_ALPHA,pe.DST_ALPHA,pe.ONE_MINUS_SRC_ALPHA,pe.ONE_MINUS_DST_ALPHA,pe.SRC_COLOR,pe.DST_COLOR,pe.ONE_MINUS_SRC_COLOR,pe.ONE_MINUS_DST_COLOR,pe.SRC_ALPHA_SATURATE,pe.CONSTANT_COLOR,pe.ONE_MINUS_CONSTANT_COLOR,pe.CONSTANT_ALPHA,pe.ONE_MINUS_CONSTANT_ALPHA];function Ye(e,t){var r=e.gl,n=e.getStateCache(),s=t.memUsage&o.HOST?pe.DYNAMIC_DRAW:pe.STATIC_DRAW;if(t.usage&h.VERTEX){t.glTarget=pe.ARRAY_BUFFER;var i=r.createBuffer();i&&(t.glBuffer=i,t.size>0&&(e.extensions.useVAO&&n.glVAO&&(r.bindVertexArray(null),n.glVAO=null),nt.gpuInputAssembler=null,n.glArrayBuffer!==t.glBuffer&&(r.bindBuffer(pe.ARRAY_BUFFER,t.glBuffer),n.glArrayBuffer=t.glBuffer),r.bufferData(pe.ARRAY_BUFFER,t.size,s),r.bindBuffer(pe.ARRAY_BUFFER,null),n.glArrayBuffer=null))}else if(t.usage&h.INDEX){t.glTarget=pe.ELEMENT_ARRAY_BUFFER;var _=r.createBuffer();_&&(t.glBuffer=_,t.size>0&&(e.extensions.useVAO&&n.glVAO&&(r.bindVertexArray(null),n.glVAO=null),nt.gpuInputAssembler=null,n.glElementArrayBuffer!==t.glBuffer&&(r.bindBuffer(pe.ELEMENT_ARRAY_BUFFER,t.glBuffer),n.glElementArrayBuffer=t.glBuffer),r.bufferData(pe.ELEMENT_ARRAY_BUFFER,t.size,s),r.bindBuffer(pe.ELEMENT_ARRAY_BUFFER,null),n.glElementArrayBuffer=null))}else if(t.usage&h.UNIFORM){t.glTarget=pe.UNIFORM_BUFFER;var u=r.createBuffer();u&&t.size>0&&(t.glBuffer=u,n.glUniformBuffer!==t.glBuffer&&(r.bindBuffer(pe.UNIFORM_BUFFER,t.glBuffer),n.glUniformBuffer=t.glBuffer),r.bufferData(pe.UNIFORM_BUFFER,t.size,s),r.bindBuffer(pe.UNIFORM_BUFFER,null),n.glUniformBuffer=null)}else t.usage&h.INDIRECT||t.usage&h.TRANSFER_DST||t.usage&h.TRANSFER_SRC||a(16315),t.glTarget=pe.NONE}function qe(e,t){var r=e.gl,a=e.getStateCache(),n=e.extensions.useVAO;if(t.glBuffer){switch(t.glTarget){case pe.ARRAY_BUFFER:n&&a.glVAO&&(r.bindVertexArray(null),a.glVAO=null),nt.gpuInputAssembler=null,r.bindBuffer(pe.ARRAY_BUFFER,null),a.glArrayBuffer=null;break;case pe.ELEMENT_ARRAY_BUFFER:n&&a.glVAO&&(r.bindVertexArray(null),a.glVAO=null),nt.gpuInputAssembler=null,r.bindBuffer(pe.ELEMENT_ARRAY_BUFFER,null),a.glElementArrayBuffer=null;break;case pe.UNIFORM_BUFFER:r.bindBuffer(pe.UNIFORM_BUFFER,null),a.glUniformBuffer=null}r.deleteBuffer(t.glBuffer),t.glBuffer=null}}function Ze(e,t,r,i,_){if(t.usage&h.INDIRECT){t.indirects.clearDraws();for(var u=r.drawInfos,l=0;l<u.length;++l)t.indirects.setDrawInfo(i+l,u[l])}else{var R=r,c=e.gl,E=e.getStateCache();switch(t.glTarget){case pe.ARRAY_BUFFER:e.extensions.useVAO&&E.glVAO&&(c.bindVertexArray(null),E.glVAO=null),nt.gpuInputAssembler=null,E.glArrayBuffer!==t.glBuffer&&(c.bindBuffer(pe.ARRAY_BUFFER,t.glBuffer),E.glArrayBuffer=t.glBuffer),n.os===s.IOS&&t.memUsage&o.HOST&&0===i&&_===R.byteLength?c.bufferData(t.glTarget,R,c.DYNAMIC_DRAW):_===R.byteLength?c.bufferSubData(t.glTarget,i,R):c.bufferSubData(t.glTarget,i,R.slice(0,_));break;case pe.ELEMENT_ARRAY_BUFFER:e.extensions.useVAO&&E.glVAO&&(c.bindVertexArray(null),E.glVAO=null),nt.gpuInputAssembler=null,E.glElementArrayBuffer!==t.glBuffer&&(c.bindBuffer(pe.ELEMENT_ARRAY_BUFFER,t.glBuffer),E.glElementArrayBuffer=t.glBuffer),n.os===s.IOS&&t.memUsage&o.HOST&&0===i&&_===R.byteLength?c.bufferData(t.glTarget,R,c.DYNAMIC_DRAW):_===R.byteLength?c.bufferSubData(t.glTarget,i,R):c.bufferSubData(t.glTarget,i,R.slice(0,_));break;case pe.UNIFORM_BUFFER:E.glUniformBuffer!==t.glBuffer&&(c.bindBuffer(pe.UNIFORM_BUFFER,t.glBuffer),E.glUniformBuffer=t.glBuffer),n.os===s.IOS&&t.memUsage&o.HOST&&0===i&&_===R.byteLength?c.bufferData(t.glTarget,R,c.DYNAMIC_DRAW):_===R.byteLength?c.bufferSubData(t.glTarget,i,R):c.bufferSubData(t.glTarget,i,new Float32Array(R,0,_/4));break;default:a(16316)}}}function je(e,t){var r=e.gl,n=e.getStateCache(),s=e.capabilities;t.glInternalFmt=Ne(t.format),t.glFormat=ye(t.format),t.glType=Ue(t.format);var i=t.width,_=t.height,u=t.depth,l=t.arrayLayer;switch(t.type){case B.TEX2D:t.glTarget=pe.TEXTURE_2D;var R=Le(i,_);if(R>s.maxTextureSize&&a(9100,R,s.maxTextureSize),t.samples===d.X1){if(t.glTexture=r.createTexture(),t.size>0){var c=n.glTexUnits[n.texUnit];if(c.glTexture!==t.glTexture&&(r.bindTexture(pe.TEXTURE_2D,t.glTexture),c.glTexture=t.glTexture),C[t.format].isCompressed)for(var E=0;E<t.mipLevel;++E){var f=p(t.format,i,_,1),A=new Uint8Array(f);r.compressedTexImage2D(pe.TEXTURE_2D,E,t.glInternalFmt,i,_,0,A),i=Le(1,i>>1),_=Le(1,_>>1)}else t.flags&x.MUTABLE_STORAGE?r.texImage2D(pe.TEXTURE_2D,0,t.glInternalFmt,i,_,0,t.glFormat,t.glType,null):r.texStorage2D(pe.TEXTURE_2D,t.mipLevel,t.glInternalFmt,i,_)}}else t.glRenderbuffer=r.createRenderbuffer(),t.size>0&&(n.glRenderbuffer!==t.glRenderbuffer&&(r.bindRenderbuffer(pe.RENDERBUFFER,t.glRenderbuffer),n.glRenderbuffer=t.glRenderbuffer),r.renderbufferStorageMultisample(pe.RENDERBUFFER,t.samples,t.glInternalFmt,t.width,t.height));break;case B.TEX2D_ARRAY:t.glTarget=pe.TEXTURE_2D_ARRAY;var T=Le(i,_);if(T>s.maxTextureSize&&a(9100,T,s.maxTextureSize),l>s.maxArrayTextureLayers&&a(9100,l,s.maxArrayTextureLayers),t.glTexture=r.createTexture(),t.size>0){var S=n.glTexUnits[n.texUnit];if(S.glTexture!==t.glTexture&&(r.bindTexture(pe.TEXTURE_2D_ARRAY,t.glTexture),S.glTexture=t.glTexture),C[t.format].isCompressed)for(var g=0;g<t.mipLevel;++g){var o=p(t.format,i,_,l),h=new Uint8Array(o);r.compressedTexImage3D(pe.TEXTURE_2D_ARRAY,g,t.glInternalFmt,i,_,l,0,h),i=Le(1,i>>1),_=Le(1,_>>1)}else r.texStorage3D(pe.TEXTURE_2D_ARRAY,t.mipLevel,t.glInternalFmt,i,_,l)}break;case B.TEX3D:t.glTarget=pe.TEXTURE_3D;var G=Le(Le(i,_),u);if(G>s.max3DTextureSize&&a(9100,G,s.max3DTextureSize),t.glTexture=r.createTexture(),t.size>0){var m=n.glTexUnits[n.texUnit];if(m.glTexture!==t.glTexture&&(r.bindTexture(pe.TEXTURE_3D,t.glTexture),m.glTexture=t.glTexture),C[t.format].isCompressed)for(var I=0;I<t.mipLevel;++I){var F=p(t.format,i,_,u),b=new Uint8Array(F);r.compressedTexImage3D(pe.TEXTURE_3D,I,t.glInternalFmt,i,_,u,0,b),i=Le(1,i>>1),_=Le(1,_>>1)}else r.texStorage3D(pe.TEXTURE_3D,t.mipLevel,t.glInternalFmt,i,_,u)}break;case B.CUBE:t.glTarget=pe.TEXTURE_CUBE_MAP;var O=Le(i,_);if(O>s.maxCubeMapTextureSize&&a(9100,O,s.maxTextureSize),t.glTexture=r.createTexture(),t.size>0){var P=n.glTexUnits[n.texUnit];if(P.glTexture!==t.glTexture&&(r.bindTexture(pe.TEXTURE_CUBE_MAP,t.glTexture),P.glTexture=t.glTexture),C[t.format].isCompressed)for(var D=0;D<t.mipLevel;++D){for(var M=p(t.format,i,_,1),L=new Uint8Array(M),v=0;v<6;++v)r.compressedTexImage2D(pe.TEXTURE_CUBE_MAP_POSITIVE_X+v,D,t.glInternalFmt,i,_,0,L);i=Le(1,i>>1),_=Le(1,_>>1)}else r.texStorage2D(pe.TEXTURE_CUBE_MAP,t.mipLevel,t.glInternalFmt,i,_)}break;default:a(16317),t.type=B.TEX2D,t.glTarget=pe.TEXTURE_2D}}function Qe(e,t){var r=e.gl,a=e.getStateCache();if(t.glTexture){var n=a.glTexUnits,s=a.texUnit;r.deleteTexture(t.glTexture);for(var i=0;i<n.length;++i)n[i].glTexture===t.glTexture&&(r.activeTexture(pe.TEXTURE0+i),s=i,r.bindTexture(t.glTarget,null),n[i].glTexture=null);a.texUnit=s,t.glTexture=null}if(t.glRenderbuffer){var _=a.glRenderbuffer;r.deleteRenderbuffer(t.glRenderbuffer),_===t.glRenderbuffer&&(r.bindRenderbuffer(pe.RENDERBUFFER,null),a.glRenderbuffer=null),t.glRenderbuffer=null}}function Je(e,t){if(t.size){var r=e.gl,n=e.getStateCache(),s=e.capabilities,i=t.width,_=t.height,u=t.depth,l=t.arrayLayer;switch(t.type){case B.TEX2D:t.glTarget=pe.TEXTURE_2D;var R=Le(i,_);if(R>s.maxTextureSize&&a(9100,R,s.maxTextureSize),t.samples===d.X1){var c=n.glTexUnits[n.texUnit];if(c.glTexture!==t.glTexture&&(r.bindTexture(pe.TEXTURE_2D,t.glTexture),c.glTexture=t.glTexture),C[t.format].isCompressed)for(var E=0;E<t.mipLevel;++E){var f=p(t.format,i,_,1),A=new Uint8Array(f);r.compressedTexImage2D(pe.TEXTURE_2D,E,t.glInternalFmt,i,_,0,A),i=Le(1,i>>1),_=Le(1,_>>1)}else Qe(e,t),je(e,t)}else t.glRenderbuffer&&(n.glRenderbuffer!==t.glRenderbuffer&&(r.bindRenderbuffer(pe.RENDERBUFFER,t.glRenderbuffer),n.glRenderbuffer=t.glRenderbuffer),r.renderbufferStorageMultisample(pe.RENDERBUFFER,t.samples,t.glInternalFmt,t.width,t.height));break;case B.TEX2D_ARRAY:t.glTarget=pe.TEXTURE_2D_ARRAY;var T=Le(i,_);if(T>s.maxTextureSize&&a(9100,T,s.maxTextureSize),l>s.maxArrayTextureLayers&&a(9100,l,s.maxArrayTextureLayers),t.glTexture=r.createTexture(),t.size>0){var S=n.glTexUnits[n.texUnit];if(S.glTexture!==t.glTexture&&(r.bindTexture(pe.TEXTURE_2D_ARRAY,t.glTexture),S.glTexture=t.glTexture),C[t.format].isCompressed)for(var g=0;g<t.mipLevel;++g){var o=p(t.format,i,_,l),h=new Uint8Array(o);r.compressedTexImage3D(pe.TEXTURE_2D_ARRAY,g,t.glInternalFmt,i,_,l,0,h),i=Le(1,i>>1),_=Le(1,_>>1)}else r.texStorage3D(pe.TEXTURE_2D_ARRAY,t.mipLevel,t.glInternalFmt,i,_,l)}break;case B.TEX3D:t.glTarget=pe.TEXTURE_3D;var x=Le(Le(i,_),u);if(x>s.max3DTextureSize&&a(9100,x,s.max3DTextureSize),t.glTexture=r.createTexture(),t.size>0){var G=n.glTexUnits[n.texUnit];if(G.glTexture!==t.glTexture&&(r.bindTexture(pe.TEXTURE_3D,t.glTexture),G.glTexture=t.glTexture),C[t.format].isCompressed)for(var m=0;m<t.mipLevel;++m){var I=p(t.format,i,_,u),F=new Uint8Array(I);r.compressedTexImage3D(pe.TEXTURE_3D,m,t.glInternalFmt,i,_,u,0,F),i=Le(1,i>>1),_=Le(1,_>>1)}else r.texStorage3D(pe.TEXTURE_3D,t.mipLevel,t.glInternalFmt,i,_,u)}break;case B.CUBE:t.type=B.CUBE,t.glTarget=pe.TEXTURE_CUBE_MAP;var b=Le(i,_);b>s.maxCubeMapTextureSize&&a(9100,b,s.maxTextureSize);var O=n.glTexUnits[n.texUnit];if(O.glTexture!==t.glTexture&&(r.bindTexture(pe.TEXTURE_CUBE_MAP,t.glTexture),O.glTexture=t.glTexture),C[t.format].isCompressed)for(var P=0;P<6;++P){i=t.width,_=t.height;for(var D=0;D<t.mipLevel;++D){var M=p(t.format,i,_,1),L=new Uint8Array(M);r.compressedTexImage2D(pe.TEXTURE_CUBE_MAP_POSITIVE_X+P,D,t.glInternalFmt,i,_,0,L),i=Le(1,i>>1),_=Le(1,_>>1)}}else Qe(e,t),je(e,t);break;default:a(16317),t.type=B.TEX2D,t.glTarget=pe.TEXTURE_2D}}}function $e(e,t){for(var r=e.gl,a=t.glSamplers.values().next();!a.done;){r.deleteSampler(a.value);for(var n=e.getStateCache().glSamplerUnits,s=0;s<n.length;++s)n[s]===a.value&&(r.bindSampler(s,null),n[s]=null)}t.glSamplers.clear()}function et(e,t){for(var r=e.getStateCache(),n=0;n<t.gpuColorViews.length;++n)if(t.gpuColorViews[n].gpuTexture.isSwapchainTexture)return void(t.isOffscreen=!1);var s=e.gl,i=[],_=s.createFramebuffer();if(_){t.glFramebuffer=_,r.glFramebuffer!==t.glFramebuffer&&s.bindFramebuffer(pe.FRAMEBUFFER,t.glFramebuffer);for(var u=0;u<t.gpuColorViews.length;++u){var l=t.gpuColorViews[u],R=l.gpuTexture;R&&(R.glTexture?s.framebufferTexture2D(pe.FRAMEBUFFER,pe.COLOR_ATTACHMENT0+u,R.glTarget,R.glTexture,l.baseLevel):s.framebufferRenderbuffer(pe.FRAMEBUFFER,pe.COLOR_ATTACHMENT0+u,pe.RENDERBUFFER,R.glRenderbuffer),i.push(pe.COLOR_ATTACHMENT0+u),t.width=ve(t.width,R.width>>l.baseLevel),t.height=ve(t.height,R.height>>l.baseLevel))}var c=t.gpuDepthStencilView;if(c){var E=c.gpuTexture,f=C[E.format].hasStencil?pe.DEPTH_STENCIL_ATTACHMENT:pe.DEPTH_ATTACHMENT;E.glTexture?s.framebufferTexture2D(pe.FRAMEBUFFER,f,E.glTarget,E.glTexture,t.gpuDepthStencilView.baseLevel):s.framebufferRenderbuffer(pe.FRAMEBUFFER,f,pe.RENDERBUFFER,E.glRenderbuffer),t.width=ve(t.width,E.width>>c.baseLevel),t.height=ve(t.height,E.height>>c.baseLevel)}s.drawBuffers(i);var A=s.checkFramebufferStatus(pe.FRAMEBUFFER);if(A!==pe.FRAMEBUFFER_COMPLETE)switch(A){case pe.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:a(16318);break;case pe.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:a(16319);break;case pe.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:a(16320);break;case pe.FRAMEBUFFER_UNSUPPORTED:a(16321)}r.glFramebuffer!==t.glFramebuffer&&s.bindFramebuffer(pe.FRAMEBUFFER,r.glFramebuffer)}}function tt(e,t){for(var r,n=e.gl,s=e.getStateCache(),i=e.capabilities,l=function(){var e=t.gpuStages[R],r=0,s="",i=1;switch(e.type){case y.VERTEX:s="VertexShader",r=pe.VERTEX_SHADER;break;case y.FRAGMENT:s="FragmentShader",r=pe.FRAGMENT_SHADER;break;default:return a(16322),{v:void 0}}var _=n.createShader(r);if(_&&(e.glShader=_,n.shaderSource(e.glShader,"#version 300 es\n"+e.source),n.compileShader(e.glShader),!n.getShaderParameter(e.glShader,pe.COMPILE_STATUS))){a(16323,s,t.name),a(16324,e.source.replace(/^|\n/g,(function(){return"\n"+i+++" "}))),u(n.getShaderInfoLog(e.glShader));for(var l=0;l<t.gpuStages.length;l++){var c=t.gpuStages[R];c.glShader&&(n.deleteShader(c.glShader),c.glShader=null)}return{v:void 0}}},R=0;R<t.gpuStages.length;R++)if(r=l())return r.v;var c=n.createProgram();if(c){t.glProgram=c;for(var E=!(!de.rendering||!de.rendering.enableEffectImport),f=0;f<t.gpuStages.length;f++){var A=t.gpuStages[f];n.attachShader(t.glProgram,A.glShader)}n.linkProgram(t.glProgram);for(var T=0;T<t.gpuStages.length;T++){var S=t.gpuStages[T];S.glShader&&(n.detachShader(t.glProgram,S.glShader),n.deleteShader(S.glShader),S.glShader=null)}if(!n.getProgramParameter(t.glProgram,pe.LINK_STATUS))return a(16326,t.name),void u(n.getProgramInfoLog(t.glProgram));_(16325,t.name);var g=n.getProgramParameter(t.glProgram,pe.ACTIVE_ATTRIBUTES);t.glInputs=new Array(g);for(var o=0;o<g;++o){var h=n.getActiveAttrib(t.glProgram,o);if(h){var B,C=h.name.indexOf("[");B=-1!==C?h.name.substring(0,C):h.name;var p=n.getAttribLocation(t.glProgram,B),d=He(h.type),x=Xe(h.type);t.glInputs[o]={name:B,type:d,stride:x,count:h.size,size:x*h.size,glType:h.type,glLoc:p}}}var G,m,I,F,b=n.getProgramParameter(t.glProgram,pe.ACTIVE_UNIFORM_BLOCKS);if(b){t.glBlocks=new Array(b);for(var O=0;O<b;++O){var P=(G=n.getActiveUniformBlockName(t.glProgram,O)).indexOf("[");-1!==P&&(G=G.substring(0,P)),F=null;for(var D=0;D<t.blocks.length;D++)if(t.blocks[D].name===G){F=t.blocks[D];break}if(F){m=O,I=n.getActiveUniformBlockParameter(t.glProgram,m,pe.UNIFORM_BLOCK_DATA_SIZE);var M=E?F.flattened:F.binding+(e.bindingMappings.blockOffsets[F.set]||0);n.uniformBlockBinding(t.glProgram,m,M),t.glBlocks[O]={set:F.set,binding:F.binding,idx:m,name:G,size:I,glBinding:M}}else a(16404,G)}}for(var U=0;U<t.subpassInputs.length;++U){var N=t.subpassInputs[U];t.samplerTextures.push(new L(N.set,N.binding,N.name,v.SAMPLER2D,N.count))}if(t.samplerTextures.length>0){t.glSamplerTextures=new Array(t.samplerTextures.length);for(var w=0;w<t.samplerTextures.length;++w){var H=t.samplerTextures[w];t.glSamplerTextures[w]={set:H.set,binding:H.binding,name:H.name,type:H.type,count:H.count,units:[],glUnits:null,glType:we(H.type),glLoc:null}}}var X=[],V=[],k=s.texUnitCacheMap;if(E)for(var K=0;K<t.samplerTextures.length;++K){var W=t.samplerTextures[K],z=n.getUniformLocation(t.glProgram,W.name);z&&-1!==z.id&&(X.push(t.glSamplerTextures[K]),V.push(z)),void 0===k[W.name]&&(k[W.name]=W.flattened%i.maxTextureUnits)}else{for(var Y=0,q=0;q<t.blocks.length;++q)t.blocks[q].set===e.bindingMappings.flexibleSet&&Y++;for(var Z=0,j=0;j<t.samplerTextures.length;++j){var Q=t.samplerTextures[j],J=n.getUniformLocation(t.glProgram,Q.name);if(J&&-1!==J.id&&(X.push(t.glSamplerTextures[j]),V.push(J)),void 0===k[Q.name]){var $=Q.binding+e.bindingMappings.samplerTextureOffsets[Q.set]+Z;Q.set===e.bindingMappings.flexibleSet&&($-=Y),k[Q.name]=$%i.maxTextureUnits,Z+=Q.count-1}}}if(X.length){for(var ee=[],te=0;te<X.length;++te){var re=X[te],ae=k[re.name];if(void 0!==ae){re.glLoc=V[te];for(var ne=0;ne<re.count;++ne){for(;ee[ae];)ae=(ae+1)%i.maxTextureUnits;re.units.push(ae),ee[ae]=!0}}}for(var se=0,ie=0;ie<X.length;++ie){var _e=X[ie];if(!_e.glLoc){for(_e.glLoc=V[ie];ee[se];)se++;for(var ue=0;ue<_e.count;++ue){for(;ee[se];)se=(se+1)%i.maxTextureUnits;void 0===k[_e.name]&&(k[_e.name]=se),_e.units.push(se),ee[se]=!0}}}s.glProgram!==t.glProgram&&n.useProgram(t.glProgram);for(var le=0;le<X.length;le++){var Re=X[le];Re.glUnits=new Int32Array(Re.units),n.uniform1iv(Re.glLoc,Re.glUnits)}s.glProgram!==t.glProgram&&n.useProgram(s.glProgram)}t.glSamplerTextures=X}}function rt(e,t){e.gl,t.glAttribs=new Array(t.attributes.length);for(var r=[0,0,0,0,0,0,0,0],a=0;a<t.attributes.length;++a){var n=t.attributes[a],s=void 0!==n.stream?n.stream:0,i=t.gpuVertexBuffers[s],_=Ue(n.format),u=C[n.format].size;t.glAttribs[a]={name:n.name,glBuffer:i.glBuffer,glType:_,size:u,count:C[n.format].count,stride:i.stride,componentCount:Ve(_),isNormalized:void 0!==n.isNormalized&&n.isNormalized,isInstanced:void 0!==n.isInstanced&&n.isInstanced,offset:r[s]},r[s]+=u}}function at(e,t){for(var r=e.gl,a=e.getStateCache(),n=t.glVAOs.values(),s=n.next(),i=a.glVAO;!s.done;)r.deleteVertexArray(s.value),i===s.value&&(r.bindVertexArray(null),i=null),s=n.next();a.glVAO=i,t.glVAOs.clear()}var nt={gpuPipelineState:null,gpuInputAssembler:null,glPrimitive:0,invalidateAttachments:[]};function st(e,t,r,a,n,s,i){var _=e.gl,u=e.getStateCache(),l=0;if(r&&t){u.glFramebuffer!==r.glFramebuffer&&(_.bindFramebuffer(pe.FRAMEBUFFER,r.glFramebuffer),u.glFramebuffer=r.glFramebuffer),u.viewport.left===a.x&&u.viewport.top===a.y&&u.viewport.width===a.width&&u.viewport.height===a.height||(_.viewport(a.x,a.y,a.width,a.height),u.viewport.left=a.x,u.viewport.top=a.y,u.viewport.width=a.width,u.viewport.height=a.height),u.scissorRect.x===a.x&&u.scissorRect.y===a.y&&u.scissorRect.width===a.width&&u.scissorRect.height===a.height||(_.scissor(a.x,a.y,a.width,a.height),u.scissorRect.x=a.x,u.scissorRect.y=a.y,u.scissorRect.width=a.width,u.scissorRect.height=a.height),nt.invalidateAttachments.length=0;for(var R=0;R<n.length;++R){var c=t.colorAttachments[R];if(c.format!==G.UNKNOWN)switch(c.loadOp){case m.LOAD:break;case m.CLEAR:if(u.bs.targets[0].blendColorMask!==I.ALL&&_.colorMask(!0,!0,!0,!0),1===t.colorAttachments.length){var E=n[0];_.clearColor(E.x,E.y,E.z,E.w),l|=pe.COLOR_BUFFER_BIT}else Me[0]=n[R].x,Me[1]=n[R].y,Me[2]=n[R].z,Me[3]=n[R].w,_.clearBufferfv(pe.COLOR,R,Me);break;case m.DISCARD:nt.invalidateAttachments.push(pe.COLOR_ATTACHMENT0+R)}}if(t.depthStencilAttachment&&t.depthStencilAttachment.format!==G.UNKNOWN){switch(t.depthStencilAttachment.depthLoadOp){case m.LOAD:break;case m.CLEAR:u.dss.depthWrite||_.depthMask(!0),_.clearDepth(s),l|=pe.DEPTH_BUFFER_BIT;break;case m.DISCARD:nt.invalidateAttachments.push(pe.DEPTH_ATTACHMENT)}if(C[t.depthStencilAttachment.format].hasStencil)switch(t.depthStencilAttachment.stencilLoadOp){case m.LOAD:break;case m.CLEAR:u.dss.stencilWriteMaskFront||_.stencilMaskSeparate(pe.FRONT,65535),u.dss.stencilWriteMaskBack||_.stencilMaskSeparate(pe.BACK,65535),_.clearStencil(i),l|=pe.STENCIL_BUFFER_BIT;break;case m.DISCARD:nt.invalidateAttachments.push(pe.STENCIL_ATTACHMENT)}}if(r.glFramebuffer&&nt.invalidateAttachments.length&&_.invalidateFramebuffer(pe.FRAMEBUFFER,nt.invalidateAttachments),l&&_.clear(l),l&pe.COLOR_BUFFER_BIT){var f=u.bs.targets[0].blendColorMask;if(f!==I.ALL){var A=(f&I.R)!==I.NONE,T=(f&I.G)!==I.NONE,S=(f&I.B)!==I.NONE,g=(f&I.A)!==I.NONE;_.colorMask(A,T,S,g)}}l&pe.DEPTH_BUFFER_BIT&&!u.dss.depthWrite&&_.depthMask(!1),l&pe.STENCIL_BUFFER_BIT&&(u.dss.stencilWriteMaskFront||_.stencilMaskSeparate(pe.FRONT,0),u.dss.stencilWriteMaskBack||_.stencilMaskSeparate(pe.BACK,0))}}function it(e,t,r,a,n,s){var i=e.gl,_=e.capabilities,u=e.getStateCache(),l=u.rs,R=u.dss,c=u.bs,E=c.blendColor,f=t&&t.gpuShader,A=!1;if(t&&nt.gpuPipelineState!==t){if(nt.gpuPipelineState=t,nt.glPrimitive=t.glPrimitive,f){var T=f.glProgram;u.glProgram!==T&&(i.useProgram(T),u.glProgram=T,A=!0)}var S=t.rs;if(S){if(l.cullMode!==S.cullMode){switch(S.cullMode){case F.NONE:i.disable(pe.CULL_FACE);break;case F.FRONT:i.enable(pe.CULL_FACE),i.cullFace(pe.FRONT);break;case F.BACK:i.enable(pe.CULL_FACE),i.cullFace(pe.BACK)}l.cullMode=S.cullMode}var g=S.isFrontFaceCCW;l.isFrontFaceCCW!==g&&(i.frontFace(g?pe.CCW:pe.CW),l.isFrontFaceCCW=g),l.depthBias===S.depthBias&&l.depthBiasSlop===S.depthBiasSlop||(i.polygonOffset(S.depthBias,S.depthBiasSlop),l.depthBias=S.depthBias,l.depthBiasSlop=S.depthBiasSlop),l.lineWidth!==S.lineWidth&&(i.lineWidth(S.lineWidth),l.lineWidth=S.lineWidth)}var o=t.dss;o&&(R.depthTest!==o.depthTest&&(o.depthTest?i.enable(pe.DEPTH_TEST):i.disable(pe.DEPTH_TEST),R.depthTest=o.depthTest),R.depthWrite!==o.depthWrite&&(i.depthMask(o.depthWrite),R.depthWrite=o.depthWrite),R.depthFunc!==o.depthFunc&&(i.depthFunc(ke[o.depthFunc]),R.depthFunc=o.depthFunc),R.stencilTestFront===o.stencilTestFront&&R.stencilTestBack===o.stencilTestBack||(o.stencilTestFront||o.stencilTestBack?i.enable(pe.STENCIL_TEST):i.disable(pe.STENCIL_TEST),R.stencilTestFront=o.stencilTestFront,R.stencilTestBack=o.stencilTestBack),R.stencilFuncFront===o.stencilFuncFront&&R.stencilRefFront===o.stencilRefFront&&R.stencilReadMaskFront===o.stencilReadMaskFront||(i.stencilFuncSeparate(pe.FRONT,ke[o.stencilFuncFront],o.stencilRefFront,o.stencilReadMaskFront),R.stencilFuncFront=o.stencilFuncFront,R.stencilRefFront=o.stencilRefFront,R.stencilReadMaskFront=o.stencilReadMaskFront),R.stencilFailOpFront===o.stencilFailOpFront&&R.stencilZFailOpFront===o.stencilZFailOpFront&&R.stencilPassOpFront===o.stencilPassOpFront||(i.stencilOpSeparate(pe.FRONT,Ke[o.stencilFailOpFront],Ke[o.stencilZFailOpFront],Ke[o.stencilPassOpFront]),R.stencilFailOpFront=o.stencilFailOpFront,R.stencilZFailOpFront=o.stencilZFailOpFront,R.stencilPassOpFront=o.stencilPassOpFront),R.stencilWriteMaskFront!==o.stencilWriteMaskFront&&(i.stencilMaskSeparate(pe.FRONT,o.stencilWriteMaskFront),R.stencilWriteMaskFront=o.stencilWriteMaskFront),R.stencilFuncBack===o.stencilFuncBack&&R.stencilRefBack===o.stencilRefBack&&R.stencilReadMaskBack===o.stencilReadMaskBack||(i.stencilFuncSeparate(pe.BACK,ke[o.stencilFuncBack],o.stencilRefBack,o.stencilReadMaskBack),R.stencilFuncBack=o.stencilFuncBack,R.stencilRefBack=o.stencilRefBack,R.stencilReadMaskBack=o.stencilReadMaskBack),R.stencilFailOpBack===o.stencilFailOpBack&&R.stencilZFailOpBack===o.stencilZFailOpBack&&R.stencilPassOpBack===o.stencilPassOpBack||(i.stencilOpSeparate(pe.BACK,Ke[o.stencilFailOpBack],Ke[o.stencilZFailOpBack],Ke[o.stencilPassOpBack]),R.stencilFailOpBack=o.stencilFailOpBack,R.stencilZFailOpBack=o.stencilZFailOpBack,R.stencilPassOpBack=o.stencilPassOpBack),R.stencilWriteMaskBack!==o.stencilWriteMaskBack&&(i.stencilMaskSeparate(pe.BACK,o.stencilWriteMaskBack),R.stencilWriteMaskBack=o.stencilWriteMaskBack));var h=t.bs;if(h){c.isA2C!==h.isA2C&&(h.isA2C?i.enable(pe.SAMPLE_ALPHA_TO_COVERAGE):i.disable(pe.SAMPLE_ALPHA_TO_COVERAGE),c.isA2C=h.isA2C);var B=h.blendColor;E.x===B.x&&E.y===B.y&&E.z===B.z&&E.w===B.w||(i.blendColor(B.x,B.y,B.z,B.w),E.x=B.x,E.y=B.y,E.z=B.z,E.w=B.w);var C=h.targets[0],p=u.bs.targets[0];p.blend!==C.blend&&(C.blend?i.enable(pe.BLEND):i.disable(pe.BLEND),p.blend=C.blend),p.blendEq===C.blendEq&&p.blendAlphaEq===C.blendAlphaEq||(i.blendEquationSeparate(We[C.blendEq],We[C.blendAlphaEq]),p.blendEq=C.blendEq,p.blendAlphaEq=C.blendAlphaEq),p.blendSrc===C.blendSrc&&p.blendDst===C.blendDst&&p.blendSrcAlpha===C.blendSrcAlpha&&p.blendDstAlpha===C.blendDstAlpha||(i.blendFuncSeparate(ze[C.blendSrc],ze[C.blendDst],ze[C.blendSrcAlpha],ze[C.blendDstAlpha]),p.blendSrc=C.blendSrc,p.blendDst=C.blendDst,p.blendSrcAlpha=C.blendSrcAlpha,p.blendDstAlpha=C.blendDstAlpha),p.blendColorMask!==C.blendColorMask&&(i.colorMask((C.blendColorMask&I.R)!==I.NONE,(C.blendColorMask&I.G)!==I.NONE,(C.blendColorMask&I.B)!==I.NONE,(C.blendColorMask&I.A)!==I.NONE),p.blendColorMask=C.blendColorMask)}}if(t&&t.gpuPipelineLayout&&f){for(var d=f.glBlocks.length,x=t.gpuPipelineLayout.dynamicOffsetIndices,G=0;G<d;G++){var m=f.glBlocks[G],O=a[m.set],P=O&&O.descriptorIndices[m.binding],D=P>=0&&O.gpuDescriptors[P];if(D&&D.gpuBuffer){var M=x[m.set],L=M&&M[m.binding],v=D.gpuBuffer.glOffset;L>=0&&(v+=n[L]),u.glBindUBOs[m.glBinding]===D.gpuBuffer.glBuffer&&u.glBindUBOOffsets[m.glBinding]===v||(v?i.bindBufferRange(pe.UNIFORM_BUFFER,m.glBinding,D.gpuBuffer.glBuffer,v,D.gpuBuffer.size):i.bindBufferBase(pe.UNIFORM_BUFFER,m.glBinding,D.gpuBuffer.glBuffer),u.glUniformBuffer=u.glBindUBOs[m.glBinding]=D.gpuBuffer.glBuffer,u.glBindUBOOffsets[m.glBinding]=v)}}for(var U=f.glSamplerTextures.length,N=0;N<U;N++)for(var y=f.glSamplerTextures[N],w=a[y.set],H=w&&w.descriptorIndices[y.binding],X=H>=0&&w.gpuDescriptors[H],V=0;V<y.units.length;V++){var k=y.units[V],K=u.glTexUnits[k];if(X&&X.gpuTextureView&&X.gpuTextureView.gpuTexture&&X.gpuSampler){var W=X.gpuTextureView,z=W.gpuTexture,Y=W.baseLevel,q=Y+W.levelCount;if(z.size>0){K.glTexture!==z.glTexture&&(u.texUnit!==k&&(i.activeTexture(pe.TEXTURE0+k),u.texUnit=k),z.glTexture?i.bindTexture(z.glTarget,z.glTexture):i.bindTexture(z.glTarget,e.nullTex2D.gpuTexture.glTexture),K.glTexture=z.glTexture);var Z=X.gpuSampler.getGLSampler(e,Y,q);u.glSamplerUnits[k]!==Z&&(i.bindSampler(k,Z),u.glSamplerUnits[k]=Z)}X=w.gpuDescriptors[++H]}}}if(r&&f&&(A||nt.gpuInputAssembler!==r))if(nt.gpuInputAssembler=r,e.extensions.useVAO){var j=r.glVAOs.get(f.glProgram);if(!j){var Q;j=i.createVertexArray(),r.glVAOs.set(f.glProgram,j),i.bindVertexArray(j),i.bindBuffer(pe.ARRAY_BUFFER,null),i.bindBuffer(pe.ELEMENT_ARRAY_BUFFER,null),u.glArrayBuffer=null,u.glElementArrayBuffer=null;for(var J=0;J<f.glInputs.length;J++){var $=f.glInputs[J];Q=null;for(var ee=0;ee<r.glAttribs.length;ee++){var te=r.glAttribs[ee];if(te.name===$.name){Q=te;break}}if(Q){u.glArrayBuffer!==Q.glBuffer&&(i.bindBuffer(pe.ARRAY_BUFFER,Q.glBuffer),u.glArrayBuffer=Q.glBuffer);for(var re=0;re<Q.componentCount;++re){var ae=$.glLoc+re,ne=Q.offset+Q.size*re;i.enableVertexAttribArray(ae),u.glCurrentAttribLocs[ae]=!0,i.vertexAttribPointer(ae,Q.count,Q.glType,Q.isNormalized,Q.stride,ne),i.vertexAttribDivisor(ae,Q.isInstanced?1:0)}}}var se=r.gpuIndexBuffer;se&&i.bindBuffer(pe.ELEMENT_ARRAY_BUFFER,se.glBuffer),i.bindVertexArray(null),i.bindBuffer(pe.ARRAY_BUFFER,null),i.bindBuffer(pe.ELEMENT_ARRAY_BUFFER,null),u.glArrayBuffer=null,u.glElementArrayBuffer=null}u.glVAO!==j&&(i.bindVertexArray(j),u.glVAO=j)}else{for(var ie=0;ie<_.maxVertexAttributes;++ie)u.glCurrentAttribLocs[ie]=!1;for(var _e=0;_e<f.glInputs.length;_e++){for(var ue=f.glInputs[_e],le=null,Re=0;Re<r.glAttribs.length;Re++){var ce=r.glAttribs[Re];if(ce.name===ue.name){le=ce;break}}if(le){u.glArrayBuffer!==le.glBuffer&&(i.bindBuffer(pe.ARRAY_BUFFER,le.glBuffer),u.glArrayBuffer=le.glBuffer);for(var Ee=0;Ee<le.componentCount;++Ee){var fe=ue.glLoc+Ee,Ae=le.offset+le.size*Ee;!u.glEnabledAttribLocs[fe]&&fe>=0&&(i.enableVertexAttribArray(fe),u.glEnabledAttribLocs[fe]=!0),u.glCurrentAttribLocs[fe]=!0,i.vertexAttribPointer(fe,le.count,le.glType,le.isNormalized,le.stride,Ae),i.vertexAttribDivisor(fe,le.isInstanced?1:0)}}}var Te=r.gpuIndexBuffer;Te&&u.glElementArrayBuffer!==Te.glBuffer&&(i.bindBuffer(pe.ELEMENT_ARRAY_BUFFER,Te.glBuffer),u.glElementArrayBuffer=Te.glBuffer);for(var Se=0;Se<_.maxVertexAttributes;++Se)u.glEnabledAttribLocs[Se]!==u.glCurrentAttribLocs[Se]&&(i.disableVertexAttribArray(Se),u.glEnabledAttribLocs[Se]=!1)}if(t&&t.dynamicStates.length)for(var ge=t.dynamicStates.length,oe=0;oe<ge;oe++)switch(t.dynamicStates[oe]){case b.LINE_WIDTH:l.lineWidth!==s.lineWidth&&(i.lineWidth(s.lineWidth),l.lineWidth=s.lineWidth);break;case b.DEPTH_BIAS:l.depthBias===s.depthBiasConstant&&u.rs.depthBiasSlop===s.depthBiasSlope||(i.polygonOffset(s.depthBiasConstant,s.depthBiasSlope),l.depthBias=s.depthBiasConstant,l.depthBiasSlop=s.depthBiasSlope);break;case b.BLEND_CONSTANTS:var he=s.blendConstant;E.x===he.x&&E.y===he.y&&E.z===he.z&&E.w===he.w||(i.blendColor(he.x,he.y,he.z,he.w),E.copy(he));break;case b.STENCIL_WRITE_MASK:var Be=s.stencilStatesFront,Ce=s.stencilStatesBack;R.stencilWriteMaskFront!==Be.writeMask&&(i.stencilMaskSeparate(pe.FRONT,Be.writeMask),R.stencilWriteMaskFront=Be.writeMask),R.stencilWriteMaskBack!==Ce.writeMask&&(i.stencilMaskSeparate(pe.BACK,Ce.writeMask),R.stencilWriteMaskBack=Ce.writeMask);break;case b.STENCIL_COMPARE_MASK:var de=s.stencilStatesFront,xe=s.stencilStatesBack;R.stencilRefFront===de.reference&&R.stencilReadMaskFront===de.compareMask||(i.stencilFuncSeparate(pe.FRONT,ke[R.stencilFuncFront],de.reference,de.compareMask),R.stencilRefFront=de.reference,R.stencilReadMaskFront=de.compareMask),R.stencilRefBack===xe.reference&&R.stencilReadMaskBack===xe.compareMask||(i.stencilFuncSeparate(pe.BACK,ke[R.stencilFuncBack],xe.reference,xe.compareMask),R.stencilRefBack=xe.reference,R.stencilReadMaskBack=xe.compareMask)}}function _t(e,t){var r=e.gl,a=nt.gpuInputAssembler,n=nt.glPrimitive,s=e.extensions.WEBGL_multi_draw;if(a){var i=a.gpuIndexBuffer;if(a.gpuIndirectBuffer){var _=a.gpuIndirectBuffer.indirects;if(_.drawByIndex){for(var u=0;u<_.drawCount;u++)_.byteOffsets[u]=_.offsets[u]*i.stride;if(s)_.instancedDraw?s.multiDrawElementsInstancedWEBGL(n,_.counts,0,a.glIndexType,_.byteOffsets,0,_.instances,0,_.drawCount):s.multiDrawElementsWEBGL(n,_.counts,0,a.glIndexType,_.byteOffsets,0,_.drawCount);else for(var l=0;l<_.drawCount;l++)_.instances[l]?r.drawElementsInstanced(n,_.counts[l],a.glIndexType,_.byteOffsets[l],_.instances[l]):r.drawElements(n,_.counts[l],a.glIndexType,_.byteOffsets[l])}else if(s)_.instancedDraw?s.multiDrawArraysInstancedWEBGL(n,_.offsets,0,_.counts,0,_.instances,0,_.drawCount):s.multiDrawArraysWEBGL(n,_.offsets,0,_.counts,0,_.drawCount);else for(var R=0;R<_.drawCount;R++)_.instances[R]?r.drawArraysInstanced(n,_.offsets[R],_.counts[R],_.instances[R]):r.drawArrays(n,_.offsets[R],_.counts[R])}else if(t.instanceCount)if(i){if(t.indexCount>0){var c=t.firstIndex*i.stride;r.drawElementsInstanced(n,t.indexCount,a.glIndexType,c,t.instanceCount)}}else t.vertexCount>0&&r.drawArraysInstanced(n,t.firstVertex,t.vertexCount,t.instanceCount);else if(i){if(t.indexCount>0){var E=t.firstIndex*i.stride;r.drawElements(n,t.indexCount,a.glIndexType,E)}}else t.vertexCount>0&&r.drawArrays(n,t.firstVertex,t.vertexCount)}}function ut(e,t){if(e.length>1||t.length>1)return!1;if(e[0]instanceof HTMLVideoElement){var r=e[0];return 0===t[0].texOffset.x&&0===t[0].texOffset.y&&t[0].texExtent.width===r.videoWidth&&t[0].texExtent.height===r.videoHeight}return!1}function lt(e,t,r,n){var s=e.gl,i=e.getStateCache(),_=i.glTexUnits[i.texUnit];_.glTexture!==r.glTexture&&(s.bindTexture(r.glTarget,r.glTexture),_.glTexture=r.glTexture);var u=0,l=0;switch(r.glTarget){case pe.TEXTURE_2D:if(r.flags&x.MUTABLE_STORAGE||ut(t,n))s.texImage2D(pe.TEXTURE_2D,n[0].texSubres.mipLevel,r.glInternalFmt,n[0].texExtent.width,n[0].texExtent.height,0,r.glFormat,r.glType,t[0]);else for(var R=0;R<n.length;R++){var c=n[R];s.texSubImage2D(pe.TEXTURE_2D,c.texSubres.mipLevel,c.texOffset.x,c.texOffset.y,r.glFormat,r.glType,t[u++])}break;case pe.TEXTURE_CUBE_MAP:for(var E=0;E<n.length;E++){var f=n[E],A=f.texSubres,T=f.texOffset,S=A.baseArrayLayer+A.layerCount;for(l=A.baseArrayLayer;l<S;++l)s.texSubImage2D(pe.TEXTURE_CUBE_MAP_POSITIVE_X+l,A.mipLevel,T.x,T.y,r.glFormat,r.glType,t[u++])}break;default:a(16327)}r.flags&x.GEN_MIPMAP&&s.generateMipmap(r.glTarget)}var Rt=new Uint8Array(1);function ct(e,t,r,a,n){var s=P(t).height,_=p(t,n.width,n.height,n.depth),u=p(t,a.width,1,1),l=p(t,a.width,a.height,1),R=p(t,n.width,1,1),c=O(C[t]);Rt.byteLength<_&&(Rt=new Uint8Array(_));for(var E=0,f=r,A=0;A<n.depth;A++){f=r+l*A;for(var T=0;T<n.height;T+=s)Rt.subarray(E,E+R).set(new Uint8Array(e.buffer,e.byteOffset+f,R)),E+=R,f+=u}var S=_/c.BYTES_PER_ELEMENT;return i(Number.isInteger(S),9101),new c(Rt.buffer,0,S)}function Et(e,t,r,n){var s=e.gl,_=e.getStateCache(),u=_.glTexUnits[_.texUnit];u.glTexture!==r.glTexture&&(s.bindTexture(r.glTarget,r.glTexture),u.glTexture=r.glTexture);var l=0,R=0,c=C[r.format],E=O(c),f=c.isCompressed,A=P(r.format),T=new U,S=new N,g=new U;switch(r.glTarget){case pe.TEXTURE_2D:for(var o=0;o<n.length;o++){var h=n[o],B=h.texSubres.mipLevel,d=h.texOffset,G=h.texExtent,m=G.width,I=G.height,F=A.width,b=A.height,M=h.buffStride;S.x=0===d.x?0:D(d.x,F),S.y=0===d.y?0:D(d.y,b),T.width=m<F?m:D(m,F),T.height=I<b?m:D(I,b),g.width=M>0?M:T.width,g.height=h.buffTexHeight>0?h.buffTexHeight:T.height;var L=m+S.x===r.width>>B?m:T.width,v=I+S.y===r.height>>B?I:T.height,y=void 0,w=t[l++];if(g.width===T.width&&g.height===T.height){var H=p(r.format,L,v,1)/E.BYTES_PER_ELEMENT;i(Number.isInteger(H),9101),y=new E(w.buffer,w.byteOffset+h.buffOffset,H)}else y=ct(w,r.format,h.buffOffset,g,T);f?r.glInternalFmt!==be.COMPRESSED_RGB_ETC1_WEBGL?s.compressedTexSubImage2D(pe.TEXTURE_2D,B,S.x,S.y,L,v,r.glFormat,y):s.compressedTexImage2D(pe.TEXTURE_2D,B,r.glInternalFmt,L,v,0,y):s.texSubImage2D(pe.TEXTURE_2D,B,S.x,S.y,L,v,r.glFormat,r.glType,y)}break;case pe.TEXTURE_2D_ARRAY:for(var X=0;X<n.length;X++){var V=n[X],k=V.texSubres.mipLevel,K=V.texOffset,W=V.texExtent,z=W.width,Y=W.height,q=A.width,Z=A.height,j=V.buffStride,Q=V.texSubres;S.x=0===K.x?0:D(K.x,q),S.y=0===K.y?0:D(K.y,Z),T.width=z<q?z:D(z,q),T.height=Y<Z?z:D(Y,Z),T.depth=1,g.width=j>0?j:T.width,g.height=V.buffTexHeight>0?V.buffTexHeight:T.height;var J=z+S.x===r.width>>k?z:T.width,$=Y+S.y===r.height>>k?Y:T.height,ee=Q.baseArrayLayer+Q.layerCount;for(R=Q.baseArrayLayer;R<ee;++R){S.z=R;var te=void 0,re=t[l++];if(g.width===T.width&&g.height===T.height){var ae=p(r.format,J,$,1)/E.BYTES_PER_ELEMENT;i(Number.isInteger(ae),9101),te=new E(re.buffer,re.byteOffset+V.buffOffset,ae)}else te=ct(re,r.format,V.buffOffset,g,T);f?r.glInternalFmt!==be.COMPRESSED_RGB_ETC1_WEBGL?s.compressedTexSubImage3D(pe.TEXTURE_2D_ARRAY,k,S.x,S.y,S.z,J,$,T.depth,r.glFormat,te):s.compressedTexImage3D(pe.TEXTURE_2D_ARRAY,k,r.glInternalFmt,J,$,T.depth,0,te):s.texSubImage3D(pe.TEXTURE_2D_ARRAY,k,S.x,S.y,S.z,J,$,T.depth,r.glFormat,r.glType,te)}}break;case pe.TEXTURE_3D:for(var ne=0;ne<n.length;ne++){var se=n[ne],ie=se.texSubres.mipLevel,_e=se.texOffset,ue=se.texExtent,le=ue.width,Re=ue.height,ce=A.width,Ee=A.height,fe=se.buffStride;S.x=0===_e.x?0:D(_e.x,ce),S.y=0===_e.y?0:D(_e.y,Ee),S.z=_e.z,T.width=le<ce?le:D(le,ce),T.height=Re<Ee?le:D(Re,Ee),T.depth=ue.depth,g.width=fe>0?fe:T.width,g.height=se.buffTexHeight>0?se.buffTexHeight:T.height;var Ae=le+S.x===r.width>>ie?le:T.width,Te=Re+S.y===r.height>>ie?Re:T.height,Se=void 0,ge=t[l++];if(g.width===T.width&&g.height===T.height){var oe=p(r.format,Ae,Te,T.depth)/E.BYTES_PER_ELEMENT;i(Number.isInteger(oe),9101),Se=new E(ge.buffer,ge.byteOffset+se.buffOffset,oe)}else Se=ct(ge,r.format,se.buffOffset,g,T);f?r.glInternalFmt!==be.COMPRESSED_RGB_ETC1_WEBGL?s.compressedTexSubImage3D(pe.TEXTURE_2D_ARRAY,ie,S.x,S.y,S.z,Ae,Te,T.depth,r.glFormat,Se):s.compressedTexImage3D(pe.TEXTURE_2D_ARRAY,ie,r.glInternalFmt,Ae,Te,T.depth,0,Se):s.texSubImage3D(pe.TEXTURE_2D_ARRAY,ie,S.x,S.y,S.z,Ae,Te,T.depth,r.glFormat,r.glType,Se)}break;case pe.TEXTURE_CUBE_MAP:for(var he=0;he<n.length;he++){var Be=n[he],Ce=Be.texSubres.mipLevel,de=Be.texOffset,xe=Be.texExtent,Ge=xe.width,me=xe.height,Ie=A.width,Fe=A.height,Oe=Be.buffStride,Pe=Be.texSubres;S.x=0===de.x?0:D(de.x,Ie),S.y=0===de.y?0:D(de.y,Fe),T.width=Ge<Ie?Ge:D(Ge,Ie),T.height=me<Fe?Ge:D(me,Fe),g.width=Oe>0?Oe:T.width,g.height=Be.buffTexHeight>0?Be.buffTexHeight:T.height;var De=Ge+S.x===r.width>>Ce?Ge:T.width,Me=me+S.y===r.height>>Ce?me:T.height,Le=Pe.baseArrayLayer+Pe.layerCount;for(R=Pe.baseArrayLayer;R<Le;++R){var ve=void 0,Ue=t[l++];if(g.width===T.width&&g.height===T.height){var Ne=p(r.format,De,Me,1)/E.BYTES_PER_ELEMENT;i(Number.isInteger(Ne),9101),ve=new E(Ue.buffer,Ue.byteOffset+Be.buffOffset,Ne)}else ve=ct(Ue,r.format,Be.buffOffset,g,T);f?r.glInternalFmt!==be.COMPRESSED_RGB_ETC1_WEBGL?s.compressedTexSubImage2D(pe.TEXTURE_CUBE_MAP_POSITIVE_X+R,Ce,S.x,S.y,De,Me,r.glFormat,ve):s.compressedTexImage2D(pe.TEXTURE_CUBE_MAP_POSITIVE_X+R,Ce,r.glInternalFmt,De,Me,0,ve):s.texSubImage2D(pe.TEXTURE_CUBE_MAP_POSITIVE_X+R,Ce,S.x,S.y,De,Me,r.glFormat,r.glType,ve)}}break;default:a(16327)}r.flags&x.GEN_MIPMAP&&s.generateMipmap(r.glTarget)}function ft(e,t,r,n){var s=e.gl,i=e.getStateCache(),_=s.createFramebuffer();s.bindFramebuffer(pe.FRAMEBUFFER,_);var u=0,l=0,R=1,c=1;if(t.glTarget===pe.TEXTURE_2D)for(var E=0;E<n.length;E++){var f=n[E];s.framebufferTexture2D(pe.FRAMEBUFFER,pe.COLOR_ATTACHMENT0,t.glTarget,t.glTexture,f.texSubres.mipLevel),u=f.texOffset.x,l=f.texOffset.y,R=f.texExtent.width,c=f.texExtent.height,s.readPixels(u,l,R,c,t.glFormat,t.glType,r[E])}else a(16399);s.bindFramebuffer(pe.FRAMEBUFFER,null),i.glFramebuffer=null,s.deleteFramebuffer(_)}function At(e,t,r,a,n){var s=e.gl,i=e.getStateCache(),_=e.blitManager;if(_){var u=n===M.LINEAR||n===M.ANISOTROPIC?pe.LINEAR:pe.NEAREST,l=_.srcFramebuffer,R=_.dstFramebuffer,c=i.glReadFramebuffer,E=i.glFramebuffer,f=a[0].srcSubres.mipLevel,A=a[0].dstSubres.mipLevel,T=function(e){var t=0,r=pe.COLOR_ATTACHMENT0;return e.hasStencil?r=pe.DEPTH_STENCIL_ATTACHMENT:e.hasDepth&&(r=pe.DEPTH_ATTACHMENT),e.hasDepth||e.hasStencil?(e.hasDepth&&(t|=pe.DEPTH_BUFFER_BIT),e.hasStencil&&(t|=pe.STENCIL_BUFFER_BIT)):t|=pe.COLOR_BUFFER_BIT,{mask:t,attachment:r}},S=a.map((function(e,t){return t}));S.sort((function(e,t){return a[e].srcSubres.mipLevel-a[t].srcSubres.mipLevel}));var g=T(C[t.format]),o=g.mask,h=g.attachment,B=T(C[r.format]).attachment;i.glReadFramebuffer!==l&&(s.bindFramebuffer(pe.READ_FRAMEBUFFER,l),i.glReadFramebuffer=l),i.glFramebuffer!==R&&(s.bindFramebuffer(pe.DRAW_FRAMEBUFFER,R),i.glFramebuffer=R),t.glTexture?s.framebufferTexture2D(pe.READ_FRAMEBUFFER,h,t.glTarget,t.glTexture,f):s.framebufferRenderbuffer(pe.READ_FRAMEBUFFER,h,pe.RENDERBUFFER,t.glRenderbuffer),r.glTexture?s.framebufferTexture2D(pe.DRAW_FRAMEBUFFER,B,r.glTarget,r.glTexture,A):s.framebufferRenderbuffer(pe.DRAW_FRAMEBUFFER,B,pe.RENDERBUFFER,r.glRenderbuffer);for(var p=0;p<S.length;p++){var d=a[S[p]];t.glTexture&&f!==d.srcSubres.mipLevel&&(f=d.srcSubres.mipLevel,s.framebufferTexture2D(pe.READ_FRAMEBUFFER,h,t.glTarget,t.glTexture,f)),r.glTexture&&A!==d.dstSubres.mipLevel&&(A=d.dstSubres.mipLevel,s.framebufferTexture2D(pe.DRAW_FRAMEBUFFER,B,r.glTarget,r.glTexture,A)),s.blitFramebuffer(d.srcOffset.x,d.srcOffset.y,d.srcOffset.x+d.srcExtent.width,d.srcOffset.y+d.srcExtent.height,d.dstOffset.x,d.dstOffset.y,d.dstOffset.x+d.dstExtent.width,d.dstOffset.y+d.dstExtent.height,o,u)}i.glReadFramebuffer!==c&&(s.bindFramebuffer(pe.READ_FRAMEBUFFER,c),i.glReadFramebuffer=c),i.glFramebuffer!==E&&(s.bindFramebuffer(pe.DRAW_FRAMEBUFFER,E),i.glFramebuffer=E)}}var Tt=function(){function e(){this.counts=void 0,this.offsets=void 0,this.instances=void 0,this.drawCount=0,this.drawByIndex=!1,this.instancedDraw=!1,this.byteOffsets=void 0,this._capacity=4,this.counts=new Int32Array(4),this.offsets=new Int32Array(4),this.instances=new Int32Array(4),this.byteOffsets=new Int32Array(4)}var t=e.prototype;return t.clearDraws=function(){this.drawCount=0,this.drawByIndex=!1,this.instancedDraw=!1},t.setDrawInfo=function(e,t){this._ensureCapacity(e),this.drawByIndex=t.indexCount>0,this.instancedDraw=!!t.instanceCount,this.drawCount=Math.max(e+1,this.drawCount),this.drawByIndex?(this.counts[e]=t.indexCount,this.offsets[e]=t.firstIndex):(this.counts[e]=t.vertexCount,this.offsets[e]=t.firstVertex),this.instances[e]=Math.max(1,t.instanceCount)},t._ensureCapacity=function(e){if(!(this._capacity>e)){this._capacity=Ie(e);var t=new Int32Array(this._capacity),r=new Int32Array(this._capacity),a=new Int32Array(this._capacity);this.byteOffsets=new Int32Array(this._capacity),t.set(this.counts),r.set(this.offsets),a.set(this.instances),this.counts=t,this.offsets=r,this.instances=a}},e}(),St=function(){function e(){this._srcFramebuffer=void 0,this._dstFramebuffer=void 0;var e=Pe.instance.gl;this._srcFramebuffer=e.createFramebuffer(),this._dstFramebuffer=e.createFramebuffer()}return e.prototype.destroy=function(){var e=Pe.instance.gl;e.deleteFramebuffer(this._srcFramebuffer),e.deleteFramebuffer(this._dstFramebuffer)},r(e,[{key:"srcFramebuffer",get:function(){return this._srcFramebuffer}},{key:"dstFramebuffer",get:function(){return this._dstFramebuffer}}]),e}(),gt=function(e){function r(){var t;return(t=e.call(this)||this)._gpuBuffer=null,t}t(r,e);var n=r.prototype;return n.getGpuBuffer=function(){return this._gpuBuffer},n.initialize=function(e){if("buffer"in e){this._isBufferView=!0;var t=e.buffer;this._usage=t.usage,this._memUsage=t.memUsage,this._size=this._stride=e.range,this._count=1,this._flags=t.flags,this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,indirects:t.getGpuBuffer().indirects,glTarget:t.getGpuBuffer().glTarget,glBuffer:t.getGpuBuffer().glBuffer,glOffset:e.offset}}else this._usage=e.usage,this._memUsage=e.memUsage,this._size=e.size,this._stride=Math.max(e.stride||this._size,1),this._count=this._size/this._stride,this._flags=e.flags,this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,indirects:new Tt,glTarget:0,glBuffer:null,glOffset:0},Ye(Pe.instance,this._gpuBuffer),Pe.instance.memoryStatus.bufferSize+=this._size},n.destroy=function(){this._gpuBuffer&&(this._isBufferView||(qe(Pe.instance,this._gpuBuffer),Pe.instance.memoryStatus.bufferSize-=this._size),this._gpuBuffer=null)},n.resize=function(e){if(this._isBufferView)l(16379);else{var t,r,n,s,i,_=this._size;_!==e&&(this._size=e,this._count=this._size/this._stride,this._gpuBuffer&&(this._gpuBuffer.size=e,e>0&&(t=Pe.instance,r=this._gpuBuffer,n=t.gl,s=t.getStateCache(),i=r.memUsage&o.HOST?pe.DYNAMIC_DRAW:pe.STATIC_DRAW,r.usage&h.VERTEX?(t.extensions.useVAO&&s.glVAO&&(n.bindVertexArray(null),s.glVAO=null),nt.gpuInputAssembler=null,s.glArrayBuffer!==r.glBuffer&&n.bindBuffer(pe.ARRAY_BUFFER,r.glBuffer),r.buffer?n.bufferData(pe.ARRAY_BUFFER,r.buffer,i):n.bufferData(pe.ARRAY_BUFFER,r.size,i),n.bindBuffer(pe.ARRAY_BUFFER,null),s.glArrayBuffer=null):r.usage&h.INDEX?(t.extensions.useVAO&&s.glVAO&&(n.bindVertexArray(null),s.glVAO=null),nt.gpuInputAssembler=null,s.glElementArrayBuffer!==r.glBuffer&&n.bindBuffer(pe.ELEMENT_ARRAY_BUFFER,r.glBuffer),r.buffer?n.bufferData(pe.ELEMENT_ARRAY_BUFFER,r.buffer,i):n.bufferData(pe.ELEMENT_ARRAY_BUFFER,r.size,i),n.bindBuffer(pe.ELEMENT_ARRAY_BUFFER,null),s.glElementArrayBuffer=null):r.usage&h.UNIFORM?(s.glUniformBuffer!==r.glBuffer&&n.bindBuffer(pe.UNIFORM_BUFFER,r.glBuffer),n.bufferData(pe.UNIFORM_BUFFER,r.size,i),n.bindBuffer(pe.UNIFORM_BUFFER,null),s.glUniformBuffer=null):(r.usage&h.INDIRECT||r.usage&h.TRANSFER_DST||r.usage&h.TRANSFER_SRC||a(16315),r.glTarget=pe.NONE),Pe.instance.memoryStatus.bufferSize-=_,Pe.instance.memoryStatus.bufferSize+=e)))}},n.update=function(e,t){var r;this._isBufferView?l(16380):(r=void 0!==t?t:this._usage&h.INDIRECT?0:e.byteLength,Ze(Pe.instance,this._gpuBuffer,e,0,r))},r}(w),ot=function(e){function r(){var t;return(t=e.call(this)||this)._isInRenderPass=!1,t._curGPUPipelineState=null,t._curGPUDescriptorSets=[],t._curGPUInputAssembler=null,t._curDynamicOffsets=Array(8).fill(0),t._curDynamicStates=new X,t._isStateInvalid=!1,t}t(r,e);var n=r.prototype;return n.initialize=function(e){this._type=e.type,this._queue=e.queue;for(var t=Pe.instance.bindingMappings.blockOffsets.length,r=0;r<t;r++)this._curGPUDescriptorSets.push(null)},n.destroy=function(){},n.begin=function(){this._curGPUPipelineState=null,this._curGPUInputAssembler=null,this._curGPUDescriptorSets.length=0,this._numDrawCalls=0,this._numInstances=0,this._numTris=0},n.end=function(){this._isStateInvalid&&this.bindStates(),this._isInRenderPass=!1},n.beginRenderPass=function(){a(16401),this._isInRenderPass=!0},n.endRenderPass=function(){this._isInRenderPass=!1},n.bindPipelineState=function(e){var t=e.gpuPipelineState;t!==this._curGPUPipelineState&&(this._curGPUPipelineState=t,this._isStateInvalid=!0)},n.bindDescriptorSet=function(e,t,r){var a=t.gpuDescriptorSet;if(a!==this._curGPUDescriptorSets[e]&&(this._curGPUDescriptorSets[e]=a,this._isStateInvalid=!0),r){var n,s=null==(n=this._curGPUPipelineState)?void 0:n.gpuPipelineLayout;if(s){for(var i=this._curDynamicOffsets,_=s.dynamicOffsetOffsets[e],u=0;u<r.length;u++)i[_+u]=r[u];this._isStateInvalid=!0}}},n.bindInputAssembler=function(e){var t=e.gpuInputAssembler;this._curGPUInputAssembler=t,this._isStateInvalid=!0},n.setViewport=function(e){var t=this._curDynamicStates.viewport;t.left===e.left&&t.top===e.top&&t.width===e.width&&t.height===e.height&&t.minDepth===e.minDepth&&t.maxDepth===e.maxDepth||(t.left=e.left,t.top=e.top,t.width=e.width,t.height=e.height,t.minDepth=e.minDepth,t.maxDepth=e.maxDepth,this._isStateInvalid=!0)},n.setScissor=function(e){var t=this._curDynamicStates.scissor;t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height||(t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,this._isStateInvalid=!0)},n.setLineWidth=function(e){this._curDynamicStates.lineWidth!==e&&(this._curDynamicStates.lineWidth=e,this._isStateInvalid=!0)},n.setDepthBias=function(e,t,r){var a=this._curDynamicStates;a.depthBiasConstant===e&&a.depthBiasClamp===t&&a.depthBiasSlope===r||(a.depthBiasConstant=e,a.depthBiasClamp=t,a.depthBiasSlope=r,this._isStateInvalid=!0)},n.setBlendConstants=function(e){var t=this._curDynamicStates.blendConstant;t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w||(t.copy(e),this._isStateInvalid=!0)},n.setDepthBound=function(e,t){var r=this._curDynamicStates;r.depthMinBounds===e&&r.depthMaxBounds===t||(r.depthMinBounds=e,r.depthMaxBounds=t,this._isStateInvalid=!0)},n.setStencilWriteMask=function(e,t){var r=this._curDynamicStates.stencilStatesFront,a=this._curDynamicStates.stencilStatesBack;e&H.FRONT&&r.writeMask!==t&&(r.writeMask=t,this._isStateInvalid=!0),e&H.BACK&&a.writeMask!==t&&(a.writeMask=t,this._isStateInvalid=!0)},n.setStencilCompareMask=function(e,t,r){var a=this._curDynamicStates.stencilStatesFront,n=this._curDynamicStates.stencilStatesBack;e&H.FRONT&&(a.compareMask===r&&a.reference===t||(a.reference=t,a.compareMask=r,this._isStateInvalid=!0)),e&H.BACK&&(n.compareMask===r&&n.reference===t||(n.reference=t,n.compareMask=r,this._isStateInvalid=!0))},n.draw=function(){a(16328)},n.updateBuffer=function(){a(16329)},n.copyBuffersToTexture=function(){a(16330)},n.execute=function(){a(16402)},n.pipelineBarrier=function(){},n.bindStates=function(){a(16401),this._isStateInvalid=!1},n.blitTexture=function(){a(16401)},r}(V),ht=function(e){function a(){var t;return(t=e.call(this)||this)._gpuFramebuffer=null,t._gpuColorViews=[],t._gpuDepthStencilView=void 0,t}t(a,e);var n=a.prototype;return n.getGpuFramebuffer=function(){return this._gpuFramebuffer},n.initialize=function(e){var t,r=this;this._renderPass=e.renderPass,this._colorTextures=e.colorTextures||[],this._depthStencilTexture=e.depthStencilTexture||null;for(var a=[],n=0;n<e.colorTextures.length;n++){var s=e.colorTextures[n];s&&a.push(s.gpuTextureView)}var i=null;e.depthStencilTexture&&(i=e.depthStencilTexture.gpuTextureView);var _=Number.MAX_SAFE_INTEGER,u=Number.MAX_SAFE_INTEGER;this._gpuFramebuffer={gpuRenderPass:e.renderPass.getGpuRenderPass(),gpuColorViews:a,gpuDepthStencilView:i,glFramebuffer:null,isOffscreen:!0,get width(){return this.gpuColorViews.length>0?this.gpuColorViews[0].gpuTexture.width:this.gpuDepthStencilView?this.gpuDepthStencilView.gpuTexture.width:_},set width(e){_=e},get height(){return this.gpuColorViews.length>0?this.gpuColorViews[0].gpuTexture.height:this.gpuDepthStencilView?this.gpuDepthStencilView.gpuTexture.height:u},set height(e){u=e}},et(Pe.instance,this._gpuFramebuffer),this._gpuFramebuffer.gpuColorViews.forEach((function(e){return r._gpuColorViews.push(e.gpuTexture.glTexture)})),this._gpuDepthStencilView=null==(t=this._gpuFramebuffer.gpuDepthStencilView)?void 0:t.gpuTexture.glTexture,this._width=this._gpuFramebuffer.width,this._height=this._gpuFramebuffer.height},n.destroy=function(){var e,t,r,a;this._gpuFramebuffer&&(e=Pe.instance,t=this._gpuFramebuffer,r=e.gl,a=e.getStateCache(),t.glFramebuffer&&(r.deleteFramebuffer(t.glFramebuffer),a.glFramebuffer===t.glFramebuffer&&(r.bindFramebuffer(pe.FRAMEBUFFER,null),a.glFramebuffer=null),t.glFramebuffer=null),this._gpuFramebuffer=null,this._gpuColorViews.length=0,this._gpuDepthStencilView=null)},r(a,[{key:"needRebuild",get:function(){var e=this.getGpuFramebuffer();if(e){for(var t,r=0;r<e.gpuColorViews.length;r++)if(e.gpuColorViews[r].gpuTexture.glTexture!==this._gpuColorViews[r])return!0;if((null==(t=e.gpuDepthStencilView)?void 0:t.gpuTexture.glTexture)!==this._gpuDepthStencilView)return!0}return!1}}]),a}(k),Bt=function(e){function n(){var t;return(t=e.call(this)||this)._gpuInputAssembler=null,t}t(n,e);var s=n.prototype;return s.initialize=function(e){if(0!==e.vertexBuffers.length){if(this._attributes=e.attributes,this._attributesHash=this.computeAttributesHash(),this._vertexBuffers=e.vertexBuffers,e.indexBuffer)this._indexBuffer=e.indexBuffer,this._drawInfo.indexCount=this._indexBuffer.size/this._indexBuffer.stride,this._drawInfo.firstIndex=0;else{var t=this._vertexBuffers[0];this._drawInfo.vertexCount=t.size/t.stride,this._drawInfo.firstVertex=0,this._drawInfo.vertexOffset=0}this._drawInfo.instanceCount=0,this._drawInfo.firstInstance=0,this._indirectBuffer=e.indirectBuffer||null;for(var r=new Array(e.vertexBuffers.length),n=0;n<e.vertexBuffers.length;++n){var s=e.vertexBuffers[n];s.getGpuBuffer()&&(r[n]=s.getGpuBuffer())}var i=null,_=0;if(e.indexBuffer&&(i=e.indexBuffer.getGpuBuffer()))switch(i.stride){case 1:_=pe.UNSIGNED_BYTE;break;case 2:_=pe.UNSIGNED_SHORT;break;case 4:_=pe.UNSIGNED_INT;break;default:a(16332)}var u=null;e.indirectBuffer&&(u=e.indirectBuffer.getGpuBuffer()),this._gpuInputAssembler={attributes:e.attributes,gpuVertexBuffers:r,gpuIndexBuffer:i,gpuIndirectBuffer:u,glAttribs:[],glIndexType:_,glVAOs:new Map},rt(Pe.instance,this._gpuInputAssembler)}else a(16331)},s.destroy=function(){var e=Pe.instance;this._gpuInputAssembler&&e.extensions.useVAO&&at(e,this._gpuInputAssembler),this._gpuInputAssembler=null},r(n,[{key:"gpuInputAssembler",get:function(){return this._gpuInputAssembler}}]),n}(K),Ct=function(e){t(a,e);var r=a.prototype;function a(){var t;return(t=e.call(this)||this)._gpuDescriptorSetLayout=null,t}return r.getGpuDescriptorSetLayout=function(){return this._gpuDescriptorSetLayout},r.initialize=function(e){Array.prototype.push.apply(this._bindings,e.bindings);for(var t=0,r=-1,a=[],n=0;n<this._bindings.length;n++){var s=this._bindings[n];a.push(t),t+=s.count,s.binding>r&&(r=s.binding)}this._bindingIndices=Array(r+1).fill(-1);for(var i=this._descriptorIndices=Array(r+1).fill(-1),_=0;_<this._bindings.length;_++){var u=this._bindings[_];this._bindingIndices[u.binding]=_,i[u.binding]=a[_]}for(var l=[],R=0;R<this._bindings.length;R++){var c=this._bindings[R];if(c.descriptorType&W)for(var E=0;E<c.count;E++)l.push(c.binding)}this._gpuDescriptorSetLayout={bindings:this._bindings,dynamicBindings:l,descriptorIndices:i,descriptorCount:t}},r.destroy=function(){this._bindings.length=0},a}(z),pt=function(e){function r(){var t;return(t=e.call(this)||this)._gpuPipelineLayout=null,t}t(r,e);var a=r.prototype;return a.getGpuPipelineLayout=function(){return this._gpuPipelineLayout},a.initialize=function(e){Array.prototype.push.apply(this._setLayouts,e.setLayouts);for(var t=[],r=[],a=0,n=[],s=0;s<this._setLayouts.length;s++){for(var i=this._setLayouts[s],_=i.getGpuDescriptorSetLayout(),u=_.dynamicBindings,l=Array(i.bindingIndices.length).fill(-1),R=0;R<u.length;R++){var c=u[R];l[c]<0&&(l[c]=a+R)}r.push(_),t.push(l),n.push(a),a+=u.length}this._gpuPipelineLayout={gpuSetLayouts:r,dynamicOffsetIndices:t,dynamicOffsetCount:a,dynamicOffsetOffsets:n}},a.destroy=function(){this._setLayouts.length=0},r}(Y),dt=[pe.POINTS,pe.LINES,pe.LINE_STRIP,pe.LINE_LOOP,pe.NONE,pe.NONE,pe.NONE,pe.TRIANGLES,pe.TRIANGLE_STRIP,pe.TRIANGLE_FAN,pe.NONE,pe.NONE,pe.NONE,pe.NONE],xt=function(e){function a(){var t;return(t=e.call(this)||this)._gpuPipelineState=null,t}t(a,e);var n=a.prototype;return n.initialize=function(e){this._primitive=e.primitive,this._shader=e.shader,this._pipelineLayout=e.pipelineLayout;var t=this._bs;if(e.blendState){var r=e.blendState,a=r.targets;a&&a.forEach((function(e,r){t.setTarget(r,e)})),void 0!==r.isA2C&&(t.isA2C=r.isA2C),void 0!==r.isIndepend&&(t.isIndepend=r.isIndepend),void 0!==r.blendColor&&(t.blendColor=r.blendColor)}Object.assign(this._rs,e.rasterizerState),Object.assign(this._dss,e.depthStencilState),this._is=e.inputState,this._renderPass=e.renderPass,this._dynamicStates=e.dynamicStates;for(var n=[],s=0;s<31;s++)this._dynamicStates&1<<s&&n.push(1<<s);this._gpuPipelineState={glPrimitive:dt[e.primitive],gpuShader:e.shader.gpuShader,gpuPipelineLayout:e.pipelineLayout.getGpuPipelineLayout(),rs:e.rasterizerState,dss:e.depthStencilState,bs:e.blendState,gpuRenderPass:e.renderPass.getGpuRenderPass(),dynamicStates:n}},n.destroy=function(){this._gpuPipelineState=null},r(a,[{key:"gpuPipelineState",get:function(){return this._gpuPipelineState}}]),a}(q),Gt=function(e){function r(){return e.call(this)||this}t(r,e);var n=r.prototype;return n.beginRenderPass=function(e,t,r,a,n,s){st(Pe.instance,e.getGpuRenderPass(),t.getGpuFramebuffer(),r,a,n,s),this._isInRenderPass=!0},n.draw=function(e){if(this._isInRenderPass){this._isStateInvalid&&this.bindStates();var t="drawInfo"in e?e.drawInfo:e;_t(Pe.instance,t),++this._numDrawCalls,this._numInstances+=t.instanceCount;var r=t.indexCount||t.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=r/3*Math.max(t.instanceCount,1);break;case 5:case 6:this._numTris+=(r-2)*Math.max(t.instanceCount,1)}}else a(16328)},n.setViewport=function(e){var t=Pe.instance.gl,r=Pe.instance.getStateCache();r.viewport.left===e.left&&r.viewport.top===e.top&&r.viewport.width===e.width&&r.viewport.height===e.height||(t.viewport(e.left,e.top,e.width,e.height),r.viewport.left=e.left,r.viewport.top=e.top,r.viewport.width=e.width,r.viewport.height=e.height)},n.setScissor=function(e){var t=Pe.instance.gl,r=Pe.instance.getStateCache();r.scissorRect.x===e.x&&r.scissorRect.y===e.y&&r.scissorRect.width===e.width&&r.scissorRect.height===e.height||(t.scissor(e.x,e.y,e.width,e.height),r.scissorRect.x=e.x,r.scissorRect.y=e.y,r.scissorRect.width=e.width,r.scissorRect.height=e.height)},n.updateBuffer=function(e,t,r){if(this._isInRenderPass)a(16329);else{var n,s=e.getGpuBuffer();s&&(n=void 0!==r?r:e.usage&h.INDIRECT?0:t.byteLength,Ze(Pe.instance,s,t,0,n))}},n.copyBuffersToTexture=function(e,t,r){if(this._isInRenderPass)a(16330);else{var n=t.gpuTexture;n&&Et(Pe.instance,e,n,r)}},n.execute=function(){a(16402)},n.bindStates=function(){it(Pe.instance,this._curGPUPipelineState,this._curGPUInputAssembler,this._curGPUDescriptorSets,this._curDynamicOffsets,this._curDynamicStates),this._isStateInvalid=!1},n.blitTexture=function(e,t,r,a){var n=e.gpuTexture,s=t.gpuTexture;At(Pe.instance,n,s,r,a)},r}(ot),mt=function(e){function r(){var t;return(t=e.call(this)||this).numDrawCalls=0,t.numInstances=0,t.numTris=0,t}t(r,e);var a=r.prototype;return a.initialize=function(e){this._type=e.type},a.destroy=function(){},a.submit=function(e){for(var t=0;t<e.length;t++){var r=e[t];this.numDrawCalls+=r.numDrawCalls,this.numInstances+=r.numInstances,this.numTris+=r.numTris}},a.clear=function(){this.numDrawCalls=0,this.numInstances=0,this.numTris=0},r}(Z),It=function(e){function r(){var t;return(t=e.call(this)||this)._gpuRenderPass=null,t}t(r,e);var a=r.prototype;return a.getGpuRenderPass=function(){return this._gpuRenderPass},a.initialize=function(e){this._colorInfos=e.colorAttachments,this._depthStencilInfo=e.depthStencilAttachment,this._subpasses=e.subpasses,this._gpuRenderPass={colorAttachments:this._colorInfos,depthStencilAttachment:this._depthStencilInfo},this._hash=this.computeHash()},a.destroy=function(){this._gpuRenderPass=null},r}(j),Ft=function(e){function a(t,r){var a,n,s;return(a=e.call(this,t,r)||this)._gpuSampler=null,a._gpuSampler={glSamplers:new Map,minFilter:a._info.minFilter,magFilter:a._info.magFilter,mipFilter:a._info.mipFilter,addressU:a._info.addressU,addressV:a._info.addressV,addressW:a._info.addressW,glMinFilter:0,glMagFilter:0,glWrapS:0,glWrapT:0,glWrapR:0,getGLSampler:function(e,t,r){var a=e.gl,n=t<<16|r;if(!this.glSamplers.has(n)){var s=a.createSampler();if(s){this.glSamplers.set(n,s);var i=a.samplerParameteri.bind(a),_=a.samplerParameterf.bind(a);i(s,pe.TEXTURE_MIN_FILTER,this.glMinFilter),i(s,pe.TEXTURE_MAG_FILTER,this.glMagFilter),i(s,pe.TEXTURE_WRAP_S,this.glWrapS),i(s,pe.TEXTURE_WRAP_T,this.glWrapT),i(s,pe.TEXTURE_WRAP_R,this.glWrapR),_(s,pe.TEXTURE_MIN_LOD,t),_(s,pe.TEXTURE_MAX_LOD,r)}}return this.glSamplers.get(n)}},n=Pe.instance,s=a._gpuSampler,n.gl,s.minFilter===M.LINEAR||s.minFilter===M.ANISOTROPIC?s.mipFilter===M.LINEAR||s.mipFilter===M.ANISOTROPIC?s.glMinFilter=pe.LINEAR_MIPMAP_LINEAR:s.mipFilter===M.POINT?s.glMinFilter=pe.LINEAR_MIPMAP_NEAREST:s.glMinFilter=pe.LINEAR:s.mipFilter===M.LINEAR||s.mipFilter===M.ANISOTROPIC?s.glMinFilter=pe.NEAREST_MIPMAP_LINEAR:s.mipFilter===M.POINT?s.glMinFilter=pe.NEAREST_MIPMAP_NEAREST:s.glMinFilter=pe.NEAREST,s.magFilter===M.LINEAR||s.magFilter===M.ANISOTROPIC?s.glMagFilter=pe.LINEAR:s.glMagFilter=pe.NEAREST,s.glWrapS=De[s.addressU],s.glWrapT=De[s.addressV],s.glWrapR=De[s.addressW],a}return t(a,e),a.prototype.destroy=function(){this._gpuSampler&&($e(Pe.instance,this._gpuSampler),this._gpuSampler=null)},r(a,[{key:"gpuSampler",get:function(){return this._gpuSampler}}]),a}(Q),bt=function(e){function a(){var t;return(t=e.call(this)||this)._gpuShader=null,t}t(a,e);var n=a.prototype;return n.initialize=function(e){this._name=e.name,this._stages=e.stages,this._attributes=e.attributes,this._blocks=e.blocks,this._samplers=e.samplers,this._gpuShader={name:e.name,blocks:e.blocks.slice(),samplerTextures:e.samplerTextures.slice(),subpassInputs:e.subpassInputs.slice(),gpuStages:new Array(e.stages.length),glProgram:null,glInputs:[],glUniforms:[],glBlocks:[],glSamplerTextures:[]};for(var t=0;t<e.stages.length;++t){var r=e.stages[t];this._gpuShader.gpuStages[t]={type:r.stage,source:r.source,glShader:null}}},n.destroy=function(){var e,t,r,a;this._gpuShader&&(e=Pe.instance,t=this._gpuShader,r=e.gl,a=e.getStateCache(),t.glProgram&&(r.deleteProgram(t.glProgram),a.glProgram===t.glProgram&&(r.useProgram(null),a.glProgram=null),t.glProgram=null),this._gpuShader=null)},r(a,[{key:"gpuShader",get:function(){return null===this._gpuShader.glProgram&&tt(Pe.instance,this._gpuShader),this._gpuShader}}]),a}(J),Ot=function(){function e(){this.glArrayBuffer=null,this.glElementArrayBuffer=null,this.glUniformBuffer=null,this.glBindUBOs=[],this.glBindUBOOffsets=[],this.glVAO=null,this.texUnit=0,this.glTexUnits=[],this.glSamplerUnits=[],this.glRenderbuffer=null,this.glFramebuffer=null,this.glReadFramebuffer=null,this.viewport=new $,this.scissorRect=new ee(0,0,0,0),this.rs=new te,this.dss=new re,this.bs=new ae,this.glProgram=null,this.glEnabledAttribLocs=[],this.glCurrentAttribLocs=[],this.texUnitCacheMap={}}return e.prototype.initialize=function(e,t,r){for(var a=0;a<e;++a)this.glTexUnits.push({glTexture:null});this.glSamplerUnits.length=e,this.glSamplerUnits.fill(null),this.glBindUBOs.length=t,this.glBindUBOs.fill(null),this.glBindUBOOffsets.length=t,this.glBindUBOOffsets.fill(0),this.glEnabledAttribLocs.length=r,this.glEnabledAttribLocs.fill(!1),this.glCurrentAttribLocs.length=r,this.glCurrentAttribLocs.fill(!1)},e}(),Pt=function(e){function a(){var t;return(t=e.call(this)||this)._gpuTexture=null,t._gpuTextureView=null,t}t(a,e);var n=a.prototype;return n.initialize=function(e,t){var r=this,a=Pe.instance,n=r._info,s=r._viewInfo,i=e,_=e;if("texture"in e&&(i=_.texture.info,r._isTextureView=!0),n.copy(i),r._isPowerOf2=ne(n.width)&&ne(n.height),r._size=se(n.format,r.width,r.height,r.depth,n.levelCount)*n.layerCount,r._isTextureView){var u;if(s.copy(_),r._gpuTexture=_.texture._gpuTexture,(null==(u=r._gpuTexture)?void 0:u.format)!==i.format)return void R(16403);r._gpuTextureView={gpuTexture:r._gpuTexture,type:_.type,format:_.format,baseLevel:_.baseLevel,levelCount:_.levelCount}}else r._gpuTexture={type:i.type,format:i.format,usage:i.usage,width:i.width,height:i.height,depth:i.depth,size:r._size,arrayLayer:i.layerCount,mipLevel:i.levelCount,samples:i.samples,flags:i.flags,isPowerOf2:r._isPowerOf2,glTarget:0,glInternalFmt:0,glFormat:0,glType:0,glUsage:0,glTexture:null,glRenderbuffer:null,glWrapS:0,glWrapT:0,glMinFilter:0,glMagFilter:0,isSwapchainTexture:t||!1},r._gpuTexture.isSwapchainTexture||(je(a,r._gpuTexture),a.memoryStatus.textureSize+=r._size),s.texture=r,s.type=e.type,s.format=e.format,s.baseLevel=0,s.levelCount=e.levelCount,s.baseLayer=0,s.layerCount=e.layerCount,r._gpuTextureView={gpuTexture:r._gpuTexture,type:s.type,format:s.format,baseLevel:s.baseLevel,levelCount:s.levelCount}},n.destroy=function(){var e=this,t=Pe.instance;!e._isTextureView&&e._gpuTexture&&(Qe(t,e._gpuTexture),t.memoryStatus.textureSize-=e._size,e._gpuTexture=null)},n.getTextureHandle=function(){var e=this._gpuTexture;return e?e.glTexture?e.glTexture:e.glRenderbuffer?e.glRenderbuffer:0:0},n.resize=function(e,t){var r=this,n=Pe.instance,s=r._info;if(s.width!==e||s.height!==t){s.levelCount===a.getLevelCount(s.width,s.height)?s.levelCount=a.getLevelCount(e,t):s.levelCount>1&&(s.levelCount=Math.min(s.levelCount,a.getLevelCount(e,t)));var i=r._size;s.width=e,s.height=t,r._size=se(s.format,r.width,r.height,r.depth,s.levelCount)*s.layerCount;var _=r._gpuTexture;!r._isTextureView&&_&&(_.width=e,_.height=t,_.size=r._size,_.isSwapchainTexture||(Je(n,_),n.memoryStatus.textureSize-=i,n.memoryStatus.textureSize+=r._size))}},n.initAsSwapchainTexture=function(e){var t=new ie;t.format=e.format,t.usage=C[e.format].hasDepth?_e.DEPTH_STENCIL_ATTACHMENT:_e.COLOR_ATTACHMENT,t.width=e.width,t.height=e.height,this.initialize(t,!0)},r(a,[{key:"gpuTexture",get:function(){return this._gpuTexture}},{key:"gpuTextureView",get:function(){return this._gpuTextureView}}]),a}(ue),Dt="webglcontextlost";function Mt(e){e.activeTexture(pe.TEXTURE0),e.pixelStorei(pe.PACK_ALIGNMENT,1),e.pixelStorei(pe.UNPACK_ALIGNMENT,1),e.pixelStorei(pe.UNPACK_FLIP_Y_WEBGL,!1),e.bindFramebuffer(pe.FRAMEBUFFER,null),e.enable(pe.SCISSOR_TEST),e.enable(pe.CULL_FACE),e.cullFace(pe.BACK),e.frontFace(pe.CCW),e.polygonOffset(0,0),e.enable(pe.DEPTH_TEST),e.depthMask(!0),e.depthFunc(pe.LESS),e.stencilFuncSeparate(pe.FRONT,pe.ALWAYS,1,65535),e.stencilOpSeparate(pe.FRONT,pe.KEEP,pe.KEEP,pe.KEEP),e.stencilMaskSeparate(pe.FRONT,65535),e.stencilFuncSeparate(pe.BACK,pe.ALWAYS,1,65535),e.stencilOpSeparate(pe.BACK,pe.KEEP,pe.KEEP,pe.KEEP),e.stencilMaskSeparate(pe.BACK,65535),e.disable(pe.STENCIL_TEST),e.disable(pe.SAMPLE_ALPHA_TO_COVERAGE),e.disable(pe.BLEND),e.blendEquationSeparate(pe.FUNC_ADD,pe.FUNC_ADD),e.blendFuncSeparate(pe.ONE,pe.ZERO,pe.ONE,pe.ZERO),e.colorMask(!0,!0,!0,!0),e.blendColor(0,0,0,0)}function Lt(e,t){for(var r=["","WEBKIT_","MOZ_"],a=0;a<r.length;++a){var n=e.getExtension(r[a]+t);if(n)return n}return null}function vt(e){var t={EXT_texture_filter_anisotropic:Lt(e,"EXT_texture_filter_anisotropic"),EXT_color_buffer_half_float:Lt(e,"EXT_color_buffer_half_float"),EXT_color_buffer_float:Lt(e,"EXT_color_buffer_float"),WEBGL_compressed_texture_etc1:Lt(e,"WEBGL_compressed_texture_etc1"),WEBGL_compressed_texture_etc:Lt(e,"WEBGL_compressed_texture_etc"),WEBGL_compressed_texture_pvrtc:Lt(e,"WEBGL_compressed_texture_pvrtc"),WEBGL_compressed_texture_astc:Lt(e,"WEBGL_compressed_texture_astc"),WEBGL_compressed_texture_s3tc:Lt(e,"WEBGL_compressed_texture_s3tc"),WEBGL_compressed_texture_s3tc_srgb:Lt(e,"WEBGL_compressed_texture_s3tc_srgb"),WEBGL_debug_shaders:Lt(e,"WEBGL_debug_shaders"),WEBGL_lose_context:Lt(e,"WEBGL_lose_context"),WEBGL_debug_renderer_info:Lt(e,"WEBGL_debug_renderer_info"),OES_texture_half_float_linear:Lt(e,"OES_texture_half_float_linear"),OES_texture_float_linear:Lt(e,"OES_texture_float_linear"),WEBGL_multi_draw:null,useVAO:!0};return n.os!==s.ANDROID&&n.os!==s.IOS&&(t.WEBGL_multi_draw=Lt(e,"WEBGL_multi_draw")),t}function Ut(e){var t=null;try{var r;if(xe&&null!=(r=globalThis.__globalXR)&&r.webxrCompatible){var a={alpha:f.ENABLE_TRANSPARENT_CANVAS,antialias:Ge||f.ENABLE_WEBGL_ANTIALIAS,depth:!0,stencil:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1,xrCompatible:!0};return e.getContext("webgl2",a)}var n={alpha:f.ENABLE_TRANSPARENT_CANVAS,antialias:Ge||f.ENABLE_WEBGL_ANTIALIAS,depth:!0,stencil:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};t=e.getContext("webgl2",n)}catch(e){return null}return t}var Nt=function(e){function a(){var t;return(t=e.call(this)||this).stateCache=new Ot,t.nullTex2D=null,t.nullTexCube=null,t._canvas=null,t._webGL2ContextLostHandler=null,t._extensions=null,t._blitManager=null,t}t(a,e);var n=a.prototype;return n.initialize=function(e){var t=this;t._canvas=e.windowHandle,t._webGL2ContextLostHandler=t._onWebGLContextLost.bind(t),t._canvas.addEventListener(Dt,t._onWebGLContextLost);var r=Pe.instance,a=r.gl,n=r.capabilities;t.stateCache.initialize(n.maxTextureUnits,n.maxUniformBufferBindings,n.maxVertexAttributes),t._extensions=vt(a),Mt(a);var s=G.RGBA8,i=G.DEPTH_STENCIL,_=a.getParameter(pe.DEPTH_BITS),u=a.getParameter(pe.STENCIL_BITS);_&&u?i=G.DEPTH_STENCIL:_&&(i=G.DEPTH),t._colorTexture=new Pt,t._colorTexture.initAsSwapchainTexture({swapchain:t,format:s,width:e.width,height:e.height}),t._depthStencilTexture=new Pt,t._depthStencilTexture.initAsSwapchainTexture({swapchain:t,format:i,width:e.width,height:e.height}),t.nullTex2D=r.createTexture(new ie(B.TEX2D,_e.SAMPLED,G.RGBA8,2,2,x.NONE)),t.nullTexCube=r.createTexture(new ie(B.CUBE,_e.SAMPLED,G.RGBA8,2,2,x.NONE,6));var l=new le;l.texExtent.width=2,l.texExtent.height=2;var R=new Uint8Array(t.nullTex2D.size);R.fill(0),r.copyBuffersToTexture([R],t.nullTex2D,[l]),l.texSubres.layerCount=6,r.copyBuffersToTexture([R,R,R,R,R,R],t.nullTexCube,[l]),t._blitManager=new St},n.destroy=function(){var e=this;e._canvas&&e._webGL2ContextLostHandler&&(e._canvas.removeEventListener(Dt,e._webGL2ContextLostHandler),e._webGL2ContextLostHandler=null),e.nullTex2D&&(e.nullTex2D.destroy(),e.nullTex2D=null),e.nullTexCube&&(e.nullTexCube.destroy(),e.nullTexCube=null),e._blitManager&&(e._blitManager.destroy(),e._blitManager=null),e._extensions=null,e._canvas=null},n.resize=function(e,t){var r=this;r._colorTexture.width===e&&r._colorTexture.height===t||(c("Resizing swapchain: "+e+"x"+t),r._canvas.width=e,r._canvas.height=t,r._colorTexture.resize(e,t),r._depthStencilTexture.resize(e,t))},n._onWebGLContextLost=function(e){l(11e3),E(e)},r(a,[{key:"extensions",get:function(){return this._extensions}},{key:"blitManager",get:function(){return this._blitManager}}]),a}(Re);function yt(e,t,r){for(var a=0;a<t.length;++a)e[t[a]]=r}function wt(e,t,r){for(var a=0;a<t.length;++a)e[t[a]]=r}var Ht=e("WebGL2Device",function(e){function i(){var t;return(t=e.call(this)||this)._swapchain=null,t._context=null,t._bindingMappings=null,t._textureExclusive=new Array(G.COUNT),t}t(i,e);var _=i.prototype;return _.getStateCache=function(){return this._swapchain.stateCache},_.initialize=function(e){Pe.setInstance(this),this._gfxAPI=ce.WEBGL2;var t=this._bindingMappingInfo=e.bindingMappingInfo,r=[],i=[],_=t.setIndices[0];r[_]=0,i[_]=0;for(var u=1;u<t.setIndices.length;++u){var l=t.setIndices[u],R=t.setIndices[u-1];r[l]=t.maxBlockCounts[R]+r[R],i[l]=t.maxSamplerTextureCounts[R]+i[R]}for(var E=0;E<t.setIndices.length;++E){var f=t.setIndices[E];i[f]-=t.maxBlockCounts[f]}this._bindingMappings={blockOffsets:r,samplerTextureOffsets:i,flexibleSet:t.setIndices[t.setIndices.length-1]};var T=this._context=Ut(Ee.canvas);if(!T)return a(16405),!1;this._queue=this.createQueue(new fe(Ae.GRAPHICS)),this._cmdBuff=this.createCommandBuffer(new Te(this._queue));var S=T.getParameter.bind(T),g=this._caps;if(g.maxVertexAttributes=S(pe.MAX_VERTEX_ATTRIBS),g.maxVertexUniformVectors=S(pe.MAX_VERTEX_UNIFORM_VECTORS),n.os===s.IOS){var o=g.maxVertexUniformVectors;Fe.browserType===A.WECHAT?g.maxVertexUniformVectors=o<256?o:256:Fe.browserType===A.SAFARI&&(g.maxVertexUniformVectors=o<512?o:512)}g.maxFragmentUniformVectors=S(pe.MAX_FRAGMENT_UNIFORM_VECTORS),g.maxTextureUnits=S(pe.MAX_TEXTURE_IMAGE_UNITS),g.maxVertexTextureUnits=S(pe.MAX_VERTEX_TEXTURE_IMAGE_UNITS),g.maxUniformBufferBindings=S(pe.MAX_UNIFORM_BUFFER_BINDINGS),g.maxUniformBlockSize=S(pe.MAX_UNIFORM_BLOCK_SIZE),g.maxTextureSize=S(pe.MAX_TEXTURE_SIZE),g.maxCubeMapTextureSize=S(pe.MAX_CUBE_MAP_TEXTURE_SIZE),g.maxArrayTextureLayers=S(pe.MAX_ARRAY_TEXTURE_LAYERS),g.max3DTextureSize=S(pe.MAX_3D_TEXTURE_SIZE),g.uboOffsetAlignment=S(pe.UNIFORM_BUFFER_OFFSET_ALIGNMENT);var h=T.getSupportedExtensions(),B="";h&&h.forEach((function(e){B+=e+" "}));var C=vt(T);C.WEBGL_debug_renderer_info?(this._renderer=S(C.WEBGL_debug_renderer_info.UNMASKED_RENDERER_WEBGL),this._vendor=S(C.WEBGL_debug_renderer_info.UNMASKED_VENDOR_WEBGL)):(this._renderer=S(pe.RENDERER),this._vendor=S(pe.VENDOR));var p=S(pe.VERSION),d=this._features;d.fill(!1),this.initFormatFeatures(C),d[Se.ELEMENT_INDEX_UINT]=!0,d[Se.INSTANCED_ARRAYS]=!0,d[Se.MULTIPLE_RENDER_TARGETS]=!0,d[Se.BLEND_MINMAX]=!0;var x="";return this.getFormatFeatures(G.ETC_RGB8)&&(x+="etc1 "),this.getFormatFeatures(G.ETC2_RGB8)&&(x+="etc2 "),this.getFormatFeatures(G.BC1)&&(x+="dxt "),this.getFormatFeatures(G.PVRTC_RGB2)&&(x+="pvrtc "),this.getFormatFeatures(G.ASTC_RGBA_4X4)&&(x+="astc "),c("WebGL2 device initialized."),c("RENDERER: "+this._renderer),c("VENDOR: "+this._vendor),c("VERSION: "+p),c("COMPRESSED_FORMAT: "+x),c("EXTENSIONS: "+B),!0},_.destroy=function(){this._queue&&(this._queue.destroy(),this._queue=null),this._cmdBuff&&(this._cmdBuff.destroy(),this._cmdBuff=null);for(var e=this._samplers.values(),t=e.next();!t.done;)t.value.destroy(),t=e.next();this._swapchain=null},_.flushCommands=function(){},_.acquire=function(){},_.present=function(){var e=this._queue;this._numDrawCalls=e.numDrawCalls,this._numInstances=e.numInstances,this._numTris=e.numTris,e.clear()},_.initFormatFeatures=function(e){var t=this._formatFeatures,r=this._textureExclusive;t.fill(ge.NONE),r.fill(!0);var a=ge.RENDER_TARGET|ge.SAMPLED_TEXTURE|ge.STORAGE_TEXTURE|ge.LINEAR_FILTER|ge.VERTEX_ATTRIBUTE;yt(t,[G.R8,G.RG8,G.RGB8,G.RGBA8],a),a=ge.RENDER_TARGET|ge.SAMPLED_TEXTURE|ge.STORAGE_TEXTURE|ge.LINEAR_FILTER,yt(t,[G.R8SN,G.RG8SN,G.RGB8SN,G.RGBA8SN,G.R5G6B5,G.RGBA4,G.RGB5A1,G.RGB10A2,G.SRGB8,G.SRGB8_A8,G.R11G11B10F,G.RGB9E5,G.DEPTH,G.DEPTH_STENCIL],a),t[G.RGB10A2UI]=ge.RENDER_TARGET|ge.STORAGE_TEXTURE|ge.SAMPLED_TEXTURE|ge.LINEAR_FILTER,a=ge.RENDER_TARGET|ge.SAMPLED_TEXTURE|ge.STORAGE_TEXTURE|ge.VERTEX_ATTRIBUTE,yt(t,[G.R16F,G.RG16F,G.RGB16F,G.RGBA16F],a),a=ge.STORAGE_TEXTURE|ge.SAMPLED_TEXTURE|ge.VERTEX_ATTRIBUTE,yt(t,[G.R32F,G.RG32F,G.RGB32F,G.RGBA32F],a),t[G.RGB10A2UI]=ge.RENDER_TARGET|ge.STORAGE_TEXTURE|ge.SAMPLED_TEXTURE|ge.LINEAR_FILTER,a=ge.RENDER_TARGET|ge.STORAGE_TEXTURE|ge.SAMPLED_TEXTURE|ge.LINEAR_FILTER|ge.VERTEX_ATTRIBUTE,yt(t,[G.R8I,G.R8UI,G.R16I,G.R16UI,G.R32I,G.R32UI,G.RG8I,G.RG8UI,G.RG16I,G.RG16UI,G.RG32I,G.RG32UI,G.RGB8I,G.RGB8UI,G.RGB16I,G.RGB16UI,G.RGB32I,G.RGB32UI,G.RGBA8I,G.RGBA8UI,G.RGBA16I,G.RGBA16UI,G.RGBA32I,G.RGBA32UI],a),wt(r,[G.R8,G.RG8,G.RGB8,G.R5G6B5,G.RGBA4,G.RGB5A1,G.RGBA8,G.RGB10A2,G.RGB10A2UI,G.SRGB8_A8,G.R8I,G.R8UI,G.R16I,G.R16UI,G.R32I,G.R32UI,G.RG8I,G.RG8UI,G.RG16I,G.RG16UI,G.RG32I,G.RG32UI,G.RGBA8I,G.RGBA8UI,G.RGBA16I,G.RGBA16UI,G.RGBA32I,G.RGBA32UI,G.DEPTH,G.DEPTH_STENCIL],!1),e.EXT_color_buffer_float&&(t[G.R32F]|=ge.RENDER_TARGET,t[G.RG32F]|=ge.RENDER_TARGET,t[G.RGBA32F]|=ge.RENDER_TARGET,wt(r,[G.R32F,G.RG32F,G.RGBA32F],!1)),e.EXT_color_buffer_half_float&&wt(r,[G.R16F,G.RG16F,G.RGBA16F],!1),e.OES_texture_float_linear&&(t[G.RGB32F]|=ge.LINEAR_FILTER,t[G.RGBA32F]|=ge.LINEAR_FILTER,t[G.R32F]|=ge.LINEAR_FILTER,t[G.RG32F]|=ge.LINEAR_FILTER),e.OES_texture_half_float_linear&&(t[G.RGB16F]|=ge.LINEAR_FILTER,t[G.RGBA16F]|=ge.LINEAR_FILTER,t[G.R16F]|=ge.LINEAR_FILTER,t[G.RG16F]|=ge.LINEAR_FILTER);var n=ge.SAMPLED_TEXTURE|ge.LINEAR_FILTER;e.WEBGL_compressed_texture_etc1&&(t[G.ETC_RGB8]=n),e.WEBGL_compressed_texture_etc&&yt(t,[G.ETC2_RGB8,G.ETC2_RGBA8,G.ETC2_SRGB8,G.ETC2_SRGB8_A8,G.ETC2_RGB8_A1,G.ETC2_SRGB8_A1],n),e.WEBGL_compressed_texture_s3tc&&yt(t,[G.BC1,G.BC1_ALPHA,G.BC1_SRGB,G.BC1_SRGB_ALPHA,G.BC2,G.BC2_SRGB,G.BC3,G.BC3_SRGB],n),e.WEBGL_compressed_texture_pvrtc&&yt(t,[G.PVRTC_RGB2,G.PVRTC_RGBA2,G.PVRTC_RGB4,G.PVRTC_RGBA4],n),e.WEBGL_compressed_texture_astc&&yt(t,[G.ASTC_RGBA_4X4,G.ASTC_RGBA_5X4,G.ASTC_RGBA_5X5,G.ASTC_RGBA_6X5,G.ASTC_RGBA_6X6,G.ASTC_RGBA_8X5,G.ASTC_RGBA_8X6,G.ASTC_RGBA_8X8,G.ASTC_RGBA_10X5,G.ASTC_RGBA_10X6,G.ASTC_RGBA_10X8,G.ASTC_RGBA_10X10,G.ASTC_RGBA_12X10,G.ASTC_RGBA_12X12,G.ASTC_SRGBA_4X4,G.ASTC_SRGBA_5X4,G.ASTC_SRGBA_5X5,G.ASTC_SRGBA_6X5,G.ASTC_SRGBA_6X6,G.ASTC_SRGBA_8X5,G.ASTC_SRGBA_8X6,G.ASTC_SRGBA_8X8,G.ASTC_SRGBA_10X5,G.ASTC_SRGBA_10X6,G.ASTC_SRGBA_10X8,G.ASTC_SRGBA_10X10,G.ASTC_SRGBA_12X10,G.ASTC_SRGBA_12X12],n)},_.createCommandBuffer=function(e){var t=new(e.type===oe.PRIMARY?Gt:ot);return t.initialize(e),t},_.createSwapchain=function(e){var t=new Nt;return this._swapchain=t,t.initialize(e),t},_.createBuffer=function(e){var t=new gt;return t.initialize(e),t},_.createTexture=function(e){var t=new Pt;return t.initialize(e),t},_.createDescriptorSet=function(e){var t=new Oe;return t.initialize(e),t},_.createShader=function(e){var t=new bt;return t.initialize(e),t},_.createInputAssembler=function(e){var t=new Bt;return t.initialize(e),t},_.createRenderPass=function(e){var t=new It;return t.initialize(e),t},_.createFramebuffer=function(e){var t=new ht;return t.initialize(e),t},_.createDescriptorSetLayout=function(e){var t=new Ct;return t.initialize(e),t},_.createPipelineLayout=function(e){var t=new pt;return t.initialize(e),t},_.createPipelineState=function(e){var t=new xt;return t.initialize(e),t},_.createQueue=function(e){var t=new mt;return t.initialize(e),t},_.getSampler=function(e){var t=Q.computeHash(e);return this._samplers.has(t)||this._samplers.set(t,new Ft(e,t)),this._samplers.get(t)},_.getSwapchains=function(){return[this._swapchain]},_.getGeneralBarrier=function(e){var t=he.computeHash(e);return this._generalBarrierss.has(t)||this._generalBarrierss.set(t,new he(e,t)),this._generalBarrierss.get(t)},_.getTextureBarrier=function(e){var t=Be.computeHash(e);return this._textureBarriers.has(t)||this._textureBarriers.set(t,new Be(e,t)),this._textureBarriers.get(t)},_.getBufferBarrier=function(e){var t=Ce.computeHash(e);return this._bufferBarriers.has(t)||this._bufferBarriers.set(t,new Ce(e,t)),this._bufferBarriers.get(t)},_.copyBuffersToTexture=function(e,t,r){Et(this,e,t.gpuTexture,r)},_.copyTextureToBuffers=function(e,t,r){ft(this,e.gpuTexture,t,r)},_.copyTexImagesToTexture=function(e,t,r){lt(this,e,t.gpuTexture,r)},r(i,[{key:"gl",get:function(){return this._context}},{key:"extensions",get:function(){return this._swapchain.extensions}},{key:"nullTex2D",get:function(){return this._swapchain.nullTex2D}},{key:"nullTexCube",get:function(){return this._swapchain.nullTexCube}},{key:"textureExclusive",get:function(){return this._textureExclusive}},{key:"bindingMappings",get:function(){return this._bindingMappings}},{key:"blitManager",get:function(){return this._swapchain.blitManager}}]),i}(Ee));me.WebGL2Device=Ht}}}));
