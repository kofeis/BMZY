System.register(["./index-C5lmLqDW.js","./director-DIlqD2Nd.js","./gc-object-CKHc4SnS.js","./global-exports-CR3GRnjt.js","./scene-7MDSMR3j.js","./prefab-DH0xadMc.js","./device-manager-BvjvoelW.js","./buffer-barrier-CuX_5NUR.js","./pipeline-state-manager-Cdpe3is6.js","./node-event-DTNosVQv.js","./component-BaGvu7EF.js","./factory-D9_8ZCqM.js","./deprecated-Ca3AjUwj.js"],(function(e,t){"use strict";var n,i,r,s,a,o,u,c,_,l,m,E,f,d,h,T,g,p,N,R,I,P,S,v,D,y,b,A,V,w,C,O,B,L,U;return{setters:[function(e){n=e.m,i=e.G,r=e.o,s=e.h,a=e.r},function(e){o=e.d,u=e.D,c=e.a},function(e){_=e.a,l=e.U,m=e.s,E=e._,f=e.W,d=e.X,h=e.Y,T=e.A,g=e.Z,p=e.S,N=e.h,R=e.H,I=e.R,P=e.$,S=e.a0,v=e.n},function(e){D=e.l,y=e.c,b=e.E,A=e.e},function(e){V=e.l,w=e.d},function(e){C=e.i},function(e){O=e.d,B=e.L},null,function(e){L=e.k,U=e.L},null,null,null,null],execute:function(){var F=function(){function e(){var e=this;this._rafHandle=0,this._onTick=null,this._targetFrameRate=60,this._isPlaying=!1,this._updateCallback=function(){e._isPlaying&&(e._rafHandle=requestAnimationFrame(e._updateCallback)),e._onTick&&e._onTick()}}var t=e.prototype;return t.start=function(){this._isPlaying||(this._rafHandle=requestAnimationFrame(this._updateCallback),this._isPlaying=!0)},t.stop=function(){this._isPlaying&&(cancelAnimationFrame(this._rafHandle),this._rafHandle=0,this._isPlaying=!1)},_(e,[{key:"targetFrameRate",get:function(){return this._targetFrameRate},set:function(e){this._targetFrameRate!==e&&(this._targetFrameRate=e,l.setPreferredFramesPerSecond(this._targetFrameRate),this._isPlaying&&(this.stop(),this.start()))}},{key:"onTick",get:function(){return this._onTick},set:function(e){this._onTick=e}}]),e}(),M=new(function(){function e(){this._data=null}return e.prototype.init=function(e){var t=this;return void 0===e&&(e=""),D.rendering&&D.rendering.enableEffectImport&&e?new Promise((function(n,i){if(e.startsWith("http")){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="arraybuffer",r.onload=function(){t._data=r.response,n()},r.onerror=function(){i(new Error("request effect settings failed!"))},r.send(null)}else globalThis.fsUtils.readArrayBuffer(e,(function(e,r){e?i(e):(t._data=r,n())}))})):Promise.resolve()},_(e,[{key:"data",get:function(){return this._data}}]),e}());D.effectSettings=M;var j=m.querySettings.bind(m),k=e("G",function(e){function r(){var t;return(t=e.call(this)||this).frame=null,t.container=null,t.canvas=null,t.renderType=-1,t.eventTargetOn=e.prototype.on,t.eventTargetOnce=e.prototype.once,t.config={},t.onStart=null,t.frameTime=1e3/60,t._isCloning=!1,t._inited=!1,t._engineInited=!1,t._rendererInitialized=!1,t._paused=!0,t._pausedByEngine=!1,t._frameRate=60,t._pacer=null,t._initTime=0,t._startTime=0,t._deltaTime=0,t._useFixedDeltaTime=!1,t._shouldLoadLaunchScene=!0,t.onPreBaseInitDelegate=new S,t.onPostBaseInitDelegate=new S,t.onPreInfrastructureInitDelegate=new S,t.onPostInfrastructureInitDelegate=new S,t.onPreSubsystemInitDelegate=new S,t.onPostSubsystemInitDelegate=new S,t.onPreProjectInitDelegate=new S,t.onPostProjectInitDelegate=new S,t}E(r,e);var s=r.prototype;return s.setFrameRate=function(e){this.frameRate=e},s.getFrameRate=function(){return this.frameRate},s.step=function(){o.tick(this._calculateDT(!0))},s.pauseByEngine=function(){this._paused||(this._pausedByEngine=!0,this.pause())},s.resumeByEngine=function(){this._pausedByEngine&&(this.resume(),this._pausedByEngine=!1)},s.pause=function(){var e;this._paused||(this._paused=!0,null==(e=this._pacer)||e.stop(),this.emit(r.EVENT_PAUSE))},s.resume=function(){var e;this._paused&&(C._clearEvents(),this._paused=!1,null==(e=this._pacer)||e.start(),this.emit(r.EVENT_RESUME))},s.isPaused=function(){return this._paused},s.restart=function(){var e=this;return new Promise((function(e){o.once(u.END_FRAME,(function(){return e()}))})).then((function(){o.reset(),y.Object._deferredDestroy(),e.pause(),e.resume(),e._shouldLoadLaunchScene=!0})).then((function(){return Promise.resolve([])})).then((function(){e._safeEmit(r.EVENT_RESTART)}))},s.end=function(){f.close()},s.on=function(e,t,n,i){return this.canRegisterEvent(e)&&t.call(n),this.eventTargetOn(e,t,n,i)},s.once=function(e,t,n){return this.canRegisterEvent(e)?t.call(n):this.eventTargetOnce(e,t,n)},s.canRegisterEvent=function(e){return this._engineInited&&e===r.EVENT_ENGINE_INITED||this._inited&&e===r.EVENT_GAME_INITED||this._rendererInitialized&&e===r.EVENT_RENDERER_INITED},s.init=function(e){var s=this;return this._compatibleWithOldParams(e),Promise.resolve().then((function(){return s.emit(r.EVENT_PRE_BASE_INIT),s.onPreBaseInitDelegate.dispatch()})).then((function(){var t=e.debugMode||d.NONE;h(t)})).then((function(){return n.init()})).then((function(){s._initEvents()})).then((function(){return m.init(e.settingsPath,e.overrideSettings)})).then((function(){return s.emit(r.EVENT_POST_BASE_INIT),s.onPostBaseInitDelegate.dispatch()})).then((function(){return s.emit(r.EVENT_PRE_INFRASTRUCTURE_INIT),s.onPreInfrastructureInitDelegate.dispatch()})).then((function(){T.init(),s._initXR();var e,t={frame:e=document.createElement("div"),canvas:window.canvas,container:e};return s.canvas=t.canvas,s.frame=t.frame,s.container=t.container,i.init(),g.init(),O.init(s.canvas,L)})).then((function(){if(j(p.RENDERING,"customPipeline")){if(!y.rendering)return void N(12109);T.CUSTOM_PIPELINE_NAME||(T.CUSTOM_PIPELINE_NAME="Builtin")}else y.rendering=void 0;V.init(),w.init(),U.init(),s.initPacer()})).then((function(){return s.emit(r.EVENT_POST_INFRASTRUCTURE_INIT),s.onPostInfrastructureInitDelegate.dispatch()})).then((function(){return s.emit(r.EVENT_PRE_SUBSYSTEM_INIT),s.onPreSubsystemInitDelegate.dispatch()})).then((function(){return M.init(j(p.RENDERING,"effectSettingsPath"))})).then((function(){if(y.rendering&&y.rendering.enableEffectImport)if(j(p.RENDERING,"renderMode")!==B.HEADLESS){var e=M.data;null!==e?y.rendering.init(O.gfxDevice,e):N(1102)}else y.rendering.init(O.gfxDevice,null)})).then((function(){var e=j(p.SCRIPTING,"scriptPackages");return e?Promise.all(e.map((function(e){return t.import(e)}))):Promise.resolve([])})).then((function(){return o.init(),w.loadBuiltinAssets()})).then((function(){return s.emit(r.EVENT_POST_SUBSYSTEM_INIT),s.onPostSubsystemInitDelegate.dispatch()})).then((function(){R("Cocos Creator v"+A),s.emit(r.EVENT_ENGINE_INITED),s._engineInited=!0})).then((function(){return s.emit(r.EVENT_PRE_PROJECT_INIT),s.onPreProjectInitDelegate.dispatch()})).then((function(){var e=j(p.PLUGINS,"jsList"),t=Promise.resolve();return e&&e.forEach((function(e){t=t.then((function(){return __wxRequire("src/"+e)}))})),t})).then((function(){return s._loadProjectBundles()})).then((function(){return s._loadCCEScripts()})).then((function(){return s._setupRenderPipeline()})).then((function(){return s._loadPreloadAssets()})).then((function(){return w.compileBuiltinMaterial(),Promise.resolve([])})).then((function(){return s.emit(r.EVENT_POST_PROJECT_INIT),s.onPostProjectInitDelegate.dispatch()})).then((function(){s._inited=!0,s._safeEmit(r.EVENT_GAME_INITED)}))},s._initXR=function(){var e;if(void 0===globalThis.__globalXR&&(globalThis.__globalXR={}),globalThis.__globalXR.webxrCompatible=null!==(e=j(p.XR,"webxrCompatible"))&&void 0!==e&&e,n.isXR){var t,i;xr.entry=xr.XrEntry.getInstance();var r=null!==(t=j(p.RENDERING,"msaa"))&&void 0!==t?t:1,s=null!==(i=j(p.RENDERING,"renderingScale"))&&void 0!==i?i:1;xr.entry.setMultisamplesRTT(r),xr.entry.setRenderingScale(s)}},s._compatibleWithOldParams=function(e){var t=e.overrideSettings=e.overrideSettings||{};"showFPS"in e&&(t.profiling=t.profiling||{},t.profiling.showFPS=e.showFPS),"frameRate"in e&&(t.screen=t.screen||{},t.screen.frameRate=e.frameRate),"renderMode"in e&&(t.rendering=t.rendering||{},t.rendering.renderMode=e.renderMode),"renderPipeline"in e&&(t.rendering=t.rendering||{},t.rendering.renderPipeline=e.renderPipeline),"assetOptions"in e&&(t.assets=t.assets||{},Object.assign(t.assets,e.assetOptions)),"customJointTextureLayouts"in e&&(t.animation=t.animation||{},t.animation.customJointTextureLayouts=e.customJointTextureLayouts),"physics"in e&&(t.physics=t.physics||{},Object.assign(t.physics,e.physics)),"orientation"in e&&(t.screen=t.screen||{},t.screen.orientation=e.orientation),"exactFitScreen"in e&&(t.screen=t.screen||{},t.screen.exactFitScreen=e.exactFitScreen)},s._loadPreloadAssets=function(){var e=j(p.ASSETS,"preloadAssets");return e?Promise.all(e.map((function(e){return new Promise((function(t,n){V.loadAny(e,(function(e){e?n(e):t()}))}))}))):Promise.resolve([])},s._loadCCEScripts=function(){return new Promise((function(e){e()}))},s._loadProjectBundles=function(){var e=j(p.ASSETS,"preloadBundles");return e?Promise.all(e.map((function(e){var t=e.bundle,n=e.version;return new Promise((function(e,i){var r={};n&&(r.version=n),V.loadBundle(t,r,(function(t){t?i(t):e()}))}))}))):Promise.resolve([])},s.run=function(e){e&&(this.onStart=e),this._inited&&!b&&this.resume()},s._calculateDT=function(e){if(this._useFixedDeltaTime=e,e)return this._startTime=performance.now(),this.frameTime/1e3;var t=performance.now();return this._deltaTime=t>this._startTime?(t-this._startTime)/1e3:0,this._deltaTime>r.DEBUG_DT_THRESHOLD&&(this._deltaTime=this.frameTime/1e3),this._startTime=t,this._deltaTime},s._updateCallback=function(){var e=this;if(this._inited)if(this._shouldLoadLaunchScene){this._shouldLoadLaunchScene=!1;var t,n=j(p.LAUNCH,"launchScene");n?o.loadScene(n,(function(){I(1103,n),e._initTime=performance.now(),o.startAnimation(),null==e.onStart||e.onStart()})):(this._initTime=performance.now(),o.startAnimation(),null==(t=this.onStart)||t.call(this))}else o.tick(this._calculateDT(!1))},s.initPacer=function(){var e,t=null!==(e=j(p.SCREEN,"frameRate"))&&void 0!==e?e:60;P("number"==typeof t),this._pacer=new F,this._pacer.onTick=this._updateCallback.bind(this),this.frameRate=t},s._initEvents=function(){f.on("show",this._onShow,this),f.on("hide",this._onHide,this),f.on("close",this._onClose,this)},s._onHide=function(){this.emit(r.EVENT_HIDE),this.pauseByEngine()},s._onShow=function(){this.emit(r.EVENT_SHOW),this.resumeByEngine()},s._onClose=function(){this.emit(r.EVENT_CLOSE),f.exit()},s.addPersistRootNode=function(e){o.addPersistRootNode(e)},s.removePersistRootNode=function(e){o.removePersistRootNode(e)},s.isPersistRootNode=function(e){return o.isPersistRootNode(e)},s._setupRenderPipeline=function(){var e=j(p.RENDERING,"customPipeline");return this._setRenderPipeline(!!e)},s._setRenderPipeline=function(e){o.root.setRenderPipeline(e)?(this._rendererInitialized=!0,this._safeEmit(r.EVENT_RENDERER_INITED)):N(1222)},s._safeEmit=function(e){this.emit(e)},_(r,[{key:"inited",get:function(){return this._inited}},{key:"frameRate",get:function(){return this._frameRate},set:function(e){"number"!=typeof e&&(e=parseInt(e,10),Number.isNaN(e)&&(e=60)),this._frameRate=e,this.frameTime=1e3/e,this._pacer&&(this._pacer.targetFrameRate=this._frameRate)}},{key:"deltaTime",get:function(){return this._useFixedDeltaTime?this.frameTime/1e3:this._deltaTime}},{key:"totalTime",get:function(){return performance.now()-this._initTime}},{key:"frameStartTime",get:function(){return this._startTime}}]),r}(v));k.EVENT_HIDE="game_on_hide",k.EVENT_SHOW="game_on_show",k.EVENT_LOW_MEMORY="game_on_low_memory",k.EVENT_GAME_INITED="game_inited",k.EVENT_ENGINE_INITED="engine_inited",k.EVENT_RENDERER_INITED="renderer_inited",k.EVENT_PRE_BASE_INIT="pre_base_init",k.EVENT_POST_BASE_INIT="post_base_init",k.EVENT_PRE_INFRASTRUCTURE_INIT="pre_infrastructure_init",k.EVENT_POST_INFRASTRUCTURE_INIT="post_infrastructure_init",k.EVENT_PRE_SUBSYSTEM_INIT="pre_subsystem_init",k.EVENT_POST_SUBSYSTEM_INIT="post_subsystem_init",k.EVENT_PRE_PROJECT_INIT="pre_project_init",k.EVENT_POST_PROJECT_INIT="post_project_init",k.EVENT_RESTART="game_on_restart",k.EVENT_PAUSE="game_on_pause",k.EVENT_RESUME="game_on_resume",k.EVENT_CLOSE="game_on_close",k.RENDER_TYPE_CANVAS=0,k.RENDER_TYPE_WEBGL=1,k.RENDER_TYPE_OPENGL=2,k.RENDER_TYPE_HEADLESS=3,k.DEBUG_DT_THRESHOLD=1,y.Game=k;var x=e("g",y.game=new k);r(c.prototype,"director",[{name:"calculateDeltaTime"},{name:"getDeltaTime",suggest:"Use game.deltaTime instead"},{name:"getTotalTime",suggest:"Use game.totalTime instead"},{name:"getCurrentTime",suggest:"Use game.frameStartTime instead"}]),s(c.prototype,"director",[{name:"setAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getRunningScene",suggest:"please use getScene instead"},{name:"setDepthTest",suggest:"please use camera API instead"},{name:"setClearColor",suggest:"please use camera API instead"},{name:"getWinSize",suggest:"please use view.getVisibleSize instead"},{name:"getWinSizeInPixels"},{name:"purgeCachedData",suggest:"please use assetManager.releaseAll instead"},{name:"convertToGL"},{name:"convertToUI"}]),a(o,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(e){var t;return V.main?null==(t=V.main.getSceneInfo(e))?void 0:t.uuid:""}}]),r(x,"game",[{name:"collisionMatrix"},{name:"groupList"}]),a(x,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var e=[];return V.main&&V.main.config.scenes.forEach((function(t){e.push(t)})),e}}])}}}));
