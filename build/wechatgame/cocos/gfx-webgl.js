System.register(["./gc-object-CKHc4SnS.js","./buffer-barrier-CuX_5NUR.js","./global-exports-CR3GRnjt.js","./gl-constants-ByUWAeN6.js"],(function(e){"use strict";var t,r,a,n,s,i,u,l,_,f,c,o,E,g,T,S,R,A,h,p,B,d,C,x,m,b,P,v,G,O,F,L,I,M,D,y,N,U,w,H,X,k,V,W,z,K,Y,j,q,Z,Q,J,$,ee,te,re,ae,ne,se,ie,ue,le,_e,fe,ce,oe,Ee,ge,Te,Se,Re,Ae,he,pe,Be,de,Ce,xe,me,be,Pe,ve,Ge,Oe,Fe;return{setters:[function(e){t=e._,r=e.a,a=e.h,n=e.W,s=e.a2,i=e.J,u=e.ad,l=e.L,_=e.av,f=e.w,c=e.y,o=e.G,E=e.O,g=e.A},function(e){T=e.at,S=e.av,R=e.X,A=e.M,h=e.b,p=e.d,B=e.c,d=e.aJ,C=e.F,x=e.aQ,m=e.aj,b=e.as,P=e.aE,v=e.p,G=e.v,O=e.br,F=e.bq,L=e.k,I=e.j,M=e.b1,D=e.aH,y=e.aU,N=e.S,U=e.U,w=e.i,H=e.g,X=e.h,k=e.a7,V=e.A,W=e.D,z=e.w,K=e.J,Y=e.ba,j=e.aF,q=e.$,Z=e.W,Q=e.O,J=e.au,$=e.Y,ee=e.Z,te=e._,re=e.a0,ae=e.Q,ne=e.L,se=e.N,ie=e.bo,ue=e.a4,le=e.a5,_e=e.aP,fe=e.aK,ce=e.T,oe=e.e,Ee=e.K,ge=e.f,Te=e.H,Se=e.r,Re=e.G,Ae=e.a$,he=e.b0,pe=e.aq,Be=e.a8,de=e.o,Ce=e.ar,xe=e.a1,me=e.a2,be=e.a3},function(e){Pe=e.B,ve=e.c,Ge=e.b,Oe=e.l},function(e){Fe=e.W}],execute:function(){var Le,Ie=function(e){function a(){var t;return(t=e.call(this)||this)._gpuDescriptorSet=null,t}t(a,e);var n=a.prototype;return n.initialize=function(e){this._layout=e.layout;var t=e.layout.gpuDescriptorSetLayout,r=t.bindings,a=t.descriptorIndices,n=t.descriptorCount;this._buffers=Array(n).fill(null),this._textures=Array(n).fill(null),this._samplers=Array(n).fill(null);var s=[];this._gpuDescriptorSet={gpuDescriptors:s,descriptorIndices:a};for(var i=0;i<r.length;++i)for(var u=r[i],l=0;l<u.count;l++){var _={type:u.descriptorType,gpuBuffer:null,gpuTexture:null,gpuSampler:null};s.push(_)}},n.destroy=function(){this._layout=null,this._gpuDescriptorSet=null},n.update=function(){if(this._isDirty&&this._gpuDescriptorSet){for(var e=this._gpuDescriptorSet.gpuDescriptors,t=0;t<e.length;++t)if(e[t].type&T){var r=this._buffers[t];r&&(e[t].gpuBuffer=r.gpuBuffer||r.gpuBufferView)}else e[t].type&S&&(this._textures[t]&&(e[t].gpuTexture=this._textures[t].gpuTexture),this._samplers[t]&&(e[t].gpuSampler=this._samplers[t].gpuSampler));this._isDirty=!1}},r(a,[{key:"gpuDescriptorSet",get:function(){return this._gpuDescriptorSet}}]),a}(R);!function(e){e[e.RGBA16F_EXT=34842]="RGBA16F_EXT",e[e.RGB16F_EXT=34843]="RGB16F_EXT",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR"}(Le||(Le={}));var Me=function(){function e(){}return e.setInstance=function(t){e._instance=t},r(e,null,[{key:"instance",get:function(){return e._instance}}]),e}();Me._instance=null;var De=Math.max,ye=Math.min;function Ne(e){switch(e){case C.R8:return Fe.UNSIGNED_BYTE;case C.R8SN:return Fe.BYTE;case C.R8UI:return Fe.UNSIGNED_BYTE;case C.R8I:return Fe.BYTE;case C.R16F:return Le.HALF_FLOAT_OES;case C.R16UI:return Fe.UNSIGNED_SHORT;case C.R16I:return Fe.SHORT;case C.R32F:return Fe.FLOAT;case C.R32UI:return Fe.UNSIGNED_INT;case C.R32I:return Fe.INT;case C.RG8:return Fe.UNSIGNED_BYTE;case C.RG8SN:return Fe.BYTE;case C.RG8UI:return Fe.UNSIGNED_BYTE;case C.RG8I:return Fe.BYTE;case C.RG16F:return Le.HALF_FLOAT_OES;case C.RG16UI:return Fe.UNSIGNED_SHORT;case C.RG16I:return Fe.SHORT;case C.RG32F:return Fe.FLOAT;case C.RG32UI:return Fe.UNSIGNED_INT;case C.RG32I:return Fe.INT;case C.RGB8:case C.SRGB8:return Fe.UNSIGNED_BYTE;case C.RGB8SN:return Fe.BYTE;case C.RGB8UI:return Fe.UNSIGNED_BYTE;case C.RGB8I:return Fe.BYTE;case C.RGB16F:return Le.HALF_FLOAT_OES;case C.RGB16UI:return Fe.UNSIGNED_SHORT;case C.RGB16I:return Fe.SHORT;case C.RGB32F:return Fe.FLOAT;case C.RGB32UI:return Fe.UNSIGNED_INT;case C.RGB32I:return Fe.INT;case C.BGRA8:case C.RGBA8:case C.SRGB8_A8:return Fe.UNSIGNED_BYTE;case C.RGBA8SN:return Fe.BYTE;case C.RGBA8UI:return Fe.UNSIGNED_BYTE;case C.RGBA8I:return Fe.BYTE;case C.RGBA16F:return Le.HALF_FLOAT_OES;case C.RGBA16UI:return Fe.UNSIGNED_SHORT;case C.RGBA16I:return Fe.SHORT;case C.RGBA32F:return Fe.FLOAT;case C.RGBA32UI:return Fe.UNSIGNED_INT;case C.RGBA32I:return Fe.INT;case C.R5G6B5:return Fe.UNSIGNED_SHORT_5_6_5;case C.R11G11B10F:return Fe.FLOAT;case C.RGB5A1:return Fe.UNSIGNED_SHORT_5_5_5_1;case C.RGBA4:return Fe.UNSIGNED_SHORT_4_4_4_4;case C.RGB10A2:return Fe.UNSIGNED_BYTE;case C.RGB10A2UI:return Fe.UNSIGNED_INT;case C.RGB9E5:return Fe.UNSIGNED_BYTE;case C.DEPTH:return Fe.UNSIGNED_INT;case C.DEPTH_STENCIL:return Le.UNSIGNED_INT_24_8_WEBGL;case C.BC1:case C.BC1_SRGB:case C.BC2:case C.BC2_SRGB:case C.BC3:case C.BC3_SRGB:case C.BC4:return Fe.UNSIGNED_BYTE;case C.BC4_SNORM:return Fe.BYTE;case C.BC5:return Fe.UNSIGNED_BYTE;case C.BC5_SNORM:return Fe.BYTE;case C.BC6H_SF16:case C.BC6H_UF16:return Fe.FLOAT;case C.BC7:case C.BC7_SRGB:case C.ETC_RGB8:case C.ETC2_RGB8:case C.ETC2_SRGB8:case C.ETC2_RGB8_A1:case C.ETC2_SRGB8_A1:case C.EAC_R11:return Fe.UNSIGNED_BYTE;case C.EAC_R11SN:return Fe.BYTE;case C.EAC_RG11:return Fe.UNSIGNED_BYTE;case C.EAC_RG11SN:return Fe.BYTE;case C.PVRTC_RGB2:case C.PVRTC_RGBA2:case C.PVRTC_RGB4:case C.PVRTC_RGBA4:case C.PVRTC2_2BPP:case C.PVRTC2_4BPP:case C.ASTC_RGBA_4X4:case C.ASTC_RGBA_5X4:case C.ASTC_RGBA_5X5:case C.ASTC_RGBA_6X5:case C.ASTC_RGBA_6X6:case C.ASTC_RGBA_8X5:case C.ASTC_RGBA_8X6:case C.ASTC_RGBA_8X8:case C.ASTC_RGBA_10X5:case C.ASTC_RGBA_10X6:case C.ASTC_RGBA_10X8:case C.ASTC_RGBA_10X10:case C.ASTC_RGBA_12X10:case C.ASTC_RGBA_12X12:case C.ASTC_SRGBA_4X4:case C.ASTC_SRGBA_5X4:case C.ASTC_SRGBA_5X5:case C.ASTC_SRGBA_6X5:case C.ASTC_SRGBA_6X6:case C.ASTC_SRGBA_8X5:case C.ASTC_SRGBA_8X6:case C.ASTC_SRGBA_8X8:case C.ASTC_SRGBA_10X5:case C.ASTC_SRGBA_10X6:case C.ASTC_SRGBA_10X8:case C.ASTC_SRGBA_10X10:case C.ASTC_SRGBA_12X10:case C.ASTC_SRGBA_12X12:default:return Fe.UNSIGNED_BYTE}}function Ue(e){switch(e){case C.R5G6B5:return Fe.RGB565;case C.RGB5A1:return Fe.RGB5_A1;case C.RGBA4:return Fe.RGBA4;case C.RGBA16F:return Le.RGBA16F_EXT;case C.RGBA32F:return Le.RGBA32F_EXT;case C.SRGB8_A8:return Le.SRGB8_ALPHA8_EXT;case C.DEPTH:return Fe.DEPTH_COMPONENT16;case C.DEPTH_STENCIL:return Fe.DEPTH_STENCIL;default:return a(16309),Fe.RGBA}}function we(e){switch(e){case C.A8:return Fe.ALPHA;case C.L8:return Fe.LUMINANCE;case C.LA8:return Fe.LUMINANCE_ALPHA;case C.RGB8:case C.RGB16F:case C.RGB32F:return Fe.RGB;case C.BGRA8:case C.RGBA8:case C.SRGB8_A8:case C.RGBA16F:case C.RGBA32F:return Fe.RGBA;case C.R5G6B5:return Fe.RGB;case C.RGB5A1:case C.RGBA4:return Fe.RGBA;case C.DEPTH:return Fe.DEPTH_COMPONENT;case C.DEPTH_STENCIL:return Fe.DEPTH_STENCIL;case C.BC1:return Le.COMPRESSED_RGB_S3TC_DXT1_EXT;case C.BC1_ALPHA:return Le.COMPRESSED_RGBA_S3TC_DXT1_EXT;case C.BC1_SRGB:return Le.COMPRESSED_SRGB_S3TC_DXT1_EXT;case C.BC1_SRGB_ALPHA:return Le.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case C.BC2:return Le.COMPRESSED_RGBA_S3TC_DXT3_EXT;case C.BC2_SRGB:return Le.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case C.BC3:return Le.COMPRESSED_RGBA_S3TC_DXT5_EXT;case C.BC3_SRGB:return Le.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case C.ETC_RGB8:return Le.COMPRESSED_RGB_ETC1_WEBGL;case C.ETC2_RGB8:return Le.COMPRESSED_RGB8_ETC2;case C.ETC2_SRGB8:return Le.COMPRESSED_SRGB8_ETC2;case C.ETC2_RGB8_A1:return Le.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case C.ETC2_SRGB8_A1:return Le.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case C.ETC2_RGBA8:return Le.COMPRESSED_RGBA8_ETC2_EAC;case C.ETC2_SRGB8_A8:return Le.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case C.EAC_R11:return Le.COMPRESSED_R11_EAC;case C.EAC_R11SN:return Le.COMPRESSED_SIGNED_R11_EAC;case C.EAC_RG11:return Le.COMPRESSED_RG11_EAC;case C.EAC_RG11SN:return Le.COMPRESSED_SIGNED_RG11_EAC;case C.PVRTC_RGB2:return Le.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case C.PVRTC_RGBA2:return Le.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case C.PVRTC_RGB4:return Le.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case C.PVRTC_RGBA4:return Le.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case C.ASTC_RGBA_4X4:return Le.COMPRESSED_RGBA_ASTC_4x4_KHR;case C.ASTC_RGBA_5X4:return Le.COMPRESSED_RGBA_ASTC_5x4_KHR;case C.ASTC_RGBA_5X5:return Le.COMPRESSED_RGBA_ASTC_5x5_KHR;case C.ASTC_RGBA_6X5:return Le.COMPRESSED_RGBA_ASTC_6x5_KHR;case C.ASTC_RGBA_6X6:return Le.COMPRESSED_RGBA_ASTC_6x6_KHR;case C.ASTC_RGBA_8X5:return Le.COMPRESSED_RGBA_ASTC_8x5_KHR;case C.ASTC_RGBA_8X6:return Le.COMPRESSED_RGBA_ASTC_8x6_KHR;case C.ASTC_RGBA_8X8:return Le.COMPRESSED_RGBA_ASTC_8x8_KHR;case C.ASTC_RGBA_10X5:return Le.COMPRESSED_RGBA_ASTC_10x5_KHR;case C.ASTC_RGBA_10X6:return Le.COMPRESSED_RGBA_ASTC_10x6_KHR;case C.ASTC_RGBA_10X8:return Le.COMPRESSED_RGBA_ASTC_10x8_KHR;case C.ASTC_RGBA_10X10:return Le.COMPRESSED_RGBA_ASTC_10x10_KHR;case C.ASTC_RGBA_12X10:return Le.COMPRESSED_RGBA_ASTC_12x10_KHR;case C.ASTC_RGBA_12X12:return Le.COMPRESSED_RGBA_ASTC_12x12_KHR;case C.ASTC_SRGBA_4X4:return Le.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case C.ASTC_SRGBA_5X4:return Le.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case C.ASTC_SRGBA_5X5:return Le.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case C.ASTC_SRGBA_6X5:return Le.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case C.ASTC_SRGBA_6X6:return Le.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case C.ASTC_SRGBA_8X5:return Le.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case C.ASTC_SRGBA_8X6:return Le.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case C.ASTC_SRGBA_8X8:return Le.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case C.ASTC_SRGBA_10X5:return Le.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case C.ASTC_SRGBA_10X6:return Le.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case C.ASTC_SRGBA_10X8:return Le.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case C.ASTC_SRGBA_10X10:return Le.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case C.ASTC_SRGBA_12X10:return Le.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case C.ASTC_SRGBA_12X12:return Le.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return a(16310),Fe.RGBA}}function He(e){switch(e){case I.BOOL:return Fe.BOOL;case I.BOOL2:return Fe.BOOL_VEC2;case I.BOOL3:return Fe.BOOL_VEC3;case I.BOOL4:return Fe.BOOL_VEC4;case I.INT:return Fe.INT;case I.INT2:return Fe.INT_VEC2;case I.INT3:return Fe.INT_VEC3;case I.INT4:return Fe.INT_VEC4;case I.UINT:return Fe.UNSIGNED_INT;case I.FLOAT:return Fe.FLOAT;case I.FLOAT2:return Fe.FLOAT_VEC2;case I.FLOAT3:return Fe.FLOAT_VEC3;case I.FLOAT4:return Fe.FLOAT_VEC4;case I.MAT2:return Fe.FLOAT_MAT2;case I.MAT3:return Fe.FLOAT_MAT3;case I.MAT4:return Fe.FLOAT_MAT4;case I.SAMPLER2D:return Fe.SAMPLER_2D;case I.SAMPLER_CUBE:return Fe.SAMPLER_CUBE;default:return a(16311),I.UNKNOWN}}function Xe(e){switch(e){case I.BOOL:case I.BOOL2:case I.BOOL3:case I.BOOL4:case I.INT:case I.INT2:case I.INT3:case I.INT4:case I.UINT:return Int32Array;case I.FLOAT:case I.FLOAT2:case I.FLOAT3:case I.FLOAT4:case I.MAT2:case I.MAT3:case I.MAT4:return Float32Array;default:return a(16312),Float32Array}}function ke(e){switch(e){case Fe.BOOL:return I.BOOL;case Fe.BOOL_VEC2:return I.BOOL2;case Fe.BOOL_VEC3:return I.BOOL3;case Fe.BOOL_VEC4:return I.BOOL4;case Fe.INT:return I.INT;case Fe.INT_VEC2:return I.INT2;case Fe.INT_VEC3:return I.INT3;case Fe.INT_VEC4:return I.INT4;case Fe.UNSIGNED_INT:return I.UINT;case Fe.FLOAT:return I.FLOAT;case Fe.FLOAT_VEC2:return I.FLOAT2;case Fe.FLOAT_VEC3:return I.FLOAT3;case Fe.FLOAT_VEC4:return I.FLOAT4;case Fe.FLOAT_MAT2:return I.MAT2;case Fe.FLOAT_MAT3:return I.MAT3;case Fe.FLOAT_MAT4:return I.MAT4;case Fe.SAMPLER_2D:return I.SAMPLER2D;case Fe.SAMPLER_CUBE:return I.SAMPLER_CUBE;default:return a(16313),I.UNKNOWN}}function Ve(e){switch(e){case Fe.BOOL:return 4;case Fe.BOOL_VEC2:return 8;case Fe.BOOL_VEC3:return 12;case Fe.BOOL_VEC4:return 16;case Fe.INT:return 4;case Fe.INT_VEC2:return 8;case Fe.INT_VEC3:return 12;case Fe.INT_VEC4:return 16;case Fe.UNSIGNED_INT:case Fe.FLOAT:return 4;case Fe.FLOAT_VEC2:return 8;case Fe.FLOAT_VEC3:return 12;case Fe.FLOAT_VEC4:case Fe.FLOAT_MAT2:return 16;case Fe.FLOAT_MAT3:return 36;case Fe.FLOAT_MAT4:return 64;case Fe.SAMPLER_2D:case Fe.SAMPLER_CUBE:return 4;default:return a(16314),0}}function We(e){switch(e){case Fe.FLOAT_MAT2:return 2;case Fe.FLOAT_MAT3:return 3;case Fe.FLOAT_MAT4:return 4;default:return 1}}var ze=[Fe.NEVER,Fe.LESS,Fe.EQUAL,Fe.LEQUAL,Fe.GREATER,Fe.NOTEQUAL,Fe.GEQUAL,Fe.ALWAYS],Ke=[0,7680,7681,7682,7683,5386,34055,34056],Ye=[32774,32778,32779,32775,32776],je=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];function qe(e,t){var r=e.gl,n=e.stateCache,s=t.memUsage&A.HOST?Fe.DYNAMIC_DRAW:Fe.STATIC_DRAW;if(t.usage&h.VERTEX){t.glTarget=Fe.ARRAY_BUFFER;var i=r.createBuffer();i&&(t.glBuffer=i,t.size>0&&(e.extensions.useVAO&&n.glVAO&&(e.extensions.OES_vertex_array_object.bindVertexArrayOES(null),n.glVAO=null),it.gpuInputAssembler=null,n.glArrayBuffer!==t.glBuffer&&(r.bindBuffer(Fe.ARRAY_BUFFER,t.glBuffer),n.glArrayBuffer=t.glBuffer),r.bufferData(Fe.ARRAY_BUFFER,t.size,s),r.bindBuffer(Fe.ARRAY_BUFFER,null),n.glArrayBuffer=null))}else if(t.usage&h.INDEX){t.glTarget=Fe.ELEMENT_ARRAY_BUFFER;var u=r.createBuffer();u&&(t.glBuffer=u,t.size>0&&(e.extensions.useVAO&&n.glVAO&&(e.extensions.OES_vertex_array_object.bindVertexArrayOES(null),n.glVAO=null),it.gpuInputAssembler=null,n.glElementArrayBuffer!==t.glBuffer&&(r.bindBuffer(Fe.ELEMENT_ARRAY_BUFFER,t.glBuffer),n.glElementArrayBuffer=t.glBuffer),r.bufferData(Fe.ELEMENT_ARRAY_BUFFER,t.size,s),r.bindBuffer(Fe.ELEMENT_ARRAY_BUFFER,null),n.glElementArrayBuffer=null))}else t.usage&h.UNIFORM?(t.glTarget=Fe.NONE,t.buffer&&(t.vf32=new Float32Array(t.buffer.buffer))):(t.usage&h.INDIRECT||t.usage&h.TRANSFER_DST||t.usage&h.TRANSFER_SRC||a(16315),t.glTarget=Fe.NONE)}function Ze(e,t){var r=e.gl,a=e.stateCache;if(t.glBuffer){switch(t.glTarget){case Fe.ARRAY_BUFFER:e.extensions.useVAO&&a.glVAO&&(e.extensions.OES_vertex_array_object.bindVertexArrayOES(null),a.glVAO=null),it.gpuInputAssembler=null,r.bindBuffer(Fe.ARRAY_BUFFER,null),a.glArrayBuffer=null;break;case Fe.ELEMENT_ARRAY_BUFFER:e.extensions.useVAO&&a.glVAO&&(e.extensions.OES_vertex_array_object.bindVertexArrayOES(null),a.glVAO=null),it.gpuInputAssembler=null,r.bindBuffer(Fe.ELEMENT_ARRAY_BUFFER,null),a.glElementArrayBuffer=null}r.deleteBuffer(t.glBuffer),t.glBuffer=null}}function Qe(e,t,r,i,u){if(t.usage&h.UNIFORM)ArrayBuffer.isView(r)?t.vf32.set(r,i/Float32Array.BYTES_PER_ELEMENT):t.vf32.set(new Float32Array(r),i/Float32Array.BYTES_PER_ELEMENT);else if(t.usage&h.INDIRECT){t.indirects.clearDraws();for(var l=r.drawInfos,_=0;_<l.length;++_)t.indirects.setDrawInfo(i+_,l[_])}else{var f=r,c=e.gl,o=e.stateCache;switch(t.glTarget){case Fe.ARRAY_BUFFER:e.extensions.useVAO&&o.glVAO&&(e.extensions.OES_vertex_array_object.bindVertexArrayOES(null),o.glVAO=null),it.gpuInputAssembler=null,o.glArrayBuffer!==t.glBuffer&&(c.bindBuffer(Fe.ARRAY_BUFFER,t.glBuffer),o.glArrayBuffer=t.glBuffer);break;case Fe.ELEMENT_ARRAY_BUFFER:e.extensions.useVAO&&o.glVAO&&(e.extensions.OES_vertex_array_object.bindVertexArrayOES(null),o.glVAO=null),it.gpuInputAssembler=null,o.glElementArrayBuffer!==t.glBuffer&&(c.bindBuffer(Fe.ELEMENT_ARRAY_BUFFER,t.glBuffer),o.glElementArrayBuffer=t.glBuffer);break;default:return void a(16316)}n.os===s.IOS&&t.memUsage&A.HOST&&0===i&&u===f.byteLength?c.bufferData(t.glTarget,f,c.DYNAMIC_DRAW):u===f.byteLength?c.bufferSubData(t.glTarget,i,f):c.bufferSubData(t.glTarget,i,f.slice(0,u))}}function Je(e,t){var r=e.gl,n=e.stateCache;t.glFormat=t.glInternalFmt=we(t.format),t.glType=Ne(t.format);var s=t.width,i=t.height;switch(t.type){case p.TEX2D:t.glTarget=Fe.TEXTURE_2D;var u=De(s,i);if(u>e.capabilities.maxTextureSize&&a(9100,u,e.capabilities.maxTextureSize),e.textureExclusive[t.format]||e.extensions.WEBGL_depth_texture&&!Pe||!B[t.format].hasDepth){if(t.glTexture=r.createTexture(),t.size>0){var l=n.glTexUnits[n.texUnit];if(l.glTexture!==t.glTexture&&(r.bindTexture(Fe.TEXTURE_2D,t.glTexture),l.glTexture=t.glTexture),B[t.format].isCompressed)for(var _=0;_<t.mipLevel;++_){var f=d(t.format,s,i,1),c=new Uint8Array(f);r.compressedTexImage2D(Fe.TEXTURE_2D,_,t.glInternalFmt,s,i,0,c),s=De(1,s>>1),i=De(1,i>>1)}else for(var o=0;o<t.mipLevel;++o)r.texImage2D(Fe.TEXTURE_2D,o,t.glInternalFmt,s,i,0,t.glFormat,t.glType,null),s=De(1,s>>1),i=De(1,i>>1);t.isPowerOf2?(t.glWrapS=Fe.REPEAT,t.glWrapT=Fe.REPEAT):(t.glWrapS=Fe.CLAMP_TO_EDGE,t.glWrapT=Fe.CLAMP_TO_EDGE),t.glMinFilter=Fe.LINEAR,t.glMagFilter=Fe.LINEAR,r.texParameteri(t.glTarget,Fe.TEXTURE_WRAP_S,t.glWrapS),r.texParameteri(t.glTarget,Fe.TEXTURE_WRAP_T,t.glWrapT),r.texParameteri(t.glTarget,Fe.TEXTURE_MIN_FILTER,t.glMinFilter),r.texParameteri(t.glTarget,Fe.TEXTURE_MAG_FILTER,t.glMagFilter)}}else t.glInternalFmt=Ue(t.format),t.glRenderbuffer=r.createRenderbuffer(),t.size>0&&(n.glRenderbuffer!==t.glRenderbuffer&&(r.bindRenderbuffer(Fe.RENDERBUFFER,t.glRenderbuffer),n.glRenderbuffer=t.glRenderbuffer),r.renderbufferStorage(Fe.RENDERBUFFER,t.glInternalFmt,s,i));break;case p.CUBE:t.glTarget=Fe.TEXTURE_CUBE_MAP;var E=De(s,i);if(E>e.capabilities.maxCubeMapTextureSize&&a(9100,E,e.capabilities.maxTextureSize),t.glTexture=r.createTexture(),t.size>0){var g=n.glTexUnits[n.texUnit];if(g.glTexture!==t.glTexture&&(r.bindTexture(Fe.TEXTURE_CUBE_MAP,t.glTexture),g.glTexture=t.glTexture),B[t.format].isCompressed)for(var T=0;T<6;++T){s=t.width,i=t.height;for(var S=0;S<t.mipLevel;++S){var R=d(t.format,s,i,1),A=new Uint8Array(R);r.compressedTexImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+T,S,t.glInternalFmt,s,i,0,A),s=De(1,s>>1),i=De(1,i>>1)}}else for(var h=0;h<6;++h){s=t.width,i=t.height;for(var C=0;C<t.mipLevel;++C)r.texImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+h,C,t.glInternalFmt,s,i,0,t.glFormat,t.glType,null),s=De(1,s>>1),i=De(1,i>>1)}t.isPowerOf2?(t.glWrapS=Fe.REPEAT,t.glWrapT=Fe.REPEAT):(t.glWrapS=Fe.CLAMP_TO_EDGE,t.glWrapT=Fe.CLAMP_TO_EDGE),t.glMinFilter=Fe.LINEAR,t.glMagFilter=Fe.LINEAR,r.texParameteri(t.glTarget,Fe.TEXTURE_WRAP_S,t.glWrapS),r.texParameteri(t.glTarget,Fe.TEXTURE_WRAP_T,t.glWrapT),r.texParameteri(t.glTarget,Fe.TEXTURE_MIN_FILTER,t.glMinFilter),r.texParameteri(t.glTarget,Fe.TEXTURE_MAG_FILTER,t.glMagFilter)}break;default:a(16317),t.type=p.TEX2D,t.glTarget=Fe.TEXTURE_2D}}function $e(e,t){var r=e.gl,a=e.stateCache;if(t.glTexture){var n=a.glTexUnits,s=a.texUnit;r.deleteTexture(t.glTexture);for(var i=0;i<n.length;i++)n[i].glTexture===t.glTexture&&(r.activeTexture(Fe.TEXTURE0+i),s=i,r.bindTexture(t.glTarget,null),n[i].glTexture=null);a.texUnit=s,t.glTexture=null}if(t.glRenderbuffer){var u=a.glRenderbuffer;r.deleteRenderbuffer(t.glRenderbuffer),u===t.glRenderbuffer&&(r.bindRenderbuffer(Fe.RENDERBUFFER,null),a.glRenderbuffer=null),t.glRenderbuffer=null}}function et(e,t){if(t.size){var r=e.gl,n=e.stateCache,s=t.width,i=t.height;switch(t.type){case p.TEX2D:t.glTarget=Fe.TEXTURE_2D;var u=De(s,i);if(u>e.capabilities.maxTextureSize&&a(9100,u,e.capabilities.maxTextureSize),t.glRenderbuffer)n.glRenderbuffer!==t.glRenderbuffer&&(r.bindRenderbuffer(Fe.RENDERBUFFER,t.glRenderbuffer),n.glRenderbuffer=t.glRenderbuffer),r.renderbufferStorage(Fe.RENDERBUFFER,t.glInternalFmt,s,i);else if(t.glTexture){var l=n.glTexUnits[n.texUnit];if(l.glTexture!==t.glTexture&&(r.bindTexture(Fe.TEXTURE_2D,t.glTexture),l.glTexture=t.glTexture),B[t.format].isCompressed)for(var _=0;_<t.mipLevel;++_){var f=d(t.format,s,i,1),c=new Uint8Array(f);r.compressedTexImage2D(Fe.TEXTURE_2D,_,t.glInternalFmt,s,i,0,c),s=De(1,s>>1),i=De(1,i>>1)}else for(var o=0;o<t.mipLevel;++o)r.texImage2D(Fe.TEXTURE_2D,o,t.glInternalFmt,s,i,0,t.glFormat,t.glType,null),s=De(1,s>>1),i=De(1,i>>1)}break;case p.CUBE:t.glTarget=Fe.TEXTURE_CUBE_MAP;var E=De(s,i);E>e.capabilities.maxCubeMapTextureSize&&a(9100,E,e.capabilities.maxTextureSize);var g=n.glTexUnits[n.texUnit];if(g.glTexture!==t.glTexture&&(r.bindTexture(Fe.TEXTURE_CUBE_MAP,t.glTexture),g.glTexture=t.glTexture),B[t.format].isCompressed)for(var T=0;T<6;++T){s=t.width,i=t.height;for(var S=0;S<t.mipLevel;++S){var R=d(t.format,s,i,1),A=new Uint8Array(R);r.compressedTexImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+T,S,t.glInternalFmt,s,i,0,A),s=De(1,s>>1),i=De(1,i>>1)}}else for(var h=0;h<6;++h){s=t.width,i=t.height;for(var C=0;C<t.mipLevel;++C)r.texImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+h,C,t.glInternalFmt,s,i,0,t.glFormat,t.glType,null),s=De(1,s>>1),i=De(1,i>>1)}break;default:a(16317),t.type=p.TEX2D,t.glTarget=Fe.TEXTURE_2D}}}function tt(e,t){for(var r=0;r<t.gpuColorTextures.length;++r)if(t.gpuColorTextures[r].isSwapchainTexture)return void(t.isOffscreen=!1);var n=e.gl,s=e.stateCache,i=[],u=n.createFramebuffer();if(u){t.glFramebuffer=u,s.glFramebuffer!==t.glFramebuffer&&n.bindFramebuffer(Fe.FRAMEBUFFER,t.glFramebuffer);for(var l=0;l<t.gpuColorTextures.length;++l){var _=t.gpuColorTextures[l];_&&(_.glTexture?n.framebufferTexture2D(Fe.FRAMEBUFFER,Fe.COLOR_ATTACHMENT0+l,_.glTarget,_.glTexture,0):n.framebufferRenderbuffer(Fe.FRAMEBUFFER,Fe.COLOR_ATTACHMENT0+l,Fe.RENDERBUFFER,_.glRenderbuffer),i.push(Fe.COLOR_ATTACHMENT0+l),t.width=ye(t.width,_.width),t.height=ye(t.height,_.height))}var f=t.gpuDepthStencilTexture;if(f){var c=B[f.format].hasStencil?Fe.DEPTH_STENCIL_ATTACHMENT:Fe.DEPTH_ATTACHMENT;f.glTexture?n.framebufferTexture2D(Fe.FRAMEBUFFER,c,f.glTarget,f.glTexture,0):n.framebufferRenderbuffer(Fe.FRAMEBUFFER,c,Fe.RENDERBUFFER,f.glRenderbuffer),t.width=ye(t.width,f.width),t.height=ye(t.height,f.height)}e.extensions.WEBGL_draw_buffers&&e.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(i);var o=n.checkFramebufferStatus(Fe.FRAMEBUFFER);if(o!==Fe.FRAMEBUFFER_COMPLETE)switch(o){case Fe.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:a(16318);break;case Fe.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:a(16319);break;case Fe.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:a(16320);break;case Fe.FRAMEBUFFER_UNSUPPORTED:a(16321)}s.glFramebuffer!==t.glFramebuffer&&n.bindFramebuffer(Fe.FRAMEBUFFER,s.glFramebuffer)}}function rt(e,t){for(var r,n=e.gl,s=e.stateCache,i=function(){var e=t.gpuStages[_],r=0,s="",i=1;switch(e.type){case N.VERTEX:s="VertexShader",r=Fe.VERTEX_SHADER;break;case N.FRAGMENT:s="FragmentShader",r=Fe.FRAGMENT_SHADER;break;default:return a(16322),{v:void 0}}var u=n.createShader(r);if(u&&(e.glShader=u,n.shaderSource(e.glShader,e.source),n.compileShader(e.glShader),!n.getShaderParameter(e.glShader,Fe.COMPILE_STATUS))){a(16323,s,t.name),a(16324,e.source.replace(/^|\n/g,(function(){return"\n"+i+++" "}))),l(n.getShaderInfoLog(e.glShader));for(var f=0;f<t.gpuStages.length;f++){var c=t.gpuStages[_];c.glShader&&(n.deleteShader(c.glShader),c.glShader=null)}return{v:void 0}}},_=0;_<t.gpuStages.length;_++)if(r=i())return r.v;var f=n.createProgram();if(f){t.glProgram=f;for(var c=0;c<t.gpuStages.length;c++){var o=t.gpuStages[c];n.attachShader(t.glProgram,o.glShader)}if(n.linkProgram(t.glProgram),e.extensions.destroyShadersImmediately)for(var E=0;E<t.gpuStages.length;E++){var g=t.gpuStages[E];g.glShader&&(n.detachShader(t.glProgram,g.glShader),n.deleteShader(g.glShader),g.glShader=null)}if(!n.getProgramParameter(t.glProgram,Fe.LINK_STATUS))return a(16326,t.name),void l(n.getProgramInfoLog(t.glProgram));u(16325,t.name);var T=n.getProgramParameter(t.glProgram,Fe.ACTIVE_ATTRIBUTES);t.glInputs=new Array(T);for(var S=0;S<T;++S){var R=n.getActiveAttrib(t.glProgram,S);if(R){var A,h=R.type,p=R.name,B=R.size,d=p.indexOf("[");A=-1!==d?p.substring(0,d):p;var C=n.getAttribLocation(t.glProgram,A),x=ke(h),m=Ve(h);t.glInputs[S]={binding:C,name:A,type:x,stride:m,count:B,size:m*B,glType:h,glLoc:C}}}if(t.blocks.length>0){t.glBlocks=new Array(t.blocks.length);for(var b=0;b<t.blocks.length;++b){var P=t.blocks[b],v={set:P.set,binding:P.binding,name:P.name,size:0,glUniforms:new Array(P.members.length),glActiveUniforms:[]};t.glBlocks[b]=v;for(var G=0;G<P.members.length;++G){var O=P.members[G],F=He(O.type),M=Ve(F),D=M*O.count;v.glUniforms[G]={binding:-1,name:O.name,type:O.type,stride:M,count:O.count,size:D,offset:0,glType:F,glLoc:null,array:null}}}}for(var y=0;y<t.subpassInputs.length;++y){var U=t.subpassInputs[y];t.samplerTextures.push(new L(U.set,U.binding,U.name,I.SAMPLER2D,U.count))}if(t.samplerTextures.length>0){t.glSamplerTextures=new Array(t.samplerTextures.length);for(var w=0;w<t.samplerTextures.length;++w){var H=t.samplerTextures[w];t.glSamplerTextures[w]={set:H.set,binding:H.binding,name:H.name,type:H.type,count:H.count,units:[],glUnits:null,glType:He(H.type),glLoc:null}}}for(var X=n.getProgramParameter(t.glProgram,Fe.ACTIVE_UNIFORMS),k=0;k<X;++k){var V=n.getActiveUniform(t.glProgram,k);if(V&&V.type!==Fe.SAMPLER_2D&&V.type!==Fe.SAMPLER_CUBE){var W=n.getUniformLocation(t.glProgram,V.name);if(e.extensions.isLocationActive(W)){var z,K=V.name.indexOf("[");z=-1!==K?V.name.substring(0,K):V.name;for(var Y=0;Y<t.glBlocks.length;Y++)for(var j=t.glBlocks[Y],q=0;q<j.glUniforms.length;q++){var Z=j.glUniforms[q];if(Z.name===z){Z.glLoc=W,Z.count=V.size,Z.size=Z.stride*Z.count,Z.array=new(Xe(Z.type))(Z.size/4),j.glActiveUniforms.push(Z);break}}}}}for(var Q=0;Q<t.glBlocks.length;Q++)for(var J=t.glBlocks[Q],$=0;$<J.glUniforms.length;$++){var ee=J.glUniforms[$];ee.offset=J.size/4,J.size+=ee.size}var te=[],re=[],ae=e.bindingMappings,ne=e.capabilities,se=e.stateCache.texUnitCacheMap,ie=ne.maxTextureUnits;if(ve.rendering&&ve.rendering.enableEffectImport)for(var ue=0;ue<t.samplerTextures.length;++ue){var le=t.samplerTextures[ue],_e=n.getUniformLocation(t.glProgram,le.name);e.extensions.isLocationActive(_e)&&(te.push(t.glSamplerTextures[ue]),re.push(_e)),void 0===se[le.name]&&(se[le.name]=le.flattened%ie)}else{for(var fe=0,ce=0;ce<t.blocks.length;++ce)t.blocks[ce].set===ae.flexibleSet&&fe++;for(var oe=0,Ee=0;Ee<t.samplerTextures.length;++Ee){var ge=t.samplerTextures[Ee],Te=n.getUniformLocation(t.glProgram,ge.name);if(e.extensions.isLocationActive(Te)&&(te.push(t.glSamplerTextures[Ee]),re.push(Te)),void 0===se[ge.name]){var Se=ge.binding+ae.samplerTextureOffsets[ge.set]+oe;ge.set===ae.flexibleSet&&(Se-=fe),se[ge.name]=Se%ie,oe+=ge.count-1}}}if(te.length){for(var Re=[],Ae=0;Ae<te.length;++Ae){var he=te[Ae],pe=se[he.name];if(void 0!==pe){he.glLoc=re[Ae];for(var Be=0;Be<he.count;++Be){for(;Re[pe];)pe=(pe+1)%ie;he.units.push(pe),Re[pe]=!0}}}for(var de=0,Ce=0;Ce<te.length;++Ce){var xe=te[Ce];if(!e.extensions.isLocationActive(xe.glLoc)){xe.glLoc=re[Ce];for(var me=0;me<xe.count;++me){for(;Re[de];)de=(de+1)%ie;void 0===se[xe.name]&&(se[xe.name]=de),xe.units.push(de),Re[de]=!0}}}s.glProgram!==t.glProgram&&n.useProgram(t.glProgram);for(var be=0;be<te.length;be++){var Pe=te[be];Pe.glUnits=new Int32Array(Pe.units),n.uniform1iv(Pe.glLoc,Pe.glUnits)}s.glProgram!==t.glProgram&&n.useProgram(s.glProgram)}for(var Ge=0;Ge<t.glBlocks.length;)t.glBlocks[Ge].glActiveUniforms.length?Ge++:(t.glBlocks[Ge]=t.glBlocks[t.glBlocks.length-1],t.glBlocks.length--);t.glSamplerTextures=te}}function at(e,t){if(t.glProgram){var r=e.gl,a=e.stateCache;if(!e.extensions.destroyShadersImmediately)for(var n=0;n<t.gpuStages.length;n++){var s=t.gpuStages[n];s.glShader&&(r.detachShader(t.glProgram,s.glShader),r.deleteShader(s.glShader),s.glShader=null)}r.deleteProgram(t.glProgram),a.glProgram===t.glProgram&&(r.useProgram(null),a.glProgram=null),t.glProgram=null}}function nt(e,t){e.gl,t.glAttribs=new Array(t.attributes.length);for(var r=[0,0,0,0,0,0,0,0],a=0;a<t.attributes.length;++a){var n=t.attributes[a],s=n.format,i=n.isNormalized,u=n.isInstanced,l=void 0!==n.stream?n.stream:0,_=t.gpuVertexBuffers[l],f=Ne(s),c=B[s].size;t.glAttribs[a]={name:n.name,glBuffer:_.glBuffer,glType:f,size:c,count:B[s].count,stride:_.stride,componentCount:We(f),isNormalized:void 0!==i&&i,isInstanced:void 0!==u&&u,offset:r[l]},r[l]+=c}}function st(e,t){for(var r=e.stateCache,a=t.glVAOs.values(),n=a.next(),s=e.extensions.OES_vertex_array_object,i=r.glVAO;!n.done;)s.deleteVertexArrayOES(n.value),i===n.value&&(s.bindVertexArrayOES(null),i=null),n=a.next();r.glVAO=i,t.glVAOs.clear()}var it={gpuPipelineState:null,gpuInputAssembler:null,glPrimitive:0},ut=new M;function lt(e,t,r,a,n,s,i){var u=e.gl,l=e.stateCache,_=0;if(r){var f=r.lodLevel;ut.x=a.x<<f,ut.y=a.y<<f,ut.width=a.width<<f,ut.height=a.height<<f}if(r&&t){var c=r.glFramebuffer,o=ut.x,E=ut.y,g=ut.width,T=ut.height;l.glFramebuffer!==c&&(u.bindFramebuffer(Fe.FRAMEBUFFER,c),l.glFramebuffer=c);var S=l.viewport;S.left===o&&S.top===E&&S.width===g&&S.height===T||(u.viewport(o,E,g,T),S.left=o,S.top=E,S.width=g,S.height=T);var R=l.scissorRect;R.x===o&&R.y===E&&R.width===g&&R.height===T||(u.scissor(o,E,g,T),R.x=o,R.y=E,R.width=g,R.height=T);var A=n.length;e.extensions.WEBGL_draw_buffers||(A=1);for(var h=l.dss,p=0;p<A;++p){var d=t.colorAttachments[p];if(d.format!==C.UNKNOWN)switch(d.loadOp){case x.LOAD:break;case x.CLEAR:l.bs.targets[0].blendColorMask!==m.ALL&&u.colorMask(!0,!0,!0,!0);var b=n[0];u.clearColor(b.x,b.y,b.z,b.w),_|=Fe.COLOR_BUFFER_BIT;case x.DISCARD:}}if(t.depthStencilAttachment&&t.depthStencilAttachment.format!==C.UNKNOWN){switch(t.depthStencilAttachment.depthLoadOp){case x.LOAD:break;case x.CLEAR:h.depthWrite||u.depthMask(!0),u.clearDepth(s),_|=Fe.DEPTH_BUFFER_BIT;case x.DISCARD:}if(B[t.depthStencilAttachment.format].hasStencil)switch(t.depthStencilAttachment.stencilLoadOp){case x.LOAD:break;case x.CLEAR:h.stencilWriteMaskFront||u.stencilMaskSeparate(Fe.FRONT,65535),h.stencilWriteMaskBack||u.stencilMaskSeparate(Fe.BACK,65535),u.clearStencil(i),_|=Fe.STENCIL_BUFFER_BIT;case x.DISCARD:}}if(_&&u.clear(_),_&Fe.COLOR_BUFFER_BIT){var P=l.bs.targets[0].blendColorMask;if(P!==m.ALL){var v=(P&m.R)!==m.NONE,G=(P&m.G)!==m.NONE,O=(P&m.B)!==m.NONE,F=(P&m.A)!==m.NONE;u.colorMask(v,G,O,F)}}_&Fe.DEPTH_BUFFER_BIT&&!h.depthWrite&&u.depthMask(!1),_&Fe.STENCIL_BUFFER_BIT&&(h.stencilWriteMaskFront||u.stencilMaskSeparate(Fe.FRONT,0),h.stencilWriteMaskBack||u.stencilMaskSeparate(Fe.BACK,0))}}function _t(e,t,r,a,n,s){var i,u,l,_=e.gl,f=e.stateCache,c=f.dss,o=f.bs,E=t&&t.gpuShader,g=!1;if(t&&it.gpuPipelineState!==t){if(it.gpuPipelineState=t,it.glPrimitive=t.glPrimitive,t.gpuShader){var T=t.gpuShader.glProgram;f.glProgram!==T&&(_.useProgram(T),f.glProgram=T,g=!0)}var S=t.rs,R=f.rs;if(S){if(R.cullMode!==S.cullMode){switch(S.cullMode){case b.NONE:_.disable(Fe.CULL_FACE);break;case b.FRONT:_.enable(Fe.CULL_FACE),_.cullFace(Fe.FRONT);break;case b.BACK:_.enable(Fe.CULL_FACE),_.cullFace(Fe.BACK)}R.cullMode=S.cullMode}var A=S.isFrontFaceCCW;R.isFrontFaceCCW!==A&&(_.frontFace(A?Fe.CCW:Fe.CW),R.isFrontFaceCCW=A),R.depthBias===S.depthBias&&R.depthBiasSlop===S.depthBiasSlop||(_.polygonOffset(S.depthBias,S.depthBiasSlop),R.depthBias=S.depthBias,R.depthBiasSlop=S.depthBiasSlop),R.lineWidth!==S.lineWidth&&(_.lineWidth(S.lineWidth),R.lineWidth=S.lineWidth)}var h=t.dss;h&&(c.depthTest!==h.depthTest&&(h.depthTest?_.enable(Fe.DEPTH_TEST):_.disable(Fe.DEPTH_TEST),c.depthTest=h.depthTest),c.depthWrite!==h.depthWrite&&(_.depthMask(h.depthWrite),c.depthWrite=h.depthWrite),c.depthFunc!==h.depthFunc&&(_.depthFunc(ze[h.depthFunc]),c.depthFunc=h.depthFunc),c.stencilTestFront===h.stencilTestFront&&c.stencilTestBack===h.stencilTestBack||(h.stencilTestFront||h.stencilTestBack?_.enable(Fe.STENCIL_TEST):_.disable(Fe.STENCIL_TEST),c.stencilTestFront=h.stencilTestFront,c.stencilTestBack=h.stencilTestBack),c.stencilFuncFront===h.stencilFuncFront&&c.stencilRefFront===h.stencilRefFront&&c.stencilReadMaskFront===h.stencilReadMaskFront||(_.stencilFuncSeparate(Fe.FRONT,ze[h.stencilFuncFront],h.stencilRefFront,h.stencilReadMaskFront),c.stencilFuncFront=h.stencilFuncFront,c.stencilRefFront=h.stencilRefFront,c.stencilReadMaskFront=h.stencilReadMaskFront),c.stencilFailOpFront===h.stencilFailOpFront&&c.stencilZFailOpFront===h.stencilZFailOpFront&&c.stencilPassOpFront===h.stencilPassOpFront||(_.stencilOpSeparate(Fe.FRONT,Ke[h.stencilFailOpFront],Ke[h.stencilZFailOpFront],Ke[h.stencilPassOpFront]),c.stencilFailOpFront=h.stencilFailOpFront,c.stencilZFailOpFront=h.stencilZFailOpFront,c.stencilPassOpFront=h.stencilPassOpFront),c.stencilWriteMaskFront!==h.stencilWriteMaskFront&&(_.stencilMaskSeparate(Fe.FRONT,h.stencilWriteMaskFront),c.stencilWriteMaskFront=h.stencilWriteMaskFront),c.stencilFuncBack===h.stencilFuncBack&&c.stencilRefBack===h.stencilRefBack&&c.stencilReadMaskBack===h.stencilReadMaskBack||(_.stencilFuncSeparate(Fe.BACK,ze[h.stencilFuncBack],h.stencilRefBack,h.stencilReadMaskBack),c.stencilFuncBack=h.stencilFuncBack,c.stencilRefBack=h.stencilRefBack,c.stencilReadMaskBack=h.stencilReadMaskBack),c.stencilFailOpBack===h.stencilFailOpBack&&c.stencilZFailOpBack===h.stencilZFailOpBack&&c.stencilPassOpBack===h.stencilPassOpBack||(_.stencilOpSeparate(Fe.BACK,Ke[h.stencilFailOpBack],Ke[h.stencilZFailOpBack],Ke[h.stencilPassOpBack]),c.stencilFailOpBack=h.stencilFailOpBack,c.stencilZFailOpBack=h.stencilZFailOpBack,c.stencilPassOpBack=h.stencilPassOpBack),c.stencilWriteMaskBack!==h.stencilWriteMaskBack&&(_.stencilMaskSeparate(Fe.BACK,h.stencilWriteMaskBack),c.stencilWriteMaskBack=h.stencilWriteMaskBack));var p=t.bs;if(p){o.isA2C!==p.isA2C&&(p.isA2C?_.enable(Fe.SAMPLE_ALPHA_TO_COVERAGE):_.disable(Fe.SAMPLE_ALPHA_TO_COVERAGE),o.isA2C=p.isA2C),o.blendColor.x===p.blendColor.x&&o.blendColor.y===p.blendColor.y&&o.blendColor.z===p.blendColor.z&&o.blendColor.w===p.blendColor.w||(_.blendColor(p.blendColor.x,p.blendColor.y,p.blendColor.z,p.blendColor.w),o.blendColor.x=p.blendColor.x,o.blendColor.y=p.blendColor.y,o.blendColor.z=p.blendColor.z,o.blendColor.w=p.blendColor.w);var B=p.targets[0],d=o.targets[0];d.blend!==B.blend&&(B.blend?_.enable(Fe.BLEND):_.disable(Fe.BLEND),d.blend=B.blend),d.blendEq===B.blendEq&&d.blendAlphaEq===B.blendAlphaEq||(_.blendEquationSeparate(Ye[B.blendEq],Ye[B.blendAlphaEq]),d.blendEq=B.blendEq,d.blendAlphaEq=B.blendAlphaEq),d.blendSrc===B.blendSrc&&d.blendDst===B.blendDst&&d.blendSrcAlpha===B.blendSrcAlpha&&d.blendDstAlpha===B.blendDstAlpha||(_.blendFuncSeparate(je[B.blendSrc],je[B.blendDst],je[B.blendSrcAlpha],je[B.blendDstAlpha]),d.blendSrc=B.blendSrc,d.blendDst=B.blendDst,d.blendSrcAlpha=B.blendSrcAlpha,d.blendDstAlpha=B.blendDstAlpha),d.blendColorMask!==B.blendColorMask&&(_.colorMask((B.blendColorMask&m.R)!==m.NONE,(B.blendColorMask&m.G)!==m.NONE,(B.blendColorMask&m.B)!==m.NONE,(B.blendColorMask&m.A)!==m.NONE),d.blendColorMask=B.blendColorMask)}}if(t&&t.gpuPipelineLayout&&E){for(var C=E.glBlocks.length,x=t.gpuPipelineLayout.dynamicOffsetIndices,v=0;v<C;v++){var G=E.glBlocks[v],O=a[G.set],F=O&&O.descriptorIndices[G.binding],L=F>=0&&O.gpuDescriptors[F],I=null,M=0;if(L&&L.gpuBuffer){var D=L.gpuBuffer,y=x[G.set],N=y&&y[G.binding];N>=0&&(M=n[N]),"vf32"in D?I=D.vf32:(M+=D.offset,I=D.gpuBuffer.vf32),M>>=2}if(I)for(var U=G.glActiveUniforms.length,w=0;w<U;w++){var H=G.glActiveUniforms[w];switch(H.glType){case Fe.BOOL:case Fe.INT:for(var X=0;X<H.array.length;++X){var k=H.offset+M+X;if(I[k]!==H.array[X]){for(var V=X,W=k;V<H.array.length;++V,++W)H.array[V]=I[W];_.uniform1iv(H.glLoc,H.array);break}}break;case Fe.BOOL_VEC2:case Fe.INT_VEC2:for(var z=0;z<H.array.length;++z){var K=H.offset+M+z;if(I[K]!==H.array[z]){for(var Y=z,j=K;Y<H.array.length;++Y,++j)H.array[Y]=I[j];_.uniform2iv(H.glLoc,H.array);break}}break;case Fe.BOOL_VEC3:case Fe.INT_VEC3:for(var q=0;q<H.array.length;++q){var Z=H.offset+M+q;if(I[Z]!==H.array[q]){for(var Q=q,J=Z;Q<H.array.length;++Q,++J)H.array[Q]=I[J];_.uniform3iv(H.glLoc,H.array);break}}break;case Fe.BOOL_VEC4:case Fe.INT_VEC4:for(var $=0;$<H.array.length;++$){var ee=H.offset+M+$;if(I[ee]!==H.array[$]){for(var te=$,re=ee;te<H.array.length;++te,++re)H.array[te]=I[re];_.uniform4iv(H.glLoc,H.array);break}}break;case Fe.FLOAT:for(var ae=0;ae<H.array.length;++ae){var ne=H.offset+M+ae;if(I[ne]!==H.array[ae]){for(var se=ae,ie=ne;se<H.array.length;++se,++ie)H.array[se]=I[ie];_.uniform1fv(H.glLoc,H.array);break}}break;case Fe.FLOAT_VEC2:for(var ue=0;ue<H.array.length;++ue){var le=H.offset+M+ue;if(I[le]!==H.array[ue]){for(var _e=ue,fe=le;_e<H.array.length;++_e,++fe)H.array[_e]=I[fe];_.uniform2fv(H.glLoc,H.array);break}}break;case Fe.FLOAT_VEC3:for(var ce=0;ce<H.array.length;++ce){var oe=H.offset+M+ce;if(I[oe]!==H.array[ce]){for(var Ee=ce,ge=oe;Ee<H.array.length;++Ee,++ge)H.array[Ee]=I[ge];_.uniform3fv(H.glLoc,H.array);break}}break;case Fe.FLOAT_VEC4:for(var Te=0;Te<H.array.length;++Te){var Se=H.offset+M+Te;if(I[Se]!==H.array[Te]){for(var Re=Te,Ae=Se;Re<H.array.length;++Re,++Ae)H.array[Re]=I[Ae];_.uniform4fv(H.glLoc,H.array);break}}break;case Fe.FLOAT_MAT2:for(var he=0;he<H.array.length;++he){var pe=H.offset+M+he;if(I[pe]!==H.array[he]){for(var Be=he,de=pe;Be<H.array.length;++Be,++de)H.array[Be]=I[de];_.uniformMatrix2fv(H.glLoc,!1,H.array);break}}break;case Fe.FLOAT_MAT3:for(var Ce=0;Ce<H.array.length;++Ce){var xe=H.offset+M+Ce;if(I[xe]!==H.array[Ce]){for(var me=Ce,be=xe;me<H.array.length;++me,++be)H.array[me]=I[be];_.uniformMatrix3fv(H.glLoc,!1,H.array);break}}break;case Fe.FLOAT_MAT4:for(var Pe=0;Pe<H.array.length;++Pe){var ve=H.offset+M+Pe;if(I[ve]!==H.array[Pe]){for(var Ge=Pe,Oe=ve;Ge<H.array.length;++Ge,++Oe)H.array[Ge]=I[Oe];_.uniformMatrix4fv(H.glLoc,!1,H.array);break}}}}}for(var Le=E.glSamplerTextures.length,Ie=0;Ie<Le;Ie++)for(var Me=E.glSamplerTextures[Ie],De=a[Me.set],ye=De&&De.descriptorIndices[Me.binding],Ne=ye>=0&&De.gpuDescriptors[ye],Ue=Me.units.length,we=0;we<Ue;we++){var He=Me.units[we];if(Ne&&Ne.gpuSampler){if(Ne.gpuTexture&&Ne.gpuTexture.size>0){var Xe=Ne.gpuTexture,ke=f.glTexUnits[He];ke.glTexture!==Xe.glTexture&&(f.texUnit!==He&&(_.activeTexture(Fe.TEXTURE0+He),f.texUnit=He),Xe.glTexture?_.bindTexture(Xe.glTarget,Xe.glTexture):_.bindTexture(Xe.glTarget,e.nullTex2D.gpuTexture.glTexture),ke.glTexture=Xe.glTexture);var Ve=Ne.gpuSampler;Xe.isPowerOf2?(i=Ve.glWrapS,u=Ve.glWrapT):(i=Fe.CLAMP_TO_EDGE,u=Fe.CLAMP_TO_EDGE),l=Xe.isPowerOf2?Xe.mipLevel<=1&&(Ve.glMinFilter===Fe.LINEAR_MIPMAP_NEAREST||Ve.glMinFilter===Fe.LINEAR_MIPMAP_LINEAR)?Fe.LINEAR:Ve.glMinFilter:Ve.glMinFilter===Fe.LINEAR||Ve.glMinFilter===Fe.LINEAR_MIPMAP_NEAREST||Ve.glMinFilter===Fe.LINEAR_MIPMAP_LINEAR?Fe.LINEAR:Fe.NEAREST,Xe.glWrapS!==i&&(f.texUnit!==He&&(_.activeTexture(Fe.TEXTURE0+He),f.texUnit=He),_.texParameteri(Xe.glTarget,Fe.TEXTURE_WRAP_S,i),Xe.glWrapS=i),Xe.glWrapT!==u&&(f.texUnit!==He&&(_.activeTexture(Fe.TEXTURE0+He),f.texUnit=He),_.texParameteri(Xe.glTarget,Fe.TEXTURE_WRAP_T,u),Xe.glWrapT=u),Xe.glMinFilter!==l&&(f.texUnit!==He&&(_.activeTexture(Fe.TEXTURE0+He),f.texUnit=He),_.texParameteri(Xe.glTarget,Fe.TEXTURE_MIN_FILTER,l),Xe.glMinFilter=l),Xe.glMagFilter!==Ve.glMagFilter&&(f.texUnit!==He&&(_.activeTexture(Fe.TEXTURE0+He),f.texUnit=He),_.texParameteri(Xe.glTarget,Fe.TEXTURE_MAG_FILTER,Ve.glMagFilter),Xe.glMagFilter=Ve.glMagFilter)}Ne=De.gpuDescriptors[++ye]}}}if(r&&E&&(g||it.gpuInputAssembler!==r)){it.gpuInputAssembler=r;var We=e.extensions.ANGLE_instanced_arrays;if(e.extensions.useVAO){var qe=e.extensions.OES_vertex_array_object,Ze=r.glVAOs.get(E.glProgram);if(!Ze){var Qe;Ze=qe.createVertexArrayOES(),r.glVAOs.set(E.glProgram,Ze),qe.bindVertexArrayOES(Ze),_.bindBuffer(Fe.ARRAY_BUFFER,null),_.bindBuffer(Fe.ELEMENT_ARRAY_BUFFER,null),f.glArrayBuffer=null,f.glElementArrayBuffer=null;for(var Je=E.glInputs.length,$e=0;$e<Je;$e++){var et=E.glInputs[$e];Qe=null;for(var tt=r.glAttribs.length,rt=0;rt<tt;rt++){var at=r.glAttribs[rt];if(at.name===et.name){Qe=at;break}}if(Qe){f.glArrayBuffer!==Qe.glBuffer&&(_.bindBuffer(Fe.ARRAY_BUFFER,Qe.glBuffer),f.glArrayBuffer=Qe.glBuffer);for(var nt=0;nt<Qe.componentCount;++nt){var st=et.glLoc+nt,ut=Qe.offset+Qe.size*nt;_.enableVertexAttribArray(st),f.glCurrentAttribLocs[st]=!0,_.vertexAttribPointer(st,Qe.count,Qe.glType,Qe.isNormalized,Qe.stride,ut),We&&We.vertexAttribDivisorANGLE(st,Qe.isInstanced?1:0)}}}var lt=r.gpuIndexBuffer;lt&&_.bindBuffer(Fe.ELEMENT_ARRAY_BUFFER,lt.glBuffer),qe.bindVertexArrayOES(null),_.bindBuffer(Fe.ARRAY_BUFFER,null),_.bindBuffer(Fe.ELEMENT_ARRAY_BUFFER,null),f.glArrayBuffer=null,f.glElementArrayBuffer=null}f.glVAO!==Ze&&(qe.bindVertexArrayOES(Ze),f.glVAO=Ze)}else{for(var _t=0;_t<e.capabilities.maxVertexAttributes;++_t)f.glCurrentAttribLocs[_t]=!1;for(var ft=E.glInputs.length,ct=0;ct<ft;ct++){for(var ot=E.glInputs[ct],Et=null,gt=r.glAttribs.length,Tt=0;Tt<gt;Tt++){var St=r.glAttribs[Tt];if(St.name===ot.name){Et=St;break}}if(Et){f.glArrayBuffer!==Et.glBuffer&&(_.bindBuffer(Fe.ARRAY_BUFFER,Et.glBuffer),f.glArrayBuffer=Et.glBuffer);for(var Rt=0;Rt<Et.componentCount;++Rt){var At=ot.glLoc+Rt,ht=Et.offset+Et.size*Rt;!f.glEnabledAttribLocs[At]&&At>=0&&(_.enableVertexAttribArray(At),f.glEnabledAttribLocs[At]=!0),f.glCurrentAttribLocs[At]=!0,_.vertexAttribPointer(At,Et.count,Et.glType,Et.isNormalized,Et.stride,ht),We&&We.vertexAttribDivisorANGLE(At,Et.isInstanced?1:0)}}}var pt=r.gpuIndexBuffer;pt&&f.glElementArrayBuffer!==pt.glBuffer&&(_.bindBuffer(Fe.ELEMENT_ARRAY_BUFFER,pt.glBuffer),f.glElementArrayBuffer=pt.glBuffer);for(var Bt=0;Bt<e.capabilities.maxVertexAttributes;++Bt)f.glEnabledAttribLocs[Bt]!==f.glCurrentAttribLocs[Bt]&&(_.disableVertexAttribArray(Bt),f.glEnabledAttribLocs[Bt]=!1)}}if(t&&t.dynamicStates.length)for(var dt=t.dynamicStates.length,Ct=0;Ct<dt;Ct++)switch(t.dynamicStates[Ct]){case P.LINE_WIDTH:f.rs.lineWidth!==s.lineWidth&&(_.lineWidth(s.lineWidth),f.rs.lineWidth=s.lineWidth);break;case P.DEPTH_BIAS:f.rs.depthBias===s.depthBiasConstant&&f.rs.depthBiasSlop===s.depthBiasSlope||(_.polygonOffset(s.depthBiasConstant,s.depthBiasSlope),f.rs.depthBias=s.depthBiasConstant,f.rs.depthBiasSlop=s.depthBiasSlope);break;case P.BLEND_CONSTANTS:var xt=s.blendConstant;o.blendColor.x===xt.x&&o.blendColor.y===xt.y&&o.blendColor.z===xt.z&&o.blendColor.w===xt.w||(_.blendColor(xt.x,xt.y,xt.z,xt.w),o.blendColor.copy(xt));break;case P.STENCIL_WRITE_MASK:var mt=s.stencilStatesFront,bt=s.stencilStatesBack;c.stencilWriteMaskFront!==mt.writeMask&&(_.stencilMaskSeparate(Fe.FRONT,mt.writeMask),c.stencilWriteMaskFront=mt.writeMask),c.stencilWriteMaskBack!==bt.writeMask&&(_.stencilMaskSeparate(Fe.BACK,bt.writeMask),c.stencilWriteMaskBack=bt.writeMask);break;case P.STENCIL_COMPARE_MASK:var Pt=s.stencilStatesFront,vt=s.stencilStatesBack;c.stencilRefFront===Pt.reference&&c.stencilReadMaskFront===Pt.compareMask||(_.stencilFuncSeparate(Fe.FRONT,ze[c.stencilFuncFront],Pt.reference,Pt.compareMask),c.stencilRefFront=Pt.reference,c.stencilReadMaskFront=Pt.compareMask),c.stencilRefBack===vt.reference&&c.stencilReadMaskBack===vt.compareMask||(_.stencilFuncSeparate(Fe.BACK,ze[c.stencilFuncBack],vt.reference,vt.compareMask),c.stencilRefBack=vt.reference,c.stencilReadMaskBack=vt.compareMask)}}function ft(e,t){var r=e.gl,a=e.extensions,n=a.ANGLE_instanced_arrays,s=a.WEBGL_multi_draw,i=it.gpuInputAssembler,u=it.glPrimitive;if(i){var l=i.gpuIndexBuffer;if(i.gpuIndirectBuffer){var _=i.gpuIndirectBuffer.indirects;if(_.drawByIndex){for(var f=0;f<_.drawCount;f++)_.byteOffsets[f]=_.offsets[f]*l.stride;if(s)_.instancedDraw?s.multiDrawElementsInstancedWEBGL(u,_.counts,0,i.glIndexType,_.byteOffsets,0,_.instances,0,_.drawCount):s.multiDrawElementsWEBGL(u,_.counts,0,i.glIndexType,_.byteOffsets,0,_.drawCount);else for(var c=0;c<_.drawCount;c++)_.instances[c]&&n?n.drawElementsInstancedANGLE(u,_.counts[c],i.glIndexType,_.byteOffsets[c],_.instances[c]):r.drawElements(u,_.counts[c],i.glIndexType,_.byteOffsets[c])}else if(s)_.instancedDraw?s.multiDrawArraysInstancedWEBGL(u,_.offsets,0,_.counts,0,_.instances,0,_.drawCount):s.multiDrawArraysWEBGL(u,_.offsets,0,_.counts,0,_.drawCount);else for(var o=0;o<_.drawCount;o++)_.instances[o]&&n?n.drawArraysInstancedANGLE(u,_.offsets[o],_.counts[o],_.instances[o]):r.drawArrays(u,_.offsets[o],_.counts[o])}else if(t.instanceCount&&n)if(l){if(t.indexCount>0){var E=t.firstIndex*l.stride;n.drawElementsInstancedANGLE(u,t.indexCount,i.glIndexType,E,t.instanceCount)}}else t.vertexCount>0&&n.drawArraysInstancedANGLE(u,t.firstVertex,t.vertexCount,t.instanceCount);else if(l){if(t.indexCount>0){var g=t.firstIndex*l.stride;r.drawElements(u,t.indexCount,i.glIndexType,g)}}else t.vertexCount>0&&r.drawArrays(u,t.firstVertex,t.vertexCount)}}function ct(e,t,r,n){var s=e.gl,i=e.stateCache,u=i.glTexUnits[i.texUnit];u.glTexture!==r.glTexture&&(s.bindTexture(r.glTarget,r.glTexture),u.glTexture=r.glTexture);var l=0,_=0;switch(r.glTarget){case Fe.TEXTURE_2D:for(var f=0;f<n.length;f++){var c=n[f];s.texSubImage2D(Fe.TEXTURE_2D,c.texSubres.mipLevel,c.texOffset.x,c.texOffset.y,r.glFormat,r.glType,t[l++])}break;case Fe.TEXTURE_CUBE_MAP:for(var o=0;o<n.length;o++){var E=n[o],g=E.texOffset,T=E.texSubres,S=T.baseArrayLayer+T.layerCount;for(_=T.baseArrayLayer;_<S;++_)s.texSubImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+_,T.mipLevel,g.x,g.y,r.glFormat,r.glType,t[l++])}break;default:a(16327)}r.flags&v.GEN_MIPMAP&&r.isPowerOf2&&s.generateMipmap(r.glTarget)}var ot=new Uint8Array(1);function Et(e,t,r,a,n){var s=O(t).height,u=d(t,n.width,n.height,n.depth),l=d(t,a.width,1,1),_=d(t,a.width,a.height,1),f=d(t,n.width,1,1),c=G(B[t]);ot.byteLength<u&&(ot=new Uint8Array(u));for(var o=0,E=r,g=0;g<n.depth;g++){E=r+_*g;for(var T=0;T<n.height;T+=s)ot.subarray(o,o+f).set(new Uint8Array(e.buffer,e.byteOffset+E,f)),o+=f,E+=l}var S=u/c.BYTES_PER_ELEMENT;return i(Number.isInteger(S),9101),new c(ot.buffer,0,S)}function gt(e,t,r,n){var s=e.gl,u=e.stateCache,l=u.glTexUnits[u.texUnit];l.glTexture!==r.glTexture&&(s.bindTexture(r.glTarget,r.glTexture),l.glTexture=r.glTexture);var _=0,f=0,c=B[r.format],o=G(c),E=c.isCompressed,g=O(r.format),T=new D,S=new y,R=new D;switch(r.glTarget){case Fe.TEXTURE_2D:for(var A=0;A<n.length;A++){var h=n[A],p=h.texSubres.mipLevel,C=h.texOffset,x=h.texExtent,m=x.width,b=x.height,P=g.width,L=g.height,I=h.buffStride;S.x=0===C.x?0:F(C.x,P),S.y=0===C.y?0:F(C.y,L),T.width=m<P?m:F(m,P),T.height=b<L?m:F(b,L),R.width=I>0?I:T.width,R.height=h.buffTexHeight>0?h.buffTexHeight:T.height;var M=m+S.x===r.width>>p?m:T.width,N=b+S.y===r.height>>p?b:T.height,U=void 0,w=t[_++];if(R.width===T.width&&R.height===T.height){var H=d(r.format,M,N,1)/o.BYTES_PER_ELEMENT;i(Number.isInteger(H),9101),U=new o(w.buffer,w.byteOffset+h.buffOffset,H)}else U=Et(w,r.format,h.buffOffset,R,T);E?r.glInternalFmt===Le.COMPRESSED_RGB_ETC1_WEBGL||e.extensions.noCompressedTexSubImage2D?s.compressedTexImage2D(Fe.TEXTURE_2D,p,r.glInternalFmt,M,N,0,U):s.compressedTexSubImage2D(Fe.TEXTURE_2D,p,S.x,S.y,M,N,r.glFormat,U):s.texSubImage2D(Fe.TEXTURE_2D,p,S.x,S.y,M,N,r.glFormat,r.glType,U)}break;case Fe.TEXTURE_CUBE_MAP:for(var X=0;X<n.length;X++){var k=n[X],V=k.texSubres.mipLevel,W=k.texOffset,z=k.texExtent,K=k.texSubres,Y=z.width,j=z.height,q=g.width,Z=g.height;S.x=0===W.x?0:F(W.x,q),S.y=0===W.y?0:F(W.y,Z),T.width=Y<q?Y:F(Y,q),T.height=j<Z?Y:F(j,Z),R.width=k.buffStride>0?k.buffStride:T.width,R.height=k.buffTexHeight>0?k.buffTexHeight:T.height;var Q=Y+S.x===r.width>>V?Y:T.width,J=j+S.y===r.height>>V?j:T.height,$=K.baseArrayLayer+K.layerCount;for(f=K.baseArrayLayer;f<$;++f){var ee=void 0,te=t[_++];if(R.width===T.width&&R.height===T.height){var re=d(r.format,Q,J,1)/o.BYTES_PER_ELEMENT;i(Number.isInteger(re),9101),ee=new o(te.buffer,te.byteOffset+k.buffOffset,re)}else ee=Et(te,r.format,k.buffOffset,R,T);E?r.glInternalFmt===Le.COMPRESSED_RGB_ETC1_WEBGL||e.extensions.noCompressedTexSubImage2D?s.compressedTexImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+f,V,r.glInternalFmt,Q,J,0,ee):s.compressedTexSubImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+f,V,S.x,S.y,Q,J,r.glFormat,ee):s.texSubImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+f,V,S.x,S.y,Q,J,r.glFormat,r.glType,ee)}}break;default:a(16327)}r.flags&v.GEN_MIPMAP&&s.generateMipmap(r.glTarget)}function Tt(e,t,r,n){var s=e.gl,i=e.stateCache,u=s.createFramebuffer();s.bindFramebuffer(Fe.FRAMEBUFFER,u);var l=0,_=0,f=1,c=1;if(t.glTarget===Fe.TEXTURE_2D)for(var o=0;o<n.length;o++){var E=n[o];s.framebufferTexture2D(Fe.FRAMEBUFFER,Fe.COLOR_ATTACHMENT0,t.glTarget,t.glTexture,E.texSubres.mipLevel),l=E.texOffset.x,_=E.texOffset.y,f=E.texExtent.width,c=E.texExtent.height,s.readPixels(l,_,f,c,t.glFormat,t.glType,r[o])}else a(16399);s.bindFramebuffer(Fe.FRAMEBUFFER,null),i.glFramebuffer=null,s.deleteFramebuffer(u)}function St(e,t,r,a,n){e.blitManager.draw(t,r,a,n)}function Rt(e){return new Int32Array(e)}var At=function(){function e(){this.drawCount=0,this.drawByIndex=!1,this.instancedDraw=!1,this._capacity=4,this.counts=Rt(this._capacity),this.offsets=Rt(this._capacity),this.instances=Rt(this._capacity),this.byteOffsets=Rt(this._capacity)}var t=e.prototype;return t.clearDraws=function(){this.drawCount=0,this.drawByIndex=!1,this.instancedDraw=!1},t.setDrawInfo=function(e,t){this._ensureCapacity(e),this.drawByIndex=t.indexCount>0,this.instancedDraw=!!t.instanceCount,this.drawCount=Math.max(e+1,this.drawCount),this.drawByIndex?(this.counts[e]=t.indexCount,this.offsets[e]=t.firstIndex):(this.counts[e]=t.vertexCount,this.offsets[e]=t.firstVertex),this.instances[e]=Math.max(1,t.instanceCount)},t._ensureCapacity=function(e){if(!(this._capacity>e)){this._capacity=_(e);var t=Rt(this._capacity),r=Rt(this._capacity),a=Rt(this._capacity);this.byteOffsets=Rt(this._capacity),t.set(this.counts),r.set(this.offsets),a.set(this.instances),this.counts=t,this.offsets=r,this.instances=a}},e}(),ht=function(){function e(){this._gpuShader=null,this._gpuDescriptorSetLayout=null,this._gpuPipelineLayout=null,this._gpuPipelineState=null,this._gpuVertexBuffer=null,this._gpuInputAssembler=null,this._gpuPointSampler=null,this._gpuLinearSampler=null,this._gpuDescriptorSet=null,this._gpuUniformBuffer=null,this._drawInfo=null,this._glFramebuffer=null,this._uniformBuffer=null;var e=Me.instance.bindingMappingInfo.maxBlockCounts[0];this._gpuShader={name:"Blit Pass",blocks:[new U(0,0,"BlitParams",[new w("tilingOffsetSrc",I.FLOAT4,1),new w("tilingOffsetDst",I.FLOAT4,1)],1)],samplerTextures:[new L(0,e,"textureSrc",I.SAMPLER2D,1)],subpassInputs:[],gpuStages:[{type:N.VERTEX,source:"\nprecision mediump float;\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nuniform vec4 tilingOffsetSrc;\nuniform vec4 tilingOffsetDst;\nvarying vec2 v_texCoord;\nvoid main() {\n    v_texCoord = a_texCoord * tilingOffsetSrc.xy + tilingOffsetSrc.zw;\n    gl_Position = vec4((a_position + 1.0) * tilingOffsetDst.xy - 1.0 + tilingOffsetDst.zw * 2.0, 0, 1);\n}",glShader:null},{type:N.FRAGMENT,source:"\nprecision mediump float;\nuniform sampler2D textureSrc;\nvarying vec2 v_texCoord;\nvoid main() {\n    gl_FragColor = texture2D(textureSrc, v_texCoord);\n}",glShader:null}],glProgram:null,glInputs:[],glUniforms:[],glBlocks:[],glSamplerTextures:[]},rt(Me.instance,this._gpuShader),this._gpuDescriptorSetLayout={bindings:[new H(0,X.UNIFORM_BUFFER,1,N.VERTEX),new H(e,X.SAMPLER_TEXTURE,1,N.FRAGMENT)],dynamicBindings:[],descriptorIndices:[],descriptorCount:e+1};for(var t=0;t<e;t++)this._gpuDescriptorSetLayout.descriptorIndices[t]=0;this._gpuDescriptorSetLayout.descriptorIndices.push(1),this._gpuPipelineLayout={gpuSetLayouts:[this._gpuDescriptorSetLayout],dynamicOffsetCount:0,dynamicOffsetOffsets:[0],dynamicOffsetIndices:[[]]},this._gpuPipelineState={glPrimitive:Fe.TRIANGLE_STRIP,gpuShader:this._gpuShader,gpuPipelineLayout:this._gpuPipelineLayout,rs:null,dss:new k(!1,!1),bs:null,dynamicStates:[],gpuRenderPass:null},this._gpuVertexBuffer={usage:h.VERTEX,memUsage:A.DEVICE,size:16*Float32Array.BYTES_PER_ELEMENT,stride:4*Float32Array.BYTES_PER_ELEMENT,buffer:null,vf32:null,indirects:new At,glTarget:0,glBuffer:null},qe(Me.instance,this._gpuVertexBuffer),Me.instance.memoryStatus.bufferSize+=this._gpuVertexBuffer.size;var r=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);Qe(Me.instance,this._gpuVertexBuffer,r,0,r.length),this._gpuInputAssembler={attributes:[new V("a_position",C.RG32F),new V("a_texCoord",C.RG32F)],gpuVertexBuffers:[this._gpuVertexBuffer],gpuIndexBuffer:null,gpuIndirectBuffer:null,glAttribs:[],glIndexType:0,glVAOs:new Map},nt(Me.instance,this._gpuInputAssembler),this._gpuPointSampler={glMinFilter:9728,glMagFilter:9728,glWrapS:10497,glWrapT:10497,glWrapR:10497},this._gpuLinearSampler={glMinFilter:9729,glMagFilter:9729,glWrapS:10497,glWrapT:10497,glWrapR:10497},this._uniformBuffer=new Float32Array(8),this._gpuUniformBuffer={usage:h.UNIFORM,memUsage:A.DEVICE,size:8*Float32Array.BYTES_PER_ELEMENT,stride:8*Float32Array.BYTES_PER_ELEMENT,buffer:this._uniformBuffer,vf32:null,indirects:new At,glTarget:0,glBuffer:null},qe(Me.instance,this._gpuUniformBuffer),Me.instance.memoryStatus.bufferSize+=this._gpuUniformBuffer.size,this._gpuDescriptorSet={gpuDescriptors:[{type:X.UNIFORM_BUFFER,gpuBuffer:this._gpuUniformBuffer,gpuTexture:null,gpuSampler:null},{type:X.SAMPLER_TEXTURE,gpuBuffer:null,gpuTexture:null,gpuSampler:null}],descriptorIndices:this._gpuDescriptorSetLayout.descriptorIndices},this._drawInfo=new W(4,0,0,0,0,0,0),this._glFramebuffer=Me.instance.gl.createFramebuffer()}var t=e.prototype;return t.destroy=function(){this._glFramebuffer&&(Me.instance.gl.deleteFramebuffer(this._glFramebuffer),this._glFramebuffer=null),this._gpuVertexBuffer&&(Me.instance.memoryStatus.bufferSize-=this._gpuVertexBuffer.size,Ze(Me.instance,this._gpuVertexBuffer)),this._gpuUniformBuffer&&(Me.instance.memoryStatus.bufferSize-=this._gpuUniformBuffer.size,Ze(Me.instance,this._gpuUniformBuffer)),this._gpuShader&&at(Me.instance,this._gpuShader),this._gpuInputAssembler&&st(Me.instance,this._gpuInputAssembler)},t.draw=function(e,t,r,a){var n=Me.instance,s=n.gl,i=n.stateCache,u=i.glFramebuffer;if(s.viewport(0,0,t.width,t.height),s.scissor(0,0,t.width,t.height),this._uniformBuffer&&this._gpuUniformBuffer&&this._gpuPipelineState&&this._gpuInputAssembler&&this._gpuDescriptorSet&&this._drawInfo){var l=this._gpuDescriptorSet.gpuDescriptors[1];l.gpuTexture=e,l.gpuSampler=a===z.POINT?this._gpuPointSampler:this._gpuLinearSampler;var _=B[t.format],f=Fe.COLOR_ATTACHMENT0;_.hasStencil?f=Fe.DEPTH_STENCIL_ATTACHMENT:_.hasDepth&&(f=Fe.DEPTH_ATTACHMENT);var c=r.map((function(e,t){return t}));c.sort((function(e,t){return r[e].srcSubres.mipLevel-r[t].srcSubres.mipLevel})),i.glFramebuffer!==this._glFramebuffer&&(s.bindFramebuffer(Fe.FRAMEBUFFER,this._glFramebuffer),i.glFramebuffer=this._glFramebuffer);var o=r[0].dstSubres.mipLevel;t.glTexture?s.framebufferTexture2D(Fe.FRAMEBUFFER,f,t.glTarget,t.glTexture,o):s.framebufferRenderbuffer(Fe.FRAMEBUFFER,f,Fe.RENDERBUFFER,t.glRenderbuffer);for(var E=0;E<c.length;++E){var g=r[c[E]];e.glTexture&&o!==g.srcSubres.mipLevel&&(o=g.srcSubres.mipLevel,s.framebufferTexture2D(Fe.FRAMEBUFFER,f,t.glTarget,t.glTexture,o));var T=e.width,S=e.height,R=t.width,A=t.height;this._uniformBuffer[0]=g.srcExtent.width/T,this._uniformBuffer[1]=g.srcExtent.height/S,this._uniformBuffer[2]=g.srcOffset.x/T,this._uniformBuffer[3]=g.srcOffset.y/S,this._uniformBuffer[4]=g.dstExtent.width/R,this._uniformBuffer[5]=g.dstExtent.height/A,this._uniformBuffer[6]=g.dstOffset.x/R,this._uniformBuffer[7]=g.dstOffset.y/A,Qe(n,this._gpuUniformBuffer,this._uniformBuffer,0,this._uniformBuffer.length*Float32Array.BYTES_PER_ELEMENT),_t(n,this._gpuPipelineState,this._gpuInputAssembler,[this._gpuDescriptorSet],[],null),ft(n,this._drawInfo)}i.glFramebuffer!==u&&(s.bindFramebuffer(Fe.FRAMEBUFFER,u),i.glFramebuffer=u);var h=i.viewport;s.viewport(h.left,h.top,h.width,h.height);var p=i.scissorRect;s.scissor(p.x,p.y,p.width,p.height)}},e}(),pt=function(e){function n(){var t;return(t=e.call(this)||this)._gpuBuffer=null,t._gpuBufferView=null,t._uniformBuffer=null,t}t(n,e);var s=n.prototype;return s.initialize=function(e){if("buffer"in e){this._isBufferView=!0;var t=e.buffer;this._usage=t.usage,this._memUsage=t.memUsage,this._size=this._stride=e.range,this._count=1,this._flags=t.flags,this._gpuBufferView={gpuBuffer:t.gpuBuffer,offset:e.offset,range:e.range}}else this._usage=e.usage,this._memUsage=e.memUsage,this._size=e.size,this._stride=Math.max(e.stride||this._size,1),this._count=this._size/this._stride,this._flags=e.flags,this._usage&h.UNIFORM&&this._size>0&&(this._uniformBuffer=new Uint8Array(this._size)),this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,vf32:null,indirects:new At,glTarget:0,glBuffer:null},this._usage&h.UNIFORM&&(this._gpuBuffer.buffer=this._uniformBuffer),qe(Me.instance,this._gpuBuffer),Me.instance.memoryStatus.bufferSize+=this._size},s.destroy=function(){this._gpuBuffer&&(Ze(Me.instance,this._gpuBuffer),Me.instance.memoryStatus.bufferSize-=this._size,this._gpuBuffer=null),this._gpuBufferView&&(this._gpuBufferView=null)},s.resize=function(e){if(this._isBufferView)f(16379);else{var t,r,n,s,i,u=this._size;u!==e&&(this._size=e,this._count=this._size/this._stride,this._uniformBuffer&&(this._uniformBuffer=new Uint8Array(e)),this._gpuBuffer&&(this._uniformBuffer&&(this._gpuBuffer.buffer=this._uniformBuffer),this._gpuBuffer.size=e,e>0&&(t=Me.instance,r=this._gpuBuffer,n=t.gl,s=t.stateCache,i=r.memUsage&A.HOST?Fe.DYNAMIC_DRAW:Fe.STATIC_DRAW,r.usage&h.VERTEX?(t.extensions.useVAO&&s.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),s.glVAO=null),it.gpuInputAssembler=null,s.glArrayBuffer!==r.glBuffer&&n.bindBuffer(Fe.ARRAY_BUFFER,r.glBuffer),r.buffer?n.bufferData(Fe.ARRAY_BUFFER,r.buffer,i):n.bufferData(Fe.ARRAY_BUFFER,r.size,i),n.bindBuffer(Fe.ARRAY_BUFFER,null),s.glArrayBuffer=null):r.usage&h.INDEX?(t.extensions.useVAO&&s.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),s.glVAO=null),it.gpuInputAssembler=null,s.glElementArrayBuffer!==r.glBuffer&&n.bindBuffer(Fe.ELEMENT_ARRAY_BUFFER,r.glBuffer),r.buffer?n.bufferData(Fe.ELEMENT_ARRAY_BUFFER,r.buffer,i):n.bufferData(Fe.ELEMENT_ARRAY_BUFFER,r.size,i),n.bindBuffer(Fe.ELEMENT_ARRAY_BUFFER,null),s.glElementArrayBuffer=null):r.usage&h.UNIFORM?r.buffer&&(r.vf32=new Float32Array(r.buffer.buffer)):(r.usage&h.INDIRECT||r.usage&h.TRANSFER_DST||r.usage&h.TRANSFER_SRC||a(16315),r.glTarget=Fe.NONE),Me.instance.memoryStatus.bufferSize-=u,Me.instance.memoryStatus.bufferSize+=e)))}},s.update=function(e,t){var r;this._isBufferView?f(16380):(r=void 0!==t?t:this._usage&h.INDIRECT?0:e.byteLength,Qe(Me.instance,this._gpuBuffer,e,0,r))},r(n,[{key:"gpuBuffer",get:function(){return this._gpuBuffer}},{key:"gpuBufferView",get:function(){return this._gpuBufferView}}]),n}(K),Bt=function(e){function r(){var t;return(t=e.call(this)||this)._isInRenderPass=!1,t._curGPUPipelineState=null,t._curGPUInputAssembler=null,t._curGPUDescriptorSets=[],t._curDynamicOffsets=Array(8).fill(0),t._curDynamicStates=new j,t._isStateInvalied=!1,t}t(r,e);var n=r.prototype;return n.initialize=function(e){this._type=e.type,this._queue=e.queue;for(var t=Me.instance.bindingMappings.blockOffsets.length,r=0;r<t;r++)this._curGPUDescriptorSets.push(null)},n.destroy=function(){},n.begin=function(){this._curGPUPipelineState=null,this._curGPUInputAssembler=null,this._curGPUDescriptorSets.length=0,this._numDrawCalls=0,this._numInstances=0,this._numTris=0},n.end=function(){this._isStateInvalied&&this.bindStates(),this._isInRenderPass=!1},n.beginRenderPass=function(){a(16401),this._isInRenderPass=!0},n.endRenderPass=function(){this._isInRenderPass=!1},n.bindPipelineState=function(e){var t=e.gpuPipelineState;t!==this._curGPUPipelineState&&(this._curGPUPipelineState=t,this._isStateInvalied=!0)},n.bindDescriptorSet=function(e,t,r){var a=t.gpuDescriptorSet;if(a!==this._curGPUDescriptorSets[e]&&(this._curGPUDescriptorSets[e]=a,this._isStateInvalied=!0),r){var n,s=null==(n=this._curGPUPipelineState)?void 0:n.gpuPipelineLayout;if(s){for(var i=this._curDynamicOffsets,u=s.dynamicOffsetOffsets[e],l=0;l<r.length;l++)i[u+l]=r[l];this._isStateInvalied=!0}}},n.bindInputAssembler=function(e){var t=e.getGpuInputAssembler();this._curGPUInputAssembler=t,this._isStateInvalied=!0},n.setViewport=function(e){var t=this._curDynamicStates.viewport;t.left===e.left&&t.top===e.top&&t.width===e.width&&t.height===e.height&&t.minDepth===e.minDepth&&t.maxDepth===e.maxDepth||(t.left=e.left,t.top=e.top,t.width=e.width,t.height=e.height,t.minDepth=e.minDepth,t.maxDepth=e.maxDepth,this._isStateInvalied=!0)},n.setScissor=function(e){var t=this._curDynamicStates.scissor;t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height||(t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,this._isStateInvalied=!0)},n.setLineWidth=function(e){this._curDynamicStates.lineWidth!==e&&(this._curDynamicStates.lineWidth=e,this._isStateInvalied=!0)},n.setDepthBias=function(e,t,r){var a=this._curDynamicStates;a.depthBiasConstant===e&&a.depthBiasClamp===t&&a.depthBiasSlope===r||(a.depthBiasConstant=e,a.depthBiasClamp=t,a.depthBiasSlope=r,this._isStateInvalied=!0)},n.setBlendConstants=function(e){var t=this._curDynamicStates.blendConstant;t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w||(t.copy(e),this._isStateInvalied=!0)},n.setDepthBound=function(e,t){var r=this._curDynamicStates;r.depthMinBounds===e&&r.depthMaxBounds===t||(r.depthMinBounds=e,r.depthMaxBounds=t,this._isStateInvalied=!0)},n.setStencilWriteMask=function(e,t){var r=this._curDynamicStates.stencilStatesFront,a=this._curDynamicStates.stencilStatesBack;e&Y.FRONT&&r.writeMask!==t&&(r.writeMask=t,this._isStateInvalied=!0),e&Y.BACK&&a.writeMask!==t&&(a.writeMask=t,this._isStateInvalied=!0)},n.setStencilCompareMask=function(e,t,r){var a=this._curDynamicStates.stencilStatesFront,n=this._curDynamicStates.stencilStatesBack;e&Y.FRONT&&(a.compareMask===r&&a.reference===t||(a.reference=t,a.compareMask=r,this._isStateInvalied=!0)),e&Y.BACK&&(n.compareMask===r&&n.reference===t||(n.reference=t,n.compareMask=r,this._isStateInvalied=!0))},n.draw=function(){a(16328)},n.updateBuffer=function(){a(16329)},n.copyBuffersToTexture=function(){a(16330)},n.execute=function(){a(16402)},n.pipelineBarrier=function(){},n.bindStates=function(){a(16401)},n.blitTexture=function(){a(16401)},r}(q),dt=function(e){t(n,e);var a=n.prototype;function n(){var t;return(t=e.call(this)||this)._gpuFramebuffer=null,t._gpuColorTextures=[],t._gpuDepthStencilTexture=void 0,t}return a.getGpuFramebuffer=function(){return this._gpuFramebuffer},a.initialize=function(e){var t,r=this;this._renderPass=e.renderPass,this._colorTextures=e.colorTextures||[];for(var a=this._depthStencilTexture=e.depthStencilTexture||null,n=0,s=[],i=0;i<e.colorTextures.length;++i){var u=e.colorTextures[i];u&&(s.push(u.gpuTexture),n=u.lodLevel)}var l=null;a&&(l=a.gpuTexture,n=a.lodLevel);var _=Number.MAX_SAFE_INTEGER,f=Number.MAX_SAFE_INTEGER;this._gpuFramebuffer={gpuRenderPass:e.renderPass.gpuRenderPass,gpuColorTextures:s,gpuDepthStencilTexture:l,glFramebuffer:null,isOffscreen:!0,get width(){return this.gpuColorTextures.length>0?this.gpuColorTextures[0].width:this.gpuDepthStencilTexture?this.gpuDepthStencilTexture.width:_},set width(e){_=e},get height(){return this.gpuColorTextures.length>0?this.gpuColorTextures[0].height:this.gpuDepthStencilTexture?this.gpuDepthStencilTexture.height:f},set height(e){f=e},lodLevel:n},tt(Me.instance,this._gpuFramebuffer),this._gpuFramebuffer.gpuColorTextures.forEach((function(e){return r._gpuColorTextures.push(e.glTexture)})),this._gpuDepthStencilTexture=null==(t=this._gpuFramebuffer.gpuDepthStencilTexture)?void 0:t.glTexture,this._width=this._gpuFramebuffer.width,this._height=this._gpuFramebuffer.height},a.destroy=function(){var e,t,r,a;this._gpuFramebuffer&&(e=Me.instance,t=this._gpuFramebuffer,r=e.gl,a=e.stateCache,t.glFramebuffer&&(r.deleteFramebuffer(t.glFramebuffer),a.glFramebuffer===t.glFramebuffer&&(r.bindFramebuffer(Fe.FRAMEBUFFER,null),a.glFramebuffer=null),t.glFramebuffer=null),this._gpuFramebuffer=null,this._gpuColorTextures.length=0,this._gpuDepthStencilTexture=null)},r(n,[{key:"needRebuild",get:function(){var e=this._gpuFramebuffer;if(e){for(var t,r=0;r<e.gpuColorTextures.length;r++)if(e.gpuColorTextures[r].glTexture!==this._gpuColorTextures[r])return!0;if((null==(t=e.gpuDepthStencilTexture)?void 0:t.glTexture)!==this._gpuDepthStencilTexture)return!0}return!1}}]),n}(Z),Ct=function(e){t(n,e);var r=n.prototype;function n(){var t;return(t=e.call(this)||this)._gpuInputAssembler=null,t}return r.getGpuInputAssembler=function(){return this._gpuInputAssembler},r.initialize=function(e){if(0!==e.vertexBuffers.length){if(this._attributes=e.attributes,this._attributesHash=this.computeAttributesHash(),this._vertexBuffers=e.vertexBuffers,e.indexBuffer)this._indexBuffer=e.indexBuffer,this._drawInfo.indexCount=this._indexBuffer.size/this._indexBuffer.stride,this._drawInfo.firstIndex=0;else{var t=this._vertexBuffers[0];this._drawInfo.vertexCount=t.size/t.stride,this._drawInfo.firstVertex=0,this._drawInfo.vertexOffset=0}this._drawInfo.instanceCount=0,this._drawInfo.firstInstance=0,this._indirectBuffer=e.indirectBuffer||null;for(var r=new Array(e.vertexBuffers.length),n=0;n<e.vertexBuffers.length;++n){var s=e.vertexBuffers[n];s.gpuBuffer&&(r[n]=s.gpuBuffer)}var i=null,u=0;if(e.indexBuffer&&(i=e.indexBuffer.gpuBuffer))switch(i.stride){case 1:u=5121;break;case 2:u=5123;break;case 4:u=5125;break;default:a(16332)}var l=null;e.indirectBuffer&&(l=e.indirectBuffer.gpuBuffer),this._gpuInputAssembler={attributes:e.attributes,gpuVertexBuffers:r,gpuIndexBuffer:i,gpuIndirectBuffer:l,glAttribs:[],glIndexType:u,glVAOs:new Map},nt(Me.instance,this._gpuInputAssembler)}else a(16331)},r.destroy=function(){var e=Me.instance;this._gpuInputAssembler&&e.extensions.useVAO&&st(e,this._gpuInputAssembler),this._gpuInputAssembler=null},n}(Q),xt=function(e){function a(){var t;return(t=e.call(this)||this)._gpuDescriptorSetLayout=null,t}t(a,e);var n=a.prototype;return n.initialize=function(e){Array.prototype.push.apply(this._bindings,e.bindings);for(var t=0,r=-1,a=[],n=0;n<this._bindings.length;n++){var s=this._bindings[n];a.push(t),t+=s.count,s.binding>r&&(r=s.binding)}this._bindingIndices=Array(r+1).fill(-1);for(var i=this._descriptorIndices=Array(r+1).fill(-1),u=0;u<this._bindings.length;u++){var l=this._bindings[u];this._bindingIndices[l.binding]=u,i[l.binding]=a[u]}for(var _=[],f=0;f<this._bindings.length;f++){var c=this._bindings[f];if(c.descriptorType&J)for(var o=0;o<c.count;o++)_.push(c.binding)}this._gpuDescriptorSetLayout={bindings:this._bindings,dynamicBindings:_,descriptorIndices:i,descriptorCount:t}},n.destroy=function(){this._bindings.length=0},r(a,[{key:"gpuDescriptorSetLayout",get:function(){return this._gpuDescriptorSetLayout}}]),a}($),mt=function(e){function a(){var t;return(t=e.call(this)||this)._gpuPipelineLayout=null,t}t(a,e);var n=a.prototype;return n.initialize=function(e){Array.prototype.push.apply(this._setLayouts,e.setLayouts);for(var t=[],r=[],a=0,n=[],s=0;s<this._setLayouts.length;s++){for(var i=this._setLayouts[s],u=i.gpuDescriptorSetLayout.dynamicBindings,l=Array(i.bindingIndices.length).fill(-1),_=0;_<u.length;_++){var f=u[_];l[f]<0&&(l[f]=a+_)}r.push(i.gpuDescriptorSetLayout),t.push(l),n.push(a),a+=u.length}this._gpuPipelineLayout={gpuSetLayouts:r,dynamicOffsetIndices:t,dynamicOffsetCount:a,dynamicOffsetOffsets:n}},n.destroy=function(){this._setLayouts.length=0},r(a,[{key:"gpuPipelineLayout",get:function(){return this._gpuPipelineLayout}}]),a}(ee),bt=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],Pt=function(e){function a(){var t;return(t=e.call(this)||this)._gpuPipelineState=null,t}t(a,e);var n=a.prototype;return n.initialize=function(e){this._primitive=e.primitive,this._shader=e.shader,this._pipelineLayout=e.pipelineLayout;var t=this._bs;if(e.blendState){var r=e.blendState,a=r.targets;a&&a.forEach((function(e,r){t.setTarget(r,e)})),void 0!==r.isA2C&&(t.isA2C=r.isA2C),void 0!==r.isIndepend&&(t.isIndepend=r.isIndepend),void 0!==r.blendColor&&(t.blendColor=r.blendColor)}Object.assign(this._rs,e.rasterizerState),Object.assign(this._dss,e.depthStencilState),this._is=e.inputState,this._renderPass=e.renderPass,this._dynamicStates=e.dynamicStates;for(var n=[],s=0;s<31;s++)this._dynamicStates&1<<s&&n.push(1<<s);this._gpuPipelineState={glPrimitive:bt[e.primitive],gpuShader:e.shader.gpuShader,gpuPipelineLayout:e.pipelineLayout.gpuPipelineLayout,rs:e.rasterizerState,dss:e.depthStencilState,bs:e.blendState,gpuRenderPass:e.renderPass.gpuRenderPass,dynamicStates:n}},n.destroy=function(){this._gpuPipelineState=null},r(a,[{key:"gpuPipelineState",get:function(){return this._gpuPipelineState}}]),a}(te),vt=function(e){function r(){return e.apply(this,arguments)||this}t(r,e);var n=r.prototype;return n.beginRenderPass=function(e,t,r,a,n,s){lt(Me.instance,e.gpuRenderPass,t.getGpuFramebuffer(),r,a,n,s),this._isInRenderPass=!0},n.draw=function(e){if(this._isInRenderPass){this._isStateInvalied&&this.bindStates();var t="drawInfo"in e?e.drawInfo:e;ft(Me.instance,t),++this._numDrawCalls,this._numInstances+=t.instanceCount;var r=t.indexCount||t.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case Fe.TRIANGLES:this._numTris+=r/3*Math.max(t.instanceCount,1);break;case Fe.TRIANGLE_STRIP:case Fe.TRIANGLE_FAN:this._numTris+=(r-2)*Math.max(t.instanceCount,1)}}else a(16328)},n.setViewport=function(e){var t=Me.instance,r=t.stateCache,a=t.gl;r.viewport.left===e.left&&r.viewport.top===e.top&&r.viewport.width===e.width&&r.viewport.height===e.height||(a.viewport(e.left,e.top,e.width,e.height),r.viewport.left=e.left,r.viewport.top=e.top,r.viewport.width=e.width,r.viewport.height=e.height)},n.setScissor=function(e){var t=Me.instance,r=t.stateCache,a=t.gl;r.scissorRect.x===e.x&&r.scissorRect.y===e.y&&r.scissorRect.width===e.width&&r.scissorRect.height===e.height||(a.scissor(e.x,e.y,e.width,e.height),r.scissorRect.x=e.x,r.scissorRect.y=e.y,r.scissorRect.width=e.width,r.scissorRect.height=e.height)},n.updateBuffer=function(e,t,r){if(this._isInRenderPass)a(16329);else{var n,s=e.gpuBuffer;s&&(n=void 0!==r?r:e.usage&h.INDIRECT?0:t.byteLength,Qe(Me.instance,s,t,0,n))}},n.copyBuffersToTexture=function(e,t,r){if(this._isInRenderPass)a(16330);else{var n=t.gpuTexture;n&&gt(Me.instance,e,n,r)}},n.execute=function(){a(16402)},n.bindStates=function(){_t(Me.instance,this._curGPUPipelineState,this._curGPUInputAssembler,this._curGPUDescriptorSets,this._curDynamicOffsets,this._curDynamicStates),this._isStateInvalied=!1},n.blitTexture=function(e,t,r,a){var n=e.gpuTexture,s=t.gpuTexture;St(Me.instance,n,s,r,a)},r}(Bt),Gt=function(e){function r(){var t;return(t=e.call(this)||this).numDrawCalls=0,t.numInstances=0,t.numTris=0,t}t(r,e);var a=r.prototype;return a.initialize=function(e){this._type=e.type},a.destroy=function(){},a.submit=function(e){for(var t=e.length,r=0;r<t;r++){var a=e[r];this.numDrawCalls+=a.numDrawCalls,this.numInstances+=a.numInstances,this.numTris+=a.numTris}},a.clear=function(){this.numDrawCalls=0,this.numInstances=0,this.numTris=0},r}(re),Ot=function(e){function a(){var t;return(t=e.call(this)||this)._gpuRenderPass=null,t}t(a,e);var n=a.prototype;return n.initialize=function(e){this._colorInfos=e.colorAttachments,this._depthStencilInfo=e.depthStencilAttachment,this._subpasses=e.subpasses,this._gpuRenderPass={colorAttachments:this._colorInfos,depthStencilAttachment:this._depthStencilInfo},this._hash=this.computeHash()},n.destroy=function(){this._gpuRenderPass=null},r(a,[{key:"gpuRenderPass",get:function(){return this._gpuRenderPass}}]),a}(ae),Ft=[10497,33648,33071,33071],Lt=function(e){function a(t,r){var a;(a=e.call(this,t,r)||this)._gpuSampler=null;var n,s,i=a._info.minFilter,u=a._info.magFilter,l=a._info.mipFilter;n=i===z.LINEAR||i===z.ANISOTROPIC?l===z.LINEAR||l===z.ANISOTROPIC?Fe.LINEAR_MIPMAP_LINEAR:l===z.POINT?Fe.LINEAR_MIPMAP_NEAREST:Fe.LINEAR:l===z.LINEAR||l===z.ANISOTROPIC?Fe.NEAREST_MIPMAP_LINEAR:l===z.POINT?Fe.NEAREST_MIPMAP_NEAREST:Fe.NEAREST,s=u===z.LINEAR||u===z.ANISOTROPIC?Fe.LINEAR:Fe.NEAREST;var _=Ft[a._info.addressU],f=Ft[a._info.addressV],c=Ft[a._info.addressW];return a._gpuSampler={glMinFilter:n,glMagFilter:s,glWrapS:_,glWrapT:f,glWrapR:c},a}return t(a,e),r(a,[{key:"gpuSampler",get:function(){return this._gpuSampler}}]),a}(ne),It=function(e){function a(){var t;return(t=e.call(this)||this)._gpuShader=null,t}t(a,e);var n=a.prototype;return n.initialize=function(e){this._name=e.name,this._stages=e.stages,this._attributes=e.attributes,this._blocks=e.blocks,this._samplers=e.samplers,this._gpuShader={name:e.name,blocks:e.blocks.slice(),samplerTextures:e.samplerTextures.slice(),subpassInputs:e.subpassInputs.slice(),gpuStages:new Array(e.stages.length),glProgram:null,glInputs:[],glUniforms:[],glBlocks:[],glSamplerTextures:[]};for(var t=0;t<e.stages.length;++t){var r=e.stages[t];this._gpuShader.gpuStages[t]={type:r.stage,source:r.source,glShader:null}}},n.destroy=function(){this._gpuShader&&(at(Me.instance,this._gpuShader),this._gpuShader=null)},r(a,[{key:"gpuShader",get:function(){return null===this._gpuShader.glProgram&&rt(Me.instance,this._gpuShader),this._gpuShader}}]),a}(se),Mt=function(){function e(){this.glArrayBuffer=null,this.glElementArrayBuffer=null,this.glVAO=null,this.texUnit=0,this.glTexUnits=[],this.glRenderbuffer=null,this.glFramebuffer=null,this.viewport=new ie,this.scissorRect=new M(0,0,0,0),this.rs=new ue,this.dss=new k,this.bs=new le,this.glProgram=null,this.glEnabledAttribLocs=[],this.glCurrentAttribLocs=[],this.texUnitCacheMap={}}return e.prototype.initialize=function(e,t){for(var r=0;r<e;++r)this.glTexUnits.push({glTexture:null});this.glEnabledAttribLocs.length=t,this.glEnabledAttribLocs.fill(!1),this.glCurrentAttribLocs.length=t,this.glCurrentAttribLocs.fill(!1)},e}(),Dt=function(e){function a(){var t;return(t=e.call(this)||this)._gpuTexture=null,t._lodLevel=0,t}t(a,e);var n=a.prototype;return n.initialize=function(e,t){var r=this,a=Me.instance,n=e,s=e;"texture"in e&&(n=s.texture.info,r._isTextureView=!0);var i=r._info;i.copy(n);var u=r._viewInfo;r._isPowerOf2=_e(i.width)&&_e(i.height),r._size=fe(i.format,r.width,r.height,r.depth,i.levelCount)*i.layerCount,r._isTextureView?(u.copy(s),r._lodLevel=s.baseLevel,r._gpuTexture=s.texture._gpuTexture):(r._gpuTexture={type:n.type,format:n.format,usage:n.usage,width:n.width,height:n.height,depth:n.depth,size:r._size,arrayLayer:n.layerCount,mipLevel:n.levelCount,samples:n.samples,flags:n.flags,isPowerOf2:r._isPowerOf2,glTarget:0,glInternalFmt:0,glFormat:0,glType:0,glUsage:0,glTexture:null,glRenderbuffer:null,glWrapS:0,glWrapT:0,glMinFilter:0,glMagFilter:0,isSwapchainTexture:t||!1},r._gpuTexture.isSwapchainTexture||(Je(a,r._gpuTexture),a.memoryStatus.textureSize+=r._size),u.texture=r,u.type=e.type,u.format=e.format,u.baseLevel=0,u.levelCount=e.levelCount,u.baseLayer=0,u.layerCount=e.layerCount)},n.destroy=function(){var e=this,t=Me.instance;!e._isTextureView&&e._gpuTexture&&($e(t,e._gpuTexture),t.memoryStatus.textureSize-=e._size,e._gpuTexture=null)},n.getTextureHandle=function(){var e=this._gpuTexture;return e?e.glTexture?e.glTexture:e.glRenderbuffer?e.glRenderbuffer:0:0},n.resize=function(e,t){var r=this,n=Me.instance,s=r._info;if(s.width!==e||s.height!==t){s.levelCount===a.getLevelCount(s.width,s.height)?s.levelCount=a.getLevelCount(e,t):s.levelCount>1&&(s.levelCount=Math.min(s.levelCount,a.getLevelCount(e,t)));var i=r._size;s.width=e,s.height=t,r._size=fe(s.format,r.width,r.height,r.depth,s.levelCount)*s.layerCount;var u=r._gpuTexture;!r._isTextureView&&u&&(u.width=e,u.height=t,u.size=r._size,u.isSwapchainTexture||(et(n,u),n.memoryStatus.textureSize-=i,n.memoryStatus.textureSize+=r._size))}},n.initAsSwapchainTexture=function(e){var t=new ce;t.format=e.format,t.usage=B[e.format].hasDepth?oe.DEPTH_STENCIL_ATTACHMENT:oe.COLOR_ATTACHMENT,t.width=e.width,t.height=e.height,this.initialize(t,!0)},r(a,[{key:"gpuTexture",get:function(){return this._gpuTexture}},{key:"lodLevel",get:function(){return this._lodLevel}}]),a}(Ee),yt="webglcontextlost";function Nt(e){e.activeTexture(Fe.TEXTURE0),e.pixelStorei(Fe.PACK_ALIGNMENT,1),e.pixelStorei(Fe.UNPACK_ALIGNMENT,1),e.pixelStorei(Fe.UNPACK_FLIP_Y_WEBGL,!1),e.bindFramebuffer(Fe.FRAMEBUFFER,null),e.enable(Fe.SCISSOR_TEST),e.enable(Fe.CULL_FACE),e.cullFace(Fe.BACK),e.frontFace(Fe.CCW),e.disable(Fe.POLYGON_OFFSET_FILL),e.polygonOffset(0,0),e.enable(Fe.DEPTH_TEST),e.depthMask(!0),e.depthFunc(Fe.LESS),e.depthRange(0,1),e.stencilFuncSeparate(Fe.FRONT,Fe.ALWAYS,1,65535),e.stencilOpSeparate(Fe.FRONT,Fe.KEEP,Fe.KEEP,Fe.KEEP),e.stencilMaskSeparate(Fe.FRONT,65535),e.stencilFuncSeparate(Fe.BACK,Fe.ALWAYS,1,65535),e.stencilOpSeparate(Fe.BACK,Fe.KEEP,Fe.KEEP,Fe.KEEP),e.stencilMaskSeparate(Fe.BACK,65535),e.disable(Fe.STENCIL_TEST),e.disable(Fe.SAMPLE_ALPHA_TO_COVERAGE),e.disable(Fe.BLEND),e.blendEquationSeparate(Fe.FUNC_ADD,Fe.FUNC_ADD),e.blendFuncSeparate(Fe.ONE,Fe.ZERO,Fe.ONE,Fe.ZERO),e.colorMask(!0,!0,!0,!0),e.blendColor(0,0,0,0)}function Ut(e,t){for(var r=["","WEBKIT_","MOZ_"],a=0;a<r.length;++a){var n=e.getExtension(r[a]+t);if(n)return n}return null}function wt(e){var t={EXT_texture_filter_anisotropic:Ut(e,"EXT_texture_filter_anisotropic"),EXT_blend_minmax:Ut(e,"EXT_blend_minmax"),EXT_frag_depth:Ut(e,"EXT_frag_depth"),EXT_shader_texture_lod:Ut(e,"EXT_shader_texture_lod"),EXT_sRGB:Ut(e,"EXT_sRGB"),OES_vertex_array_object:Ut(e,"OES_vertex_array_object"),EXT_color_buffer_half_float:Ut(e,"EXT_color_buffer_half_float"),WEBGL_color_buffer_float:Ut(e,"WEBGL_color_buffer_float"),WEBGL_compressed_texture_etc1:Ut(e,"WEBGL_compressed_texture_etc1"),WEBGL_compressed_texture_etc:Ut(e,"WEBGL_compressed_texture_etc"),WEBGL_compressed_texture_pvrtc:Ut(e,"WEBGL_compressed_texture_pvrtc"),WEBGL_compressed_texture_s3tc:Ut(e,"WEBGL_compressed_texture_s3tc"),WEBGL_compressed_texture_s3tc_srgb:Ut(e,"WEBGL_compressed_texture_s3tc_srgb"),WEBGL_debug_shaders:Ut(e,"WEBGL_debug_shaders"),WEBGL_draw_buffers:Ut(e,"WEBGL_draw_buffers"),WEBGL_lose_context:Ut(e,"WEBGL_lose_context"),WEBGL_depth_texture:Ut(e,"WEBGL_depth_texture"),OES_texture_half_float:Ut(e,"OES_texture_half_float"),OES_texture_half_float_linear:Ut(e,"OES_texture_half_float_linear"),OES_texture_float:Ut(e,"OES_texture_float"),OES_texture_float_linear:Ut(e,"OES_texture_float_linear"),OES_standard_derivatives:Ut(e,"OES_standard_derivatives"),OES_element_index_uint:Ut(e,"OES_element_index_uint"),ANGLE_instanced_arrays:Ut(e,"ANGLE_instanced_arrays"),WEBGL_debug_renderer_info:Ut(e,"WEBGL_debug_renderer_info"),WEBGL_multi_draw:null,WEBGL_compressed_texture_astc:null,destroyShadersImmediately:!0,noCompressedTexSubImage2D:!1,isLocationActive:function(e){return!!e},useVAO:!1};return n.os===s.IOS&&14===n.osMainVersion&&n.isBrowser||(t.WEBGL_compressed_texture_astc=Ut(e,"WEBGL_compressed_texture_astc")),n.os!==s.ANDROID&&n.os!==s.IOS&&(t.WEBGL_multi_draw=Ut(e,"WEBGL_multi_draw")),n.browserType===E.UC&&(t.ANGLE_instanced_arrays=null),(n.os===s.IOS&&n.osMainVersion<=10||n.os===s.ANDROID)&&(t.destroyShadersImmediately=!1),t.isLocationActive=function(e){return!!e&&-1!==e.id},t.noCompressedTexSubImage2D=!0,t.OES_vertex_array_object&&(t.useVAO=!0),t}function Ht(e){var t=null;try{var r={alpha:g.ENABLE_TRANSPARENT_CANVAS,antialias:Ge||g.ENABLE_WEBGL_ANTIALIAS,depth:!0,stencil:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};t=e.getContext("webgl",r)}catch(e){return null}return t}var Xt=function(e){function a(){var t;return(t=e.call(this)||this).stateCache=new Mt,t.nullTex2D=null,t.nullTexCube=null,t._canvas=null,t._webGLContextLostHandler=null,t._extensions=null,t._blitManager=null,t}t(a,e);var n=a.prototype;return n.initialize=function(e){var t=this;t._canvas=e.windowHandle,t._webGLContextLostHandler=t._onWebGLContextLost.bind(t),t._canvas.addEventListener(yt,t._webGLContextLostHandler);var r=Me.instance,a=r.gl,n=r.capabilities;t.stateCache.initialize(n.maxTextureUnits,n.maxVertexAttributes),t._extensions=wt(a),Nt(a);var s=C.RGBA8,i=C.DEPTH_STENCIL,u=a.getParameter(Fe.DEPTH_BITS),l=a.getParameter(Fe.STENCIL_BITS);u&&l?i=C.DEPTH_STENCIL:u&&(i=C.DEPTH),t._colorTexture=new Dt,t._colorTexture.initAsSwapchainTexture({swapchain:t,format:s,width:e.width,height:e.height}),t._depthStencilTexture=new Dt,t._depthStencilTexture.initAsSwapchainTexture({swapchain:t,format:i,width:e.width,height:e.height}),t.nullTex2D=r.createTexture(new ce(p.TEX2D,oe.SAMPLED,C.RGBA8,2,2,v.GEN_MIPMAP)),t.nullTexCube=r.createTexture(new ce(p.CUBE,oe.SAMPLED,C.RGBA8,2,2,v.GEN_MIPMAP,6));var _=new ge;_.texExtent.width=2,_.texExtent.height=2;var f=new Uint8Array(t.nullTex2D.size);f.fill(0),r.copyBuffersToTexture([f],t.nullTex2D,[_]),_.texSubres.layerCount=6,r.copyBuffersToTexture([f,f,f,f,f,f],t.nullTexCube,[_]),t._blitManager=new ht},n.destroy=function(){var e=this;e._canvas&&e._webGLContextLostHandler&&(e._canvas.removeEventListener(yt,e._webGLContextLostHandler),e._webGLContextLostHandler=null),e.nullTex2D&&(e.nullTex2D.destroy(),e.nullTex2D=null),e.nullTexCube&&(e.nullTexCube.destroy(),e.nullTexCube=null),e._blitManager&&(e._blitManager.destroy(),e._blitManager=null),e._extensions=null,e._canvas=null},n.resize=function(e,t){var r=this;r._colorTexture.width===e&&r._colorTexture.height===t||(c("Resizing swapchain: "+e+"x"+t),r._canvas.width=e,r._canvas.height=t,r._colorTexture.resize(e,t),r._depthStencilTexture.resize(e,t))},n._onWebGLContextLost=function(e){f(11e3),o(e)},r(a,[{key:"extensions",get:function(){return this._extensions}},{key:"blitManager",get:function(){return this._blitManager}}]),a}(Te);function kt(e,t,r){for(var a=0;a<t.length;++a)e[t[a]]=r}function Vt(e,t,r){for(var a=0;a<t.length;++a)e[t[a]]|=r}function Wt(e,t,r){for(var a=0;a<t.length;++a)e[t[a]]=r}var zt=e("WebGLDevice",function(e){function n(){var t;return(t=e.call(this)||this)._swapchain=null,t._context=null,t._bindingMappings=null,t._textureExclusive=new Array(C.COUNT),t}t(n,e);var s=n.prototype;return s.initialize=function(e){Me.setInstance(this),this._gfxAPI=Se.WEBGL;var t=this._bindingMappingInfo=e.bindingMappingInfo,r=[],n=[],s=t.setIndices[0];r[s]=0,n[s]=0;for(var i=1;i<t.setIndices.length;++i){var u=t.setIndices[i],l=t.setIndices[i-1];r[u]=t.maxBlockCounts[l]+r[l],n[u]=t.maxSamplerTextureCounts[l]+n[l]}for(var _=0;_<t.setIndices.length;++_){var f=t.setIndices[_];n[f]-=t.maxBlockCounts[f]}this._bindingMappings={blockOffsets:r,samplerTextureOffsets:n,flexibleSet:t.setIndices[t.setIndices.length-1]};var o=this._context=Ht(Re.canvas);if(!o)return a(16333),!1;this._queue=this.createQueue(new Ae(he.GRAPHICS)),this._cmdBuff=this.createCommandBuffer(new pe(this._queue));var E=o.getParameter.bind(o),g=this._caps;g.maxVertexAttributes=E(Fe.MAX_VERTEX_ATTRIBS),g.maxVertexUniformVectors=E(Fe.MAX_VERTEX_UNIFORM_VECTORS),g.maxFragmentUniformVectors=E(Fe.MAX_FRAGMENT_UNIFORM_VECTORS),g.maxTextureUnits=E(Fe.MAX_TEXTURE_IMAGE_UNITS),g.maxVertexTextureUnits=E(Fe.MAX_VERTEX_TEXTURE_IMAGE_UNITS),g.maxTextureSize=E(Fe.MAX_TEXTURE_SIZE),g.maxCubeMapTextureSize=E(Fe.MAX_CUBE_MAP_TEXTURE_SIZE),g.maxArrayTextureLayers=0,g.max3DTextureSize=0,g.maxUniformBufferBindings=16;var T=o.getSupportedExtensions(),S="";T&&T.forEach((function(e){S+=e+" "}));var R=wt(o);R.WEBGL_debug_renderer_info?(this._renderer=E(R.WEBGL_debug_renderer_info.UNMASKED_RENDERER_WEBGL),this._vendor=E(R.WEBGL_debug_renderer_info.UNMASKED_VENDOR_WEBGL)):(this._renderer=E(Fe.RENDERER),this._vendor=E(Fe.VENDOR));var A=E(Fe.VERSION),h=this._features;h.fill(!1),this.initFormatFeatures(R),R.EXT_blend_minmax&&(h[Be.BLEND_MINMAX]=!0),R.OES_element_index_uint&&(h[Be.ELEMENT_INDEX_UINT]=!0),R.ANGLE_instanced_arrays&&(h[Be.INSTANCED_ARRAYS]=!0),R.WEBGL_draw_buffers&&(h[Be.MULTIPLE_RENDER_TARGETS]=!0);var p="";return this.getFormatFeatures(C.ETC_RGB8)&&(p+="etc1 "),this.getFormatFeatures(C.ETC2_RGB8)&&(p+="etc2 "),this.getFormatFeatures(C.BC1)&&(p+="dxt "),this.getFormatFeatures(C.PVRTC_RGB2)&&(p+="pvrtc "),this.getFormatFeatures(C.ASTC_RGBA_4X4)&&(p+="astc "),c("WebGL device initialized."),c("RENDERER: "+this._renderer),c("VENDOR: "+this._vendor),c("VERSION: "+A),c("COMPRESSED_FORMAT: "+p),c("EXTENSIONS: "+S),!0},s.destroy=function(){this._queue&&(this._queue.destroy(),this._queue=null),this._cmdBuff&&(this._cmdBuff.destroy(),this._cmdBuff=null),this._swapchain=null},s.flushCommands=function(){},s.acquire=function(){},s.present=function(){var e=this._queue;this._numDrawCalls=e.numDrawCalls,this._numInstances=e.numInstances,this._numTris=e.numTris,e.clear()},s.initFormatFeatures=function(e){var t=this._formatFeatures;t.fill(de.NONE);var r=this._textureExclusive;r.fill(!0);var a=de.RENDER_TARGET|de.SAMPLED_TEXTURE|de.LINEAR_FILTER;kt(t,[C.RGB8,C.R5G6B5,C.RGBA8,C.RGBA4,C.RGB5A1],a),kt(t,[C.DEPTH,C.DEPTH_STENCIL],de.RENDER_TARGET),Wt(r,[C.R5G6B5,C.RGBA4,C.RGB5A1,C.DEPTH,C.DEPTH_STENCIL],!1),Vt(t,[C.R8I,C.RG8I,C.RGB8I,C.RGBA8I,C.R8UI,C.RG8UI,C.RGB8UI,C.RGBA8UI,C.R8I,C.RG8I,C.RGB8I,C.RGBA8I,C.R8UI,C.RG8UI,C.RGB8UI,C.RGBA8UI,C.R32F,C.RG32F,C.RGB32F,C.RGBA32F],de.VERTEX_ATTRIBUTE),e.EXT_sRGB&&(t[C.SRGB8]=a,t[C.SRGB8_A8]=a,r[C.SRGB8_A8]=!1),e.WEBGL_depth_texture&&(t[C.DEPTH]|=a,t[C.DEPTH_STENCIL]|=a),e.WEBGL_color_buffer_float&&(t[C.RGB32F]|=de.RENDER_TARGET,t[C.RGBA32F]|=de.RENDER_TARGET,r[C.RGB32F]=!1,r[C.RGBA32F]=!1),e.EXT_color_buffer_half_float&&(t[C.RGB16F]|=de.RENDER_TARGET,t[C.RGBA16F]|=de.RENDER_TARGET,r[C.RGB16F]=!1,r[C.RGBA16F]=!1),e.OES_texture_float&&(t[C.RGB32F]|=de.RENDER_TARGET|de.SAMPLED_TEXTURE,t[C.RGBA32F]|=de.RENDER_TARGET|de.SAMPLED_TEXTURE),e.OES_texture_half_float&&(t[C.RGB16F]|=de.RENDER_TARGET|de.SAMPLED_TEXTURE,t[C.RGBA16F]|=de.RENDER_TARGET|de.SAMPLED_TEXTURE),e.OES_texture_float_linear&&(t[C.RGB32F]|=de.LINEAR_FILTER,t[C.RGBA32F]|=de.LINEAR_FILTER),e.OES_texture_half_float_linear&&(t[C.RGB16F]|=de.LINEAR_FILTER,t[C.RGBA16F]|=de.LINEAR_FILTER);var n=de.SAMPLED_TEXTURE|de.LINEAR_FILTER;e.WEBGL_compressed_texture_etc1&&(t[C.ETC_RGB8]=n),e.WEBGL_compressed_texture_etc&&kt(t,[C.ETC2_RGB8,C.ETC2_RGBA8,C.ETC2_SRGB8,C.ETC2_SRGB8_A8,C.ETC2_RGB8_A1,C.ETC2_SRGB8_A1],n),e.WEBGL_compressed_texture_s3tc&&kt(t,[C.BC1,C.BC1_ALPHA,C.BC1_SRGB,C.BC1_SRGB_ALPHA,C.BC2,C.BC2_SRGB,C.BC3,C.BC3_SRGB],n),e.WEBGL_compressed_texture_pvrtc&&Vt(t,[C.PVRTC_RGB2,C.PVRTC_RGBA2,C.PVRTC_RGB4,C.PVRTC_RGBA4],n),e.WEBGL_compressed_texture_astc&&Vt(t,[C.ASTC_RGBA_4X4,C.ASTC_RGBA_5X4,C.ASTC_RGBA_5X5,C.ASTC_RGBA_6X5,C.ASTC_RGBA_6X6,C.ASTC_RGBA_8X5,C.ASTC_RGBA_8X6,C.ASTC_RGBA_8X8,C.ASTC_RGBA_10X5,C.ASTC_RGBA_10X6,C.ASTC_RGBA_10X8,C.ASTC_RGBA_10X10,C.ASTC_RGBA_12X10,C.ASTC_RGBA_12X12,C.ASTC_SRGBA_4X4,C.ASTC_SRGBA_5X4,C.ASTC_SRGBA_5X5,C.ASTC_SRGBA_6X5,C.ASTC_SRGBA_6X6,C.ASTC_SRGBA_8X5,C.ASTC_SRGBA_8X6,C.ASTC_SRGBA_8X8,C.ASTC_SRGBA_10X5,C.ASTC_SRGBA_10X6,C.ASTC_SRGBA_10X8,C.ASTC_SRGBA_10X10,C.ASTC_SRGBA_12X10,C.ASTC_SRGBA_12X12],n)},s.createCommandBuffer=function(e){var t=new(e.type===Ce.PRIMARY?vt:Bt);return t.initialize(e),t},s.createSwapchain=function(e){var t=new Xt;return this._swapchain=t,t.initialize(e),t},s.createBuffer=function(e){var t=new pt;return t.initialize(e),t},s.createTexture=function(e){var t=new Dt;return t.initialize(e),t},s.createDescriptorSet=function(e){var t=new Ie;return t.initialize(e),t},s.createShader=function(e){var t=new It;return t.initialize(e),t},s.createInputAssembler=function(e){var t=new Ct;return t.initialize(e),t},s.createRenderPass=function(e){var t=new Ot;return t.initialize(e),t},s.createFramebuffer=function(e){var t=new dt;return t.initialize(e),t},s.createDescriptorSetLayout=function(e){var t=new xt;return t.initialize(e),t},s.createPipelineLayout=function(e){var t=new mt;return t.initialize(e),t},s.createPipelineState=function(e){var t=new Pt;return t.initialize(e),t},s.createQueue=function(e){var t=new Gt;return t.initialize(e),t},s.getSampler=function(e){var t=ne.computeHash(e);return this._samplers.has(t)||this._samplers.set(t,new Lt(e,t)),this._samplers.get(t)},s.getSwapchains=function(){return[this._swapchain]},s.getGeneralBarrier=function(e){var t=xe.computeHash(e);return this._generalBarrierss.has(t)||this._generalBarrierss.set(t,new xe(e,t)),this._generalBarrierss.get(t)},s.getTextureBarrier=function(e){var t=me.computeHash(e);return this._textureBarriers.has(t)||this._textureBarriers.set(t,new me(e,t)),this._textureBarriers.get(t)},s.getBufferBarrier=function(e){var t=be.computeHash(e);return this._bufferBarriers.has(t)||this._bufferBarriers.set(t,new be(e,t)),this._bufferBarriers.get(t)},s.copyBuffersToTexture=function(e,t,r){gt(this,e,t.gpuTexture,r)},s.copyTextureToBuffers=function(e,t,r){Tt(this,e.gpuTexture,t,r)},s.copyTexImagesToTexture=function(e,t,r){ct(this,e,t.gpuTexture,r)},r(n,[{key:"gl",get:function(){return this._context}},{key:"extensions",get:function(){return this._swapchain.extensions}},{key:"stateCache",get:function(){return this._swapchain.stateCache}},{key:"nullTex2D",get:function(){return this._swapchain.nullTex2D}},{key:"nullTexCube",get:function(){return this._swapchain.nullTexCube}},{key:"textureExclusive",get:function(){return this._textureExclusive}},{key:"bindingMappings",get:function(){return this._bindingMappings}},{key:"blitManager",get:function(){return this._swapchain.blitManager}}]),n}(Re));Oe.WebGLDevice=zt}}}));
