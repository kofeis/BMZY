System.register(["./gc-object-CKHc4SnS.js","./index-C5lmLqDW.js","./global-exports-CR3GRnjt.js","./ui-renderer-DuhVjkfF.js","./sprite-frame-C6JiNTOk.js","./factory-D9_8ZCqM.js","./component-BaGvu7EF.js","./device-manager-BvjvoelW.js","./buffer-barrier-CuX_5NUR.js","./zlib.min-CyXMsivM.js","./ZipUtils-0TovRG4S.js","./scene-7MDSMR3j.js","./deprecated-Ca3AjUwj.js","./sprite-renderer-zme-rDJ_.js","./rendering-sub-mesh-CowWLfXC.js","./debug-view-CKetkq9d.js","./pipeline-state-manager-Cdpe3is6.js","./director-DIlqD2Nd.js","./prefab-DH0xadMc.js","./touch-DB0AR-Sc.js","./node-event-DTNosVQv.js","./deprecated-T2yM9nsJ.js","./renderer-9hfAnqUF.js","./create-mesh-hkbGggH3.js","./mesh-C8knhDLk.js","./wasm-minigame-DoCiKH-Y.js","./camera-component-Df61RNZm.js","./deprecated-C8l6Kwy8.js","./model-renderer-BcRDUYby.js"],(function(t){"use strict";var e,i,r,a,s,n,o,l,h,u,p,c,d,f,m,y,_,g,v,S,C,D,P,T,b,R,A,F,x,w,V,I,E,U,O,M,k,L,N;return{setters:[function(t){e=t.E,i=t._,r=t.a3,a=t.g,s=t.R,n=t.h,o=t.L,l=t.w,h=t.a,u=t.b},function(t){p=t.V,c=t.e,d=t.C,f=t.P,m=t.g,y=t.f,_=t.U,g=t.a,v=t.c,S=t.s,C=t.t,D=t.I,P=t.j},function(t){T=t.c,b=t.a},function(t){R=t.g,A=t.d,F=t.U,x=t.M},function(t){w=t.S},function(t){V=t.I},function(t){I=t.A,E=t.c},null,function(t){U=t.ab},function(t){O=t._},function(t){M=t.c},function(t){k=t.l,L=t.d,N=t.k},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var B=e({GRAVITY:0,RADIUS:1}),z=e({FREE:0,RELATIVE:1,GROUPED:2}),j=new p,G=new p,W=new p,Y=new p,H=new c,Z=R(A);function q(t){for(var e=0,i=t;i;)e+=i.eulerAngles.z,i=i.parent;return e}var X,J,K,Q=function(){this.pos=new p(0,0),this.startPos=new p(0,0),this.color=new d(0,0,0,255),this.deltaColor={r:0,g:0,b:0,a:255},this.size=0,this.deltaSize=0,this.rotation=0,this.deltaRotation=0,this.timeToLive=0,this.drawPos=new p(0,0),this.aspectRatio=1,this.dir=new p(0,0),this.radialAccel=0,this.tangentialAccel=0,this.angle=0,this.degreesPerSecond=0,this.radius=0,this.deltaRadius=0},$=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e.prototype.get=function(){return this._get()||new Q},e}(r),tt=new $((function(t){t.pos.set(p.ZERO),t.startPos.set(p.ZERO),t.color.set(0,0,0,255),t.deltaColor.r=t.deltaColor.g=t.deltaColor.b=0,t.deltaColor.a=255,t.size=0,t.deltaSize=0,t.rotation=0,t.deltaRotation=0,t.timeToLive=0,t.drawPos.set(p.ZERO),t.aspectRatio=1,t.dir.set(p.ZERO),t.radialAccel=0,t.tangentialAccel=0,t.angle=0,t.degreesPerSecond=0,t.radius=0,t.deltaRadius=0}),1024),et=function(){function t(t){this.particles=[],this.active=!1,this.uvFilled=0,this.finished=!1,this.renderData=null,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this._worldRotation=0,this.sys=t,this.particles=[],this.active=!1,this.readyToPlay=!0,this.finished=!1,this.elapsed=0,this.emitCounter=0,this.uvFilled=0,this._worldRotation=0}var e=t.prototype;return e.stop=function(){this.active=!1,this.readyToPlay=!1,this.elapsed=this.sys.duration,this.emitCounter=0},e.reset=function(){this.active=!0,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this.finished=!1;for(var t=this.particles,e=0;e<t.length;++e)tt.put(t[e]);t.length=0,this.renderData&&this.renderData.resize(0,0)},e.emitParticle=function(t){var e=this.sys,i=tt.get();this.particles.push(i),i.timeToLive=e.life+e.lifeVar*(f()-.5)*2;var r=i.timeToLive=Math.max(0,i.timeToLive);i.pos.x=e.sourcePos.x+e.posVar.x*(f()-.5)*2,i.pos.y=e.sourcePos.y+e.posVar.y*(f()-.5)*2;var a,s,n,o,l=e.startColor,h=e.startColorVar,u=e.endColor,p=e.endColorVar;i.color.r=a=m(l.r+h.r*(f()-.5)*2,0,255),i.color.g=s=m(l.g+h.g*(f()-.5)*2,0,255),i.color.b=n=m(l.b+h.b*(f()-.5)*2,0,255),i.color.a=o=m(l.a+h.a*(f()-.5)*2,0,255),i.deltaColor.r=(m(u.r+p.r*(f()-.5)*2,0,255)-a)/r,i.deltaColor.g=(m(u.g+p.g*(f()-.5)*2,0,255)-s)/r,i.deltaColor.b=(m(u.b+p.b*(f()-.5)*2,0,255)-n)/r,i.deltaColor.a=(m(u.a+p.a*(f()-.5)*2,0,255)-o)/r;var c=e.startSize+e.startSizeVar*(f()-.5)*2;if(c=Math.max(0,c),i.size=c,-1===e.endSize)i.deltaSize=0;else{var d=e.endSize+e.endSizeVar*(f()-.5)*2;d=Math.max(0,d),i.deltaSize=(d-c)/r}var g=e.startSpin+e.startSpinVar*(f()-.5)*2,v=e.endSpin+e.endSpinVar*(f()-.5)*2;i.rotation=g,i.deltaRotation=(v-g)/r,i.startPos.x=t.x,i.startPos.y=t.y,i.aspectRatio=e.aspectRatio||1;var S=y(e.angle+this._worldRotation+e.angleVar*(f()-.5)*2);if(e.emitterMode===B.GRAVITY){var C=e.speed+e.speedVar*(f()-.5)*2;i.dir.x=Math.cos(S),i.dir.y=Math.sin(S),i.dir.multiplyScalar(C),i.radialAccel=e.radialAccel+e.radialAccelVar*(f()-.5)*2,i.tangentialAccel=e.tangentialAccel+e.tangentialAccelVar*(f()-.5)*2,e.rotationIsDir&&(i.rotation=-_(Math.atan2(i.dir.y,i.dir.x)))}else{var D=e.startRadius+e.startRadiusVar*(f()-.5)*2,P=e.endRadius+e.endRadiusVar*(f()-.5)*2;i.radius=D,i.deltaRadius=-1===e.endRadius?0:(P-D)/r,i.angle=S,i.degreesPerSecond=y(e.rotatePerS+e.rotatePerSVar*(f()-.5)*2)}},e.updateUVs=function(t){var e=this.renderData;if(e&&this.sys._renderSpriteFrame){for(var i=e.vData,r=this.sys._renderSpriteFrame.uv,a=t?0:this.uvFilled,s=this.particles.length,n=a;n<s;n++){var o=n*Z*4;i[o+3]=r[0],i[o+4]=r[1],i[o+12]=r[2],i[o+13]=r[3],i[o+21]=r[4],i[o+22]=r[5],i[o+30]=r[6],i[o+31]=r[7]}this.uvFilled=s}},e.updateParticleBuffer=function(t,e,i,r){var a=i.vData,s=e.x,n=e.y,o=t.size,l=o,h=t.aspectRatio;h>1?l=o/h:o=l*h;var u=o/2,p=l/2;if(t.rotation){var d=-u,f=-p,m=u,_=p,g=-y(t.rotation),v=Math.cos(g),S=Math.sin(g);a[r]=d*v-f*S+s,a[r+1]=d*S+f*v+n,a[r+2]=0,a[r+9]=m*v-f*S+s,a[r+10]=m*S+f*v+n,a[r+11]=0,a[r+18]=d*v-_*S+s,a[r+19]=d*S+_*v+n,a[r+20]=0,a[r+27]=m*v-_*S+s,a[r+28]=m*S+_*v+n,a[r+29]=0}else a[r]=s-u,a[r+1]=n-p,a[r+2]=0,a[r+9]=s+u,a[r+10]=n-p,a[r+11]=0,a[r+18]=s-u,a[r+19]=n+p,a[r+20]=0,a[r+27]=s+u,a[r+28]=n+p,a[r+29]=0;var C=t.color;H.x=C.r/255,H.y=C.g/255,H.z=C.b/255,H.w=C.a/255,c.toArray(a,H,r+5),c.toArray(a,H,r+14),c.toArray(a,H,r+23),c.toArray(a,H,r+32)},e.step=function(t){var e=this.sys.assembler,i=this.sys,r=i.node,a=this.particles;if(t=t>e.maxParticleDeltaTime?e.maxParticleDeltaTime:t,r.updateWorldTransform(),i.positionType===z.FREE){this._worldRotation=q(r);var s=r.worldMatrix;j.x=s.m12,j.y=s.m13}else i.positionType===z.RELATIVE?(this._worldRotation=r.eulerAngles.z,j.x=r.position.x,j.y=r.position.y):this._worldRotation=0;if(this.active&&i.emissionRate){var n=1/i.emissionRate;for(a.length<i.totalParticles&&(this.emitCounter+=t);a.length<i.totalParticles&&this.emitCounter>n;)this.emitParticle(j),this.emitCounter-=n;this.elapsed+=t,-1!==i.duration&&i.duration<this.elapsed&&i.stopSystem()}var o=this.renderData;if(o){var l=a.length;o.reset(),this.requestData(4*l,6*l),l>this.uvFilled&&this.updateUVs();for(var h=0;h<a.length;){G.x=G.y=W.x=W.y=Y.x=Y.y=0;var u=a[h];if(u.timeToLive-=t,u.timeToLive>0){if(i.emitterMode===B.GRAVITY){var p=Y,c=G,d=W;(u.pos.x||u.pos.y)&&(c.set(u.pos),c.normalize()),d.set(c),c.multiplyScalar(u.radialAccel);var f=d.x;d.x=-d.y,d.y=f,d.multiplyScalar(u.tangentialAccel),p.set(c),p.add(d),p.add(i.gravity),p.multiplyScalar(t),u.dir.add(p),p.set(u.dir),p.multiplyScalar(t),u.pos.add(p)}else u.angle+=u.degreesPerSecond*t,u.radius+=u.deltaRadius*t,u.pos.x=-Math.cos(u.angle)*u.radius,u.pos.y=-Math.sin(u.angle)*u.radius;u.color.r+=u.deltaColor.r*t,u.color.g+=u.deltaColor.g*t,u.color.b+=u.deltaColor.b*t,u.color.a+=u.deltaColor.a*t,u.size+=u.deltaSize*t,u.size<0&&(u.size=0),u.rotation+=u.deltaRotation*t;var m=G;m.set(u.pos),i.positionType!==z.GROUPED&&m.add(u.startPos);var y=Z*h*4;this.updateParticleBuffer(u,m,o,y),++h}else{var _=a[h];h!==a.length-1&&(a[h]=a[a.length-1]),tt.put(_),a.length--,o.resize(o.vertexCount-4,o.indexCount-6)}}o.material=this.sys.getRenderMaterial(0),o.frame=this.sys._renderSpriteFrame,o.setRenderDrawInfoAttributes(),0!==a.length||this.active||this.readyToPlay||(this.finished=!0,i._finishedSimulation())}},e.requestData=function(t,e){if(this.renderData){var i=this.renderData.indexCount;this.renderData.request(t,e);for(var r=this.renderData.indexCount/6,a=this.renderData.iData,s=i;s<r;s++){var n=4*s;a[i++]=n,a[i++]=n+1,a[i++]=n+2,a[i++]=n+1,a[i++]=n+3,a[i++]=n+2}}},e.initDrawInfo=function(){var t;null==(t=this.renderData)||t.setRenderDrawInfoAttributes()},t}(),it=S,rt=t("ParticleAsset",v("cc.ParticleAsset")((J=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))||this).spriteFrame=K&&K(),e}return i(e,t),e}(I),K=g(J.prototype,"spriteFrame",[it],(function(){return null})),X=J))||X);T.ParticleAsset=rt;var at,st,nt,ot,lt,ht,ut,pt,ct,dt,ft,mt,yt,_t,gt,vt,St,Ct,Dt,Pt,Tt,bt,Rt,At,Ft,xt,wt,Vt,It,Et,Ut,Ot,Mt,kt,Lt,Nt,Bt,zt,jt,Gt,Wt,Yt,Ht,Zt,qt,Xt,Jt,Kt,Qt,$t,te,ee,ie,re=function(){function t(t){var e=this;this.pos=8,this.palette=[],this.imgData=[],this.transparency={indexed:[],rgb:[],grayscale:0},this.text={},this.width=0,this.height=0,this.bits=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.hasAlphaChannel=!1,this.pixelBitlength=0,this._decodedPalette=null;for(var i,r=this.data=t,s=0;;){s=this.readUInt32();var n=function(){for(var t=[],i=0;i<4;++i)t.push(String.fromCharCode(r[e.pos++]));return t}.call(this).join("");switch(n){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=r[this.pos++],this.colorType=r[this.pos++],this.compressionMethod=r[this.pos++],this.filterMethod=r[this.pos++],this.interlaceMethod=r[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(s);break;case"fcTL":i&&this.animation.frames.push(i),this.pos+=4,i={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32(),delay:0,disposeOp:0,blendOp:0,data:[]};var o=this.readUInt16(),l=this.readUInt16()||100;i.delay=1e3*o/l,i.disposeOp=r[this.pos++],i.blendOp=r[this.pos++];break;case"IDAT":case"fdAT":"fdAT"===n&&(this.pos+=4,s-=4),t=(null!=i?i.data:void 0)||this.imgData;for(var h=0;s>=0?h<s:h>s;s>=0?++h:--h)t.push(r[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:this.transparency.indexed=this.read(s);var u=255-this.transparency.indexed.length;if(u>0)for(var p=0;u>=0?p<u:p>u;u>=0?++p:--p)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(s)[0];break;case 2:this.transparency.rgb=this.read(s)}break;case"tEXt":var c=this.read(s),d=c.indexOf(0),f=String.fromCharCode.apply(String,c.slice(0,d));this.text[f]=String.fromCharCode.apply(String,c.slice(d+1));break;case"IEND":i&&this.animation.frames.push(i),this.colors=function(){switch(e.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3;default:return}}.call(this);var m=this.colorType;this.hasAlphaChannel=4===m||6===m;var y=this.colors+(this.hasAlphaChannel?1:0);return this.pixelBitlength=this.bits*y,this.colorSpace=function(){switch(e.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB";default:return}}.call(this),void(this.imgData instanceof Uint8Array||(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=s}if(this.pos+=4,this.pos>r.length)throw new Error(a(6017))}}var e=t.prototype;return e.read=function(t){var e=0,i=[];for(e=0;t>=0?e<t:e>t;t>=0?++e:--e)i.push(this.data[this.pos++]);return i},e.readUInt32=function(){var t=this.data;return t[this.pos++]<<24|t[this.pos++]<<16|t[this.pos++]<<8|t[this.pos++]},e.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},e.decodePixels=function(t){if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);t=new O.Inflate(t,{index:0,verify:!1}).decompress();for(var e=this.pixelBitlength/8,i=e*this.width,r=new Uint8Array(i*this.height),s=t.length,n=0,o=0,l=0,h=0,u=0,p=0,c=0,d=0,f=0,m=0,y=0,_=0,g=0,v=0,S=0,C=0,D=0,P=0,T=0;o<s;){switch(t[o++]){case 0:for(p=c=0;c<i;p=c+=1)r[l++]=t[o++];break;case 1:for(p=d=0;d<i;p=d+=1)h=t[o++],_=p<e?0:r[l-e],r[l++]=(h+_)%256;break;case 2:for(p=f=0;f<i;p=f+=1)h=t[o++],u=(p-p%e)/e,P=n&&r[(n-1)*i+u*e+p%e],r[l++]=(P+h)%256;break;case 3:for(p=m=0;m<i;p=m+=1)h=t[o++],u=(p-p%e)/e,_=p<e?0:r[l-e],P=n&&r[(n-1)*i+u*e+p%e],r[l++]=(h+Math.floor((_+P)/2))%256;break;case 4:for(p=y=0;y<i;p=y+=1)h=t[o++],u=(p-p%e)/e,_=p<e?0:r[l-e],0===n?P=T=0:(P=r[(n-1)*i+u*e+p%e],T=u&&r[(n-1)*i+(u-1)*e+p%e]),g=_+P-T,v=Math.abs(g-_),C=Math.abs(g-P),D=Math.abs(g-T),S=v<=C&&v<=D?_:C<=D?P:T,r[l++]=(h+S)%256;break;default:throw new Error(a(6018,t[o-1]))}n++}return r},e.copyToImageData=function(t,e){var i,r=this.hasAlphaChannel,a=this.colors;this.palette.length&&(i=null!=this._decodedPalette?this._decodedPalette:this._decodedPalette=this.decodePalette(),a=4,r=!0);var s=t.data||t,n=s.length,o=i||e,l=0,h=0,u=0,p=0;if(1===a)for(;l<n;)u=i?4*e[l/4]:h,p=o[u++],s[l++]=p,s[l++]=p,s[l++]=p,s[l++]=r?o[u++]:255,h=u;else for(;l<n;)u=i?4*e[l/4]:h,s[l++]=o[u++],s[l++]=o[u++],s[l++]=o[u++],s[l++]=r?o[u++]:255,h=u},e.decodePalette=function(){for(var t=this.palette,e=this.transparency.indexed||[],i=new Uint8Array((e.length||0)+t.length),r=0,a=0,s=0,n=0,o=0,l=t.length;o<l;n=o+=3)i[r++]=t[n],i[r++]=t[n+1],i[r++]=t[n+2],s=e[a++],i[r++]=null!=s?s:255;return i},e.render=function(t){t.width=this.width,t.height=this.height;var e=t.getContext("2d");if(e){var i=e.createImageData(this.width,this.height);this.copyToImageData(i,this.decodePixels(null)),e.putImageData(i,0,0)}},t}(),ae=function(){function t(){this._littleEndian=!1,this._tiffData=[],this._fileDirectories=[],this._canvas=null}var e=t.prototype;return e.getUint8=function(t){return this._tiffData[t]},e.getUint16=function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]},e.getUint32=function(t){var e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},e.checkLittleEndian=function(){var t=this.getUint16(0);if(18761===t)this._littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError(a(6019));this._littleEndian=!1}return this._littleEndian},e.hasTowel=function(){if(42!==this.getUint16(2))throw RangeError(a(6020));return!0},e.getFieldTypeName=function(t){return t in ne?ne[t]:null},e.getFieldTagName=function(t){return t in se?se[t]:(s(6021,t),"Tag"+t)},e.getFieldTypeLength=function(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:0},e.getFieldValues=function(t,e,i,r){var a=[],n=this.getFieldTypeLength(e);if(n*i<=4)!1===this._littleEndian?a.push(r>>>8*(4-n)):a.push(r);else for(var o=0;o<i;o++){var l=n*o;n>=8?-1!==["RATIONAL","SRATIONAL"].indexOf(e)?(a.push(this.getUint32(r+l)),a.push(this.getUint32(r+l+4))):s(8e3):a.push(this.getBytes(n,r+l))}return"ASCII"===e&&a.forEach((function(t,e,i){i[e]=String.fromCharCode(t)})),a},e.getBytes=function(t,e){if(t<=0)s(8001);else{if(t<=1)return this.getUint8(e);if(t<=2)return this.getUint16(e);if(t<=3)return this.getUint32(e)>>>8;if(t<=4)return this.getUint32(e);s(8002)}return 0},e.getBits=function(t,e,i){i=i||0;var r=e+Math.floor(i/8),a=i+t,n=32-t,o=0,l=0;return a<=0?s(6023):a<=8?(o=24+i,l=this.getUint8(r)):a<=16?(o=16+i,l=this.getUint16(r)):a<=32?(o=i,l=this.getUint32(r)):s(6022),{bits:l<<o>>>n,byteOffset:r+Math.floor(a/8),bitOffset:a%8}},e.parseFileDirectory=function(t){var e=this.getUint16(t),i={},r=0,a=0;for(r=t+2,a=0;a<e;r+=12,a++){var s=this.getUint16(r),n=this.getUint16(r+2),o=this.getUint32(r+4),l=this.getUint32(r+8),h=this.getFieldTagName(s),u=this.getFieldTypeName(n),p=this.getFieldValues(h,u,o,l);i[h]={type:u,values:p}}this._fileDirectories.push(i);var c=this.getUint32(r);0!==c&&this.parseFileDirectory(c)},e.clampColorSample=function(t,e){var i=Math.pow(2,8-e);return Math.floor(t*i+(i-1))},e.reset=function(){this._littleEndian=!1,this._tiffData=[],this._fileDirectories=[],this._canvas=null},e.parseTIFF=function(t,e){var i=this;if(e=e||b.document.createElement("canvas"),this._tiffData=t,this._canvas=e,this.checkLittleEndian(),this.hasTowel()){var r=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(r);var n=this._fileDirectories[0],o=n.ImageWidth.values[0],l=n.ImageLength.values[0];this._canvas.width=o,this._canvas.height=l;var h=[],u=n.Compression?n.Compression.values[0]:1,p=n.SamplesPerPixel.values[0],c=[],d=0,f=!1;n.BitsPerSample.values.forEach((function(t,e){c[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8==0&&(c[e].hasBytesPerSample=!0,c[e].bytesPerSample=t/8),d+=t}),this);var m=0;d%8==0&&(f=!0,m=d/8);var y,_=n.StripOffsets.values,g=_.length;if(n.StripByteCounts)y=n.StripByteCounts.values;else{if(s(8003),1!==g)throw Error(a(6024));y=[Math.ceil(o*l*d/8)]}for(var v=1,S=1,C=0;C<g;C++){var D=_[C];h[C]=[];for(var P=y[C],T=0,R=0,A=1,F=!0,x=[],w=0,V=0,I=0;T<P;T+=A)switch(u){case 1:x=[];for(var E=0;E<p;E++){var U=c[E];if(!U.hasBytesPerSample){var O=this.getBits(U.bitsPerSample,D+T,R);throw x.push(O.bits),T=O.byteOffset-D,R=O.bitOffset,RangeError(a(6025))}var M=U.bytesPerSample*E;x.push(this.getBytes(U.bytesPerSample,D+T+M))}if(h[C].push(x),!f)throw A=0,RangeError(a(6026));A=m;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(F){F=!1;var k=this.getUint8(D+T);k>=0&&k<=127?v=k+1:k>=-127&&k<=-1?S=1-k:F=!0}else{for(var L=this.getUint8(D+T),N=0;N<S;N++){var B=c[V];if(!B.hasBytesPerSample)throw RangeError(a(6025));I=I<<8*w|L,++w===B.bytesPerSample&&(x.push(I),I=w=0,V++),V===p&&(h[C].push(x),x=[],V=0)}0==--v&&(F=!0)}A=1}}var z=this._canvas.getContext("2d");if(z){z.fillStyle="rgba(255, 255, 255, 0)";var j=n.RowsPerStrip?n.RowsPerStrip.values[0]:l,G=h.length,W=l%j,Y=0===W?j:W,H=j,Z=0,q=n.PhotometricInterpretation.values[0],X=[],J=0;n.ExtraSamples&&(X=n.ExtraSamples.values,J=X.length);var K=[],Q=0;n.ColorMap&&(K=n.ColorMap.values,Q=Math.pow(2,c[0].bitsPerSample));for(var $=0;$<G;$++){$+1===G&&(H=Y);for(var tt=h[$].length,et=Z*$,it=0,rt=0;it<H&&rt<tt;it++)for(var at=function(){var t=h[$][rt],e=0,r=0,s=0,n=1;if(J>0)for(var o=0;o<J;o++)if(1===X[o]||2===X[o]){n=t[3+o]/256;break}switch(q){case 0:var l=0;c[0].hasBytesPerSample&&(l=Math.pow(16,2*c[0].bytesPerSample)),t.forEach((function(t,e,i){i[e]=l-t}));case 1:e=r=s=i.clampColorSample(t[0],c[0].bitsPerSample);break;case 2:e=i.clampColorSample(t[0],c[0].bitsPerSample),r=i.clampColorSample(t[1],c[1].bitsPerSample),s=i.clampColorSample(t[2],c[2].bitsPerSample);break;case 3:if(void 0===K)throw Error(a(6027));var u=t[0];e=i.clampColorSample(K[u],16),r=i.clampColorSample(K[Q+u],16),s=i.clampColorSample(K[2*Q+u],16);break;default:throw RangeError(a(6028,q))}z.fillStyle="rgba("+e+", "+r+", "+s+", "+n+")",z.fillRect(st,et+it,1,1)},st=0;st<o;st++,rt++)at();Z=H}}}},t}(),se={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},ne={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"},oe=new ae;function le(t){var e=t.parent,i=t.getComponent(De);return e&&i?le(e):t.getComponentsInChildren(De)}!function(t){t[t.JPG=0]="JPG",t[t.PNG=1]="PNG",t[t.TIFF=2]="TIFF",t[t.WEBP=3]="WEBP",t[t.PVR=4]="PVR",t[t.ETC=5]="ETC",t[t.S3TC=6]="S3TC",t[t.ATITC=7]="ATITC",t[t.TGA=8]="TGA",t[t.RAWDATA=9]="RAWDATA",t[t.UNKNOWN=10]="UNKNOWN"}(ie||(ie={}));var he,ue,pe,ce,de,fe,me,ye,_e,ge,ve,Se=parseInt,Ce=parseFloat,De=t("ParticleSystem2D",(at=v("cc.ParticleSystem2D"),st=C(rt),nt=C(w),ot=C(z),lt=C(B),ht=P("preview"),at((ee=function(t){function e(){var e;return(e=t.call(this)||this).duration=ct&&ct(),e.emissionRate=dt&&dt(),e.life=ft&&ft(),e.lifeVar=mt&&mt(),e.angle=yt&&yt(),e.angleVar=_t&&_t(),e.startSize=gt&&gt(),e.startSizeVar=vt&&vt(),e.endSize=St&&St(),e.endSizeVar=Ct&&Ct(),e.startSpin=Dt&&Dt(),e.startSpinVar=Pt&&Pt(),e.endSpin=Tt&&Tt(),e.endSpinVar=bt&&bt(),e.sourcePos=Rt&&Rt(),e.posVar=At&&At(),e.emitterMode=Ft&&Ft(),e.gravity=xt&&xt(),e.speed=wt&&wt(),e.speedVar=Vt&&Vt(),e.tangentialAccel=It&&It(),e.tangentialAccelVar=Et&&Et(),e.radialAccel=Ut&&Ut(),e.radialAccelVar=Ot&&Ot(),e.rotationIsDir=Mt&&Mt(),e.startRadius=kt&&kt(),e.startRadiusVar=Lt&&Lt(),e.endRadius=Nt&&Nt(),e.endRadiusVar=Bt&&Bt(),e.rotatePerS=zt&&zt(),e.rotatePerSVar=jt&&jt(),e.aspectRatio=1,e.playOnLoad=Gt&&Gt(),e.autoRemoveOnFinish=Wt&&Wt(),e._preview=Yt&&Yt(),e._custom=Ht&&Ht(),e._file=Zt&&Zt(),e._spriteFrame=qt&&qt(),e._totalParticles=Xt&&Xt(),e._startColor=Jt&&Jt(),e._startColorVar=Kt&&Kt(),e._endColor=Qt&&Qt(),e._endColorVar=$t&&$t(),e._positionType=te&&te(),e._stopped=!0,e._useFile=void 0,e.initProperties(),e._useFile=!1,e}i(e,t);var r=e.prototype;return r.onEnable=function(){t.prototype.onEnable.call(this),this._updateMaterial(),this._updatePositionType()},r.onDestroy=function(){t.prototype.onDestroy.call(this),this.autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._simulator.uvFilled=0,this.destroyRenderData()},r.initProperties=function(){this._previewTimer=null,this._focused=!1,this.aspectRatio=1,this._simulator=new et(this)},r.onFocusInEditor=function(){this._focused=!0;for(var t=le(this.node),e=0;e<t.length;++e)t[e]._startPreview()},r.onLostFocusInEditor=function(){this._focused=!1;for(var t=le(this.node),e=0;e<t.length;++e)t[e]._stopPreview()},r._startPreview=function(){this._preview&&this.resetSystem()},r._stopPreview=function(){this._preview&&(this.resetSystem(),this.stopSystem()),this._previewTimer&&clearInterval(this._previewTimer)},r.__preload=function(){t.prototype.__preload.call(this),this._custom&&this.spriteFrame&&!this._renderSpriteFrame?this._applySpriteFrame():this._file&&(this._custom?!this._getTexture()&&this._applyFile():this._applyFile()),this.playOnLoad&&this.resetSystem()},r.destroyRenderData=function(){if(this._simulator.renderData){var e=this._assembler;e&&e.removeData&&e.removeData(this._simulator.renderData),this._simulator.renderData=null}t.prototype.destroyRenderData.call(this)},r._flushAssembler=function(){var t=e.Assembler.getAssembler(this);if(this._assembler!==t&&(this._assembler=t),this._assembler&&this._assembler.createData){var i=this._simulator,r=i.renderData;r||(r=i.renderData=this._assembler.createData(this),i.uvFilled=0,r.particleInitRenderDrawInfo(this.renderEntity),i.initDrawInfo())}},r.lateUpdate=function(t){this._simulator.finished||this._simulator.step(t)},r.addParticle=function(){},r.stopSystem=function(){this._stopped=!0,this._simulator.stop()},r.resetSystem=function(){this._stopped=!1,this._simulator.reset(),this._markForUpdateRenderData()},r.isFull=function(){return this.particleCount>=this.totalParticles},r._applyFile=function(){var t=this._file;if(t){if(!t)return void n(6029);if(!this.isValid)return;this._plistFile=t.nativeUrl,this._custom||(this._spriteFrame!==t.spriteFrame&&(this.spriteFrame=t.spriteFrame),this._initWithDictionary(t._nativeAsset)),this._spriteFrame?!this._renderSpriteFrame&&this._spriteFrame&&this._applySpriteFrame():t.spriteFrame?this.spriteFrame=t.spriteFrame:this._custom&&this._initTextureWithDictionary(t._nativeAsset)}},r._initTextureWithDictionary=function(t){var e,i=this;if(t.spriteFrameUuid){var r=t.spriteFrameUuid;k.loadAny(r,(function(e,r){e?(t.spriteFrameUuid=void 0,i._initTextureWithDictionary(t),o(e)):i.spriteFrame=r}))}else{var a=E(this._plistFile,t.textureFileName||"");if(t.textureFileName)k.loadRemote(a,(function(e,r){e?(t.textureFileName=void 0,i._initTextureWithDictionary(t),o(e)):i.spriteFrame=r?w.createWithImage(r):w.createWithImage(L.get("white-texture"))}));else if(t.textureImageData){var s=t.textureImageData;if(!(s&&s.length>0))return!1;var n=a;this.file&&(n+="-"+this.file.uuid);var h=k.assets.get(n);if(!h){var u=M.unzipBase64AsArray(s,1);if(!u)return l(6030,this._file.name),!1;var p=(e=u).length>8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]?ie.PNG:e.length>2&&(73===e[0]&&73===e[1]||77===e[0]&&77===e[1]||255===e[0]&&216===e[1])?ie.TIFF:ie.UNKNOWN;if(p!==ie.TIFF&&p!==ie.PNG)return l(6031,this._file.name),!1;var c=b.document.createElement("canvas");p===ie.PNG?new re(u).render(c):(oe.parseTIFF(u,c),oe.reset()),h=new V(c),k.assets.add(n,h)}h||l(6032,this._file.name),this.spriteFrame=h?w.createWithImage(h):w.createWithImage(L.get("white-texture"))}}return!0},r._initWithDictionary=function(t){this._useFile=!0,this.totalParticles=Se(t.maxParticles||0),this.life=Ce(t.particleLifespan||0),this.lifeVar=Ce(t.particleLifespanVariance||0);var e=t.emissionRate;this.emissionRate=e||Math.min(this.totalParticles/this.life,Number.MAX_VALUE),this.duration=Ce(t.duration||0),this._srcBlendFactor=Se(t.blendFuncSource||U.SRC_ALPHA),this._dstBlendFactor=Se(t.blendFuncDestination||U.ONE_MINUS_SRC_ALPHA);var i=this._startColor;i.r=255*Ce(t.startColorRed||0),i.g=255*Ce(t.startColorGreen||0),i.b=255*Ce(t.startColorBlue||0),i.a=255*Ce(t.startColorAlpha||0);var r=this._startColorVar;r.r=255*Ce(t.startColorVarianceRed||0),r.g=255*Ce(t.startColorVarianceGreen||0),r.b=255*Ce(t.startColorVarianceBlue||0),r.a=255*Ce(t.startColorVarianceAlpha||0);var a=this._endColor;a.r=255*Ce(t.finishColorRed||0),a.g=255*Ce(t.finishColorGreen||0),a.b=255*Ce(t.finishColorBlue||0),a.a=255*Ce(t.finishColorAlpha||0);var s=this._endColorVar;if(s.r=255*Ce(t.finishColorVarianceRed||0),s.g=255*Ce(t.finishColorVarianceGreen||0),s.b=255*Ce(t.finishColorVarianceBlue||0),s.a=255*Ce(t.finishColorVarianceAlpha||0),this.startSize=Ce(t.startParticleSize||0),this.startSizeVar=Ce(t.startParticleSizeVariance||0),this.endSize=Ce(t.finishParticleSize||0),this.endSizeVar=Ce(t.finishParticleSizeVariance||0),this.positionType=Ce(void 0!==t.positionType?t.positionType:z.FREE),this.sourcePos.set(0,0),this.posVar.set(Ce(t.sourcePositionVariancex||0),Ce(t.sourcePositionVariancey||0)),this.angle=Ce(t.angle||0),this.angleVar=Ce(t.angleVariance||0),this.startSpin=Ce(t.rotationStart||0),this.startSpinVar=Ce(t.rotationStartVariance||0),this.endSpin=Ce(t.rotationEnd||0),this.endSpinVar=Ce(t.rotationEndVariance||0),this.emitterMode=Se(t.emitterType||B.GRAVITY),this.emitterMode===B.GRAVITY){this.gravity.set(Ce(t.gravityx||0),Ce(t.gravityy||0)),this.speed=Ce(t.speed||0),this.speedVar=Ce(t.speedVariance||0),this.radialAccel=Ce(t.radialAcceleration||0),this.radialAccelVar=Ce(t.radialAccelVariance||0),this.tangentialAccel=Ce(t.tangentialAcceleration||0),this.tangentialAccelVar=Ce(t.tangentialAccelVariance||0);var n=t.rotationIsDir||"";null!==n?(n=n.toString().toLowerCase(),this.rotationIsDir="true"===n||"1"===n):this.rotationIsDir=!1}else{if(this.emitterMode!==B.RADIUS)return l(6009),!1;this.startRadius=Ce(t.maxRadius||0),this.startRadiusVar=Ce(t.maxRadiusVariance||0),this.endRadius=Ce(t.minRadius||0),this.endRadiusVar=Ce(t.minRadiusVariance||0),this.rotatePerS=Ce(t.rotatePerSecond||0),this.rotatePerSVar=Ce(t.rotatePerSecondVariance||0)}return this._initTextureWithDictionary(t),!0},r._syncAspect=function(){if(this._renderSpriteFrame){var t=this._renderSpriteFrame.rect;this.aspectRatio=t.width/t.height}},r._applySpriteFrame=function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame?this._renderSpriteFrame.texture&&(this._simulator&&this._simulator.updateUVs(!0),this._syncAspect(),this._updateMaterial(),this._stopped=!1,this._markForUpdateRenderData()):this.resetSystem()},r._getTexture=function(){return this._renderSpriteFrame&&this._renderSpriteFrame.texture},r._updateMaterial=function(){if(this._customMaterial){this.setSharedMaterial(this._customMaterial,0);var t=this.getRenderMaterial(0).passes[0].blendState.targets[0];this._dstBlendFactor=t.blendDst,this._srcBlendFactor=t.blendSrc}var e=this.getMaterialInstance(0);e&&e.recompileShaders({USE_LOCAL:this._positionType!==z.FREE}),e&&e.passes.length>0&&this._updateBlendFunc()},r._finishedSimulation=function(){this.resetSystem(),this.stopSystem(),this._markForUpdateRenderData(),this.autoRemoveOnFinish&&this._stopped&&this.node.destroy()},r._canRender=function(){return t.prototype._canRender.call(this)&&!this._stopped&&null!==this._renderSpriteFrame&&void 0!==this._renderSpriteFrame},r._render=function(t){this._positionType===z.RELATIVE?t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,this.node.parent):this.positionType===z.GROUPED?t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,this.node):t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,null)},r._updatePositionType=function(){this._positionType===z.RELATIVE?(this._renderEntity.setRenderTransform(this.node.parent),this._renderEntity.setUseLocal(!0)):this.positionType===z.GROUPED?(this._renderEntity.setRenderTransform(this.node),this._renderEntity.setUseLocal(!0)):(this._renderEntity.setRenderTransform(null),this._renderEntity.setUseLocal(!1))},h(e,[{key:"custom",get:function(){return this._custom},set:function(t){this._custom!==t&&(this._custom=t,this._applyFile(),this._updateMaterial())}},{key:"file",get:function(){return this._file},set:function(t){this._file!==t&&(this._file=t,t?this._applyFile():this.custom=!0)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._renderSpriteFrame!==t&&(this._renderSpriteFrame=t,t&&!t._uuid||(this._spriteFrame=t),this._applySpriteFrame())}},{key:"particleCount",get:function(){return this._simulator.particles.length}},{key:"totalParticles",get:function(){return this._totalParticles},set:function(t){this._totalParticles!==t&&(this._totalParticles=t)}},{key:"startColor",get:function(){return this._startColor},set:function(t){this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._startColor.a=t.a}},{key:"startColorVar",get:function(){return this._startColorVar},set:function(t){this._startColorVar.r=t.r,this._startColorVar.g=t.g,this._startColorVar.b=t.b,this._startColorVar.a=t.a}},{key:"color",get:function(){return this._color},set:function(){}},{key:"endColor",get:function(){return this._endColor},set:function(t){this._endColor.r=t.r,this._endColor.g=t.g,this._endColor.b=t.b,this._endColor.a=t.a}},{key:"endColorVar",get:function(){return this._endColorVar},set:function(t){this._endColorVar.r=t.r,this._endColorVar.g=t.g,this._endColorVar.b=t.b,this._endColorVar.a=t.a}},{key:"positionType",get:function(){return this._positionType},set:function(t){this._positionType=t,this._updateMaterial(),this._updatePositionType()}},{key:"preview",get:function(){return this._preview},set:function(t){t?this._startPreview():this._stopPreview(),this._preview=t}},{key:"stopped",get:function(){return this._stopped}},{key:"active",get:function(){return this._simulator.active}},{key:"assembler",get:function(){return this._assembler}}]),e}(F),ee.EmitterMode=B,ee.PositionType=z,ee.DURATION_INFINITY=-1,ee.START_SIZE_EQUAL_TO_END_SIZE=-1,ee.START_RADIUS_EQUAL_TO_END_RADIUS=-1,u((pt=ee).prototype,"file",[st],Object.getOwnPropertyDescriptor(pt.prototype,"file"),pt.prototype),u(pt.prototype,"spriteFrame",[nt],Object.getOwnPropertyDescriptor(pt.prototype,"spriteFrame"),pt.prototype),ct=g(pt.prototype,"duration",[S],(function(){return-1})),dt=g(pt.prototype,"emissionRate",[S],(function(){return 10})),ft=g(pt.prototype,"life",[S],(function(){return 1})),mt=g(pt.prototype,"lifeVar",[S],(function(){return 0})),u(pt.prototype,"color",[D],Object.getOwnPropertyDescriptor(pt.prototype,"color"),pt.prototype),yt=g(pt.prototype,"angle",[S],(function(){return 90})),_t=g(pt.prototype,"angleVar",[S],(function(){return 20})),gt=g(pt.prototype,"startSize",[S],(function(){return 50})),vt=g(pt.prototype,"startSizeVar",[S],(function(){return 0})),St=g(pt.prototype,"endSize",[S],(function(){return 0})),Ct=g(pt.prototype,"endSizeVar",[S],(function(){return 0})),Dt=g(pt.prototype,"startSpin",[S],(function(){return 0})),Pt=g(pt.prototype,"startSpinVar",[S],(function(){return 0})),Tt=g(pt.prototype,"endSpin",[S],(function(){return 0})),bt=g(pt.prototype,"endSpinVar",[S],(function(){return 0})),Rt=g(pt.prototype,"sourcePos",[S],(function(){return p.ZERO.clone()})),At=g(pt.prototype,"posVar",[S],(function(){return p.ZERO.clone()})),u(pt.prototype,"positionType",[ot],Object.getOwnPropertyDescriptor(pt.prototype,"positionType"),pt.prototype),Ft=g(pt.prototype,"emitterMode",[S,lt],(function(){return B.GRAVITY})),xt=g(pt.prototype,"gravity",[S],(function(){return p.ZERO.clone()})),wt=g(pt.prototype,"speed",[S],(function(){return 180})),Vt=g(pt.prototype,"speedVar",[S],(function(){return 50})),It=g(pt.prototype,"tangentialAccel",[S],(function(){return 80})),Et=g(pt.prototype,"tangentialAccelVar",[S],(function(){return 0})),Ut=g(pt.prototype,"radialAccel",[S],(function(){return 0})),Ot=g(pt.prototype,"radialAccelVar",[S],(function(){return 0})),Mt=g(pt.prototype,"rotationIsDir",[S],(function(){return!1})),kt=g(pt.prototype,"startRadius",[S],(function(){return 0})),Lt=g(pt.prototype,"startRadiusVar",[S],(function(){return 0})),Nt=g(pt.prototype,"endRadius",[S],(function(){return 0})),Bt=g(pt.prototype,"endRadiusVar",[S],(function(){return 0})),zt=g(pt.prototype,"rotatePerS",[S],(function(){return 0})),jt=g(pt.prototype,"rotatePerSVar",[S],(function(){return 0})),Gt=g(pt.prototype,"playOnLoad",[S],(function(){return!0})),Wt=g(pt.prototype,"autoRemoveOnFinish",[S],(function(){return!1})),Yt=g(pt.prototype,"_preview",[ht],(function(){return!0})),Ht=g(pt.prototype,"_custom",[S],(function(){return!1})),Zt=g(pt.prototype,"_file",[S],(function(){return null})),qt=g(pt.prototype,"_spriteFrame",[S],(function(){return null})),Xt=g(pt.prototype,"_totalParticles",[S],(function(){return 150})),Jt=g(pt.prototype,"_startColor",[S],(function(){return new d(255,255,255,255)})),Kt=g(pt.prototype,"_startColorVar",[S],(function(){return new d(0,0,0,0)})),Qt=g(pt.prototype,"_endColor",[S],(function(){return new d(255,255,255,0)})),$t=g(pt.prototype,"_endColorVar",[S],(function(){return new d(0,0,0,0)})),te=g(pt.prototype,"_positionType",[S],(function(){return z.FREE})),ut=pt))||ut)),Pe=function(){function t(t,e){this.point=new p,this.dir=new p,this.distance=0,this.time=0,t&&this.point.set(t),e&&this.dir.set(e)}var e=t.prototype;return e.setPoint=function(t,e){this.point.x=t,this.point.y=e},e.setDir=function(t,e){this.dir.x=t,this.dir.y=e},t}(),Te=t("MotionStreak",(he=v("cc.MotionStreak"),ue=C(N),he((ve=function(t){function e(){var e;return(e=t.call(this)||this)._preview=de&&de(),e._fadeTime=fe&&fe(),e._minSeg=me&&me(),e._stroke=ye&&ye(),e._texture=_e&&_e(),e._fastMode=ge&&ge(),e._points=[],e}i(e,t);var r=e.prototype;return r.onEnable=function(){t.prototype.onEnable.call(this),this.reset()},r._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material,this._updateColor())},r.onFocusInEditor=function(){this._preview&&this.reset()},r.onLostFocusInEditor=function(){this._preview&&this.reset()},r.reset=function(){this._points.length=0,this._renderData&&this._renderData.clear()},r.lateUpdate=function(t){this._assembler&&this._assembler.update&&this._assembler.update(this,t)},r._render=function(t){t.commitComp(this,this._renderData,this._texture,this._assembler,null)},h(e,[{key:"preview",get:function(){return this._preview},set:function(t){this._preview=t,this.reset()}},{key:"fadeTime",get:function(){return this._fadeTime},set:function(t){this._fadeTime=t,this.reset()}},{key:"minSeg",get:function(){return this._minSeg},set:function(t){this._minSeg=t}},{key:"stroke",get:function(){return this._stroke},set:function(t){this._stroke=t}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t)}},{key:"fastMode",get:function(){return this._fastMode},set:function(t){this._fastMode=t}},{key:"points",get:function(){return this._points}}]),e}(F),ve.Point=Pe,u((ce=ve).prototype,"texture",[ue],Object.getOwnPropertyDescriptor(ce.prototype,"texture"),ce.prototype),de=g(ce.prototype,"_preview",[S],(function(){return!1})),fe=g(ce.prototype,"_fadeTime",[S],(function(){return 1})),me=g(ce.prototype,"_minSeg",[S],(function(){return 1})),ye=g(ce.prototype,"_stroke",[S],(function(){return 64})),_e=g(ce.prototype,"_texture",[S],(function(){return null})),ge=g(ce.prototype,"_fastMode",[S],(function(){return!1})),pe=ce))||pe)),be=new p,Re=new p,Ae=null;function Fe(t,e){return t.x=-e.y,t.y=e.x,t}var xe=new(function(){function t(){}var e=t.prototype;return e.createData=function(t){var e=t.requestRenderData();return e.dataLength=4,e.resize(16,42),e},e.update=function(t,e){var i,r=t.stroke/2,a=t.node.worldMatrix,s=a.m12,n=a.m13,o=t.points;if(o.length>1){var l=o[0],h=l.point.x-s,u=l.point.y-n;h*h+u*u<t.minSeg&&(i=l)}i||(i=new Pe,o.unshift(i)),i.setPoint(s,n),i.time=t.fadeTime+e;var c,d=0;if(!(o.length<2)){var f=t.renderData;this.updateRenderDataCache(t,f);var m=t.color,y=m.r,_=m.g,g=m.b,v=m.a,S=o[1];S.distance=p.subtract(Re,i.point,S.point).length(),Re.normalize(),S.setDir(Re.x,Re.y),i.setDir(Re.x,Re.y),f.dataLength=2*o.length;for(var C=f.data,D=t.fadeTime,P=!1,T=o.length-1;T>=0;T--){var b=o[T],R=b.point,A=b.dir;if(b.time-=e,b.time<0)o.splice(T,1);else{var F=b.time/D,x=o[T-1];if(!P){if(!x){o.splice(T,1);continue}R.x=x.point.x-A.x*F,R.y=x.point.y-A.y*F}P=!0,Fe(be,A);var w=F*v,V=d;C[V].x=R.x+be.x*r,C[V].y=R.y+be.y*r,C[V].u=1,C[V].v=F,C[V].color.set(y,_,g,w),C[V+=1].x=R.x-be.x*r,C[V].y=R.y-be.y*r,C[V].u=0,C[V].v=F,C[V].color.set(y,_,g,w),d+=2}}c=d<=2?0:3*(d-2),f.resize(d,c)}},e.updateWorldVertexAllData=function(t){for(var e=t.renderData,i=e.floatStride,r=e.data,a=e.chunk.vb,s=0;s<r.length;s++){var n=s*i;a[n+0]=r[s].x,a[n+1]=r[s].y,a[n+2]=r[s].z,a[n+3]=r[s].u,a[n+4]=r[s].v,d.toArray(a,r[s].color,n+5)}},e.createQuadIndices=function(t,e){var i=t.renderData.chunk.meshBuffer.indexOffset;Ae=null,Ae=new Uint16Array(e);for(var r=0,a=e;r<a;r+=2){var s=0+r;Ae[i++]=s,Ae[i++]=s+2,Ae[i++]=s+1,Ae[i++]=s+1,Ae[i++]=s+2,Ae[i++]=s+3}},e.updateRenderDataCache=function(t,e){e.passDirty&&e.updatePass(t),e.nodeDirty&&e.updateNode(t),e.textureDirty&&t.texture&&(e.updateTexture(t.texture),e.material=t.getRenderMaterial(0)),e.hashDirty&&e.updateHash()},e.fillBuffers=function(t){for(var e=t.renderData,i=e.chunk,r=e.data,a=e.vertexCount,s=e.indexCount,n=i.vb,o=0,l=0;l<a;l++){var h=r[l];n[o++]=h.x,n[o++]=h.y,n[o++]=h.z,n[o++]=h.u,n[o++]=h.v,d.toArray(n,h.color,o),o+=4}i.bufferId;for(var u=i.vertexOffset,p=i.meshBuffer,c=i.meshBuffer.iData,f=p.indexOffset,m=0,y=s;m<y;m+=2){var _=u+m;c[f++]=_,c[f++]=_+2,c[f++]=_+1,c[f++]=_+1,c[f++]=_+2,c[f++]=_+3}p.indexOffset+=e.indexCount,p.setDirty()},t}()),we=t("MotionStreakAssemblerManager",{getAssembler:function(){return xe}});Te.Assembler=we;var Ve=new(function(){function t(){this.maxParticleDeltaTime=0}var e=t.prototype;return e.createData=function(){return x.add()},e.removeData=function(t){x.remove(t)},t}()),Ie=t("ParticleSystem2DAssembler",{getAssembler:function(){return Ve.maxParticleDeltaTime||(Ve.maxParticleDeltaTime=T.game.frameTime/1e3*2),Ve}});De.Assembler=Ie}}}));
