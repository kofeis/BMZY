System.register(["./gc-object-CKHc4SnS.js","./index-C5lmLqDW.js","./global-exports-CR3GRnjt.js","./sprite-frame-C6JiNTOk.js","./sprite-BN1AMlyy.js","./rendering-sub-mesh-CowWLfXC.js","./component-BaGvu7EF.js","./factory-D9_8ZCqM.js","./debug-view-CKetkq9d.js","./scene-7MDSMR3j.js","./device-manager-BvjvoelW.js","./buffer-barrier-CuX_5NUR.js","./director-DIlqD2Nd.js","./ui-renderer-DuhVjkfF.js"],(function(t){"use strict";var e,i,n,r,s,o,a,h,u,l,f,c,d,p,_,g,y,m,v,x,b,D,F,A,w,S,O,T,k,R,C,E,L,H,I,z;return{setters:[function(t){e=t._,i=t.a,n=t.b,r=t.a3,s=t.w,o=t.j,a=t.ap,h=t.A,u=t.t},function(t){l=t.c,f=t.a,c=t.I,d=t.b1,p=t.s,_=t.t,g=t.C,y=t.B,m=t.k,v=t.V,x=t.i},function(t){b=t.c,D=t.a},function(t){F=t.S},null,null,function(t){A=t.A,w=t.e},function(t){S=t.d,O=t.f,T=t.P,k=t.I},null,function(t){R=t.k,C=t.i},null,function(t){E=t.f},function(t){L=t.d,H=t.D},function(t){I=t.I,z=t.U}],execute:function(){var B;t({a:et,b:it,c:nt,d:function(t){return/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/.test(t)||/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g.test(t)||/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/.test(t)},e:G,f:function(t,e,i,n){var r=[];if(0===t.length||i<0)return r.push(""),r;for(var s=t;e>i&&s.length>1;){for(var o=s.length*(i/e)|0,a=ot(s,o),h=e-n(a),u=a,l=0,f=0;h>i&&f++<100;)o*=i/h,h=e-n(a=ot(s,o|=0));for(f=0;a&&h<=i&&f++<100;){var c=$.exec(a);u=a,h=e-n(a=ot(s,o+=l=c?c[0].length:1))}0==(o-=l)?(o=1,u=ot(s,1)):1===o&&s[0]>="\ud800"&&s[0]<="\udbff"&&(o=2,u=ot(s,2));var d=ot(s,0,o),p=void 0;q.test(u||a)&&(0==(o-=(p=J.exec(d))?p[0].length:0)&&(o=1),u=ot(s,o),d=ot(s,0,o)),tt.test(u)&&(p=Q.exec(d))&&d!==p[0]&&(u=ot(s,o-=p[0].length),d=ot(s,0,o)),(0===r.length||(d=d.trim()).length>0)&&r.push(d),e=n(s=u||a)}return(0===r.length||(s=s.trim()).length>0)&&r.push(s),r},g:function(t){for(var e=t.length,i=0,n=0,r=0;r<e;r++)8205!==(n=t.charCodeAt(r))&&(n>=55296&&n<=56319&&(n=t.charCodeAt(r+1))>=56320&&n<=57343?((r+2>=e||8205!==t.charCodeAt(r+2))&&i++,r++):i++);return i},i:function(t){var e=t.charCodeAt(0);return e>=9&&e<=13||32===e||133===e||160===e||5760===e||e>=8192&&e<=8202||8232===e||8233===e||8239===e||8287===e||12288===e},k:function(t){var e=t.color.toHEX(),i="";return t.isOutlined&&t.margin>0&&(i=i+t.margin+t.out.toHEX()),""+t.fontSize+t.fontFamily+e+i},q:function(t){return tt.test(t)},r:function(t){return Q.test(t)},t:function(t){return tt.exec(t)},u:function(t){return Q.exec(t)}});var U,W,P,j=t("n",l("cc.Font")(B=function(t){function i(e){return t.call(this,e)||this}return e(i,t),i}(A))||B);b.Font=j;var N=t("T",l("cc.TTFFont")((W=function(t){function n(){var e;return(e=t.call(this)||this)._fontFamily=P&&P(),e}return e(n,t),n.prototype.initDefault=function(e){this._fontFamily="Arial",t.prototype.initDefault.call(this,e)},i(n,[{key:"_nativeAsset",get:function(){return this._fontFamily},set:function(t){this._fontFamily=t||"Arial"}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,__nativeName__:this._native,ext:w(this._native),__isNative__:!0}}}]),n}(j),P=f(W.prototype,"_fontFamily",[p],(function(){return null})),n(W.prototype,"_nativeAsset",[c,d],Object.getOwnPropertyDescriptor(W.prototype,"_nativeAsset"),W.prototype),n(W.prototype,"_nativeDep",[c],Object.getOwnPropertyDescriptor(W.prototype,"_nativeDep"),W.prototype),U=W))||U);b.TTFFont=N;var M=t("B",.26),X=0,Y=t("M",(M+1)/2-M);function G(){return X}var V=new r(2);V.get=function(){return this._get()||{key:"",value:0,prev:null,next:null}};var Z=new(t("p",function(){function t(t){this.count=0,this.limit=0,this.datas={},this.head=null,this.tail=null,this.limit=t}var e=t.prototype;return e.moveToHead=function(t){t.next=this.head,t.prev=null,this.head&&(this.head.prev=t),this.head=t,this.tail||(this.tail=t),this.count++,this.datas[t.key]=t},e.put=function(t,e){var i=V.get();if(i.key=t,i.value=e,this.count>=this.limit){var n=this.tail;delete this.datas[n.key],this.count--,this.tail=n.prev,this.tail.next=null,n.prev=null,n.next=null,V.put(n)}this.moveToHead(i)},e.remove=function(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev,delete this.datas[t.key],this.count--},e.get=function(t){var e=this.datas[t];return e?(this.remove(e),this.moveToHead(e),e.value):null},e.clear=function(){this.count=0,this.datas={},this.head=null,this.tail=null},e.has=function(t){return!!this.datas[t]},e.delete=function(t){var e=this.datas[t];this.remove(e)},t}()))(100),$=/([a-zA-Z0-9√Ñ√ñ√ú√§√∂√º√ü√©√®√ß√†√π√™√¢√Æ√¥√ª–∞-—è–ê-–Ø–Å—ë]+|\S)/,q=/^[!,.:;'}\]%\?>„ÄÅ‚Äò‚Äú„ÄãÔºü„ÄÇÔºåÔºÅ]/,K="[a-zA-Z0-9√Ñ√ñ√ú√§√∂√º√ü√©√®√ß√†√π√™√¢√Æ√¥√ª–∞√≠√¨√ç√å√Ø√Å√Ä√°√†√â√à√í√ì√≤√≥≈ê≈ë√ô√ö≈∞√∫≈±√±√ë√¶√Ü≈ì≈í√É√Ç√£√î√µƒõ≈°ƒç≈ô≈æ√Ω√°√≠√©√≥√∫≈Ø≈•ƒè≈àƒö≈†ƒå≈ò≈Ω√Å√ç√â√ì√ö≈§≈º≈∫≈õ√≥≈Ñ≈ÇƒôƒáƒÖ≈ª≈π≈ö√ì≈É≈ÅƒòƒÜƒÑ-—è–ê-–Ø–Å—ë√°√†·∫£·∫°√£ƒÉ·∫Ø·∫±·∫≥·∫µ·∫∑√¢·∫•·∫ß·∫©·∫´·∫≠√©√®·∫ª·∫Ω·∫π√™·∫ø·ªÅ·ªÉ·ªÖ·ªái√≠√¨·ªâƒ©·ªã√≥√≤·ªè√µ·ªç√¥·ªë·ªì·ªï·ªó·ªô∆°·ªõ·ªù·ªü·ª°·ª£√∫√π·ªß≈©·ª•∆∞·ª©·ª´·ª≠·ªØ·ª±√Ω·ª≥·ª∑·ªπ·ªµƒë√Å√Ä·∫¢·∫†√ÉƒÇ·∫Æ·∫∞·∫≤·∫¥·∫∂√Ç·∫§·∫¶·∫®·∫™·∫¨√â√à·∫∫·∫º·∫∏√ä·∫æ·ªÄ·ªÇ·ªÑ·ªÜI√ç√å·ªàƒ®·ªä√ì√í·ªé√ï·ªå√î·ªê·ªí·ªî·ªñ·ªò∆†·ªö·ªú·ªû·ª†·ª¢√ö√ô·ª¶≈®·ª§∆Ø·ª®·ª™·ª¨·ªÆ·ª∞√ù·ª≤·ª∂·ª∏·ª¥ƒê]",J=new RegExp("("+K+"+|\\S)$"),Q=new RegExp(K+"+$"),tt=new RegExp("^"+K);function et(t,e,i){var n=(i||t.font)+"üéÆ"+e,r=Z.get(n);if(null!==r)return r;var s=t.measureText(e),o=s&&s.width||0;return Z.put(n,o),o}function it(t,e){for(var i=t.length,n=0,r=0,s=0,o=0,a=0;a<i;a++)if(8205!==(o=t.charCodeAt(a)))if(o>=55296&&o<=56319&&(n++,(o=t.charCodeAt(a+1))>=56320&&o<=57343)){if(n++,a+2>=i||8205!==t.charCodeAt(a+2)){if(e===r)return t.slice(s,s+n);s+=n,r++,n=0}a++}else{if(e===r)return t.charAt(a);s=a+1,r++,n=0}else n++;return""}function nt(t,e){var i=it(t,e);if(1===i.length)return""+i.charCodeAt(0);for(var n="",r=0;r<i.length;r++)n+=""+i.charCodeAt(r);return""+n}function rt(t,e){if(e>=t.length)return t.length;for(var i=e,n=t[i];i>=0&&("‚Äç"===n&&(n=t[--i]),n>="\udc00"&&n<="\udfff"&&i-1>=0&&(n=t[--i]),n>="\ud800"&&n<="\udbff")&&i-1>=0&&"‚Äç"===t[i-1];)n=t[--i];return i}function st(t,e){for(var i=e,n=e,r=t[n];n<t.length;)if("‚Äç"===r&&(i++,(r=t[++n])>="\ud800"&&r<="\udbff"&&(i++,r=t[++n])),r>="\ud800"&&r<="\udbff")i++,r=t[++n];else{if(!(r>="\udc00"&&r<="\udfff"))break;if(r=t[++n],!(n<t.length&&"‚Äç"===t[n]))break;i++,r=t[n]}return i}function ot(t,e,i){var n=rt(t,e);n<e&&(n=st(t,e)+1);var r=i;if(void 0!==i){r=st(t,i=Math.max(0,i-1));var s=rt(t,i);s<n||s===n&&e>n?r=n:r+=1}return t.substring(n,r)}var at,ht=D.document,ut=null,lt=-1,ft="BES bswy:->@123‰∏Å„ÅÅ·ÑÅ",ct=Object.create(null),dt=[],pt=3e3,_t=function(){if(void 0===at)if("FontFace"in D){var t=/Gecko.*Firefox\/(\d+)/.exec(D.navigator.userAgent),e=/OS X.*Version\/10\..*Safari/.exec(D.navigator.userAgent)&&/Apple/.exec(D.navigator.vendor);at=t?parseInt(t[1],10)>42:!e}else at=!1;return at};function gt(){for(var t=!0,e=Date.now(),i=dt.length-1;i>=0;i--){var n=dt[i],r=n.fontFamilyName;if(e-n.startTime>pt)s(4933,r),n.onComplete(null,r),dt.splice(i,1);else{var o=n.refWidth,a="40px "+r;ut.font=a,o!==et(ut,ft,a)?(dt.splice(i,1),n.onComplete(null,r)):t=!1}}t&&(clearInterval(lt),lt=-1)}function yt(t,e,i){var n=mt(t);if(ct[n])i(null,n);else{if(!ut){var r=ht.createElement("canvas");r.width=100,r.height=100,ut=r.getContext("2d")}var o="40px "+n,a=ht.createElement("style");a.type="text/css";var h="";Number.isNaN(n)?h+="@font-face { font-family:"+n+"; src:":h+='@font-face { font-family:"'+n+'"; src:',h+='url("'+t+'");',a.textContent=h+"}",ht.body.appendChild(a);var u,l,f,c,d,p,_=ht.createElement("div"),g=_.style;if(g.fontFamily=n,_.innerHTML=".",g.position="absolute",g.left="-100px",g.top="-100px",ht.body.appendChild(_),_t())u=Date.now(),l=n,f=i,c=new Promise((function(t,e){!function i(){Date.now()-u>=pt?e():ht.fonts.load("40px "+l).then((function(e){e.length>=1?t():setTimeout(i,100)}),(function(){e()}))}()})),d=null,p=new Promise((function(t,e){d=setTimeout(e,pt)})),Promise.race([p,c]).then((function(){d&&(clearTimeout(d),d=null),f(null,l)}),(function(){s(4933,l),f(null,l)}));else{var y={fontFamilyName:n,refWidth:et(ut,ft,o),onComplete:i,startTime:Date.now()};dt.push(y),-1===lt&&(lt=setInterval(gt,100))}ct[n]=a}}function mt(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var i,n=t.lastIndexOf("/");return-1!==(i=-1===n?t.substring(0,e)+"_LABEL":t.substring(n+1,e)+"_LABEL").indexOf(" ")&&(i='"'+i+'"'),i}function vt(t,e,i,n){var r=new N;r._nativeUrl=t,r._nativeAsset=e,n(null,r)}S.register({".font":yt,".eot":yt,".ttf":yt,".woff":yt,".svg":yt,".ttc":yt}),O.register({".font":vt,".eot":vt,".ttf":vt,".woff":vt,".svg":vt,".ttc":vt});var xt,bt,Dt,Ft,At,wt,St,Ot,Tt,kt=/^(click)(\s)*=|(param)(\s)*=/,Rt=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,Ct=(t("o",function(){function t(){this._specialSymbolArray=[],this._stack=[],this._resultObjectArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])}var e=t.prototype;return e.parse=function(t){this._resultObjectArray.length=0,this._stack.length=0;for(var e=0,i=t.length;e<i;){var n=t.indexOf(">",e),r=-1;if(n>=0&&(r=t.lastIndexOf("<",n))<e-1&&(r=t.indexOf("<",n+1),n=t.indexOf(">",r+1)),r<0)this._stack.pop(),this._processResult(t.substring(e)),e=i;else{var s=t.substring(e,r),o=t.substring(r+1,n);""===o&&(s=t.substring(e,n+1)),this._processResult(s),-1===n?n=r:"/"===t.charAt(r+1)?this._stack.pop():this._addToStack(o),e=n+1}}return this._resultObjectArray},e._attributeToObject=function(t){t=t.trim();var e={},i=/^(color|size)(\s)*=/.exec(t),n="",r=0,s="";if(i){if(n=i[0],""===(t=t.substring(n.length).trim()))return e;switch(r=t.indexOf(" "),n[0]){case"c":e.color=r>-1?t.substring(0,r).trim():t;break;case"s":e.size=parseInt(t)}return r>-1&&(s=t.substring(r+1).trim(),e.event=this._processEventHandler(s)),e}if((i=/^(br(\s)*\/)/.exec(t))&&i[0].length>0&&(n=i[0].trim()).startsWith("br")&&"/"===n[n.length-1])return e.isNewLine=!0,this._resultObjectArray.push({text:"",style:{isNewLine:!0}}),e;var o="",a=-1;if((i=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(t))&&i[0].length>0&&(n=i[0].trim()).startsWith("img")&&"/"===n[n.length-1]){var h;i=Rt.exec(t);for(var u=!1;i;){var l=(n=(t=t.substring(t.indexOf(i[0]))).substring(0,i[0].length)).length;if(n=(n=n.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),o=t.substring(l).trim(),a="src"===n?this.getRightQuotationIndex(o):-1,h=(r=o.indexOf(" ",a+1>=o.length?-1:a+1))>-1?o.substring(0,r):o,t=o.substring(r).trim(),h.endsWith("/")&&(h=h.slice(0,-1)),"src"===n){switch(h.charCodeAt(0)){case 34:case 39:u=!0,h=h.slice(1,-1)}e.isImage=!0,e.src=h}else if("height"===n)e.imageHeight=parseInt(h);else if("width"===n)e.imageWidth=parseInt(h);else if("align"===n){switch(h.charCodeAt(0)){case 34:case 39:h=h.slice(1,-1)}e.imageAlign=h.toLowerCase()}else"offset"===n?e.imageOffset=h:"click"===n&&(e.event=this._processEventHandler(n+"="+h));e.event&&"param"===n&&(e.event[n]=h.replace(/^"|"$/g,"")),i=Rt.exec(t)}return u&&e.isImage&&this._resultObjectArray.push({text:"",style:e}),{}}if(i=/^(outline(\s)*[^>]*)/.exec(t)){var f={color:"#ffffff",width:1};if(t=i[0].substring(7).trim()){var c,d=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(i=d.exec(t);i;)n=(t=t.substring(t.indexOf(i[0]))).substring(0,i[0].length),c=(r=(o=t.substring(n.length).trim()).indexOf(" "))>-1?o.substring(0,r):o,n=(n=n.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=o.substring(r).trim(),"click"===n?e.event=this._processEventHandler(n+"="+c):"color"===n?f.color=c:"width"===n&&(f.width=parseInt(c)),e.event&&"param"===n&&(e.event[n]=c.replace(/^"|"$/g,"")),i=d.exec(t)}e.outline=f}if((i=/^(on|u|b|i)(\s)*/.exec(t))&&i[0].length>0){switch(n=i[0],t=t.substring(n.length).trim(),n[0]){case"u":e.underline=!0;break;case"i":e.italic=!0;break;case"b":e.bold=!0}if(""===t)return e;e.event=this._processEventHandler(t)}return e},e.getRightQuotationIndex=function(t){var e=-1,i=-1,n=t.indexOf("'"),r=t.indexOf('"'),s=r>-1&&(r<n||-1===n);return n>-1&&(n<r||-1===r)?(e=n,i=t.indexOf("'",e+1>=t.length?-1:e+1)):s&&(e=r,i=t.indexOf('"',e+1>=t.length?-1:e+1)),i},e._processEventHandler=function(t){for(var e={},i=0,n=!1,r=kt.exec(t);r;){var s=r[0],o="";if(n=!1,'"'===(t=t.substring(s.length).trim()).charAt(0))(i=t.indexOf('"',1))>-1&&(o=t.substring(1,i).trim(),n=!0),i++;else if("'"===t.charAt(0))(i=t.indexOf("'",1))>-1&&(o=t.substring(1,i).trim(),n=!0),i++;else{var a=/(\S)+/.exec(t);i=(o=a?a[0]:"").length}n&&(e[s=s.substring(0,s.length-1).trim()]=o),t=t.substring(i).trim(),r=kt.exec(t)}return e},e._addToStack=function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var i=this._stack[this._stack.length-1];for(var n in i)e[n]||(e[n]=i[n]);this._stack.push(e)}},e._processResult=function(t){0!==t.length&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},e._escapeSpecialSymbol=function(t){for(var e,i=o(this._specialSymbolArray);!(e=i()).done;){var n=e.value,r=n[0],s=n[1];t=t.replace(r,s)}return t},t}()),function(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.valid=!1,this.xAdvance=0}),Et=t("F",function(){function t(t){this.letterDefinitions={},this._texture=null,this.texture=t}var e=t.prototype;return e.addLetterDefinitions=function(t,e){this.letterDefinitions[t]=e},e.cloneLetterDefinition=function(){var t={};for(var e in this.letterDefinitions){var i=new Ct;a(i,this.letterDefinitions[e]),t[e]=i}return t},e.getTexture=function(){return this._texture},e.getLetter=function(t){return this.letterDefinitions[t]},e.getLetterDefinitionForChar=function(t){var e=nt(t,0),i=null;return Object.prototype.hasOwnProperty.call(this.letterDefinitions,e)&&(i=this.letterDefinitions[e]),i},e.clear=function(){this.letterDefinitions={}},i(t,[{key:"texture",get:function(){return this._texture},set:function(t){var e=this._texture;e!==t&&(e&&(e.decRef(!1),e.refCount<=0&&e.destroy()),t&&t.addRef(),this._texture=t)}}]),t}()),Lt=t("l",(xt=l("cc.BitmapFont"),bt=_(F),xt((Ft=function(t){function i(){var e;return(e=t.call(this)||this).fntDataStr=At&&At(),e.spriteFrame=wt&&wt(),e.fontSize=St&&St(),e.fntConfig=Ot&&Ot(),e}return e(i,t),i.prototype.onLoaded=function(){var t=this.spriteFrame;!this.fontDefDictionary&&t&&(this.fontDefDictionary=new Et(t.texture));var e=this.fntConfig;if(e){var i=e.fontDefDictionary;for(var n in i){var r=i[n],o=new Ct,a=r.rect;o.offsetX=r.xOffset,o.offsetY=r.yOffset,o.w=a.width,o.h=a.height,o.u=a.x,o.v=a.y,o.valid=!0,o.xAdvance=r.xAdvance,this.fontDefDictionary.addLetterDefinitions(n,o)}}else s(16376)},i}(j),At=f(Ft.prototype,"fntDataStr",[p],(function(){return""})),wt=f(Ft.prototype,"spriteFrame",[bt],(function(){return null})),St=f(Ft.prototype,"fontSize",[p],(function(){return-1})),Ot=f(Ft.prototype,"fntConfig",[p],(function(){return null})),Dt=Ft))||Dt));b.BitmapFont=Lt;var Ht,It=t("m",l("cc.LabelAtlas")(Tt=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i}(Lt))||Tt);b.LabelAtlas=It;var zt=t("C",function(){function t(){this.pool=[]}t.getInstance=function(){return Ht||(Ht=new t),Ht};var e=t.prototype;return e.get=function(){var t=this.pool.pop();if(!t){var e=D.document.createElement("canvas"),i=e.getContext("2d");t={canvas:e,context:i}}return t},e.put=function(t){this.pool.length>=h.MAX_LABEL_CANVAS_POOL_SIZE||this.pool.push(t)},t}()),Bt=g.WHITE.clone(),Ut="rgba(255, 255, 255, "+(1/255).toFixed(3)+")",Wt=G(),Pt=function(){function t(t,e){this.image=null,this.data=null,this.canvas=null,this.context=null,this.width=0,this.height=0,this.offsetY=0,this.char=t,this.labelInfo=e,this.hash=""+nt(t,0)+e.hash}var e=t.prototype;return e.updateRenderData=function(){this._updateProperties(),this._updateTexture()},e.destroy=function(){this.image=null,zt.getInstance().put(this.data),this.data=null},e._updateProperties=function(){if(this.data=zt.getInstance().get(),this.canvas=this.data.canvas,this.context=this.data.context,this.context){var t=this.labelInfo.fontScale;this.context.font=this.labelInfo.fontDesc;var e=et(this.context,this.char,this.labelInfo.fontDesc),i=2*this.labelInfo.margin+2;this.width=parseFloat(e.toFixed(2))*t+i,this.height=(1+M)*this.labelInfo.fontSize*t+i,this.offsetY=-this.labelInfo.fontSize*M*t/2}this.canvas.width!==this.width&&(this.canvas.width=this.width),this.canvas.height!==this.height&&(this.canvas.height=this.height),this.image||(this.image=new k),this.image.reset(this.canvas)},e._updateTexture=function(){if(this.context&&this.canvas){var t=this.context,e=this.labelInfo,i=this.canvas.width,n=this.canvas.height,r=e.fontScale;t.textAlign="center",t.textBaseline="alphabetic",t.clearRect(0,0,i,n),t.fillStyle=Ut,t.fillRect(0,0,i,n),t.font=e.fontDesc.replace(/(\d+)(\.\d+)?(px|em|rem|pt)/g,(function(t,e,i,n){return(+e*r+(+i||0)*r).toString()+n}));var s=e.fontSize*r,o=i/2,a=n/2+s*Y+s*Wt,h=e.color;if(t.lineJoin="round",t.fillStyle="rgba("+h.r+", "+h.g+", "+h.b+", 1)",e.isOutlined){var u=e.out||Bt;t.strokeStyle="rgba("+u.r+", "+u.g+", "+u.b+", "+u.a/255+")",t.lineWidth=2*e.margin*r,t.strokeText(this.char,o,a)}t.fillText(this.char,o,a)}},t}(),jt=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.initWithSize=function(t,e,i){void 0===i&&(i=T.RGBA8888),this.reset({width:t,height:e,format:i})},n.drawTextureAt=function(t,e,i){var n=this.getGFXTexture();if(t&&n){var r=this._getGFXDevice();if(r){var o=new E;o.texOffset.x=e,o.texOffset.y=i,o.texExtent.width=t.width,o.texExtent.height=t.height,r.copyTexImagesToTexture([t.data],n,[o])}else s(16363)}},i}(R);t("h",function(){function t(t,e){this._x=0,this._y=0,this._nextY=0,this._width=0,this._height=0,this._halfBleed=0,this._dirty=!1;var i=new jt;i.initWithSize(t,e),this.fontDefDictionary=new Et(i),this._halfBleed=1,this._width=t,this._height=e,L.on(H.BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)}var e=t.prototype;return e.insertLetterTexture=function(t){var e=t.image,i=L.root.device;if(!e||!this.fontDefDictionary||!i)return null;var n=e.width,r=e.height;if(this._x+n+0>this._width&&(this._x=0,this._y=this._nextY),this._y+r>this._nextY&&(this._nextY=this._y+r+0),this._nextY>this._height)return s(12100),null;if(!this.fontDefDictionary.texture)return null;this.fontDefDictionary.texture.drawTextureAt(e,this._x,this._y),this._dirty=!0;var o=new Ct;return o.u=this._x+this._halfBleed,o.v=this._y+this._halfBleed,o.valid=!0,o.w=t.width-2,o.h=t.height-2,o.xAdvance=o.w,o.offsetY=t.offsetY,this._x+=n+0,this.fontDefDictionary.addLetterDefinitions(t.hash,o),o},e.update=function(){this._dirty&&(this._dirty=!1)},e.reset=function(){this._x=0,this._y=0,this._nextY=0,this.fontDefDictionary.clear()},e.destroy=function(){this.reset();var t=this.fontDefDictionary;t&&t.texture&&(t.texture=null)},e.getTexture=function(){return this.fontDefDictionary.getTexture()},e.beforeSceneLoad=function(){this.clearAllCache()},e.clearAllCache=function(){this.destroy();var t=new jt;t.initWithSize(this._width,this._height),this.fontDefDictionary.texture=t},e.getLetter=function(t){return this.fontDefDictionary.letterDefinitions[t]},e.getLetterDefinitionForChar=function(t,e){var i=nt(t,0)+e.hash,n=this.fontDefDictionary.letterDefinitions[i];if(!n){var r=new Pt(t,e);r.updateRenderData(),n=this.insertLetterTexture(r),r.destroy()}return n},i(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),t}()),t("s",{fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:g.WHITE.clone(),isOutlined:!1,out:g.WHITE.clone(),margin:0,fontScale:1});var Nt,Mt,Xt,Yt,Gt,Vt,Zt,$t,qt,Kt,Jt,Qt,te,ee,ie,ne,re,se,oe,ae,he,ue,le,fe,ce,de,pe,_e,ge,ye,me,ve,xe,be,De,Fe,Ae,we,Se=function(){function t(){this.isBold=!1,this.isItalic=!1,this.isUnderline=!1,this.underlineHeight=1,this.isOutlined=!1,this.outlineColor=g.WHITE.clone(),this.outlineWidth=1,this.hasShadow=!1,this.shadowColor=g.BLACK.clone(),this.shadowBlur=2,this.shadowOffsetX=0,this.shadowOffsetY=0,this.color=g.WHITE.clone(),this.fontSize=40,this.actualFontSize=0,this.isSystemFontUsed=!1,this.originFontSize=0,this.bmfontScale=1,this.fontFamily="Arial",this.fontDesc="",this.fntConfig=null,this.spriteFrame=null,this.fontScale=1}return t.prototype.reset=function(){this.isBold=!1,this.isItalic=!1,this.isUnderline=!1,this.underlineHeight=1,this.isOutlined=!1,this.outlineColor.set(),this.outlineWidth=1,this.hasShadow=!1,this.shadowColor.set(),this.shadowBlur=2,this.shadowOffsetX=0,this.shadowOffsetY=0},t}(),Oe=function(){function t(){this.horizontalAlign=0,this.verticalAlign=0,this.wrapping=!0,this.overFlow=0,this.lineHeight=10,this.maxLineWidth=0,this.spacingX=0,this.textWidthTemp=0,this.textHeightTemp=0,this.textDimensions=new y,this.horizontalKerning=[],this.numberOfLines=1,this.linesOffsetX=[],this.letterOffsetY=0,this.tailoredTopY=0,this.tailoredBottomY=0,this.textDesiredHeight=0,this.linesWidth=[]}return t.prototype.reset=function(){this.horizontalAlign=0,this.verticalAlign=0,this.wrapping=!0,this.overFlow=0,this.lineHeight=10,this.maxLineWidth=0,this.spacingX=0,this.textWidthTemp=0,this.textHeightTemp=0,this.textDimensions.set(),this.horizontalKerning.length=0,this.numberOfLines=1,this.linesOffsetX.length=0,this.letterOffsetY=0,this.tailoredTopY=0,this.tailoredBottomY=0,this.textDesiredHeight=0,this.linesWidth.length=0},t}(),Te=function(){function t(){this.parsedString=[],this.nodeContentSize=y.ZERO.clone(),this.canvasSize=new y,this.canvasPadding=new m,this.contentSizeExtend=y.ZERO.clone(),this.startPosition=v.ZERO.clone()}return t.prototype.reset=function(){this.parsedString.length=0,this.nodeContentSize.set(0,0),this.canvasSize.set(),this.canvasPadding.set(),this.contentSizeExtend.set(),this.startPosition.set()},t}(),ke=function(){function t(){this.quadCount=0,this.vertexBuffer=[],this.texture=null,this.uiTransAnchorX=.5,this.uiTransAnchorY=.5}return t.prototype.reset=function(){this.quadCount=0,this.vertexBuffer.length=0,this.texture=null,this.uiTransAnchorX=.5,this.uiTransAnchorY=.5},t}();g.WHITE.clone(),t("H",De),function(t){t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT"}(De||t("H",De={})),u(De),t("V",Fe),function(t){t[t.TOP=0]="TOP",t[t.CENTER=1]="CENTER",t[t.BOTTOM=2]="BOTTOM"}(Fe||t("V",Fe={})),u(Fe),t("O",Ae),function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.SHRINK=2]="SHRINK",t[t.RESIZE_HEIGHT=3]="RESIZE_HEIGHT"}(Ae||t("O",Ae={})),u(Ae),t("j",we),function(t){t[t.NONE=0]="NONE",t[t.BITMAP=1]="BITMAP",t[t.CHAR=2]="CHAR"}(we||t("j",we={})),u(we);var Re=t("L",(Nt=l("cc.Label"),Mt=x(110),Xt=_(De),Yt=_(Fe),Gt=_(Ae),Vt=_(j),Zt=_(we),Nt($t=Mt((be=function(t){function n(){var e;return(e=t.call(this)||this)._string=Kt&&Kt(),e._horizontalAlign=Jt&&Jt(),e._verticalAlign=Qt&&Qt(),e._actualFontSize=te&&te(),e._fontSize=ee&&ee(),e._fontFamily=ie&&ie(),e._lineHeight=ne&&ne(),e._overflow=re&&re(),e._enableWrapText=se&&se(),e._font=oe&&oe(),e._isSystemFontUsed=ae&&ae(),e._spacingX=he&&he(),e._isItalic=ue&&ue(),e._isBold=le&&le(),e._isUnderline=fe&&fe(),e._underlineHeight=ce&&ce(),e._cacheMode=de&&de(),e._enableOutline=pe&&pe(),e._outlineColor=_e&&_e(),e._outlineWidth=ge&&ge(),e._enableShadow=ye&&ye(),e._shadowColor=me&&me(),e._shadowOffset=ve&&ve(),e._shadowBlur=xe&&xe(),e._N$file=null,e._texture=null,e._ttfSpriteFrame=null,e._userDefinedFont=null,e._assemblerData=null,e._fontAtlas=null,e._letterTexture=null,e._contentWidth=0,e._textStyle=null,e._textLayout=null,e._textRenderData=null,e._textLayoutData=null,e._ttfSpriteFrame=null,e._textStyle=new Se,e._textLayout=new Oe,e._textLayoutData=new Te,e._textRenderData=new ke,e}e(n,t);var r=n.prototype;return r.onEnable=function(){t.prototype.onEnable.call(this),this._font||this._isSystemFontUsed||(this.useSystemFont=!0),this._isSystemFontUsed&&!this._fontFamily&&(this.fontFamily="Arial"),this._applyFontTexture()},r.destroyTtfSpriteFrame=function(){if(this._ttfSpriteFrame){this._ttfSpriteFrame._resetDynamicAtlasFrame();var t=this._ttfSpriteFrame.texture;if(this._ttfSpriteFrame.destroy(),t){var e=t;e.image&&e.image.destroy(),t.destroy()}this._ttfSpriteFrame=null}},r._onPreDestroy=function(){t.prototype._onPreDestroy.call(this),this._isOnLoadCalled||this.destroyTtfSpriteFrame()},r.onDestroy=function(){this._assembler&&this._assembler.resetAssemblerData&&this._assembler.resetAssemblerData(this._assemblerData),this._assemblerData=null,this.destroyTtfSpriteFrame(),this.destroyLetterTexture(),t.prototype.onDestroy.call(this)},r.destroyLetterTexture=function(){var t=this._letterTexture;t&&(t.decRef(!1),t.refCount<=0&&t.destroy()),this._letterTexture=null},r.updateRenderData=function(t){void 0===t&&(t=!1),t&&(this._flushAssembler(),this.renderData&&(this.renderData.vertDirty=!0),this._applyFontTexture()),this._assembler&&this._assembler.updateRenderData(this)},r._render=function(t){t.commitComp(this,this.renderData,this._texture,this._assembler,null)},r._updateColor=function(){t.prototype._updateColor.call(this),this._markForUpdateRenderData()},r.setEntityColor=function(){},r._canRender=function(){if(!t.prototype._canRender.call(this)||!this._string)return!1;var e=this._font;if(e&&e instanceof Lt){var i=e.spriteFrame;if(!i||!i.texture)return!1}return!0},r._flushAssembler=function(){var t=n.Assembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t,this.textStyle.reset(),this.textLayout.reset(),this.textLayoutData.reset(),this.textRenderData.reset()),this.renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this.renderData.material=this.material,this._updateColor())},r._applyFontTexture=function(){this._markForUpdateRenderData();var t=this._font;if(t instanceof Lt){var e=t.spriteFrame;e&&e.texture&&(this._texture=e,this.renderData&&(this.renderData.textureDirty=!0),this.changeMaterialForDefine(),this._assembler&&this._assembler.updateRenderData(this))}else{if(this.cacheMode===we.CHAR){var i=this._letterTexture,n=this._assembler.getAssemblerData();n!==i&&(this.destroyLetterTexture(),n&&n.addRef()),this._texture=this._letterTexture=n}else if(!this._ttfSpriteFrame){this._ttfSpriteFrame=new F,this._assemblerData=this._assembler.getAssemblerData();var r=new k(this._assemblerData.canvas),s=new R;s.image=r,this._ttfSpriteFrame.texture=s}this.cacheMode!==we.CHAR&&(this._texture=this._ttfSpriteFrame),this.changeMaterialForDefine()}},r.changeMaterialForDefine=function(){if(this._texture){var t=!1;if(this.cacheMode!==we.CHAR){var e=this._texture.texture;if(e instanceof C){var i=e.getPixelFormat();t=i===T.RGBA_ETC1||i===T.RGB_A_PVRTC_4BPPV1||i===T.RGB_A_PVRTC_2BPPV1}}this._instanceMaterialType=t?I.USE_ALPHA_SEPARATED:I.ADD_COLOR_AND_TEXTURE,this.updateMaterial()}},r._updateBlendFunc=function(){t.prototype._updateBlendFunc.call(this)},i(n,[{key:"string",get:function(){return this._string},set:function(t){t=null==t?"":t.toString(),this._string!==t&&(this._string=t,this._markForUpdateRenderData())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this._horizontalAlign!==t&&(this._horizontalAlign=t,this._markForUpdateRenderData())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this._markForUpdateRenderData())}},{key:"actualFontSize",get:function(){return this._actualFontSize},set:function(t){this._actualFontSize=t}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._markForUpdateRenderData())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._markForUpdateRenderData())}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this._markForUpdateRenderData())}},{key:"overflow",get:function(){return this._overflow},set:function(t){this._overflow!==t&&(this._overflow=t,this._markForUpdateRenderData())}},{key:"enableWrapText",get:function(){return this._enableWrapText},set:function(t){this._enableWrapText!==t&&(this._enableWrapText=t,this._markForUpdateRenderData())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this.destroyRenderData(),this._isSystemFontUsed=!!t,t&&(this.font=null),this._flushAssembler(),this._markForUpdateRenderData())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._markForUpdateRenderData())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._isSystemFontUsed=!t,this._font=t,this.destroyRenderData(),this._fontAtlas=null,this.updateRenderData(!0))}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){var e=this._cacheMode;e!==t&&(e!==we.BITMAP||this._font instanceof Lt||!this._ttfSpriteFrame||this._ttfSpriteFrame._resetDynamicAtlasFrame(),e===we.CHAR&&(this._ttfSpriteFrame=null,this.destroyLetterTexture()),this._cacheMode=t,this.updateRenderData(!0))}},{key:"isBold",get:function(){return this._isBold},set:function(t){this._isBold!==t&&(this._isBold=t,this._markForUpdateRenderData())}},{key:"isItalic",get:function(){return this._isItalic},set:function(t){this._isItalic!==t&&(this._isItalic=t,this._markForUpdateRenderData())}},{key:"isUnderline",get:function(){return this._isUnderline},set:function(t){this._isUnderline!==t&&(this._isUnderline=t,this._markForUpdateRenderData())}},{key:"underlineHeight",get:function(){return this._underlineHeight},set:function(t){this._underlineHeight!==t&&(this._underlineHeight=t,this._markForUpdateRenderData())}},{key:"enableOutline",get:function(){return this._enableOutline},set:function(t){this._enableOutline!==t&&(this._enableOutline=t,this._markForUpdateRenderData())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(t){this._outlineColor!==t&&(this._outlineColor.set(t),this._markForUpdateRenderData())}},{key:"outlineWidth",get:function(){return this._outlineWidth},set:function(t){this._outlineWidth!==t&&(this._outlineWidth=t,this._markForUpdateRenderData())}},{key:"enableShadow",get:function(){return this._enableShadow},set:function(t){this._enableShadow!==t&&(this._enableShadow=t,this._markForUpdateRenderData())}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor!==t&&(this._shadowColor.set(t),this._markForUpdateRenderData())}},{key:"shadowOffset",get:function(){return this._shadowOffset},set:function(t){this._shadowOffset!==t&&(this._shadowOffset.set(t),this._markForUpdateRenderData())}},{key:"shadowBlur",get:function(){return this._shadowBlur},set:function(t){this._shadowBlur!==t&&(this._shadowBlur=t,this._markForUpdateRenderData())}},{key:"spriteFrame",get:function(){return this._texture}},{key:"ttfSpriteFrame",get:function(){return this._ttfSpriteFrame}},{key:"assemblerData",get:function(){return this._assemblerData}},{key:"fontAtlas",get:function(){return this._fontAtlas},set:function(t){this._fontAtlas=t}},{key:"_bmFontOriginalSize",get:function(){return this._font instanceof Lt?this._font.fontSize:-1}},{key:"textStyle",get:function(){return this._textStyle}},{key:"textLayout",get:function(){return this._textLayout}},{key:"textRenderData",get:function(){return this._textRenderData}},{key:"textLayoutData",get:function(){return this._textLayoutData}},{key:"contentWidth",get:function(){return this._contentWidth},set:function(t){this._contentWidth=t}}]),n}(z),be.HorizontalAlign=De,be.VerticalAlign=Fe,be.Overflow=Ae,be.CacheMode=we,be._canvasPool=zt.getInstance(),n((qt=be).prototype,"horizontalAlign",[Xt],Object.getOwnPropertyDescriptor(qt.prototype,"horizontalAlign"),qt.prototype),n(qt.prototype,"verticalAlign",[Yt],Object.getOwnPropertyDescriptor(qt.prototype,"verticalAlign"),qt.prototype),n(qt.prototype,"overflow",[Gt],Object.getOwnPropertyDescriptor(qt.prototype,"overflow"),qt.prototype),n(qt.prototype,"font",[Vt],Object.getOwnPropertyDescriptor(qt.prototype,"font"),qt.prototype),n(qt.prototype,"cacheMode",[Zt],Object.getOwnPropertyDescriptor(qt.prototype,"cacheMode"),qt.prototype),Kt=f(qt.prototype,"_string",[p],(function(){return"label"})),Jt=f(qt.prototype,"_horizontalAlign",[p],(function(){return De.CENTER})),Qt=f(qt.prototype,"_verticalAlign",[p],(function(){return Fe.CENTER})),te=f(qt.prototype,"_actualFontSize",[p],(function(){return 0})),ee=f(qt.prototype,"_fontSize",[p],(function(){return 40})),ie=f(qt.prototype,"_fontFamily",[p],(function(){return"Arial"})),ne=f(qt.prototype,"_lineHeight",[p],(function(){return 40})),re=f(qt.prototype,"_overflow",[p],(function(){return Ae.NONE})),se=f(qt.prototype,"_enableWrapText",[p],(function(){return!0})),oe=f(qt.prototype,"_font",[p],(function(){return null})),ae=f(qt.prototype,"_isSystemFontUsed",[p],(function(){return!0})),he=f(qt.prototype,"_spacingX",[p],(function(){return 0})),ue=f(qt.prototype,"_isItalic",[p],(function(){return!1})),le=f(qt.prototype,"_isBold",[p],(function(){return!1})),fe=f(qt.prototype,"_isUnderline",[p],(function(){return!1})),ce=f(qt.prototype,"_underlineHeight",[p],(function(){return 2})),de=f(qt.prototype,"_cacheMode",[p],(function(){return we.NONE})),pe=f(qt.prototype,"_enableOutline",[p],(function(){return!1})),_e=f(qt.prototype,"_outlineColor",[p],(function(){return new g(0,0,0,255)})),ge=f(qt.prototype,"_outlineWidth",[p],(function(){return 2})),ye=f(qt.prototype,"_enableShadow",[p],(function(){return!1})),me=f(qt.prototype,"_shadowColor",[p],(function(){return new g(0,0,0,255)})),ve=f(qt.prototype,"_shadowOffset",[p],(function(){return new v(2,2)})),xe=f(qt.prototype,"_shadowBlur",[p],(function(){return 2})),$t=qt))||$t)||$t));b.Label=Re}}}));
