{"version":3,"sources":["file:///D:/Cocos/Project/XH/assets/Script/Other/SDK/WxApi.ts"],"names":["_decorator","Component","sys","GravityPlatform","Tool_Event","ccclass","property","WxApi","constructor","CustomAd","customadIndex","customadTop","customadBottom","setTimer","isNewUser","times","videoAd","videoPath","InterstitialAd","callback","close_callback","openId","_userInfo","_avatarCallBack","isInterstitialLoading","interstitialRetryCount","MAX_RETRY_COUNT","Data_Get","Data_Name","Default_Value","Data_Value","Data_Raw","localStorage","getItem","JSON","parse","undefined","e","console","error","Data_Set","Data","setItem","stringify","authorize","onLoad","log","loadVideoAd","loadInterstitialAd","wx","onShow","res","scene","instance","Event_Dispatch","login","timeout","success","code","sendCodeToServer","initGeSdk","errMsg","fail","err","complete","request","url","method","data","getUserProfile","desc","userInfo","avatarUrl","initAutoSetting","object","autoSetting","authSetting","getUserInfo","creatUserInfoButton","getSetting","isFull","window","type","text","style","left","top","width","height","backgroundColor","color","textAlign","lineHeight","fontSize","button","createUserInfoButton","onTap","destroy","setFrameRate","frameRate","setPreferredFramesPerSecond","addShortcut","openAwemeUserProfile","isPlatform","platform","Platform","WECHAT_GAME","WECHAT_MINI_PROGRAM","isRecordVideo","showToast","title","icon","duration","startRecordVideo","t","stopRecordVideo","loadRecordVideo","adUnitId","createRewardedVideoAd","onClose","isEnded","onError","showVideoAd","successCallback","closeCallback","warn","show","then","onAdFinish","catch","reLoadVideo","load","createInterstitialAd","errCode","reLoadInterstitial","showInterstitialAd","setTimeout","scheduleOnce","showShareMenu","shareUrl","imageUrl","query","menus","onShareAppMessage","shareAppMessage","failCallback","o","n","a","Math","floor","random","length","share_show","onShareAppVideo","reportAnalytics","setImRankDataScore","setImRankDataDuanWei","createCustomAd","updateCustomAd","hideCustomAd","showCustomAdSelf","showCustomAd","showTop","showBottom","clearInterval","setInterval","i","ad","shouldShow","isShow","hideTop","hideBottom","forEach","index","position","hide","requestSubscribeMessage","Env","offShow","onHide","offHide","getLaunchOptionsSync","vibrateShort","Type","Callbacks","shareMessageToFriend","path","templateId","imageFileId"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, sys } from 'cc';\r\nimport { GravityPlatform } from '../GeSdk/GravityPlatform';\r\nimport { Tool_Event } from '../../Tool/Tool_Event';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('WxApi')\r\nexport class WxApi extends Component {\r\n\r\n    private CustomAd: any[] = [];\r\n    private customadIndex: number = 0;\r\n    private customadTop: boolean = true;\r\n    private customadBottom: boolean = false;\r\n    private setTimer: number = -1;\r\n    private isNewUser: boolean = false;\r\n    private times: number = 0;\r\n\r\n    private videoAd: any;\r\n    private videoPath?: string;\r\n    private InterstitialAd: any;\r\n\r\n    private callback?: () => void;\r\n    private close_callback?: () => void;\r\n\r\n    openId: string = null;\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    Data_Get(Data_Name: string, Default_Value: any = null): any {\r\n        try {\r\n            let Data_Value;\r\n            const Data_Raw = sys.localStorage.getItem(Data_Name);\r\n            Data_Value = Data_Raw ? JSON.parse(Data_Raw) : null;\r\n            // 返回数据或默认值\r\n            return Data_Value !== undefined ? Data_Value : Default_Value;\r\n        } catch (e) {\r\n            console.error(`[Storage] 读取 ${Data_Name} 失败:`, e);\r\n            return Default_Value;\r\n        }\r\n    }\r\n\r\n    Data_Set(Data_Name: string, Data: any): void {\r\n        try {\r\n            sys.localStorage.setItem(Data_Name, JSON.stringify(Data));\r\n        } catch (e) {\r\n            console.error(`[Storage] 保存 ${Data_Name} 失败:`, e);\r\n        }\r\n    }\r\n\r\n    /**授权 */\r\n    authorize() { }\r\n\r\n    /**\r\n     * 初始化微信平台\r\n     */\r\n    onLoad(): void {\r\n        console.log(\"微信平台初始化\");\r\n        //加载激励视频\r\n        this.loadVideoAd(\"adunit-c6a790cad3e75438\");\r\n        //加载插屏广告\r\n        this.loadInterstitialAd(\"adunit-74880b34ad4aa7f7\");\r\n\r\n        // 监听游戏显示事件\r\n        wx.onShow((res: { scene: number }) => {\r\n            console.log(\"wx.onShow:\", res.scene);\r\n            Tool_Event.instance.Event_Dispatch(\"WXOnShow\");\r\n        });\r\n\r\n        this.login();\r\n\r\n        // this.getUserProfile();\r\n\r\n\r\n        // this.initAutoSetting();\r\n\r\n\r\n    }\r\n\r\n\r\n    /**登录 */\r\n    login() {\r\n        wx.login({\r\n            timeout: 5000, //超时时间\r\n            success: (res) => {\r\n                if (res.code) {\r\n                    console.log('获取code成功:', res.code);\r\n                    let openId = this.Data_Get(\"openId\");\r\n                    if (openId == null || openId == undefined) {\r\n                        this.sendCodeToServer(res.code);\r\n                    } else {\r\n                        this.openId = openId;\r\n                        console.log(\"初始化引力引擎\", this.openId);\r\n                        GravityPlatform.instance.initGeSdk(this.openId);\r\n                    }\r\n                } else {\r\n                    console.error('获取code失败:', res.errMsg);\r\n                }\r\n            },\r\n            fail: (err) => {\r\n                console.error('wx.login调用失败:', err);\r\n            },\r\n            complete: () => {\r\n                console.log('wx.login调用完成');\r\n            }\r\n        });\r\n    }\r\n    // 将code发送到开发者服务器\r\n    sendCodeToServer(code) {\r\n        wx.request({\r\n            url: 'https://yx.megoo.top/zhishanggoubudao/user/getWxOpenId',\r\n            method: 'POST',\r\n            data: {\r\n                code: code\r\n            },\r\n            success: (res) => {\r\n                console.log('服务器响应:', res.data);\r\n                console.log('openId:', res.data.openId);\r\n                this.openId = res.data.openId;\r\n                this.Data_Set(\"openId\", this.openId);\r\n\r\n                GravityPlatform.instance.initGeSdk(this.openId);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**获取用户信息 */\r\n    getUserProfile() {\r\n        wx.getUserProfile({\r\n            desc: '用于完善会员资料',\r\n            success: (res) => {\r\n                console.log('用户信息:', res.userInfo);\r\n                //获取到头像URL\r\n                const avatarUrl = res.userInfo.avatarUrl;\r\n                console.log(avatarUrl);\r\n                // this.saveUserAvatar(avatarUrl, openId);\r\n            },\r\n            fail: (err) => {\r\n                console.error('获取用户信息失败:', err);\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    // 获取标记权限\r\n    public initAutoSetting() {\r\n        // 获取请求过的权限标记\r\n        let object: any = {\r\n            // 成功回调         \r\n            success: (res) => {\r\n                // 是否授权用户信息\r\n                const autoSetting = res.authSetting;\r\n                if (autoSetting[\"scope.userInfo\"]) {\r\n                    // 已授权\r\n                    this.getUserInfo();\r\n                } else {\r\n                    // 未授权\r\n                    this.creatUserInfoButton();\r\n                }\r\n            },\r\n            // 失败回调\r\n            fail() {\r\n                console.log(\"wx.getSetting获取用户配置失败\");\r\n            },\r\n            // 结束回调(调用成功，失败都会执行)\r\n            complete() {\r\n                console.log(\"wx.getSetting获取用户配置结束\");\r\n            }\r\n        }\r\n        wx.getSetting(object);\r\n    }\r\n\r\n\r\n\r\n    private _userInfo;\r\n    // 头像回调\r\n    private _avatarCallBack = null;\r\n\r\n    // 创建用户授权按钮(仅用于登录页面, 如果用户拒绝授权，则一直显示)\r\n    private creatUserInfoButton(isFull: boolean = false) {\r\n        const wx = window['wx'];\r\n        let object: any = {\r\n            // 按钮类型： text可设置背景色和文本 image仅能设置背景贴图\r\n            type: \"text\",\r\n            // 按钮文本，仅对type为text有效\r\n            text: \"授权\",\r\n            // 按钮样式\r\n            style: {\r\n                left: 70,\r\n                top: 60,\r\n                width: 100,\r\n                height: 40,\r\n                backgroundColor: \"#66CC00\",\r\n                color: \"#FFFFFF\",\r\n                textAlign: 'center',\r\n                lineHeight: 40,\r\n                fontSize: 20,\r\n            },\r\n        };\r\n\r\n        const button = wx.createUserInfoButton(object);\r\n        // 监听用户信息按钮点击事件\r\n        button.onTap((res) => {\r\n            if (res && res.userInfo) {\r\n                console.log(\"用户同意授权\");\r\n                this._userInfo = res.userInfo;\r\n                if (this._avatarCallBack) {\r\n                    this._avatarCallBack(this._userInfo.avatarUrl);\r\n                }\r\n                // 授权成功后，才销毁按钮\r\n                button.destroy();\r\n            } else {\r\n                console.log(\"用户拒绝授权\");\r\n            }\r\n        });\r\n    }\r\n\r\n    // 获取用户信息，需要获取scope.userInfo的授权，也就是getSettings的接口调用\r\n    public getUserInfo() {\r\n        const wx = window['wx'];\r\n        let object: any = {\r\n            success: (res) => {\r\n                console.log(\"通过 getUserInfo 获取的数据:\", res);\r\n                if (res) {\r\n                    this._userInfo = res.userInfo;\r\n                    if (this._avatarCallBack) {\r\n                        this._avatarCallBack(this._userInfo.avatarUrl);\r\n                    }\r\n                }\r\n            },\r\n            fail: () => {\r\n                console.log(\"getUserInfo获取信息失败\");\r\n            },\r\n            complete: () => { },\r\n        };\r\n        wx.getUserInfo(object);\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n    //-----------------------------------\r\n\r\n\r\n    /**\r\n     * 设置游戏帧率\r\n     * @param frameRate 目标帧率（建议30/60）\r\n     */\r\n    setFrameRate(frameRate: number): void {\r\n        wx.setPreferredFramesPerSecond(frameRate);\r\n    }\r\n\r\n    addShortcut() { }\r\n\r\n    openAwemeUserProfile() { }\r\n\r\n    /**\r\n     * 检查是否在微信平台\r\n     */\r\n    isPlatform(): boolean {\r\n        return !!window.wx;\r\n        return (sys.platform === sys.Platform.WECHAT_GAME || sys.platform === sys.Platform.WECHAT_MINI_PROGRAM);\r\n    }\r\n\r\n    /**\r\n     * 检查是否有录制的视频\r\n     */\r\n    isRecordVideo(): boolean {\r\n        return !!this.videoPath;\r\n    }\r\n\r\n    /**\r\n     * 显示Toast提示\r\n     * @param title 提示内容\r\n     * @param icon 图标类型 (\"success\"/\"loading\"/\"none\")\r\n     * @param duration 显示时长(ms)，默认2000\r\n     */\r\n    showToast(title: string, icon: string | \"success\" | \"loading\" | \"none\" = \"none\", duration: number = 2000): void {\r\n        wx.showToast({\r\n            title,\r\n            icon,\r\n            duration\r\n        });\r\n    }\r\n\r\n\r\n    startRecordVideo(t) {\r\n        undefined === t && (t = 90);\r\n    }\r\n\r\n    stopRecordVideo() {\r\n\r\n    }\r\n\r\n    loadRecordVideo() { }\r\n\r\n\r\n\r\n\r\n\r\n\r\n    /**加载激励视频广告 */\r\n    loadVideoAd(adUnitId: string): void {\r\n        this.videoAd = wx.createRewardedVideoAd({\r\n            adUnitId: adUnitId,\r\n        });\r\n        // 广告关闭回调\r\n        this.videoAd.onClose((res: { isEnded: boolean }) => {\r\n            if (res.isEnded) {\r\n                this.callback && this.callback(); // 完整观看回调\r\n            } else {\r\n                this.close_callback && this.close_callback(); // 中途关闭回调\r\n            }\r\n            this.callback = null;\r\n            this.close_callback = null;\r\n        });\r\n        // 广告错误回调\r\n        this.videoAd.onError((err: any) => {\r\n            console.log(\"onError\" + err);\r\n            this.showToast(\"视频加载错误\", \"fail\");\r\n        });\r\n    }\r\n    /**\r\n     * 展示激励视频广告\r\n     * @param successCallback 观看完成的回调\r\n     * @param closeCallback 中途关闭的回调\r\n     */\r\n    showVideoAd(successCallback: () => void, closeCallback?: () => void): void {\r\n        console.log(\"展示激励广告\");\r\n        if (!this.videoAd) {\r\n            console.warn(\"激励广告未初始化\");\r\n            return;\r\n        }\r\n        this.callback = successCallback;\r\n        this.close_callback = closeCallback || null;\r\n        this.videoAd.show()\r\n            .then(() => {\r\n                console.log(\"激励广告展示成功\");\r\n                GravityPlatform.instance.onAdFinish();\r\n            })\r\n            .catch((err) => {\r\n                console.error(\"激励广告展示失败:\", err);\r\n                this.reLoadVideo();\r\n            });\r\n    }\r\n    /**\r\n     * 重新加载激励视频广告\r\n     */\r\n    reLoadVideo(): void {\r\n        this.videoAd?.load().then(() => {\r\n            console.log(\"激励广告重载成功\");\r\n            this.videoAd.show();\r\n        }).catch(() => {\r\n            console.error(\"激励广告重载失败\");\r\n            this.showToast(\"视频显示失败, 稍后重试\", \"fail\");\r\n        });\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    createInterstitialAd() { }\r\n\r\n    private isInterstitialLoading: boolean = false;\r\n    private interstitialRetryCount: number = 0;\r\n    private readonly MAX_RETRY_COUNT: number = 3;\r\n    /** 加载插屏广告（仅在广告未初始化或需要更换广告ID时调用） */\r\n    loadInterstitialAd(adUnitId: string): void {\r\n        // 如果广告已存在且未更换广告ID，无需重新创建\r\n        if (this.InterstitialAd && this.InterstitialAd.adUnitId === adUnitId) {\r\n            console.log(\"广告已存在，无需重新加载\");\r\n            return;\r\n        }\r\n        // 销毁旧广告（如果有）\r\n        if (this.InterstitialAd) {\r\n            this.InterstitialAd.destroy();\r\n            this.InterstitialAd = null;\r\n        }\r\n        // 创建新广告\r\n        this.InterstitialAd = wx.createInterstitialAd({\r\n            adUnitId: adUnitId,\r\n        });\r\n        this.isInterstitialLoading = true;\r\n        // 监听广告加载成功\r\n        this.InterstitialAd.onLoad(() => {\r\n            console.log(\"插屏广告加载成功\");\r\n            this.isInterstitialLoading = false;\r\n            this.interstitialRetryCount = 0; // 重置重试次数\r\n        });\r\n        // 监听广告关闭\r\n        this.InterstitialAd.onClose(() => {\r\n            console.log(\"插屏广告已关闭\");\r\n            // 广告关闭后可以尝试重新加载\r\n            this.loadInterstitialAd(adUnitId);\r\n        });\r\n        // 监听广告错误\r\n        this.InterstitialAd.onError((err) => {\r\n            console.log(\"插屏广告加载失败:\", err);\r\n            this.isInterstitialLoading = false;\r\n            // 特定错误码处理\r\n            if (err.errCode === 1004) {\r\n                console.log(\"广告已过期，尝试重新加载\");\r\n                this.reLoadInterstitial(adUnitId);\r\n            } else {\r\n                // this.showToast(\"广告加载失败，请稍后再试\", \"fail\");\r\n            }\r\n        });\r\n        // 主动加载广告\r\n        this.InterstitialAd.load().catch((err) => {\r\n            console.log(\"主动加载失败:\", err);\r\n            this.isInterstitialLoading = false;\r\n        });\r\n    }\r\n\r\n    /** 展示插屏广告 */\r\n    showInterstitialAd(): void {\r\n        if (!this.InterstitialAd) {\r\n            console.warn(\"广告未初始化，尝试加载\");\r\n            this.loadInterstitialAd(\"adunit-583b7c2c8548161c\");\r\n            return;\r\n        }\r\n        // 如果广告正在加载，延迟展示\r\n        if (this.isInterstitialLoading) {\r\n            console.log(\"广告正在加载，延迟展示\");\r\n            setTimeout(() => this.showInterstitialAd(), 1000);\r\n            return;\r\n        }\r\n        this.InterstitialAd.show()\r\n            .then(() => {\r\n                console.log(\"插屏广告展示成功\");\r\n            })\r\n            .catch((err) => {\r\n                console.log(\"插屏广告展示失败:\", err);\r\n                // 如果是未加载完成（2004），延迟重试\r\n                if (err.errCode === 2004) {\r\n                    console.log(\"广告未加载完成，1秒后重试\");\r\n                    setTimeout(() => this.showInterstitialAd(), 1000);\r\n                } else {\r\n                    // this.showToast(\"广告展示失败\", \"fail\");\r\n                }\r\n            });\r\n    }\r\n\r\n    /** 重新加载插屏广告（带重试限制） */\r\n    reLoadInterstitial(adUnitId: string): void {\r\n        if (this.interstitialRetryCount >= this.MAX_RETRY_COUNT) {\r\n            console.log(\"已达到最大重试次数，停止加载\");\r\n            return;\r\n        }\r\n        this.interstitialRetryCount++;\r\n        console.log(`第 ${this.interstitialRetryCount} 次重试加载广告`);\r\n        // 延迟1秒后重试，避免频繁请求\r\n        this.scheduleOnce(() => {\r\n            this.loadInterstitialAd(adUnitId);\r\n        }, 1);\r\n    }\r\n\r\n    /**显示分享菜单 */\r\n    showShareMenu(): void {\r\n        const shareUrl = \"https://zhishanggoubudao-1328679667.cos.ap-shanghai.myqcloud.com/share/0.webp\"; // 替换为实际分享图片URL\r\n        wx.showShareMenu({\r\n            title: \"别笑，你试了也过不了第三关\",\r\n            imageUrl: shareUrl,\r\n            query: this.openId,\r\n            menus: ['shareAppMessage', 'shareTimeline'],\r\n        });\r\n\r\n        wx.onShareAppMessage(() => {\r\n            return {\r\n                title: \"别笑，你试了也过不了第三关\",\r\n                imageUrl: shareUrl,\r\n                query: this.openId\r\n            };\r\n        });\r\n    }\r\n\r\n    /**主动分享 */\r\n    shareAppMessage(successCallback: () => void, failCallback?: () => void) {\r\n        console.log(\"主动分享\");\r\n        var o;\r\n        var n = this;\r\n        o = [\"https://zhishanggoubudao-1328679667.cos.ap-shanghai.myqcloud.com/share/0.webp\"];// $z1PublicMager.default.get().config.share_url;\r\n        var a = Math.floor(Math.random() * o.length);\r\n        wx.shareAppMessage({\r\n            title: \"别笑，你试了也过不了第三关\",\r\n            imageUrl: o[a],\r\n            query: \"openId=\" + this.openId,\r\n            success() {\r\n                console.log(\"分享视频成功\");\r\n                successCallback();\r\n            },\r\n            fail() {\r\n                console.log(\"需要分享游戏给好友才能获得奖励哟！\");\r\n                failCallback();\r\n            }\r\n        });\r\n    };\r\n\r\n\r\n\r\n    share_show() { }\r\n\r\n    onShareAppVideo(t, e) {\r\n        undefined === e && (e = true);\r\n        this.shareAppMessage(t, e);\r\n    }\r\n\r\n    reportAnalytics(t, e) {\r\n        undefined === e && (e = {});\r\n        // wx.reportAnalytics(t, e);\r\n    }\r\n\r\n\r\n\r\n    setImRankDataScore() { }\r\n    setImRankDataDuanWei() { }\r\n    createCustomAd() { }\r\n\r\n    updateCustomAd() {\r\n        this.hideCustomAd(true, true);\r\n        this.customadIndex = (this.customadIndex + 4) % this.CustomAd.length;\r\n        this.showCustomAdSelf(this.customadTop, this.customadBottom);\r\n    }\r\n\r\n\r\n    showCustomAd(showTop: boolean, showBottom: boolean): void {\r\n        clearInterval(this.setTimer);\r\n        this.setTimer = window.setInterval(() => this.updateCustomAd(), 10000);\r\n        this.customadTop = showTop;\r\n        this.customadBottom = showBottom;\r\n        this.showCustomAdSelf(showTop, showBottom);\r\n    }\r\n\r\n    showCustomAdSelf(showTop: boolean, showBottom: boolean): void {\r\n        for (let i = 0; i < 4; i++) {\r\n            const ad = this.CustomAd[this.customadIndex + i];\r\n            if (!ad) continue;\r\n\r\n            const shouldShow = (i < 2 && showTop) || (i >= 2 && showBottom);\r\n            shouldShow && (ad.isShow() || ad.show());\r\n        }\r\n    }\r\n\r\n    hideCustomAd(hideTop: boolean, hideBottom: boolean): void {\r\n        this.CustomAd.forEach((ad, index) => {\r\n            const position = index % 4;\r\n            if (ad?.isShow() && (\r\n                (hideTop && position < 2) ||\r\n                (hideBottom && position >= 2)\r\n            )) {\r\n                ad.hide();\r\n            }\r\n        });\r\n    }\r\n\r\n    requestSubscribeMessage() { }\r\n\r\n    onShow(Env) {\r\n        wx.onShow(Env);\r\n    }\r\n\r\n    offShow(Env) {\r\n        wx.offShow(Env);\r\n    }\r\n\r\n    onHide(Env) {\r\n        wx.onHide(Env);\r\n    }\r\n\r\n    offHide(Env) {\r\n        wx.offHide(Env);\r\n    }\r\n\r\n    getLaunchOptionsSync() {\r\n        return wx.getLaunchOptionsSync();\r\n    }\r\n\r\n    /**\r\n     * 微信震动功能\r\n     * @param Type 震动强度类型，可选值为 'heavy' | 'medium' | 'light'，默认为'medium'\r\n     * @param Callbacks 可选的回调函数配置\r\n     * @param Callbacks.success 震动成功的回调函数\r\n     * @param Callbacks.fail 震动失败的回调函数\r\n     * @param Callbacks.complete 震动完成的回调函数（无论成功失败都会执行）\r\n     */\r\n    vibrateShort(\r\n        Type: 'heavy' | 'medium' | 'light' = 'heavy',\r\n        Callbacks?: {\r\n            success?: () => void,\r\n            fail?: (err: { errMsg: string }) => void,\r\n            complete?: () => void\r\n        }\r\n    ): void {\r\n        wx.vibrateShort({ Type, ...Callbacks });\r\n    }\r\n\r\n    shareMessageToFriend() {\r\n        wx.shareMessageToFriend({\r\n            // 必填参数\r\n            openId: '好友的openid', // 要分享的好友openid\r\n\r\n            // 分享内容配置（三选一）\r\n            title: '分享标题',      // 文本分享\r\n            imageUrl: '图片路径',   // 图片分享\r\n            path: '页面路径',       // 小程序页面分享\r\n\r\n            // 可选参数\r\n            templateId: '模板ID',   // 使用服务消息模板\r\n            imageFileId: '媒体ID',  // 使用已上传的媒体文件\r\n\r\n            // 回调函数\r\n            success(res) {\r\n                console.log('分享成功', res)\r\n            },\r\n            fail(err) {\r\n                console.error('分享失败', err)\r\n            },\r\n            complete() {\r\n                console.log('分享完成')\r\n            }\r\n        })\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n"]}