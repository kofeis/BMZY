{"version":3,"sources":["file:///D:/CYDW/WoChengYuTeNiu/assets/Script/Other/SDK/WxApi.ts"],"names":["_decorator","Component","sys","ccclass","property","WxApi","constructor","CustomAd","customadIndex","customadTop","customadBottom","setTimer","isNewUser","times","videoAd","videoPath","InterstitialAd","callback","close_callback","openId","_userInfo","_avatarCallBack","isInterstitialLoading","interstitialRetryCount","MAX_RETRY_COUNT","Data_Get","Data_Name","Default_Value","Data_Value","Data_Raw","localStorage","getItem","JSON","parse","undefined","e","console","error","Data_Set","Data","setItem","stringify","authorize","onLoad","log","loadVideoAd","loadInterstitialAd","wx","onShow","res","scene","login","getUserProfile","timeout","success","code","sendCodeToServer","errMsg","fail","err","complete","request","url","method","data","desc","userInfo","avatarUrl","initAutoSetting","object","autoSetting","authSetting","getUserInfo","creatUserInfoButton","getSetting","isFull","window","type","text","style","left","top","width","height","backgroundColor","color","textAlign","lineHeight","fontSize","button","createUserInfoButton","onTap","destroy","setFrameRate","frameRate","setPreferredFramesPerSecond","addShortcut","openAwemeUserProfile","isPlatform","platform","Platform","WECHAT_GAME","WECHAT_MINI_PROGRAM","isRecordVideo","showToast","title","icon","duration","startRecordVideo","t","stopRecordVideo","loadRecordVideo","adUnitId","createRewardedVideoAd","onClose","isEnded","onError","showVideoAd","successCallback","closeCallback","warn","show","then","catch","reLoadVideo","load","createInterstitialAd","errCode","reLoadInterstitial","showInterstitialAd","setTimeout","scheduleOnce","showShareMenu","shareUrls","randomIndex","Math","floor","random","length","imageUrl","onShareAppMessage","query","shareAppMessage","failCallback","o","n","a","share_show","onShareAppVideo","reportAnalytics","setImRankDataScore","setImRankDataDuanWei","createCustomAd","updateCustomAd","hideCustomAd","showCustomAdSelf","showCustomAd","showTop","showBottom","clearInterval","setInterval","i","ad","shouldShow","isShow","hideTop","hideBottom","forEach","index","position","hide","requestSubscribeMessage","Env","offShow","onHide","offHide","getLaunchOptionsSync","vibrateShort","Type","Callbacks","shareMessageToFriend","path","templateId","imageFileId"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, sys } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\n@ccclass('WxApi')\r\nexport class WxApi extends Component {\r\n\r\n    private CustomAd: any[] = [];\r\n    private customadIndex: number = 0;\r\n    private customadTop: boolean = true;\r\n    private customadBottom: boolean = false;\r\n    private setTimer: number = -1;\r\n    private isNewUser: boolean = false;\r\n    private times: number = 0;\r\n\r\n    private videoAd: any;\r\n    private videoPath?: string;\r\n    private InterstitialAd: any;\r\n\r\n    private callback?: () => void;\r\n    private close_callback?: () => void;\r\n\r\n    openId: string = null;\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    Data_Get(Data_Name: string, Default_Value: any = null): any {\r\n        try {\r\n            let Data_Value;\r\n            const Data_Raw = sys.localStorage.getItem(Data_Name);\r\n            Data_Value = Data_Raw ? JSON.parse(Data_Raw) : null;\r\n            // 返回数据或默认值\r\n            return Data_Value !== undefined ? Data_Value : Default_Value;\r\n        } catch (e) {\r\n            console.error(`[Storage] 读取 ${Data_Name} 失败:`, e);\r\n            return Default_Value;\r\n        }\r\n    }\r\n\r\n    Data_Set(Data_Name: string, Data: any): void {\r\n        try {\r\n            sys.localStorage.setItem(Data_Name, JSON.stringify(Data));\r\n        } catch (e) {\r\n            console.error(`[Storage] 保存 ${Data_Name} 失败:`, e);\r\n        }\r\n    }\r\n\r\n    /**授权 */\r\n    authorize() { }\r\n\r\n    /**\r\n     * 初始化微信平台\r\n     */\r\n    onLoad(): void {\r\n        console.log(\"微信平台初始化\");\r\n        //加载激励视频\r\n        this.loadVideoAd(\"adunit-c21c3786607b856f\");\r\n        //加载插屏广告\r\n        this.loadInterstitialAd(\"adunit-127f752a1e417efd\");\r\n\r\n        // 监听游戏显示事件\r\n        wx.onShow((res: { scene: number }) => {\r\n            console.log(\"wx.onShow:\", res.scene);\r\n        });\r\n\r\n\r\n        this.login();\r\n\r\n        this.getUserProfile();\r\n\r\n\r\n        // this.initAutoSetting();\r\n\r\n\r\n    }\r\n\r\n\r\n    /**登录 */\r\n    login() {\r\n        wx.login({\r\n            timeout: 5000, //超时时间\r\n            success: (res) => {\r\n                if (res.code) {\r\n                    console.log('获取code成功:', res.code);\r\n                    let openId = this.Data_Get(\"openId\");\r\n                    if (openId == null || openId == undefined) {\r\n                        this.sendCodeToServer(res.code);\r\n                    }\r\n                } else {\r\n                    console.error('获取code失败:', res.errMsg);\r\n                }\r\n            },\r\n            fail: (err) => {\r\n                console.error('wx.login调用失败:', err);\r\n            },\r\n            complete: () => {\r\n                console.log('wx.login调用完成');\r\n            }\r\n        });\r\n    }\r\n    // 将code发送到开发者服务器\r\n    sendCodeToServer(code) {\r\n        wx.request({\r\n            url: 'https://yx.megoo.top/wochengyuteniu/user/getWxOpenId',//https://yx.megoo.top/zdydc/user/login  https://yx.megoo.top/wochengyuteniu/user/getWxOpenId   \"o1y5c7B6-v6rHdcphhiYjkSS-k2Y\"\r\n            method: 'POST',\r\n            data: {\r\n                code: code\r\n            },\r\n            success: (res) => {\r\n                console.log('服务器响应:', res.data);\r\n                console.log('openId:', res.data.openId);\r\n                this.openId = res.data.openId;\r\n                this.Data_Set(\"openId\", this.openId);\r\n            }\r\n        });\r\n    }\r\n    /**获取用户信息 */\r\n    getUserProfile() {\r\n        wx.getUserProfile({\r\n            desc: '用于完善会员资料',\r\n            success: (res) => {\r\n                console.log('用户信息:', res.userInfo);\r\n                //获取到头像URL\r\n                const avatarUrl = res.userInfo.avatarUrl;\r\n                console.log(avatarUrl);\r\n                // this.saveUserAvatar(avatarUrl, openId);\r\n            },\r\n            fail: (err) => {\r\n                console.error('获取用户信息失败:', err);\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    // 获取标记权限\r\n    public initAutoSetting() {\r\n        // 获取请求过的权限标记\r\n        let object: any = {\r\n            // 成功回调         \r\n            success: (res) => {\r\n                // 是否授权用户信息\r\n                const autoSetting = res.authSetting;\r\n                if (autoSetting[\"scope.userInfo\"]) {\r\n                    // 已授权\r\n                    this.getUserInfo();\r\n                } else {\r\n                    // 未授权\r\n                    this.creatUserInfoButton();\r\n                }\r\n            },\r\n            // 失败回调\r\n            fail() {\r\n                console.log(\"wx.getSetting获取用户配置失败\");\r\n            },\r\n            // 结束回调(调用成功，失败都会执行)\r\n            complete() {\r\n                console.log(\"wx.getSetting获取用户配置结束\");\r\n            }\r\n        }\r\n        wx.getSetting(object);\r\n    }\r\n\r\n\r\n\r\n    private _userInfo;\r\n    // 头像回调\r\n    private _avatarCallBack = null;\r\n\r\n    // 创建用户授权按钮(仅用于登录页面, 如果用户拒绝授权，则一直显示)\r\n    private creatUserInfoButton(isFull: boolean = false) {\r\n        const wx = window['wx'];\r\n        let object: any = {\r\n            // 按钮类型： text可设置背景色和文本 image仅能设置背景贴图\r\n            type: \"text\",\r\n            // 按钮文本，仅对type为text有效\r\n            text: \"授权\",\r\n            // 按钮样式\r\n            style: {\r\n                left: 70,\r\n                top: 60,\r\n                width: 100,\r\n                height: 40,\r\n                backgroundColor: \"#66CC00\",\r\n                color: \"#FFFFFF\",\r\n                textAlign: 'center',\r\n                lineHeight: 40,\r\n                fontSize: 20,\r\n            },\r\n        };\r\n\r\n        const button = wx.createUserInfoButton(object);\r\n        // 监听用户信息按钮点击事件\r\n        button.onTap((res) => {\r\n            if (res && res.userInfo) {\r\n                console.log(\"用户同意授权\");\r\n                this._userInfo = res.userInfo;\r\n                if (this._avatarCallBack) {\r\n                    this._avatarCallBack(this._userInfo.avatarUrl);\r\n                }\r\n                // 授权成功后，才销毁按钮\r\n                button.destroy();\r\n            } else {\r\n                console.log(\"用户拒绝授权\");\r\n            }\r\n        });\r\n    }\r\n\r\n    // 获取用户信息，需要获取scope.userInfo的授权，也就是getSettings的接口调用\r\n    public getUserInfo() {\r\n        const wx = window['wx'];\r\n        let object: any = {\r\n            success: (res) => {\r\n                console.log(\"通过 getUserInfo 获取的数据:\", res);\r\n                if (res) {\r\n                    this._userInfo = res.userInfo;\r\n                    if (this._avatarCallBack) {\r\n                        this._avatarCallBack(this._userInfo.avatarUrl);\r\n                    }\r\n                }\r\n            },\r\n            fail: () => {\r\n                console.log(\"getUserInfo获取信息失败\");\r\n            },\r\n            complete: () => { },\r\n        };\r\n        wx.getUserInfo(object);\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n    //-----------------------------------\r\n\r\n\r\n    /**\r\n     * 设置游戏帧率\r\n     * @param frameRate 目标帧率（建议30/60）\r\n     */\r\n    setFrameRate(frameRate: number): void {\r\n        wx.setPreferredFramesPerSecond(frameRate);\r\n    }\r\n\r\n    addShortcut() { }\r\n\r\n    openAwemeUserProfile() { }\r\n\r\n    /**\r\n     * 检查是否在微信平台\r\n     */\r\n    isPlatform(): boolean {\r\n        return !!window.wx;\r\n        return (sys.platform === sys.Platform.WECHAT_GAME || sys.platform === sys.Platform.WECHAT_MINI_PROGRAM);\r\n    }\r\n\r\n    /**\r\n     * 检查是否有录制的视频\r\n     */\r\n    isRecordVideo(): boolean {\r\n        return !!this.videoPath;\r\n    }\r\n\r\n    /**\r\n     * 显示Toast提示\r\n     * @param title 提示内容\r\n     * @param icon 图标类型 (\"success\"/\"loading\"/\"none\")\r\n     * @param duration 显示时长(ms)，默认2000\r\n     */\r\n    showToast(title: string, icon: string | \"success\" | \"loading\" | \"none\" = \"none\", duration: number = 2000): void {\r\n        wx.showToast({\r\n            title,\r\n            icon,\r\n            duration\r\n        });\r\n    }\r\n\r\n\r\n    startRecordVideo(t) {\r\n        undefined === t && (t = 90);\r\n    }\r\n\r\n    stopRecordVideo() {\r\n\r\n    }\r\n\r\n    loadRecordVideo() { }\r\n\r\n\r\n\r\n\r\n\r\n\r\n    /**加载激励视频广告 */\r\n    loadVideoAd(adUnitId: string): void {\r\n        this.videoAd = wx.createRewardedVideoAd({\r\n            adUnitId: adUnitId,\r\n        });\r\n        // 广告关闭回调\r\n        this.videoAd.onClose((res: { isEnded: boolean }) => {\r\n            if (res.isEnded) {\r\n                this.callback && this.callback(); // 完整观看回调\r\n            } else {\r\n                this.close_callback && this.close_callback(); // 中途关闭回调\r\n            }\r\n            this.callback = null;\r\n            this.close_callback = null;\r\n        });\r\n        // 广告错误回调\r\n        this.videoAd.onError((err: any) => {\r\n            console.log(\"onError\" + err);\r\n            this.showToast(\"视频加载错误\", \"fail\");\r\n        });\r\n    }\r\n    /**\r\n     * 展示激励视频广告\r\n     * @param successCallback 观看完成的回调\r\n     * @param closeCallback 中途关闭的回调\r\n     */\r\n    showVideoAd(successCallback: () => void, closeCallback?: () => void): void {\r\n        console.log(\"展示激励广告\");\r\n        if (!this.videoAd) {\r\n            console.warn(\"激励广告未初始化\");\r\n            return;\r\n        }\r\n        this.callback = successCallback;\r\n        this.close_callback = closeCallback || null;\r\n        this.videoAd.show()\r\n            .then(() => console.log(\"激励广告展示成功\"))\r\n            .catch((err) => {\r\n                console.error(\"激励广告展示失败:\", err);\r\n                this.reLoadVideo();\r\n            });\r\n    }\r\n    /**\r\n     * 重新加载激励视频广告\r\n     */\r\n    reLoadVideo(): void {\r\n        this.videoAd?.load().then(() => {\r\n            console.log(\"激励广告重载成功\");\r\n            this.videoAd.show();\r\n        }).catch(() => {\r\n            console.error(\"激励广告重载失败\");\r\n            this.showToast(\"视频显示失败, 稍后重试\", \"fail\");\r\n        });\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    createInterstitialAd() { }\r\n    // /**加载插屏广告 */\r\n    // loadInterstitialAd(adUnitId: string): void {\r\n    //     if (this.InterstitialAd) {\r\n    //         this.InterstitialAd.destroy();\r\n    //     }\r\n    //     this.InterstitialAd = wx.createInterstitialAd({\r\n    //         adUnitId: adUnitId,\r\n    //     });\r\n    //     this.InterstitialAd.onLoad(() => {\r\n    //         console.log('插屏广告加载成功')\r\n    //     })\r\n    //     this.InterstitialAd.onClose(res => {\r\n    //         console.log('插屏 广告关闭')\r\n    //     })\r\n    //     // 广告错误回调\r\n    //     this.InterstitialAd.onError((err: any) => {\r\n    //         console.log(\"onError\" + err);\r\n    //         // this.showToast(\"插屏广告加载错误\", \"fail\");\r\n    //     });\r\n    // }\r\n    // /**\r\n    // * 展示插屏广告\r\n    // */\r\n    // showInterstitialAd(): void {\r\n    //     console.log(\"展示插屏广告\");\r\n\r\n    //     if (!this.InterstitialAd) {\r\n    //         console.warn(\"插屏广告未初始化\");\r\n    //         return;\r\n    //     }\r\n    //     this.InterstitialAd.show()\r\n    //         .then(() => {\r\n    //             console.log(\"插屏广告展示成功\")\r\n    //         })\r\n    //         .catch((err) => {\r\n    //             console.log(\"插屏广告展示失败:\", err);\r\n    //             this.scheduleOnce(() => {\r\n    //                 console.log(err.errCode);\r\n    //                 this.reLoadInterstitial();\r\n    //             }, 1);\r\n    //         });\r\n\r\n\r\n    // }\r\n    // /**\r\n    //  * 重新加载插屏广告\r\n    //  */\r\n    // reLoadInterstitial(): void {\r\n    //     // this.loadInterstitialAd(\"adunit-583b7c2c8548161c\");\r\n    //     this.InterstitialAd?.load().then(() => {\r\n    //         console.log(\"插屏广告重载成功\");\r\n\r\n    //         this.scheduleOnce(() => {\r\n    //             this.showInterstitialAd();\r\n    //         }, 1);\r\n    //     }).catch(() => {\r\n    //         console.log(\"插屏广告重载失败\");\r\n    //         // this.showToast(\"视频显示失败, 稍后重试\", \"fail\");\r\n    //         this.scheduleOnce(() => {\r\n    //             this.showInterstitialAd();\r\n    //         }, 1);\r\n    //     });\r\n    // }\r\n\r\n\r\n\r\n\r\n    /** */\r\n    private isInterstitialLoading: boolean = false;\r\n    private interstitialRetryCount: number = 0;\r\n    private readonly MAX_RETRY_COUNT: number = 3;\r\n    /** 加载插屏广告（仅在广告未初始化或需要更换广告ID时调用） */\r\n    loadInterstitialAd(adUnitId: string): void {\r\n        // 如果广告已存在且未更换广告ID，无需重新创建\r\n        if (this.InterstitialAd && this.InterstitialAd.adUnitId === adUnitId) {\r\n            console.log(\"广告已存在，无需重新加载\");\r\n            return;\r\n        }\r\n        // 销毁旧广告（如果有）\r\n        if (this.InterstitialAd) {\r\n            this.InterstitialAd.destroy();\r\n            this.InterstitialAd = null;\r\n        }\r\n        // 创建新广告\r\n        this.InterstitialAd = wx.createInterstitialAd({\r\n            adUnitId: adUnitId,\r\n        });\r\n        this.isInterstitialLoading = true;\r\n        // 监听广告加载成功\r\n        this.InterstitialAd.onLoad(() => {\r\n            console.log(\"插屏广告加载成功\");\r\n            this.isInterstitialLoading = false;\r\n            this.interstitialRetryCount = 0; // 重置重试次数\r\n        });\r\n        // 监听广告关闭\r\n        this.InterstitialAd.onClose(() => {\r\n            console.log(\"插屏广告已关闭\");\r\n            // 广告关闭后可以尝试重新加载\r\n            this.loadInterstitialAd(adUnitId);\r\n        });\r\n        // 监听广告错误\r\n        this.InterstitialAd.onError((err) => {\r\n            console.log(\"插屏广告加载失败:\", err);\r\n            this.isInterstitialLoading = false;\r\n            // 特定错误码处理\r\n            if (err.errCode === 1004) {\r\n                console.log(\"广告已过期，尝试重新加载\");\r\n                this.reLoadInterstitial(adUnitId);\r\n            } else {\r\n                // this.showToast(\"广告加载失败，请稍后再试\", \"fail\");\r\n            }\r\n        });\r\n        // 主动加载广告\r\n        this.InterstitialAd.load().catch((err) => {\r\n            console.log(\"主动加载失败:\", err);\r\n            this.isInterstitialLoading = false;\r\n        });\r\n    }\r\n\r\n    /** 展示插屏广告 */\r\n    showInterstitialAd(): void {\r\n        if (!this.InterstitialAd) {\r\n            console.warn(\"广告未初始化，尝试加载\");\r\n            this.loadInterstitialAd(\"adunit-583b7c2c8548161c\");\r\n            return;\r\n        }\r\n        // 如果广告正在加载，延迟展示\r\n        if (this.isInterstitialLoading) {\r\n            console.log(\"广告正在加载，延迟展示\");\r\n            setTimeout(() => this.showInterstitialAd(), 1000);\r\n            return;\r\n        }\r\n        this.InterstitialAd.show()\r\n            .then(() => {\r\n                console.log(\"插屏广告展示成功\");\r\n            })\r\n            .catch((err) => {\r\n                console.log(\"插屏广告展示失败:\", err);\r\n                // 如果是未加载完成（2004），延迟重试\r\n                if (err.errCode === 2004) {\r\n                    console.log(\"广告未加载完成，1秒后重试\");\r\n                    setTimeout(() => this.showInterstitialAd(), 1000);\r\n                } else {\r\n                    // this.showToast(\"广告展示失败\", \"fail\");\r\n                }\r\n            });\r\n    }\r\n\r\n    /** 重新加载插屏广告（带重试限制） */\r\n    reLoadInterstitial(adUnitId: string): void {\r\n        if (this.interstitialRetryCount >= this.MAX_RETRY_COUNT) {\r\n            console.log(\"已达到最大重试次数，停止加载\");\r\n            return;\r\n        }\r\n        this.interstitialRetryCount++;\r\n        console.log(`第 ${this.interstitialRetryCount} 次重试加载广告`);\r\n        // 延迟1秒后重试，避免频繁请求\r\n        this.scheduleOnce(() => {\r\n            this.loadInterstitialAd(adUnitId);\r\n        }, 1);\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    /**显示分享菜单 */\r\n    showShareMenu(): void {\r\n        const shareUrls = [\"https://example.com/share1.jpg\", \"https://example.com/share2.jpg\"]; // 替换为实际分享图片URL\r\n        const randomIndex = Math.floor(Math.random() * shareUrls.length);\r\n        wx.showShareMenu({\r\n            title: \"试过了，这款小游戏真的好玩！\",\r\n            desc: \"试过了，这款小游戏真的好玩！\",\r\n            imageUrl: shareUrls[randomIndex],\r\n            success() {\r\n                console.log(\"showShareMenu 调用成功\");\r\n            },\r\n            fail(err: any) {\r\n                console.log(\"showShareMenu 调用失败\", err.errMsg);\r\n            },\r\n            complete() {\r\n                console.log(\"showShareMenu 调用完成\");\r\n            }\r\n        });\r\n\r\n        wx.onShareAppMessage(() => {\r\n            return {\r\n                title: \"试过了，这款小游戏真的好玩！\",\r\n                imageUrl: shareUrls[randomIndex],\r\n                query: this.openId // 替换为实际openId\r\n            };\r\n        });\r\n    }\r\n\r\n\r\n    /**主动分享 */\r\n    shareAppMessage(successCallback: () => void, failCallback?: () => void) {\r\n        console.log(\"主动分享\");\r\n        var o;\r\n        var n = this;\r\n        o = \"\"// $z1PublicMager.default.get().config.share_url;\r\n        var a = Math.floor(Math.random() * o.length);\r\n        wx.shareAppMessage({\r\n            title: \"试过了，这款小游戏真的好玩！\",\r\n            imageUrl: o[a],\r\n            query: \"openId=\" + this.openId,\r\n            success() {\r\n                console.log(\"分享视频成功\");\r\n                successCallback();\r\n            },\r\n            fail() {\r\n                console.log(\"需要分享游戏给好友才能获得奖励哟！\");\r\n                failCallback();\r\n            }\r\n        });\r\n    };\r\n\r\n\r\n\r\n\r\n    share_show() { }\r\n\r\n    onShareAppVideo(t, e) {\r\n        undefined === e && (e = true);\r\n        this.shareAppMessage(t, e);\r\n    }\r\n\r\n    reportAnalytics(t, e) {\r\n        undefined === e && (e = {});\r\n        // wx.reportAnalytics(t, e);\r\n    }\r\n\r\n\r\n\r\n    setImRankDataScore() { }\r\n    setImRankDataDuanWei() { }\r\n    createCustomAd() { }\r\n\r\n    updateCustomAd() {\r\n        this.hideCustomAd(true, true);\r\n        this.customadIndex = (this.customadIndex + 4) % this.CustomAd.length;\r\n        this.showCustomAdSelf(this.customadTop, this.customadBottom);\r\n    }\r\n\r\n\r\n    showCustomAd(showTop: boolean, showBottom: boolean): void {\r\n        clearInterval(this.setTimer);\r\n        this.setTimer = window.setInterval(() => this.updateCustomAd(), 10000);\r\n        this.customadTop = showTop;\r\n        this.customadBottom = showBottom;\r\n        this.showCustomAdSelf(showTop, showBottom);\r\n    }\r\n\r\n    showCustomAdSelf(showTop: boolean, showBottom: boolean): void {\r\n        for (let i = 0; i < 4; i++) {\r\n            const ad = this.CustomAd[this.customadIndex + i];\r\n            if (!ad) continue;\r\n\r\n            const shouldShow = (i < 2 && showTop) || (i >= 2 && showBottom);\r\n            shouldShow && (ad.isShow() || ad.show());\r\n        }\r\n    }\r\n\r\n    hideCustomAd(hideTop: boolean, hideBottom: boolean): void {\r\n        this.CustomAd.forEach((ad, index) => {\r\n            const position = index % 4;\r\n            if (ad?.isShow() && (\r\n                (hideTop && position < 2) ||\r\n                (hideBottom && position >= 2)\r\n            )) {\r\n                ad.hide();\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    requestSubscribeMessage() { }\r\n\r\n    onShow(Env) {\r\n        wx.onShow(Env);\r\n    }\r\n\r\n    offShow(Env) {\r\n        wx.offShow(Env);\r\n    }\r\n\r\n    onHide(Env) {\r\n        wx.onHide(Env);\r\n    }\r\n\r\n    offHide(Env) {\r\n        wx.offHide(Env);\r\n    }\r\n\r\n\r\n    getLaunchOptionsSync() {\r\n        return wx.getLaunchOptionsSync();\r\n    }\r\n\r\n    /**\r\n     * 微信震动功能\r\n     * @param Type 震动强度类型，可选值为 'heavy' | 'medium' | 'light'，默认为'medium'\r\n     * @param Callbacks 可选的回调函数配置\r\n     * @param Callbacks.success 震动成功的回调函数\r\n     * @param Callbacks.fail 震动失败的回调函数\r\n     * @param Callbacks.complete 震动完成的回调函数（无论成功失败都会执行）\r\n     */\r\n    vibrateShort(\r\n        Type: 'heavy' | 'medium' | 'light' = 'heavy',\r\n        Callbacks?: {\r\n            success?: () => void,\r\n            fail?: (err: { errMsg: string }) => void,\r\n            complete?: () => void\r\n        }\r\n    ): void {\r\n        wx.vibrateShort({ Type, ...Callbacks });\r\n    }\r\n\r\n\r\n\r\n\r\n    shareMessageToFriend() {\r\n        wx.shareMessageToFriend({\r\n            // 必填参数\r\n            openId: '好友的openid', // 要分享的好友openid\r\n\r\n            // 分享内容配置（三选一）\r\n            title: '分享标题',      // 文本分享\r\n            imageUrl: '图片路径',   // 图片分享\r\n            path: '页面路径',       // 小程序页面分享\r\n\r\n            // 可选参数\r\n            templateId: '模板ID',   // 使用服务消息模板\r\n            imageFileId: '媒体ID',  // 使用已上传的媒体文件\r\n\r\n            // 回调函数\r\n            success(res) {\r\n                console.log('分享成功', res)\r\n            },\r\n            fail(err) {\r\n                console.error('分享失败', err)\r\n            },\r\n            complete() {\r\n                console.log('分享完成')\r\n            }\r\n        })\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n"]}