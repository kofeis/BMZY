{"version":3,"sources":["file:///Users/jingfaxie/Documents/UGit/minigame3/Aby/assets/scripts/framework/common/NodePool.ts"],"names":["Component","Prefab","_decorator","cocosUtil","utilTools","ccclass","property","NodePool","itemNode","freeNodeArr","itemNodeArr","onLoad","init","instantiate","getNode","node","shift","console","error","parent","active","use","recycleNode","indexOf","push","recycleAllNode","forArr","children","forEachUseNode","cb","index"],"mappings":";;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,U,OAAAA,U;;AACzBC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,S,iBAAAA,S;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBJ,U;;0BAGjBK,Q,WADZF,OAAO,CAAC,UAAD,C,gBAAR,MACaE,QADb,SAC8BP,SAD9B,CACwC;AAAA;AAAA;AAAA,eAEpCQ,QAFoC;AAAA,eAIpCC,WAJoC,GAIjB,EAJiB;AAAA,eAKpCC,WALoC,GAKjB,EALiB;AAAA;;AAOpCC,QAAAA,MAAM,GAAG,CAER;;AAEDC,QAAAA,IAAI,CAACJ,QAAD,EAA0B;AAC1B,cAAIA,QAAQ,YAAYP,MAAxB,EAAgC;AAC5BO,YAAAA,QAAQ,GAAG;AAAA;AAAA,wCAAUK,WAAV,CAAsBL,QAAtB,CAAX;AACH;;AACD,eAAKA,QAAL,GAAgBA,QAAhB;AACH;;AAEDM,QAAAA,OAAO,GAAG;AACN,cAAIC,IAAI,GAAG,KAAKN,WAAL,CAAiBO,KAAjB,EAAX;;AACA,cAAI,CAACD,IAAL,EAAW;AACP,gBAAI,CAAC,KAAKP,QAAV,EAAoB;AAChBS,cAAAA,OAAO,CAACC,KAAR,CAAc,KAAKH,IAAnB;AACH;;AACDA,YAAAA,IAAI,GAAG;AAAA;AAAA,wCAAUF,WAAV,CAAsB,KAAKL,QAA3B,CAAP;AACAO,YAAAA,IAAI,CAACI,MAAL,GAAc,KAAKJ,IAAnB;AACH;;AACD,cAAI,CAACA,IAAI,CAACK,MAAV,EAAkB;AACdL,YAAAA,IAAI,CAACK,MAAL,GAAc,IAAd;AACH;;AACDL,UAAAA,IAAI,CAACM,GAAL,GAAW,IAAX;AAEA,iBAAON,IAAP;AACH;;AAEDO,QAAAA,WAAW,CAACP,IAAD,EAAa;AACpB,cAAI,CAAC,KAAKP,QAAV,EAAoB;AAChB,iBAAKA,QAAL,GAAgBO,IAAhB;AACH;;AACDA,UAAAA,IAAI,CAACK,MAAL,GAAc,KAAd;;AACA,cAAI,KAAKX,WAAL,CAAiBc,OAAjB,CAAyBR,IAAzB,KAAkC,CAAC,CAAvC,EAA0C;AACtC,iBAAKN,WAAL,CAAiBe,IAAjB,CAAsBT,IAAtB;AACH,WAPmB,CAQpB;;;AACAA,UAAAA,IAAI,CAACM,GAAL,GAAW,KAAX;AACH;;AAEDI,QAAAA,cAAc,GAAG;AACb;AAAA;AAAA,sCAAUC,MAAV,CAAiB,KAAKX,IAAL,CAAUY,QAA3B,EAAsCZ,IAAD,IAAgB;AACjD,iBAAKO,WAAL,CAAiBP,IAAjB;AACH,WAFD;AAGH;;AAEDa,QAAAA,cAAc,CAACC,EAAD,EAAe;AACzB;AAAA;AAAA,sCAAUH,MAAV,CAAiB,KAAKX,IAAL,CAAUY,QAA3B,EAAqC,CAACZ,IAAD,EAAYe,KAAZ,KAA8B;AAC/D,gBAAI,CAACf,IAAI,CAACM,GAAV,EAAe;AACX;AACH;;AACDQ,YAAAA,EAAE,CAACd,IAAD,EAAOe,KAAP,CAAF;AACH,WALD;AAMH;;AA5DmC,O","sourcesContent":["import { Component, Node, Prefab, _decorator } from 'cc';\nimport { cocosUtil } from '../utils/CocosUtil';\nimport { utilTools } from '../utils/UtilTools';\nconst { ccclass, property } = _decorator;\n\n@ccclass('NodePool')\nexport class NodePool extends Component {\n\n    itemNode: any;\n\n    freeNodeArr: any = [];\n    itemNodeArr: any = [];\n\n    onLoad() {\n\n    }\n\n    init(itemNode: Node | Prefab) {\n        if (itemNode instanceof Prefab) {\n            itemNode = cocosUtil.instantiate(itemNode);\n        }\n        this.itemNode = itemNode;\n    }\n\n    getNode() {\n        let node = this.freeNodeArr.shift();\n        if (!node) {\n            if (!this.itemNode) {\n                console.error(this.node);\n            }\n            node = cocosUtil.instantiate(this.itemNode);\n            node.parent = this.node;\n        }\n        if (!node.active) {\n            node.active = true;\n        }\n        node.use = true;\n\n        return node;\n    }\n\n    recycleNode(node: Node) {\n        if (!this.itemNode) {\n            this.itemNode = node;\n        }\n        node.active = false;\n        if (this.freeNodeArr.indexOf(node) == -1) {\n            this.freeNodeArr.push(node);\n        }\n        // @ts-ignore\n        node.use = false;\n    }\n\n    recycleAllNode() {\n        utilTools.forArr(this.node.children, (node: Node) => {\n            this.recycleNode(node);\n        });\n    }\n\n    forEachUseNode(cb: Function) {\n        utilTools.forArr(this.node.children, (node: any, index: number) => {\n            if (!node.use) {\n                return;\n            }\n            cb(node, index);\n        });\n    }\n\n}\n"]}