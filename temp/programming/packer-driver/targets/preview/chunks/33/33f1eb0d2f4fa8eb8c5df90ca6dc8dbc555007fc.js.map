{"version":3,"sources":["file:///D:/Cocos/Project/XH/assets/Script/Game/GameMode/PanelFindActor.ts"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAGA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAKA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAOA","sourcesContent":["// import { _decorator, Component, find, instantiate, Label, Node, Prefab, resources, Sprite, SpriteFrame, tween, UITransform, v2, v3, Vec2, Animation, log, UIOpacity } from 'cc';\r\n// import { PanelTemplate } from './PanelTemplate';\r\n// import { Tool_Other } from '../../Tool/Tool_Other';\r\n// import { Tool_UI } from '../../Tool/Tool_UI';\r\n// import { Tool_Event } from '../../Tool/Tool_Event';\r\n// import { PlatformApi } from '../../Other/SDK/PlatformApi';\r\n// const { ccclass, property } = _decorator;\r\n\r\n// @ccclass('PanelFindActor')\r\n// export class PanelFindActor extends PanelTemplate {\r\n\r\n//     /**关卡等级 */\r\n//     FindActorLevel: number = null;\r\n\r\n//     /**关卡背景 */\r\n//     LevelBg: Node = null;\r\n//     /**演员节点 */\r\n//     Actors: Node = null;\r\n\r\n//     Min_X: number = null;\r\n//     Max_X: number = null;\r\n//     Min_Y: number = null;\r\n//     Max_Y: number = null;\r\n\r\n\r\n//     /**演员数量 */\r\n//     ActorNumber: number = 10;\r\n\r\n//     /**缩放配置 */\r\n//     ScaleArr: number[] = [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1];\r\n\r\n//     async onLoad() {\r\n//         super.onLoad();\r\n//     }\r\n\r\n//     async onEnable() {\r\n//         if (!this.IsInit) {\r\n//             await this.LoadPanel();\r\n//         }\r\n//         this.GameStart();\r\n//         this.Resoure_Data.Music_Play(\"Audio/BGMGame\");\r\n//     }\r\n\r\n//     async start() {\r\n\r\n//     }\r\n\r\n//     /**加载面板 */\r\n//     async LoadPanel(): Promise<void> {\r\n//         return new Promise(async (resolve, reject) => {\r\n//             /**绑定关键节点 */\r\n//             this.LevelBg = find(\"Window/LevelBg\", this.node);\r\n//             this.Actors = find(\"Window/Actors\", this.node);\r\n//             this.BtnTip = find(\"Panel/PanelBtn/BtnTip\", this.node);\r\n//             this.BtnSetting = find(\"Panel/PanelBtn/BtnSetting\", this.node);\r\n//             this.PanelVictory = find(\"Panel/PanelVictory\", this.node);\r\n//             this.PanelVictory.active = false;\r\n//             this.BtnNext = find(\"BtnNext\", this.PanelVictory);\r\n\r\n//             this.Max_X = this.Actors.getComponent(UITransform).width / 2;\r\n//             this.Min_X = -this.Max_X;\r\n//             this.Max_Y = this.Actors.getComponent(UITransform).height / 2;\r\n//             this.Min_Y = -this.Max_Y;\r\n//             /**注册按钮事件 */\r\n//             await this.OnBtn(this.Game_Script.AnimSwitch);\r\n//             this.IsInit = true;\r\n//             resolve();\r\n//         });\r\n//     }\r\n\r\n//     /**注册按钮 */\r\n//     async OnBtn(AnimSwitch: boolean = false) {\r\n//         /**设置按钮事件 */\r\n//         Tool_Event.instance.On_Event_TOUCH_END(this.BtnTip, this.BtnTipCall, this);\r\n//         Tool_Event.instance.On_Event_TOUCH_END(this.BtnNext, this.BtnNextCall, this);\r\n//         Tool_Event.instance.On_Event_TOUCH_END(this.BtnSetting, this.BtnSettingCall, this);\r\n//         /**设置按钮动画 */\r\n//         Tool_Event.instance.Set_Btn_Event_Anim(this.BtnTip, AnimSwitch);\r\n//         Tool_Event.instance.Set_Btn_Event_Anim(this.BtnNext, AnimSwitch);\r\n//         Tool_Event.instance.Set_Btn_Event_Anim(this.BtnSetting, AnimSwitch);\r\n\r\n\r\n\r\n\r\n\r\n\r\n//         Tool_Event.instance.On_Event_TOUCH_END(find(\"Window/LevelBg\", this.node), this.ChooseWrongCall, this);\r\n\r\n//         let PrefabActor = await this.Resoure_Data.Load_Prefab(\"Prefab/PanelFindActor/Actor\");\r\n\r\n//         for (let i = 0; i < this.ActorNumber; i++) {\r\n//             let Actor = Tool_UI.instance.Set_Prefab_Node(PrefabActor, this.Actors, v3(0, 0, 0), \"\");\r\n//             Tool_Event.instance.On_Event_TOUCH_END(Actor, () => {\r\n//                 if (Actor.getChildByName(\"Select\").active) {\r\n//                     return;\r\n//                 }\r\n//                 this.ChooseCorrectCall(Actor);\r\n//                 this.Score++;\r\n//                 if (this.Score == this.ScoreTarget) {\r\n//                     this.GameVictory();\r\n//                 }\r\n//             })\r\n//             Actor.getChildByName(\"Tip\").active = false;\r\n//             Actor.getChildByName(\"Select\").active = false;\r\n//         }\r\n\r\n\r\n//     }\r\n\r\n\r\n\r\n\r\n//     /**游戏初始 */\r\n//     GameInit() {\r\n//         this.Score = 0;\r\n//         this.ScoreTarget = 10;\r\n//     }\r\n\r\n//     /**游戏开始 */\r\n//     async GameStart() {\r\n//         this.GameInit();\r\n//         this.PanelVictory.active = false;\r\n//         this.node.getChildByName(\"Title\").getChildByName(\"Leves\").getComponent(Label).string = `找找小熊·${this.Game_Script.FindActorLevel + 1}关`;\r\n//         let PosArr = Tool_Other.instance.Get_Random_Pos_Arr(this.Actors.children.length, this.Min_X, this.Max_X, this.Min_Y, this.Max_Y, 200);\r\n//         for (let i = 0; i < this.Actors.children.length; i++) {\r\n//             this.Actors.children[i].position = PosArr[i];\r\n//             this.Actors.children[i].getChildByName(\"Sp\").scale = v3(this.ScaleArr[i], this.ScaleArr[i], 1);\r\n//             this.Actors.children[i].getChildByName(\"Sp\").getComponent(Animation).play();\r\n//             this.Actors.children[i].getChildByName(\"Tip\").active = false;\r\n//             this.Actors.children[i].getChildByName(\"Select\").active = false;\r\n//         }\r\n\r\n//     }\r\n\r\n//     /**游戏胜利 */\r\n//     GameVictory() {\r\n//         /**胜利音效 */\r\n//         this.Resoure_Data.Sound_Play(\"Audio/Sound/Victory\");\r\n\r\n\r\n//         PlatformApi.instance.showInterstitialAd();\r\n//         this.Game_Script.FindActorLevel++;\r\n//         this.Game_Script.FindActorScore += this.Game_Script.IsHint ? 1 : 2;\r\n//         /**保存数据 */\r\n//         this.Game_Script.DataSet();\r\n//         this.Game_Script.UpdateScene();\r\n//         find(\"WinBanner/Condition1/Correct\", this.PanelVictory).active = !this.Game_Script.IsHint\r\n//         find(\"WinBanner/Condition1/Wrong\", this.PanelVictory).active = this.Game_Script.IsHint;\r\n//         find(\"WinBanner/Stars/StarR\", this.PanelVictory).getComponent(Sprite).grayscale = this.Game_Script.IsHint;\r\n//         find(\"Light\", this.PanelVictory).getComponent(Animation).play();\r\n//         this.PanelVictory.active = true;\r\n\r\n//     }\r\n\r\n\r\n//     /**选择正确回调 */\r\n//     ChooseCorrectCall(Actor: Node) {\r\n//         Actor.getChildByName(\"Tip\").active = false;\r\n//         Actor.getChildByName(\"Select\").active = true;\r\n//         tween(Actor.getChildByName(\"Select\").getComponent(Sprite))\r\n//             .set({ fillRange: 0 })\r\n//             .to(0.2, { fillRange: 1 })\r\n//             .start();\r\n//     };\r\n\r\n//     /**选择错误回调 */\r\n//     async ChooseWrongCall(Event: any) {\r\n//         /**错误 */\r\n//         this.Resoure_Data.Sound_Play(\"Audio/Sound/Error\");\r\n//         let PrefabError = await this.Resoure_Data.Load_Prefab(\"Prefab/PanelFindActor/Error\");\r\n//         let Parent = find(\"Window/LevelBg\", this.node);\r\n//         let Pos_Touch = Tool_UI.instance.Get_Touch_Position(Event);\r\n//         let NodeError = Tool_UI.instance.Set_Prefab_Node(PrefabError, Parent, Pos_Touch, \"\");\r\n//         tween(NodeError)\r\n//             .parallel(\r\n//                 tween().to(0.5, { scale: v3(1.2, 1.2, 1) }),\r\n//                 tween(NodeError.getComponent(UIOpacity)).to(0.5, { opacity: 0 })\r\n//             )\r\n//             .call(() => {\r\n//                 NodeError.destroy();\r\n//             })\r\n//             .start();\r\n//     }\r\n\r\n//     /**提示按钮回调 */\r\n//     BtnTipCall() {\r\n//         this.Resoure_Data.Sound_Play(\"Audio/SoundBtn\");\r\n//         let NodeTip: Node = null;\r\n//         this.Actors.children.forEach((element) => {\r\n//             if (!element.getChildByName(\"Select\").active && !element.getChildByName(\"Tip\").active) {\r\n//                 NodeTip = element.getChildByName(\"Tip\");\r\n//                 return;\r\n//             }\r\n//         });\r\n//         if (NodeTip == null) {\r\n//             console.log(\"没有可以提示的了\");\r\n//         } else {\r\n//             NodeTip.active = true;\r\n//             this.Game_Script.IsHint = true;\r\n//         }\r\n//     }\r\n\r\n//     /**下一关按钮回调 */\r\n//     BtnNextCall() {\r\n//         this.Resoure_Data.Sound_Play(\"Audio/SoundBtn\");\r\n//         this.GameStart();\r\n//     }\r\n\r\n//     /**设置按钮回调 */\r\n//     BtnSettingCall() {\r\n//         this.Resoure_Data.Sound_Play(\"Audio/SoundBtn\");\r\n//         this.Game_Script.UpdatePanelSetting(true);\r\n//     }\r\n\r\n\r\n//     //     startGame() {\r\n//     //         this.winNode.active = false;\r\n//     //         this.defeatNode.active = false;\r\n//     //         this.clearWolves();\r\n//     //         this.setupBackground();\r\n//     //         this.spawnWolves();\r\n//     //         this.isGaming = true;\r\n//     //         this.wolvesFound = 0;\r\n//     //         this.remainingTime = 60;\r\n//     //     }\r\n\r\n//     //     clearWolves() {\r\n//     //         this.wolvesContainer.removeAllChildren();\r\n//     //     }\r\n\r\n//     //     setupBackground() {\r\n//     //         const bgIndex = (this.currentLevel - 1) % this.levelBackgrounds.length;\r\n//     //         this.background.spriteFrame = new SpriteFrame(resources.get(this.levelBackgrounds[bgIndex]));\r\n//     //     }\r\n\r\n//     //     spawnWolves() {\r\n//     //         const positions = this.generatePositions(10, -300, -410, 300, 410);\r\n\r\n//     //         positions.forEach((pos, index) => {\r\n//     //             const Actor = instantiate(this.ActorPrefab);\r\n//     //             Actor.setPosition(pos);\r\n//     //             this.wolvesContainer.addChild(Actor);\r\n\r\n//     //             const scale = index < 10 - this.smallWolvesCount ? \r\n//     //                 Math.random() * 0.9 + 0.1 : \r\n//     //                 Math.random() * 0.05 + 0.025;\r\n\r\n//     //             Actor.setScale(scale);\r\n\r\n//     //             Actor.on(Node.EventType.TOUCH_END, () => this.onActorFound(Actor), this);\r\n//     //         });\r\n//     //     }\r\n\r\n//     //     generatePositions(count: number, minX: number, minY: number, maxX: number, maxY: number): Vec2[] {\r\n//     //         const positions: Vec2[] = [];\r\n//     //         const positionSet = new Set<string>();\r\n\r\n//     //         while (positions.length < count) {\r\n//     //             const x = Math.random() * (maxX - minX) + minX;\r\n//     //             const y = Math.random() * (maxY - minY) + minY;\r\n//     //             const pos = v2(x, y);\r\n//     //             const posKey = `${x},${y}`;\r\n\r\n//     //             if (!positionSet.has(posKey) && !this.isOverlapping(pos, positions, 150)) {\r\n//     //                 positions.push(pos);\r\n//     //                 positionSet.add(posKey);\r\n//     //             }\r\n//     //         }\r\n\r\n//     //         return positions;\r\n//     //     }\r\n\r\n//     //     isOverlapping(newPos: Vec2, existingPositions: Vec2[], minDistance: number): boolean {\r\n//     //         return existingPositions.some(pos => {\r\n//     //             return newPos.sub(pos).mag() < minDistance;\r\n//     //         });\r\n//     //     }\r\n\r\n//     //     onActorFound(Actor: Node) {\r\n//     //         if (!this.isGaming) return;\r\n\r\n//     //         const ActorController = Actor.getComponent(\"ActorController\"); // 假设有ActorController组件\r\n//     //         if (!ActorController.isFound) {\r\n//     //             this.wolvesFound++;\r\n//     //             ActorController.markAsFound();\r\n\r\n//     //             if (this.wolvesFound >= 10) {\r\n//     //                 this.winGame();\r\n//     //             }\r\n//     //         }\r\n//     //     }\r\n\r\n//     //     onBackgroundTap(event: Event.EventTouch) {\r\n//     //         if (!this.isGaming) return;\r\n\r\n//     //         const touchPos = this.background.node.convertToNodeSpaceAR(event.getLocation());\r\n//     //         this.showErrorEffect(touchPos);\r\n//     //         this.remainingTime -= 5;\r\n//     //     }\r\n\r\n//     //     showErrorEffect(position: Vec2) {\r\n//     //         const effect = instantiate(this.errorEffectPrefab);\r\n//     //         effect.setPosition(position);\r\n//     //         this.background.node.addChild(effect);\r\n\r\n//     //         tween(effect)\r\n//     //             .to(0.2, { scale: 1.1 })\r\n//     //             .to(0.2, { opacity: 0 })\r\n//     //             .call(() => effect.destroy())\r\n//     //             .start();\r\n//     //     }\r\n\r\n//     //     update(dt: number) {\r\n//     //         if (!this.isGaming) return;\r\n\r\n//     //         this.remainingTime -= dt;\r\n//     //         this.timeLabel.string = Math.ceil(this.remainingTime).toString();\r\n\r\n//     //         if (this.remainingTime <= 0) {\r\n//     //             this.defeat();\r\n//     //         }\r\n//     //     }\r\n\r\n//     //     winGame() {\r\n//     //         this.isGaming = false;\r\n//     //         this.winNode.active = true;\r\n//     //         this.winNode.opacity = 0;\r\n\r\n//     //         tween(this.winNode)\r\n//     //             .to(0.2, { opacity: 255 })\r\n//     //             .start();\r\n//     //     }\r\n\r\n//     //     defeat() {\r\n//     //         this.isGaming = false;\r\n//     //         this.defeatNode.active = true;\r\n//     //         this.defeatNode.opacity = 0;\r\n\r\n//     //         tween(this.defeatNode)\r\n//     //             .to(0.2, { opacity: 255 })\r\n//     //             .start();\r\n//     //     }\r\n\r\n//     //     restartGame() {\r\n//     //         this.startGame();\r\n//     //     }\r\n\r\n//     //     nextLevel() {\r\n//     //         this.currentLevel++;\r\n//     //         this.smallWolvesCount = this.calculateSmallWolvesCount();\r\n//     //         this.startGame();\r\n//     //     }\r\n\r\n//     //     calculateSmallWolvesCount(): number {\r\n//     //         if (this.currentLevel < 3) return 2;\r\n//     //         if (this.currentLevel < 6) return 4;\r\n//     //         return 6;\r\n//     //     }\r\n//     // }\r\n\r\n\r\n\r\n\r\n\r\n\r\n// }\r\n\r\n\r\n\r\n\r\n\r\n\r\n"]}