{"version":3,"sources":["file:///Users/jingfaxie/Documents/UGit/minigame3/Aby/assets/scripts/game/layer/HomeLayer.ts"],"names":["_decorator","BaseLayer","constants","audioManager","gameModel","msgcmd","UserData","designManager","tweenUtil","ccclass","property","HomeLayer","_mapIcon","onLoad","getNodeByPath","onEnable","playMusic","audioNames","bgMusic","addEventArr","mapEnter","initUI","initMapLevel","tweenUpDown","onSettingBtnClick","playEffect","btnClick","openLayer","layers","SettingLayer","onStartBtnClick","lastRow","getLastRow","tableNames","food","getInstance","openLevel","type","console","log","enterMapWithMapId","mapEnterEventCb","data","TransLayer","loadMapRes","percent","GameLayer","closeLayer"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;;AACAC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,S,iBAAAA,S;;AAEAC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,S,iBAAAA,S;;;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBV,U;;2BAGjBW,S,WADZF,OAAO,CAAC,WAAD,C,gBAAR,MACaE,SADb;AAAA;AAAA,kCACyC;AAAA;AAAA;AAAA,eAE7BC,QAF6B;AAAA;;AAIrCC,QAAAA,MAAM,GAAG;AACL,gBAAMA,MAAN;AAEA,eAAKD,QAAL,GAAgB,KAAKE,aAAL,CAAmB,gBAAnB,CAAhB;AACH;;AAEDC,QAAAA,QAAQ,GAAG;AACP,gBAAMA,QAAN;AACA;AAAA;AAAA,4CAAaC,SAAb,CAAuB;AAAA;AAAA,sCAAUC,UAAV,CAAqBC,OAA5C;AAEA,gBAAMC,WAAN,CAAkB,CACd;AAAA;AAAA,gCAAOC,QADO,CAAlB;AAGH;;AAEDC,QAAAA,MAAM,GAAG;AACL,eAAKC,YAAL;AACH;;AAEOA,QAAAA,YAAY,GAAG;AACnB;AACA;AACA;AAEA;AAAA;AAAA,sCAAUC,WAAV,CAAsB,KAAKX,QAA3B,EAAqC,EAArC;AACH;;AAEDY,QAAAA,iBAAiB,GAAG;AAChB;AAAA;AAAA,4CAAaC,UAAb,CAAwB;AAAA;AAAA,sCAAUR,UAAV,CAAqBS,QAA7C;AACA,eAAKC,SAAL,CAAe;AAAA;AAAA,sCAAUC,MAAV,CAAiBC,YAAhC;AACH;;AAEDC,QAAAA,eAAe,GAAG;AACd;AAAA;AAAA,4CAAaL,UAAb,CAAwB;AAAA;AAAA,sCAAUR,UAAV,CAAqBS,QAA7C;AACA,cAAIK,OAAO,GAAG;AAAA;AAAA,8CAAcC,UAAd,CAAyB;AAAA;AAAA,sCAAUC,UAAV,CAAqBC,IAA9C,CAAd;;AACA,cAAI;AAAA;AAAA,oCAASC,WAAT,GAAuBC,SAAvB,GAAmCL,OAAO,CAACM,IAA/C,EAAqD;AACjD;AACAC,YAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;AACA;AACH;;AAED;AAAA;AAAA,sCAAUC,iBAAV,CAA4B;AAAA;AAAA,oCAASL,WAAT,GAAuBC,SAAnD;AACH;;AAEDK,QAAAA,eAAe,CAACC,IAAD,EAAY;AACvB,eAAKf,SAAL,CAAe;AAAA;AAAA,sCAAUC,MAAV,CAAiBe,UAAhC;AACA;AAAA;AAAA,sCAAUC,UAAV,CAAsBC,OAAD,IAAqB,CACtC;AACH,WAFD,EAEG,MAAM;AACL,iBAAKlB,SAAL,CAAe;AAAA;AAAA,wCAAUC,MAAV,CAAiBkB,SAAhC,EAA2CJ,IAA3C,EAAiD,IAAjD,EAAuD,MAAM;AACzD,mBAAKK,UAAL,CAAgB;AAAA;AAAA,0CAAUnB,MAAV,CAAiBe,UAAjC;AACH,aAFD;AAGH,WAND;AAOH;;AAzDoC,O","sourcesContent":["import { _decorator, Component, Node, ProgressBar } from 'cc';\nimport { BaseLayer } from '../../framework/common/BaseLayer';\nimport { constants } from '../data/Constants';\nimport { resManager } from '../../framework/manager/ResManager';\nimport { audioManager } from '../../framework/manager/AudioManager';\nimport { gameModel } from '../model/GameModel';\nimport { msgcmd } from '../data/MsgCmd';\nimport { UserData } from '../model/UserData';\nimport { designManager } from '../../framework/manager/DesignManager';\nimport { tweenUtil } from '../../framework/utils/TweenUtil';\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('HomeLayer')\nexport class HomeLayer extends BaseLayer {\n    \n    private _mapIcon: Node;\n\n    onLoad() {\n        super.onLoad();\n        \n        this._mapIcon = this.getNodeByPath(\"UI/Region/Icon\");\n    }\n\n    onEnable() {\n        super.onEnable();\n        audioManager.playMusic(constants.audioNames.bgMusic);\n\n        super.addEventArr([\n            msgcmd.mapEnter\n        ])\n    }\n\n    initUI() {\n        this.initMapLevel();\n    }\n\n    private initMapLevel() {\n        // let mapData = designManager.getTable(constants.tableNames.map);\n        // let curMapId = RoleData.getInstance().getCurMap();\n        // let openLevel = RoleData.getInstance().openLevel;\n \n        tweenUtil.tweenUpDown(this._mapIcon, 15);\n    }\n\n    onSettingBtnClick() {\n        audioManager.playEffect(constants.audioNames.btnClick);\n        this.openLayer(constants.layers.SettingLayer);\n    }\n\n    onStartBtnClick() {\n        audioManager.playEffect(constants.audioNames.btnClick);\n        let lastRow = designManager.getLastRow(constants.tableNames.food);\n        if (UserData.getInstance().openLevel > lastRow.type) {\n            // TODO 处理通关情形\n            console.log(\"通关\")\n            return;\n        }\n        \n        gameModel.enterMapWithMapId(UserData.getInstance().openLevel);\n    }\n\n    mapEnterEventCb(data: any) {\n        this.openLayer(constants.layers.TransLayer);\n        gameModel.loadMapRes((percent: number) => {\n            // TODO 刷新加载进度\n        }, () => {\n            this.openLayer(constants.layers.GameLayer, data, null, () => {\n                this.closeLayer(constants.layers.TransLayer);\n            });\n        });\n    }\n}\n"]}