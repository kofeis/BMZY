{"version":3,"sources":["file:///Users/jingfaxie/Documents/UGit/minigame3/Aby/assets/Script/Other/SDK/HttpRequest.ts"],"names":["_decorator","Component","sys","ccclass","property","HttpRequest","getOpenId","callback","window","wx","login","success","res","console","log","code","params","request","response","openId","error","fail","err","isNative","endpoint","data","successCallback","errorCallback","isAbsoluteUrl","method","url","requestData","JSON","stringify","xhr","XMLHttpRequest","onreadystatechange","readyState","status","responseText","parse","e","open","toUpperCase","setRequestHeader","send","getplayerData","t","errno","instance"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, sys } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('HttpRequest')\nexport class HttpRequest extends Component {\n    public static readonly instance = new HttpRequest();\n\n    /**\n     * 获取微信OpenID\n     * @param callback 获取成功后的回调函数\n     */\n    getOpenId(callback?: (data?: any) => void): void {\n        // 检查是否在微信/头条环境\n        if (window.wx) {\n            // 调用微信登录接口\n            wx.login({\n                success: (res: { code: string }) => {\n                    console.log(\"微信登录成功，获取到code:\", res.code);\n                    // 准备请求参数\n                    const params = {\n                        code: res.code,  // 微信临时登录凭证\n                    };\n                    // 向服务器发送请求\n                    this.request(\n                        \"zdydc/user/login\",  // 登录接口路径\n                        params,\n                        (response: any) => {\n                            if (response.openId) {\n                                console.log(\"成功获取openid:\", response);\n                            } else {\n                                console.log(\"获取openid失败:\", response);\n                            }\n                            // 执行回调\n                            callback?.(response);\n                        },\n                        (error: any) => {\n                            console.error(\"登录接口调用失败:\", error);\n                            callback?.(null);\n                        }\n                    );\n                },\n                fail: (err: any) => {\n                    console.error(\"微信登录失败:\", err);\n                    callback?.(null);\n                }\n            });\n        } else {\n            // 非微信环境直接执行回调\n            if (callback && !sys.isNative) {\n                callback();\n            }\n        }\n    }\n\n    /**\n     * 通用HTTP请求方法\n     * @param endpoint API端点路径\n     * @param data 请求数据\n     * @param successCallback 成功回调\n     * @param errorCallback 失败回调\n     * @param isAbsoluteUrl 是否使用绝对URL\n     * @param method HTTP方法，默认POST\n     */\n    request(\n        endpoint: string,\n        data: any,\n        successCallback: (response: any) => void,\n        errorCallback: (error: any) => void,\n        isAbsoluteUrl: boolean = false,\n        method: string = \"POST\"\n    ): void {\n        // 构造完整URL\n        let url = \"https://yx.megoo.top/\" + endpoint;\n        console.log(\"请求URL:\", url, \"请求数据:\", data);\n\n        // 如果已经是绝对URL，则直接使用\n        if (isAbsoluteUrl) {\n            url = endpoint;\n        }\n\n        // 序列化请求数据\n        const requestData = JSON.stringify(data);\n        const xhr = new XMLHttpRequest();\n\n        // 状态变更回调\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4) {  // 请求完成\n                if (xhr.status === 200) {  // 成功响应\n                    let response = null;\n                    if (xhr.responseText !== \"\") {\n                        try {\n                            // 解析响应数据\n                            response = JSON.parse(xhr.responseText);\n                        } catch (e) {\n                            console.error(\"响应数据解析失败:\", e);\n                        }\n                    }\n                    successCallback?.(response);\n                } else {\n                    // 构造错误对象\n                    const error = {\n                        url: url,\n                        readyState: xhr.readyState,\n                        status: xhr.status,\n                        data: requestData\n                    };\n                    errorCallback?.(error);\n                }\n            }\n        };\n\n        // 初始化请求\n        xhr.open(method, url, true);\n        // 设置请求头（非GET请求）\n        if (method.toUpperCase() !== \"GET\") {\n            xhr.setRequestHeader(\"Content-type\", \"application/json; charset=utf-8\");\n            xhr.send(requestData);\n        } else {\n            xhr.send();\n        }\n    }\n\n    getplayerData(t) {\n        this.request(\"ot/gqsxz/savedata\", {\n            openId: t\n        }, function (t) {\n            console.log(\"-----------getplayerData:\", t);\n            if (0 == t.errno) {\n                t.data;\n            } else {\n                console.log(\"-----------获取用户数据:\", t);\n            }\n        }, function (t) {\n            console.log(\"getplayerData 调用失败\", t);\n        });\n    };\n\n}\n\n\n"]}