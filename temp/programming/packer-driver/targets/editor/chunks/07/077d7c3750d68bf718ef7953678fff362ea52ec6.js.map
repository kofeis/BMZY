{"version":3,"sources":["file:///Users/jingfaxie/Documents/UGit/ZhiShangGouBuDao/assets/Script/Game/GameMode/PanelIdiom.ts"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA","sourcesContent":["// import { _decorator, color, Component, find, Label, Layout, Node, Sprite, tween, Animation, v3, Vec3 } from 'cc';\n// import { PanelTemplate } from './PanelTemplate';\n// import { PlatformApi } from '../../Other/SDK/PlatformApi';\n// import { Tool_Animation } from '../../Tool/Tool_Animation';\n// import { Tool_Event } from '../../Tool/Tool_Event';\n// import { Tool_Other } from '../../Tool/Tool_Other';\n// import { Tool_UI } from '../../Tool/Tool_UI';\n// const { ccclass, property } = _decorator;\n\n// @ccclass('PanelIdiom')\n// export class PanelIdiom extends PanelTemplate {\n\n//     /**Key数据 */\n//     KeyData = null;\n\n//     /**Value字符串 */\n//     ValueStr: string = \"\";\n//     /**Value索引 */\n//     ValueIndex: number = 0;\n//     /**是否移动 */\n//     ValueMoveing: boolean = false;\n\n//     /**提示状态 */\n//     TipState: boolean = false;\n//     /**胜利界面 */\n//     PanelVictory: Node = null;\n\n//     /**返回按钮 */\n//     BtnBreak: Node = null;\n//     /**获取答案按钮 */\n//     BtnGet: Node = null;\n//     /**答案状态 */\n//     GetState: boolean = false;\n\n//     async onLoad() {\n//         super.onLoad();\n//     }\n\n//     async onEnable() {\n//         if (!this.IsInit) {\n//             await this.LoadPanel();\n//         }\n//         this.GameStart();\n//         this.Resoure_Data.Music_Play(\"Audio/BGMGame\");\n//     }\n\n//     async start() {\n\n//     }\n\n//     /**加载面板 */\n//     async LoadPanel(): Promise<void> {\n//         return new Promise(async (resolve, reject) => {\n//             /**绑定关键节点 */\n//             this.BtnSetting = find(\"BtnSetting\", this.node);\n//             this.BtnTip = find(\"BtnTip\", this.node);\n//             this.PanelTip = find(\"PanelTip\", this.node);\n//             this.BtnTipClose = find(\"BtnTipClose\", this.PanelTip);\n//             this.PanelVictory = find(\"PanelVictory\", this.node);\n//             this.BtnNext = find(\"BtnNext\", this.PanelVictory);\n//             this.BtnBreak = find(\"BtnBreak\", this.PanelVictory);\n//             this.BtnGet = find(\"BtnGet\", this.PanelTip);\n//             /**注册按钮事件 */\n//             await this.OnBtn(this.Game_Script.AnimSwitch);\n//             this.IsInit = true;\n//             resolve();\n//         });\n//     }\n\n//     /**注册按钮 */\n//     async OnBtn(AnimSwitch: boolean = false) {\n//         /**设置按钮 */\n//         const BtnSettingCall = () => {\n//             this.Resoure_Data.Sound_Play(\"Audio/SoundBtn\");\n//             this.Game_Script.UpdatePanelSetting(true);\n//         }\n//         /**提示按钮 */\n//         const BtnTipCall = () => {\n//             this.Resoure_Data.Sound_Play(\"Audio/SoundBtn\");\n//             if (this.TipState) {\n//                 this.PanelTip.active = true;\n//             } else {\n//                 const Call = () => {\n//                     this.TipState = true;\n//                     this.Game_Script.IsHint = true;\n//                     this.PanelTip.active = true;\n//                 }\n//                 if (this.Game_Script.PropNum > 0) {\n//                     this.Game_Script.PropNum--;\n//                     this.Game_Script.DataSet();\n//                     this.UpdatePropUI();\n//                     Call();\n//                 } else {\n//                     PlatformApi.instance.showVideoAd(async () => {\n//                         Call();\n//                     }, () => {\n\n//                     });\n//                 }\n//             }\n//         }\n//         /**关闭提示界面 */\n//         const BtnTipCloseCall = () => {\n//             this.Resoure_Data.Sound_Play(\"Audio/SoundBtn\");\n//             this.PanelTip.active = false;\n//         }\n//         /**下一关按钮 */\n//         const BtnNextCall = () => {\n//             this.Resoure_Data.Sound_Play(\"Audio/SoundBtn\");\n//             this.GameStart();\n//         }\n//         /**关闭按钮 */\n//         const BtnBreakCall = () => {\n//             this.Resoure_Data.Sound_Play(\"Audio/SoundBtn\");\n//             this.node.active = false;\n//         }\n//         /**获取答案 */\n//         const BtnGetCall = () => {\n//             this.Resoure_Data.Sound_Play(\"Audio/SoundBtn\");\n//             if (this.GetState) {\n//                 return;\n//             }\n//             this.GetState = true;\n//             let Grid = find(\"Window/Grid\", this.PanelTip);\n//             PlatformApi.instance.showVideoAd(async () => {\n//                 for (let i = 8; i < Grid.children.length; i++) {\n//                     Grid.children[i].getChildByName(\"Lock\").active = false;\n//                     Grid.children[i].getChildByName(\"Label\").active = !Grid.children[i].getChildByName(\"Lock\").active;\n//                 }\n//             }, () => {\n\n//             });\n//         }\n//         /**设置按钮事件 */\n//         Tool_Event.instance.On_Event_TOUCH_END(this.BtnSetting, BtnSettingCall);\n//         Tool_Event.instance.On_Event_TOUCH_END(this.BtnTip, BtnTipCall);\n//         Tool_Event.instance.On_Event_TOUCH_END(this.BtnTipClose, BtnTipCloseCall);\n//         Tool_Event.instance.On_Event_TOUCH_END(this.BtnNext, BtnNextCall);\n//         Tool_Event.instance.On_Event_TOUCH_END(this.BtnBreak, BtnBreakCall);\n//         Tool_Event.instance.On_Event_TOUCH_END(this.BtnGet, BtnGetCall);\n//         Tool_Event.instance.On_Event_TOUCH_END(this.PanelTip.getChildByName(\"Bg\"), () => {\n//             this.PanelTip.active = false;\n//         });\n//         /**设置按钮动画 */\n//         Tool_Event.instance.Set_Btn_Event_Anim(this.BtnSetting, AnimSwitch);\n//         Tool_Event.instance.Set_Btn_Event_Anim(this.BtnTip, AnimSwitch);\n//         Tool_Event.instance.Set_Btn_Event_Anim(this.BtnTipClose, AnimSwitch);\n//         Tool_Event.instance.Set_Btn_Event_Anim(this.BtnNext, AnimSwitch);\n//         Tool_Event.instance.Set_Btn_Event_Anim(this.BtnBreak, AnimSwitch);\n//         Tool_Event.instance.Set_Btn_Event_Anim(this.BtnGet, AnimSwitch);\n//         let Key = find(\"Key\", this.node);\n//         let Value = find(\"Value\", this.node);\n//         for (let i = 0; i < Value.children.length; i++) {\n//             Tool_Event.instance.On_Event_TOUCH_END(Value.children[i], () => {\n//                 if (this.ValueMoveing) {\n//                     return;\n//                 }\n//                 if (this.KeyData == null || this.KeyData == undefined) {\n//                     return;\n//                 }\n//                 if (Key.children[this.ValueIndex] == undefined) {\n//                     return;\n//                 }\n\n//                 this.Resoure_Data.Sound_Play(\"Audio/Sound/Click\");\n\n//                 this.ValueMoveing = true;\n//                 let PosStart = Value.children[i].position.clone();\n\n//                 // console.error(Value.children[i], Key.children[this.ValueIndex], this.ValueIndex, Key);\n\n//                 let PosEnd = Tool_UI.instance.Get_Target_Node_Local_Pos(Value.children[i], Key.children[this.ValueIndex]);\n\n//                 Tool_Animation.instance.Animation_Node_Move_Time(Value.children[i], PosEnd, 0.25, async () => {\n//                     let Char = Value.children[i].getChildByName(\"Label\").getComponent(Label).string;\n//                     let Result = this.GetResult(Char);\n//                     if (Result.isValid) {\n\n\n//                         if (this.ValueIndex % 4 == 1) {\n//                             /**首字正确 */\n//                             this.Resoure_Data.Sound_Play(\"Audio/Sound/FirstCorrect\");\n//                         }\n\n\n\n//                         Key.children[this.ValueIndex - 1].getChildByName(\"Label\").getComponent(Label).string = Char;\n//                         Value.children[i].active = false;\n//                         if (Result.isComplete) {\n//                             /**一组词音效 */\n//                             this.Resoure_Data.Sound_Play(\"Audio/Sound/YiZuCi\");\n//                             for (let j = 4; j > 0; j--) {\n//                                 tween(Key.children[this.ValueIndex - j])\n//                                     .by(0.25, { scale: v3(0.5, 0.5, 0) }, { easing: \"quadOut\" })\n//                                     .by(0.25, { scale: v3(-0.5, -0.5, 0) }, { easing: \"quadOut\" })\n//                                     .start();\n//                                 await Tool_Animation.instance.Async_Wait(0.05);\n//                             }\n//                         } else {\n//                             this.ValueMoveing = false;\n//                         }\n//                         await Tool_Animation.instance.Async_Wait(0.2);\n//                         this.ValueMoveing = false;\n//                         if (this.ValueIndex == Key.children.length) {\n//                             console.log(\"成语胜利\");\n//                             this.GameVictory();\n//                         }\n//                     } else {\n//                         /**错误 */\n//                         this.Resoure_Data.Sound_Play(\"Audio/Sound/Error\");\n//                         Tool_UI.instance.Set_Color_Sprite(Value.children[i].getChildByName(\"Bg\"), color(255, 0, 0, 255));\n//                         tween(Value.children[i])\n//                             .by(0.05, { position: v3(-25, 0, 0) }, { easing: \"quadOut\" })\n//                             .by(0.1, { position: v3(50, 0, 0) }, { easing: \"quadOut\" })\n//                             .by(0.05, { position: v3(-25, 0, 0) }, { easing: \"quadOut\" })\n//                             .call(() => {\n//                                 Tool_UI.instance.Set_Color_Sprite(Value.children[i].getChildByName(\"Bg\"), color(255, 227, 167, 255));\n//                                 Tool_Animation.instance.Animation_Node_Move_Time(Value.children[i], PosStart, 0.25, () => {\n//                                     this.ValueMoveing = false;\n//                                 });\n//                                 tween(Value.children[i])\n//                                     .to(0.25, { scale: v3(1, 1, 1) }, { easing: \"quadOut\" })\n//                                     .start();\n//                             })\n//                             .start();\n//                     }\n//                 });\n//                 tween(Value.children[i])\n//                     .to(0.25, { scale: v3(0.8, 0.8, 1) }, { easing: \"quadOut\" })\n//                     .start();\n//             });\n//         }\n//     }\n\n//     /**游戏开始 */\n//     async GameStart() {\n//         /**初始化数据 */\n//         await this.InitData();\n//         this.Game_Script.IsHint = false;\n//         this.Game_Script.IsContinue = false;\n//         this.PanelVictory.active = false;\n//         this.PanelTip.active = false;\n//         this.TipState = false;\n//         this.GetState = false;\n//         this.UpdatePropUI();\n//         if (this.KeyData == null || this.KeyData == undefined) {\n//             this.Game_Script.OnMessage(\"暂时没有新题目了\");\n//             return;\n//         }\n//         this.node.getChildByName(\"Title\").getChildByName(\"Leves\").getComponent(Label).string = `成语大王·第${this.Game_Script.IdiomLevel + 1}关`;\n//         let Text: string[] = [];\n//         for (let i = 0; i < this.KeyData.length; i++) {\n//             for (let j = 0; j < this.KeyData[i].length; j++) {\n//                 Text.push(this.KeyData[i].substring(j, j + 1));\n//             }\n//         }\n//         /**初始化提示界面 */\n//         let Grid = find(\"Window/Grid\", this.PanelTip);\n//         for (let i = 0; i < Grid.children.length; i++) {\n//             Grid.children[i].getChildByName(\"Label\").getComponent(Label).string = Text[i];\n//             Grid.children[i].getChildByName(\"Lock\").active = i >= 8 ? true : false;\n//             Grid.children[i].getChildByName(\"Label\").active = !Grid.children[i].getChildByName(\"Lock\").active;\n//         }\n//         Tool_Other.instance.Sort_Random(Text);\n//         console.log(Text);\n//         let Key = find(\"Key\", this.node);\n//         let Value = find(\"Value\", this.node);\n//         Tool_UI.instance.Component_On(Value, Layout);\n//         Value.getComponent(Layout).updateLayout();\n//         for (let i = 0; i < Key.children.length; i++) {\n//             Tool_Animation.instance.Tween_Stop_Target(Key.children[i]);\n//             Key.children[i].getChildByName(\"Label\").getComponent(Label).string = \"\";\n//             Key.children[i].scale = v3(1, 1, 1);\n//         }\n//         for (let i = 0; i < Value.children.length; i++) {\n//             Tool_Animation.instance.Tween_Stop_Target(Value.children[i]);\n//             Value.children[i].getChildByName(\"Label\").getComponent(Label).string = Text[i];\n//             Tool_UI.instance.Set_UIOpacity(Value.children[i], 255);\n//             Tool_UI.instance.Set_Color_Sprite(Value.children[i].getChildByName(\"Bg\"), color(255, 227, 167, 255));\n//             Value.children[i].scale = v3(1, 1, 1);\n//             Value.children[i].active = true;\n//             Tool_UI.instance.Set_UIOpacity(Value.children[i], 0);\n//         }\n//         /**入场节点 */\n//         let EntryNodes: Node[] = [];\n//         let PosEnd: Vec3[] = [];\n//         this.scheduleOnce(async () => {\n//             for (let i = 0; i < Value.children.length; i++) {\n//                 PosEnd.push(Value.children[i].position.clone());\n//                 EntryNodes.push(Value.children[i]);\n//             }\n//             Tool_UI.instance.Component_Off(Value, Layout);\n//             for (let i = 0; i < EntryNodes.length; i++) {\n//                 Tool_UI.instance.Set_Pos_X(EntryNodes[i], -640);\n//                 Tool_UI.instance.Set_UIOpacity(EntryNodes[i], 255);\n//                 // Tool_UI.instance.Node_Index_Set(EntryNodes[i], 0);\n//                 Tool_Animation.instance.Animation_Node_Move_Time(EntryNodes[i], PosEnd[i], 0.25);\n//                 await Tool_Animation.instance.Async_Wait(0.05);\n//             }\n//         });\n//     }\n\n//     /**游戏胜利 */\n//     async GameVictory() {\n//         /**胜利音效 */\n//         this.Resoure_Data.Sound_Play(\"Audio/Sound/Victory\");\n//         PlatformApi.instance.showInterstitialAd();\n//         this.Game_Script.IdiomLevel++;\n//         this.Game_Script.IdiomScore += this.Game_Script.IsHint ? 1 : 2;\n//         /**保存数据 */\n//         this.Game_Script.DataSet();\n//         this.Game_Script.UpdateScene();\n//         find(\"WinBanner/Condition1/Correct\", this.PanelVictory).active = !this.Game_Script.IsHint\n//         find(\"WinBanner/Condition1/Wrong\", this.PanelVictory).active = this.Game_Script.IsHint;\n//         find(\"WinBanner/Stars/StarR\", this.PanelVictory).getComponent(Sprite).grayscale = this.Game_Script.IsHint;\n//         find(\"Light\", this.PanelVictory).getComponent(Animation).play();\n//         this.PanelVictory.active = true;\n//     }\n\n//     /**刷新道具UI */\n//     UpdatePropUI() {\n//         const BtnTipLabel = this.BtnTip.getChildByName(\"PropNum\").getChildByName(\"Label\").getComponent(Label);\n//         const BtnTipNull = this.BtnTip.getChildByName(\"PropNum\").getChildByName(\"PropNumNull\");\n//         BtnTipLabel.string = `${this.Game_Script.PropNum}`;\n//         if (this.Game_Script.PropNum > 0) {\n//             BtnTipNull.active = false;\n//         } else {\n//             BtnTipNull.active = true;\n//         }\n//     }\n\n\n//     /**初始数据 */\n//     async InitData() {\n//         await this.GetData();\n//         this.ValueStr = \"\";\n//         this.ValueIndex = 0;\n//         this.ValueMoveing = false;\n//     }\n\n//     /**获取数据 */\n//     async GetData() {\n//         const Json = await this.Resoure_Data.Load_Json(\"Json/dioms\");\n//         const JsonData = Json[\"Data\"];\n//         if (this.Game_Script.IdiomLevel >= JsonData.length) {\n//             this.KeyData = JsonData[JsonData.length - 1];\n//         } else {\n//             this.KeyData = JsonData[this.Game_Script.IdiomLevel];\n//         }\n//     }\n\n//     /**获取结果 */\n//     GetResult(Char: string): { isValid: boolean, isComplete: boolean } {\n//         // 拼接新字符形成候选字符串\n//         const Candidate = this.ValueStr + Char;\n//         // 检查是否是完整成语\n//         const isComplete = this.KeyData.indexOf(Candidate);\n//         // 检查是否有成语以这个候选字符串开头\n//         const isValid = this.KeyData.some(Idiom => Idiom.startsWith(Candidate));\n//         if (isValid) {\n//             this.ValueIndex++;\n//         }\n//         if (isComplete !== -1) {\n//             // 如果是完整成语，重置当前拼接状态\n//             this.ValueStr = \"\";\n//             return { isValid: true, isComplete: true };\n//         } else if (isValid) {\n//             // 如果是有效部分，更新当前拼接状态\n//             this.ValueStr = Candidate;\n//             return { isValid: true, isComplete: false };\n//         } else {\n//             // 无效输入，重置当前拼接状态\n//             return { isValid: false, isComplete: false };\n//         }\n//     }\n\n\n// }\n\n\n\n\n\n\n"]}