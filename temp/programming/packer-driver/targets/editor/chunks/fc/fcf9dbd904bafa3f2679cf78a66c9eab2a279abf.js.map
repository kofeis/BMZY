{"version":3,"sources":["file:///D:/Cocos/Project/XH/assets/Script/Other/OpenContext.ts"],"names":["_decorator","Component","sys","ccclass","property","OpenContext","openContext","onLoad","start","platform","Platform","WECHAT_GAME","WECHAT_MINI_PROGRAM","wx","getOpenDataContext","testLevel","console","error","_reportUserLevel","postMessage","type","event","update","deltaTime","level","listener","target","setUserCloudStorage","KVDataList","key","value","success","apply","fail","err","log"],"mappings":";;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiCC,MAAAA,G,OAAAA,G;;;;;;;;;OAChD;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBJ,U;;6BAGjBK,W,WADZF,OAAO,CAAC,aAAD,C,gBAAR,MACaE,WADb,SACiCJ,SADjC,CAC2C;AAAA;AAAA;AAAA,eAE/BK,WAF+B;AAAA;;AAEb;AAG1BC,QAAAA,MAAM,GAAG,CAER;;AAEDC,QAAAA,KAAK,GAAG;AAGJ,cAAIN,GAAG,CAACO,QAAJ,KAAiBP,GAAG,CAACQ,QAAJ,CAAaC,WAA9B,IAA6CT,GAAG,CAACO,QAAJ,KAAiBP,GAAG,CAACQ,QAAJ,CAAaE,mBAA/E,EAAoG;AAChG;AACA,iBAAKN,WAAL,GAAmBO,EAAE,CAACC,kBAAH,EAAnB,CAFgG,CAEpD;;AAE5C,gBAAIC,SAAS,GAAG,CAAhB,CAJgG,CAI7E;;AACnBC,YAAAA,OAAO,CAACC,KAAR,CAAc,MAAd;;AACA,iBAAKC,gBAAL,CAAsBH,SAAtB,EAAiC,MAAM;AACnCC,cAAAA,OAAO,CAACC,KAAR,CAAc,QAAd;AACA,mBAAKX,WAAL,CAAiBa,WAAjB,CAA6B;AAAEC,gBAAAA,IAAI,EAAE,QAAR;AAAkBC,gBAAAA,KAAK,EAAE;AAAzB,eAA7B,EAFmC,CAE+B;AACrE,aAHD;AAIH;AACJ;;AAEDC,QAAAA,MAAM,CAACC,SAAD,EAAoB,CAEzB;;AAEOL,QAAAA,gBAAgB,CAACM,KAAD,EAAgBC,QAAhB,EAAqCC,MAArC,EAAmD;AAGvE;AACAb,UAAAA,EAAE,CAACc,mBAAH,CAAuB;AAAE;AACrBC,YAAAA,UAAU,EAAE,CACR;AAAEC,cAAAA,GAAG,EAAE,OAAP;AAAgBC,cAAAA,KAAK,EAAG,GAAEN,KAAM;AAAhC,aADQ,CADO;AAKnBO,YAAAA,OAAO,EAAE,MAAM;AACXN,cAAAA,QAAQ,QAAR,IAAAA,QAAQ,CAAEO,KAAV,CAAgBN,MAAhB;AACH,aAPkB;AASnBO,YAAAA,IAAI,EAAGC,GAAD,IAAc;AAChBlB,cAAAA,OAAO,CAACmB,GAAR,CAAY,qBAAZ,EAAmCD,GAAnC;AACH;AAXkB,WAAvB;AAaH;;AA9CsC,O","sourcesContent":["import { _decorator, Component, Node, SubContextView, sys } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('OpenContext')\nexport class OpenContext extends Component {\n\n    private openContext: any; // 子域对象\n\n\n    onLoad() {\n\n    }\n\n    start() {\n\n\n        if (sys.platform === sys.Platform.WECHAT_GAME || sys.platform === sys.Platform.WECHAT_MINI_PROGRAM) {\n            // @ts-ignore\n            this.openContext = wx.getOpenDataContext(); // 调用微信接口获取子域句柄，使用时需要检查\n\n            let testLevel = 5; // 测试数据\n            console.error(\"测试数据\");\n            this._reportUserLevel(testLevel, () => {\n                console.error(\"测试数据完成\");\n                this.openContext.postMessage({ type: 'engine', event: 'level' }); // level为自定义key，如果没有特殊需求，建议直接用。否则你的变动比较大，调整wx-sub-project/index.js的对应的key和this._reportUserLevel的key都需要对齐\n            });\n        }\n    }\n\n    update(deltaTime: number) {\n\n    }\n\n    private _reportUserLevel(level: number, listener?: Function, target?: any) {\n\n\n        // @ts-ignore\n        wx.setUserCloudStorage({ //调用微信接口上报关卡等级信息，用于好友圈排行\n            KVDataList: [\n                { key: 'level', value: `${level}` }\n            ],\n\n            success: () => {\n                listener?.apply(target);\n            },\n\n            fail: (err: any) => {\n                console.log('report level error:', err);\n            }\n        });\n    }\n}\n"]}